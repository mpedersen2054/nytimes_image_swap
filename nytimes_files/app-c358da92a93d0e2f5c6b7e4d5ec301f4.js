!function(t){"function"==typeof define&&define.amd?define("jquery-ajaxtransport-xdr",["jquery/nyt"],t):t(jQuery)}(function(t){if(!t.support.cors&&t.ajaxTransport&&window.XDomainRequest){var e=/^https?:\/\//i,i=/^get|post$/i,n=new RegExp("^"+location.protocol,"i");t.ajaxTransport("* text html xml json",function(s,o){if(s.crossDomain&&s.async&&i.test(s.type)&&e.test(s.url)&&n.test(s.url)){var r=null;return{send:function(e,i){var n="",a=(o.dataType||"").toLowerCase();r=new XDomainRequest,/^\d+$/.test(o.timeout)&&(r.timeout=o.timeout),r.ontimeout=function(){i(500,"timeout")},r.onload=function(){var e="Content-Length: "+r.responseText.length+"\r\nContent-Type: "+r.contentType,n={code:200,message:"success"},s={text:r.responseText};try{if("html"===a||/text\/html/i.test(r.contentType))s.html=r.responseText;else if("json"===a||"text"!==a&&/\/json/i.test(r.contentType))try{s.json=t.parseJSON(r.responseText)}catch(o){n.code=500,n.message="parseerror"}else if("xml"===a||"text"!==a&&/\/xml/i.test(r.contentType)){var l=new ActiveXObject("Microsoft.XMLDOM");l.async=!1;try{l.loadXML(r.responseText)}catch(o){l=void 0}if(!l||!l.documentElement||l.getElementsByTagName("parsererror").length)throw n.code=500,n.message="parseerror","Invalid XML: "+r.responseText;s.xml=l}}catch(d){throw d}finally{i(n.code,n.message,s,e)}},r.onprogress=function(){},r.onerror=function(){i(500,"error",{text:r.responseText})},o.data&&(n="string"===t.type(o.data)?o.data:t.param(o.data)),r.open(s.type,s.url),r.send(n)},abort:function(){r&&r.abort()}}}})}}),define("portal/tracker",["jquery/nyt","underscore/nyt"],function(t,e){var i=[],n=0,s=null,o=function(n){var s=new t.Deferred;if(window.TAGX){var o=i;i=[],e.each(o,function(t){e.isFunction(t[1])&&t[1](),t[0].resolve()}),e.isFunction(n)&&n(),s.resolve()}else i.push([s,n]);return s.promise()},r=function(){window.TAGX?o():s||(s=window.setInterval(function(){(window.TAGX||n>50)&&(window.clearInterval(s),window.TAGX&&o(),s=null),n+=1},200))},a=function(t,e){this.moduleName=t,this.constants=e};return a.prototype={track:function(t,i){var n=this.moduleName;t=this.constants?e.extend({},this.constants,t):t,o(function(){window.TAGX.EventProxy.trigger(n,t,i)}),r()}},a}),define("qute",["jquery/nyt","underscore/nyt"],function(t,e){var i=function(i){var n=i||!1,s=[],o=function(i){var o,r=new t.Deferred,a=e.isFunction(n)?n():n;return a?(o=s,s=[],e.each(o,function(t){e.isFunction(t[1])&&t[1](),t[0].resolve()}),e.isFunction(i)&&i(),r.resolve()):s.push([r,i]),r.promise()};return o.run=function(){n===!1&&(n=!0),o()},o};return i}),function(t){function e(t,e,i){switch(arguments.length){case 2:return null!=t?t:e;case 3:return null!=t?t:null!=e?e:i;default:throw new Error("Implement me")}}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function n(t,e){function i(){he.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}var n=!0;return d(function(){return n&&(i(),n=!1),e.apply(this,arguments)},e)}function s(t,e){return function(i){return h(t.call(this,i),e)}}function o(t,e){return function(i){return this.lang().ordinal(t.call(this,i),e)}}function r(){}function a(t){C(t),d(this,t)}function l(t){var e=y(t),i=e.year||0,n=e.quarter||0,s=e.month||0,o=e.week||0,r=e.day||0,a=e.hour||0,l=e.minute||0,d=e.second||0,c=e.millisecond||0;this._milliseconds=+c+1e3*d+6e4*l+36e5*a,this._days=+r+7*o,this._months=+s+3*n+12*i,this._data={},this._bubble()}function d(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return e.hasOwnProperty("toString")&&(t.toString=e.toString),e.hasOwnProperty("valueOf")&&(t.valueOf=e.valueOf),t}function c(t){var e,i={};for(e in t)t.hasOwnProperty(e)&&ke.hasOwnProperty(e)&&(i[e]=t[e]);return i}function u(t){return 0>t?Math.ceil(t):Math.floor(t)}function h(t,e,i){for(var n=""+Math.abs(t),s=t>=0;n.length<e;)n="0"+n;return(s?i?"+":"":"-")+n}function p(t,e,i,n){var s=e._milliseconds,o=e._days,r=e._months;n=null==n?!0:n,s&&t._d.setTime(+t._d+s*i),o&&ae(t,"Date",re(t,"Date")+o*i),r&&oe(t,re(t,"Month")+r*i),n&&he.updateOffset(t,o||r)}function f(t){return"[object Array]"===Object.prototype.toString.call(t)}function m(t){return"[object Date]"===Object.prototype.toString.call(t)||t instanceof Date}function g(t,e,i){var n,s=Math.min(t.length,e.length),o=Math.abs(t.length-e.length),r=0;for(n=0;s>n;n++)(i&&t[n]!==e[n]||!i&&w(t[n])!==w(e[n]))&&r++;return r+o}function v(t){if(t){var e=t.toLowerCase().replace(/(.)s$/,"$1");t=ei[t]||ii[e]||e}return t}function y(t){var e,i,n={};for(i in t)t.hasOwnProperty(i)&&(e=v(i),e&&(n[e]=t[i]));return n}function _(e){var i,n;if(0===e.indexOf("week"))i=7,n="day";else{if(0!==e.indexOf("month"))return;i=12,n="month"}he[e]=function(s,o){var r,a,l=he.fn._lang[e],d=[];if("number"==typeof s&&(o=s,s=t),a=function(t){var e=he().utc().set(n,t);return l.call(he.fn._lang,e,s||"")},null!=o)return a(o);for(r=0;i>r;r++)d.push(a(r));return d}}function w(t){var e=+t,i=0;return 0!==e&&isFinite(e)&&(i=e>=0?Math.floor(e):Math.ceil(e)),i}function S(t,e){return new Date(Date.UTC(t,e+1,0)).getUTCDate()}function b(t,e,i){return ee(he([t,11,31+e-i]),e,i).week}function E(t){return T(t)?366:365}function T(t){return t%4===0&&t%100!==0||t%400===0}function C(t){var e;t._a&&-2===t._pf.overflow&&(e=t._a[_e]<0||t._a[_e]>11?_e:t._a[we]<1||t._a[we]>S(t._a[ye],t._a[_e])?we:t._a[Se]<0||t._a[Se]>23?Se:t._a[be]<0||t._a[be]>59?be:t._a[Ee]<0||t._a[Ee]>59?Ee:t._a[Te]<0||t._a[Te]>999?Te:-1,t._pf._overflowDayOfYear&&(ye>e||e>we)&&(e=we),t._pf.overflow=e)}function k(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length)),t._isValid}function P(t){return t?t.toLowerCase().replace("_","-"):t}function x(t,e){return e._isUTC?he(t).zone(e._offset||0):he(t).local()}function D(t,e){return e.abbr=t,Ce[t]||(Ce[t]=new r),Ce[t].set(e),Ce[t]}function A(t){delete Ce[t]}function M(t){var e,i,n,s,o=0,r=function(t){if(!Ce[t]&&Pe)try{require("./lang/"+t)}catch(e){}return Ce[t]};if(!t)return he.fn._lang;if(!f(t)){if(i=r(t))return i;t=[t]}for(;o<t.length;){for(s=P(t[o]).split("-"),e=s.length,n=P(t[o+1]),n=n?n.split("-"):null;e>0;){if(i=r(s.slice(0,e).join("-")))return i;if(n&&n.length>=e&&g(s,n,!0)>=e-1)break;e--}o++}return he.fn._lang}function O(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function I(t){var e,i,n=t.match(Me);for(e=0,i=n.length;i>e;e++)n[e]=ai[n[e]]?ai[n[e]]:O(n[e]);return function(s){var o="";for(e=0;i>e;e++)o+=n[e]instanceof Function?n[e].call(s,t):n[e];return o}}function L(t,e){return t.isValid()?(e=R(e,t.lang()),ni[e]||(ni[e]=I(e)),ni[e](t)):t.lang().invalidDate()}function R(t,e){function i(t){return e.longDateFormat(t)||t}var n=5;for(Oe.lastIndex=0;n>=0&&Oe.test(t);)t=t.replace(Oe,i),Oe.lastIndex=0,n-=1;return t}function N(t,e){var i,n=e._strict;switch(t){case"Q":return He;case"DDDD":return We;case"YYYY":case"GGGG":case"gggg":return n?Ge:Re;case"Y":case"G":case"g":return $e;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return n?qe:Ne;case"S":if(n)return He;case"SS":if(n)return ze;case"SSS":if(n)return We;case"DDD":return Le;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Ue;case"a":case"A":return M(e._l)._meridiemParse;case"X":return je;case"Z":case"ZZ":return Ve;case"T":return Ye;case"SSSS":return Fe;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return n?ze:Ie;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Ie;case"Do":return Be;default:return i=new RegExp(W(z(t.replace("\\","")),"i"))}}function F(t){t=t||"";var e=t.match(Ve)||[],i=e[e.length-1]||[],n=(i+"").match(Qe)||["-",0,0],s=+(60*n[1])+w(n[2]);return"+"===n[0]?-s:s}function U(t,e,i){var n,s=i._a;switch(t){case"Q":null!=e&&(s[_e]=3*(w(e)-1));break;case"M":case"MM":null!=e&&(s[_e]=w(e)-1);break;case"MMM":case"MMMM":n=M(i._l).monthsParse(e),null!=n?s[_e]=n:i._pf.invalidMonth=e;break;case"D":case"DD":null!=e&&(s[we]=w(e));break;case"Do":null!=e&&(s[we]=w(parseInt(e,10)));break;case"DDD":case"DDDD":null!=e&&(i._dayOfYear=w(e));break;case"YY":s[ye]=he.parseTwoDigitYear(e);break;case"YYYY":case"YYYYY":case"YYYYYY":s[ye]=w(e);break;case"a":case"A":i._isPm=M(i._l).isPM(e);break;case"H":case"HH":case"h":case"hh":s[Se]=w(e);break;case"m":case"mm":s[be]=w(e);break;case"s":case"ss":s[Ee]=w(e);break;case"S":case"SS":case"SSS":case"SSSS":s[Te]=w(1e3*("0."+e));break;case"X":i._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=F(e);break;case"dd":case"ddd":case"dddd":n=M(i._l).weekdaysParse(e),null!=n?(i._w=i._w||{},i._w.d=n):i._pf.invalidWeekday=e;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":t=t.substr(0,1);case"gggg":case"GGGG":case"GGGGG":t=t.substr(0,2),e&&(i._w=i._w||{},i._w[t]=w(e));break;case"gg":case"GG":i._w=i._w||{},i._w[t]=he.parseTwoDigitYear(e)}}function V(t){var i,n,s,o,r,a,l,d;i=t._w,null!=i.GG||null!=i.W||null!=i.E?(r=1,a=4,n=e(i.GG,t._a[ye],ee(he(),1,4).year),s=e(i.W,1),o=e(i.E,1)):(d=M(t._l),r=d._week.dow,a=d._week.doy,n=e(i.gg,t._a[ye],ee(he(),r,a).year),s=e(i.w,1),null!=i.d?(o=i.d,r>o&&++s):o=null!=i.e?i.e+r:r),l=ie(n,s,o,a,r),t._a[ye]=l.year,t._dayOfYear=l.dayOfYear}function Y(t){var i,n,s,o,r=[];if(!t._d){for(s=B(t),t._w&&null==t._a[we]&&null==t._a[_e]&&V(t),t._dayOfYear&&(o=e(t._a[ye],s[ye]),t._dayOfYear>E(o)&&(t._pf._overflowDayOfYear=!0),n=J(o,0,t._dayOfYear),t._a[_e]=n.getUTCMonth(),t._a[we]=n.getUTCDate()),i=0;3>i&&null==t._a[i];++i)t._a[i]=r[i]=s[i];for(;7>i;i++)t._a[i]=r[i]=null==t._a[i]?2===i?1:0:t._a[i];t._d=(t._useUTC?J:K).apply(null,r),null!=t._tzm&&t._d.setUTCMinutes(t._d.getUTCMinutes()+t._tzm)}}function j(t){var e;t._d||(e=y(t._i),t._a=[e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond],Y(t))}function B(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function H(t){if(t._f===he.ISO_8601)return void q(t);t._a=[],t._pf.empty=!0;var e,i,n,s,o,r=M(t._l),a=""+t._i,l=a.length,d=0;for(n=R(t._f,r).match(Me)||[],e=0;e<n.length;e++)s=n[e],i=(a.match(N(s,t))||[])[0],i&&(o=a.substr(0,a.indexOf(i)),o.length>0&&t._pf.unusedInput.push(o),a=a.slice(a.indexOf(i)+i.length),d+=i.length),ai[s]?(i?t._pf.empty=!1:t._pf.unusedTokens.push(s),U(s,i,t)):t._strict&&!i&&t._pf.unusedTokens.push(s);t._pf.charsLeftOver=l-d,a.length>0&&t._pf.unusedInput.push(a),t._isPm&&t._a[Se]<12&&(t._a[Se]+=12),t._isPm===!1&&12===t._a[Se]&&(t._a[Se]=0),Y(t),C(t)}function z(t){return t.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,i,n,s){return e||i||n||s})}function W(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function G(t){var e,n,s,o,r;if(0===t._f.length)return t._pf.invalidFormat=!0,void(t._d=new Date(0/0));for(o=0;o<t._f.length;o++)r=0,e=d({},t),e._pf=i(),e._f=t._f[o],H(e),k(e)&&(r+=e._pf.charsLeftOver,r+=10*e._pf.unusedTokens.length,e._pf.score=r,(null==s||s>r)&&(s=r,n=e));d(t,n||e)}function q(t){var e,i,n=t._i,s=Xe.exec(n);if(s){for(t._pf.iso=!0,e=0,i=Je.length;i>e;e++)if(Je[e][1].exec(n)){t._f=Je[e][0]+(s[6]||" ");break}for(e=0,i=Ze.length;i>e;e++)if(Ze[e][1].exec(n)){t._f+=Ze[e][0];break}n.match(Ve)&&(t._f+="Z"),H(t)}else t._isValid=!1}function $(t){q(t),t._isValid===!1&&(delete t._isValid,he.createFromInputFallback(t))}function X(e){var i=e._i,n=xe.exec(i);i===t?e._d=new Date:n?e._d=new Date(+n[1]):"string"==typeof i?$(e):f(i)?(e._a=i.slice(0),Y(e)):m(i)?e._d=new Date(+i):"object"==typeof i?j(e):"number"==typeof i?e._d=new Date(i):he.createFromInputFallback(e)}function K(t,e,i,n,s,o,r){var a=new Date(t,e,i,n,s,o,r);return 1970>t&&a.setFullYear(t),a}function J(t){var e=new Date(Date.UTC.apply(null,arguments));return 1970>t&&e.setUTCFullYear(t),e}function Z(t,e){if("string"==typeof t)if(isNaN(t)){if(t=e.weekdaysParse(t),"number"!=typeof t)return null}else t=parseInt(t,10);return t}function Q(t,e,i,n,s){return s.relativeTime(e||1,!!i,t,n)}function te(t,e,i){var n=ve(Math.abs(t)/1e3),s=ve(n/60),o=ve(s/60),r=ve(o/24),a=ve(r/365),l=n<si.s&&["s",n]||1===s&&["m"]||s<si.m&&["mm",s]||1===o&&["h"]||o<si.h&&["hh",o]||1===r&&["d"]||r<=si.dd&&["dd",r]||r<=si.dm&&["M"]||r<si.dy&&["MM",ve(r/30)]||1===a&&["y"]||["yy",a];return l[2]=e,l[3]=t>0,l[4]=i,Q.apply({},l)}function ee(t,e,i){var n,s=i-e,o=i-t.day();return o>s&&(o-=7),s-7>o&&(o+=7),n=he(t).add("d",o),{week:Math.ceil(n.dayOfYear()/7),year:n.year()}}function ie(t,e,i,n,s){var o,r,a=J(t,0,1).getUTCDay();return a=0===a?7:a,i=null!=i?i:s,o=s-a+(a>n?7:0)-(s>a?7:0),r=7*(e-1)+(i-s)+o+1,{year:r>0?t:t-1,dayOfYear:r>0?r:E(t-1)+r}}function ne(e){var i=e._i,n=e._f;return null===i||n===t&&""===i?he.invalid({nullInput:!0}):("string"==typeof i&&(e._i=i=M().preparse(i)),he.isMoment(i)?(e=c(i),e._d=new Date(+i._d)):n?f(n)?G(e):H(e):X(e),new a(e))}function se(t,e){var i,n;if(1===e.length&&f(e[0])&&(e=e[0]),!e.length)return he();for(i=e[0],n=1;n<e.length;++n)e[n][t](i)&&(i=e[n]);return i}function oe(t,e){var i;return"string"==typeof e&&(e=t.lang().monthsParse(e),"number"!=typeof e)?t:(i=Math.min(t.date(),S(t.year(),e)),t._d["set"+(t._isUTC?"UTC":"")+"Month"](e,i),t)}function re(t,e){return t._d["get"+(t._isUTC?"UTC":"")+e]()}function ae(t,e,i){return"Month"===e?oe(t,i):t._d["set"+(t._isUTC?"UTC":"")+e](i)}function le(t,e){return function(i){return null!=i?(ae(this,t,i),he.updateOffset(this,e),this):re(this,t)}}function de(t){he.duration.fn[t]=function(){return this._data[t]}}function ce(t,e){he.duration.fn["as"+t]=function(){return+this/e}}function ue(t){"undefined"==typeof ender&&(pe=ge.moment,ge.moment=t?n("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",he):he)}for(var he,pe,fe,me="2.7.0",ge="undefined"!=typeof global?global:this,ve=Math.round,ye=0,_e=1,we=2,Se=3,be=4,Ee=5,Te=6,Ce={},ke={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_tzm:null,_isUTC:null,_offset:null,_pf:null,_lang:null},Pe="undefined"!=typeof module&&module.exports,xe=/^\/?Date\((\-?\d+)/i,De=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Ae=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Me=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Oe=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,Ie=/\d\d?/,Le=/\d{1,3}/,Re=/\d{1,4}/,Ne=/[+\-]?\d{1,6}/,Fe=/\d+/,Ue=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Ve=/Z|[\+\-]\d\d:?\d\d/gi,Ye=/T/i,je=/[\+\-]?\d+(\.\d{1,3})?/,Be=/\d{1,2}/,He=/\d/,ze=/\d\d/,We=/\d{3}/,Ge=/\d{4}/,qe=/[+-]?\d{6}/,$e=/[+-]?\d+/,Xe=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ke="YYYY-MM-DDTHH:mm:ssZ",Je=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Ze=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Qe=/([\+\-]|\d\d)/gi,ti=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),ei={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},ii={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ni={},si={s:45,m:45,h:22,dd:25,dm:45,dy:345},oi="DDD w W M D d".split(" "),ri="M D H h m s w W".split(" "),ai={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return h(this.year()%100,2)},YYYY:function(){return h(this.year(),4)},YYYYY:function(){return h(this.year(),5)},YYYYYY:function(){var t=this.year(),e=t>=0?"+":"-";return e+h(Math.abs(t),6)},gg:function(){return h(this.weekYear()%100,2)},gggg:function(){return h(this.weekYear(),4)},ggggg:function(){return h(this.weekYear(),5)},GG:function(){return h(this.isoWeekYear()%100,2)},GGGG:function(){return h(this.isoWeekYear(),4)},GGGGG:function(){return h(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return w(this.milliseconds()/100)},SS:function(){return h(w(this.milliseconds()/10),2)},SSS:function(){return h(this.milliseconds(),3)},SSSS:function(){return h(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+h(w(t/60),2)+":"+h(w(t)%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+h(w(t/60),2)+h(w(t)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},li=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];oi.length;)fe=oi.pop(),ai[fe+"o"]=o(ai[fe],fe);for(;ri.length;)fe=ri.pop(),ai[fe+fe]=s(ai[fe],2);for(ai.DDDD=s(ai.DDD,3),d(r.prototype,{set:function(t){var e,i;for(i in t)e=t[i],"function"==typeof e?this[i]=e:this["_"+i]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,i,n;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(i=he.utc([2e3,e]),n="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[e]=new RegExp(n.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,i,n;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(i=he([2e3,1]).day(e),n="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[e]=new RegExp(n.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,i){return t>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var i=this._calendar[t];return"function"==typeof i?i.apply(e):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,i,n){var s=this._relativeTime[i];return"function"==typeof s?s(t,e,i,n):s.replace(/%d/i,t)},pastFuture:function(t,e){var i=this._relativeTime[t>0?"future":"past"];return"function"==typeof i?i(e):i.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return ee(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),he=function(e,n,s,o){var r;return"boolean"==typeof s&&(o=s,s=t),r={},r._isAMomentObject=!0,r._i=e,r._f=n,r._l=s,r._strict=o,r._isUTC=!1,r._pf=i(),ne(r)},he.suppressDeprecationWarnings=!1,he.createFromInputFallback=n("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(t){t._d=new Date(t._i)}),he.min=function(){var t=[].slice.call(arguments,0);return se("isBefore",t)},he.max=function(){var t=[].slice.call(arguments,0);return se("isAfter",t)},he.utc=function(e,n,s,o){var r;return"boolean"==typeof s&&(o=s,s=t),r={},r._isAMomentObject=!0,r._useUTC=!0,r._isUTC=!0,r._l=s,r._i=e,r._f=n,r._strict=o,r._pf=i(),ne(r).utc()},he.unix=function(t){return he(1e3*t)},he.duration=function(t,e){var i,n,s,o=t,r=null;return he.isDuration(t)?o={ms:t._milliseconds,d:t._days,M:t._months}:"number"==typeof t?(o={},e?o[e]=t:o.milliseconds=t):(r=De.exec(t))?(i="-"===r[1]?-1:1,o={y:0,d:w(r[we])*i,h:w(r[Se])*i,m:w(r[be])*i,s:w(r[Ee])*i,ms:w(r[Te])*i}):(r=Ae.exec(t))&&(i="-"===r[1]?-1:1,s=function(t){var e=t&&parseFloat(t.replace(",","."));return(isNaN(e)?0:e)*i},o={y:s(r[2]),M:s(r[3]),d:s(r[4]),h:s(r[5]),m:s(r[6]),s:s(r[7]),w:s(r[8])}),n=new l(o),he.isDuration(t)&&t.hasOwnProperty("_lang")&&(n._lang=t._lang),n},he.version=me,he.defaultFormat=Ke,he.ISO_8601=function(){},he.momentProperties=ke,he.updateOffset=function(){},he.relativeTimeThreshold=function(e,i){return si[e]===t?!1:(si[e]=i,!0)},he.lang=function(t,e){var i;return t?(e?D(P(t),e):null===e?(A(t),t="en"):Ce[t]||M(t),i=he.duration.fn._lang=he.fn._lang=M(t),i._abbr):he.fn._lang._abbr},he.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),M(t)},he.isMoment=function(t){return t instanceof a||null!=t&&t.hasOwnProperty("_isAMomentObject")},he.isDuration=function(t){return t instanceof l},fe=li.length-1;fe>=0;--fe)_(li[fe]);he.normalizeUnits=function(t){return v(t)},he.invalid=function(t){var e=he.utc(0/0);return null!=t?d(e._pf,t):e._pf.userInvalidated=!0,e},he.parseZone=function(){return he.apply(null,arguments).parseZone()},he.parseTwoDigitYear=function(t){return w(t)+(w(t)>68?1900:2e3)},d(he.fn=a.prototype,{clone:function(){return he(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var t=he(this).utc();return 0<t.year()&&t.year()<=9999?L(t,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):L(t,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return k(this)},isDSTShifted:function(){return this._a?this.isValid()&&g(this._a,(this._isUTC?he.utc(this._a):he(this._a)).toArray())>0:!1},parsingFlags:function(){return d({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(t){var e=L(this,t||he.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var i;return i="string"==typeof t&&"string"==typeof e?he.duration(isNaN(+e)?+t:+e,isNaN(+e)?e:t):"string"==typeof t?he.duration(+e,t):he.duration(t,e),p(this,i,1),this},subtract:function(t,e){var i;return i="string"==typeof t&&"string"==typeof e?he.duration(isNaN(+e)?+t:+e,isNaN(+e)?e:t):"string"==typeof t?he.duration(+e,t):he.duration(t,e),p(this,i,-1),this},diff:function(t,e,i){var n,s,o=x(t,this),r=6e4*(this.zone()-o.zone());return e=v(e),"year"===e||"month"===e?(n=432e5*(this.daysInMonth()+o.daysInMonth()),s=12*(this.year()-o.year())+(this.month()-o.month()),s+=(this-he(this).startOf("month")-(o-he(o).startOf("month")))/n,s-=6e4*(this.zone()-he(this).startOf("month").zone()-(o.zone()-he(o).startOf("month").zone()))/n,"year"===e&&(s/=12)):(n=this-o,s="second"===e?n/1e3:"minute"===e?n/6e4:"hour"===e?n/36e5:"day"===e?(n-r)/864e5:"week"===e?(n-r)/6048e5:n),i?s:u(s)},from:function(t,e){return he.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(he(),t)},calendar:function(t){var e=t||he(),i=x(e,this).startOf("day"),n=this.diff(i,"days",!0),s=-6>n?"sameElse":-1>n?"lastWeek":0>n?"lastDay":1>n?"sameDay":2>n?"nextDay":7>n?"nextWeek":"sameElse";return this.format(this.lang().calendar(s,this))},isLeapYear:function(){return T(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?(t=Z(t,this.lang()),this.add({d:t-e})):e},month:le("Month",!0),startOf:function(t){switch(t=v(t)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t?this.weekday(0):"isoWeek"===t&&this.isoWeekday(1),"quarter"===t&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=v(t),this.startOf(t).add("isoWeek"===t?"week":t,1).subtract("ms",1)},isAfter:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+he(t).startOf(e)},isBefore:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+he(t).startOf(e)},isSame:function(t,e){return e=e||"ms",+this.clone().startOf(e)===+x(t,this).startOf(e)},min:n("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(t){return t=he.apply(null,arguments),this>t?this:t}),max:n("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(t){return t=he.apply(null,arguments),t>this?this:t}),zone:function(t,e){var i=this._offset||0;return null==t?this._isUTC?i:this._d.getTimezoneOffset():("string"==typeof t&&(t=F(t)),Math.abs(t)<16&&(t=60*t),this._offset=t,this._isUTC=!0,i!==t&&(!e||this._changeInProgress?p(this,he.duration(i-t,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,he.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(t){return t=t?he(t).zone():0,(this.zone()-t)%60===0},daysInMonth:function(){return S(this.year(),this.month())},dayOfYear:function(t){var e=ve((he(this).startOf("day")-he(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},quarter:function(t){return null==t?Math.ceil((this.month()+1)/3):this.month(3*(t-1)+this.month()%3)},weekYear:function(t){var e=ee(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==t?e:this.add("y",t-e)},isoWeekYear:function(t){var e=ee(this,1,4).year;return null==t?e:this.add("y",t-e)},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},isoWeek:function(t){var e=ee(this,1,4).week;return null==t?e:this.add("d",7*(t-e))},weekday:function(t){var e=(this.day()+7-this.lang()._week.dow)%7;return null==t?e:this.add("d",t-e)},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},isoWeeksInYear:function(){return b(this.year(),1,4)},weeksInYear:function(){var t=this._lang._week;return b(this.year(),t.dow,t.doy)},get:function(t){return t=v(t),this[t]()},set:function(t,e){return t=v(t),"function"==typeof this[t]&&this[t](e),this},lang:function(e){return e===t?this._lang:(this._lang=M(e),this)}}),he.fn.millisecond=he.fn.milliseconds=le("Milliseconds",!1),he.fn.second=he.fn.seconds=le("Seconds",!1),he.fn.minute=he.fn.minutes=le("Minutes",!1),he.fn.hour=he.fn.hours=le("Hours",!0),he.fn.date=le("Date",!0),he.fn.dates=n("dates accessor is deprecated. Use date instead.",le("Date",!0)),he.fn.year=le("FullYear",!0),he.fn.years=n("years accessor is deprecated. Use year instead.",le("FullYear",!0)),he.fn.days=he.fn.day,he.fn.months=he.fn.month,he.fn.weeks=he.fn.week,he.fn.isoWeeks=he.fn.isoWeek,he.fn.quarters=he.fn.quarter,he.fn.toJSON=he.fn.toISOString,d(he.duration.fn=l.prototype,{_bubble:function(){var t,e,i,n,s=this._milliseconds,o=this._days,r=this._months,a=this._data;a.milliseconds=s%1e3,t=u(s/1e3),a.seconds=t%60,e=u(t/60),a.minutes=e%60,i=u(e/60),a.hours=i%24,o+=u(i/24),a.days=o%30,r+=u(o/30),a.months=r%12,n=u(r/12),a.years=n},weeks:function(){return u(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*w(this._months/12)},humanize:function(t){var e=+this,i=te(e,!t,this.lang());return t&&(i=this.lang().pastFuture(e,i)),this.lang().postformat(i)},add:function(t,e){var i=he.duration(t,e);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(t,e){var i=he.duration(t,e);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(t){return t=v(t),this[t.toLowerCase()+"s"]()},as:function(t){return t=v(t),this["as"+t.charAt(0).toUpperCase()+t.slice(1)+"s"]()},lang:he.fn.lang,toIsoString:function(){var t=Math.abs(this.years()),e=Math.abs(this.months()),i=Math.abs(this.days()),n=Math.abs(this.hours()),s=Math.abs(this.minutes()),o=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(t?t+"Y":"")+(e?e+"M":"")+(i?i+"D":"")+(n||s||o?"T":"")+(n?n+"H":"")+(s?s+"M":"")+(o?o+"S":""):"P0D"}});for(fe in ti)ti.hasOwnProperty(fe)&&(ce(fe,ti[fe]),de(fe.toLowerCase()));ce("Weeks",6048e5),he.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},he.lang("en",{ordinal:function(t){var e=t%10,i=1===w(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+i}}),Pe?module.exports=he:"function"==typeof define&&define.amd?(define("moment",["require","exports","module"],function(t,e,i){return i.config&&i.config()&&i.config().noGlobal===!0&&(ge.moment=pe),he}),ue(!0)):ue()}.call(this),define("portal/config/feeds",{development:{current:"http://localhost:3000/api/v3/streams/portal",daily:"http://localhost:3000/api/v3/streams/portal/<%= date %>"},development_ievms:{current:"http://10.0.2.2:3000/api/v3/streams/portal",daily:"http://10.0.2.2:3000/api/v3/streams/portal/<%= date %>"},staging:{current:"http://homepage-portal.ast.int.newsdev.net/api/v3/streams/portal",daily:"http://homepage-portal.ast.int.newsdev.net/api/v3/streams/portal/<%= date %>"},production_published:{current:"http://int-cf.nyt.com/applications/portal/data/v3/streams.json",daily:"http://int-cf.nyt.com/applications/portal/data/v3/daily/<%= date %>.json"},production:{current:"http://homepage-portal.adm.int.newsdev.net/api/v3/streams/portal",daily:"http://homepage-portal.adm.int.newsdev.net/api/v3/streams/portal/<%= date %>"}}),define("portal/models/post",["jquery/nyt","underscore/nyt","backbone/nyt"],function(t,e,i){var n=/:\/\/[a-z.\-]*(nytimes.com|nyti.ms)[\:0-9]*(\/|\?|$)/,s=/(?:[a-z0-9]+\.)*[a-z0-9]+\.[a-z]+/,o=i.Model.extend({idAttribute:"id",defaults:{sticky:!1},initialize:function(){e.bindAll(this,"setCustomAttributes"),this.setCustomAttributes(),this.on("change",e.debounce(e.bind(function(){this.trigger("after-change")},this),200)),this.on("change:asset change:date_published change:live_window change:headline_style",this.setCustomAttributes)},setCustomAttributes:function(){0===this.get("date_published")&&this.set("date_published",Math.round((new Date).getTime()/1e3)),this.set("post_url",this.getAssetProp("url")),this.set("video_id","video"==this.getAssetProp("type")?this.getAssetProp("id"):null),this.checkLiveWindow()
},linkIsExternal:function(t){return t=t||this.get("post_url"),t&&!n.test(t)},isLinked:function(){return!!this.get("post_url")},getLinkHostname:function(t){var e=s.exec(t||this.get("post_url"));return e?e[0]:null},isVideo:function(){var t=this.get("headline_style");return"video"==t||"video_live"==t},hasNYTVideo:function(){return this.get("video_id")},getAssetProp:function(t){return(this.get("asset")||{})[t]},checkLiveWindow:function(){var t,e,i=this.get("live_window");i&&(t=Date.parse(new Date)/1e3,(i.start>t||i.end<t)&&(e=this.isVideo()?"video":"standard",this.set("headline_style",e)))},present:function(t){t=t||{};var i=e.chain(this.attributes).pick(e.keys(t)).reduce(function(t,i,n){return e.isNull(i)||(t[n]=i),t},{}).value();return e.defaults(i,t)}});return o}),define("portal/collections/posts",["jquery/nyt","underscore/nyt","backbone/nyt","moment","portal/config/feeds","portal/models/post"],function(t,e,i,n,s,o){var r=i.Collection.extend({model:o,order:[],initialize:function(t,i){this.options=e.defaults(i||{},{feed:"production_published",limit:0,date:null}),this.postsDate=this.options.date,this.fetchedDates=[],this.fetchErrors=0,this.maxErrors=4,this.on("sort",function(){var t=this.pluck("id");e.isEqual(t.slice(0,this.order.length),this.order)||this.trigger("reorder"),this.order=t},this)},parse:function(t){var i=e.isArray(t.streams)?t.streams[0]:t,n=e.reduce(i.clusters,function(t,e){return t.concat(e.posts)},[]);return this.options.limit?n.slice(0,this.options.limit):n},comparator:function(t,e){var i=t.get("sticky"),n=e.get("sticky");return i&&!n?-1:n&&!i?1:t.get("date_published")>e.get("date_published")?-1:1},url:function(){var t=s[this.options.feed];return this.postsDate?e.template(t.daily,{date:this.postsDate}):t.current},setPostsDate:function(t,e){return this.postsDate=t,this.fetch(e)},fetchCurrent:function(t){this.postsDate=null,this.fetch(e.extend(t,{remove:!1,timeout:15e3}))},canFetchPrevious:function(){return this.fetchErrors<this.maxErrors},fetchPreviousDay:function(){var i;if(!this.canFetchPrevious())return i=new t.Deferred,i.resolve(),i.promise();var s="YYYY-MM-DD",o=e.last(this.fetchedDates),r=this.size(),a=this.last().get("date_published"),l=o?n(o,s).subtract("days",1):n(1e3*a),d=l.format(s),c=function(t,e){t.fetchedDates.push(d),t.fetchErrors+=1,t.canFetchPrevious()&&4==e.readyState?t.fetchPreviousDay():(t.fetchErrors=t.maxErrors,t.trigger("lastDay"))};return this.setPostsDate(d,{timeout:7e3,remove:!1,success:function(t,e,i){var n=t.slice(r);n.length?(t.fetchErrors=0,t.fetchedDates.push(d),t.trigger("backfill",n)):c(t,i.xhr)},error:c})}});return r}),define("portal/views/base",["jquery/nyt","underscore/nyt","backbone/nyt"],function(t,e,i){var n=i.View.extend({setQsParams:function(t,i){var n="?"+e.map(i,function(t,e){return[encodeURIComponent(e),encodeURIComponent(t)].join("=")}).join("&");return-1!=t.indexOf("?")?t.replace("?",n+"&"):-1!=t.indexOf("#")?t.replace("#",n+"#"):t+n},setUrlProtocol:function(t){return this.options.nytapp?t.replace(/^https{0,1}/,"nytinteractive"):t},openHere:function(t){var e=document.defaultView&&document.defaultView.top!=window?document.defaultView.top:window;e.location.href=this.setUrlProtocol(t)},openNew:function(t){var e=this.setUrlProtocol(t);window.open(e)}});return n}),define("undercut",["underscore/nyt"],function(t){var e=function(t,e,i){this.setBase(t),this.partials={},this.mixins={},this.addPartial(e),this.addMixin(i)};return e.prototype={addTemplate:function(e,i){return t.isFunction(e)?e(i):t.template(e,i)},setBase:function(t){this.base=this.addTemplate(t)},addPartial:function(e,i,n){return e?void(1==arguments.length&&t.isObject(e)?t.each(e,function(t,e){this.partials[e]=this.addTemplate(t)},this):this.partials[e]=this.addTemplate(i,n)):!1},addMixin:function(e,i){return e?void(1==arguments.length&&t.isObject(e)?t.each(e,function(t,e){this.mixins[e]=t},this):this.mixins[e]=i):!1},prepare:function(e){e=t.extend({},e||{});var i=this.partials;return t.extend(e,this.mixins,{partial:function(n,s){var o=i[n];return o?t.isFunction(o)?o(t.extend(e,s)):o:void 0}})},render:function(t){return this.base(this.prepare(t))},renderPartial:function(t,e,i){var n=this.prepare(e);return n.partial(t,i)}},e}),define("portal/template_helpers",[],function(){var t=/"(?=\w)/g,e=/([?!,\.]{1})"$/g,i=/"/g,n=/'/g,s=/@([A-Za-z0-9_]+)/g,o=/#([A-Za-z0-9_]+)/g,r=/--/g,a=/^\s+|\s+$/gm,l=/^(?:\s|\&nbsp;)+|(?:\s|\&nbsp;)+$/gm,d=/\b((?:https?:(?:\/{1,3}|[a-z0-9%])|[a-z0-9.\-]+[.](?:com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|Ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)\/)(?:[^\s()<>{}\[\]]+|\([^\s()]*?\([^\s()]+\)[^\s()]*?\)|\([^\s]+?\))+(?:\([^\s()]*?\([^\s()]+\)[^\s()]*?\)|\([^\s]+?\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019])|(?:(?!@)[a-z0-9]+(?:[.\-][a-z0-9]+)*[.](?:com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|Ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)\b\/?(?!@)))/,c=function(s){return s.replace(e,"$1&#8221;").replace(t,"&#8220;").replace(i,"&#8221;").replace(n,"&#8217;")};return{linkTweetContent:function(t){return t.replace(s,'<a href="https://twitter.com/$1">@$1</a>').replace(o,'<a href="https://twitter.com/search?q=%23$1&src=hash">#$1</a>')},linkUrls:function(t){return t.replace(d,'<a href="$1">$1</a>')},timesStyle:function(t){return t.replace(r,"&#8212;")},toSmartQuotes:function(t){for(var e,i=[],n="",s="<";t.length;)e=t.indexOf(s),-1!=e?(n=t.substr(0,e),t=t.substr(e)):(n=t,t=""),"<"==s&&(n=c(n)),i.push(n),s="<"==s?">":"<";return i.join("")},trim:function(t,e){return String.prototype.trim?e===!0?t.replace(l,""):t.trim():e===!0?t.replace(l,""):t.replace(a,"")}}}),define("text",["module"],function(t){var e,i,n,s,o,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,c=d&&location.protocol&&location.protocol.replace(/\:/,""),u=d&&location.hostname,h=d&&(location.port||void 0),p={},f=t.config&&t.config()||{};return e={version:"2.0.12",strip:function(t){if(t){t=t.replace(a,"");var e=t.match(l);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;3>e;e+=1){i=r[e];try{t=new ActiveXObject(i)}catch(n){}if(t){r=[i];break}}return t},parseName:function(t){var e,i,n,s=!1,o=t.indexOf("."),r=0===t.indexOf("./")||0===t.indexOf("../");return-1!==o&&(!r||o>1)?(e=t.substring(0,o),i=t.substring(o+1,t.length)):e=t,n=i||e,o=n.indexOf("!"),-1!==o&&(s="strip"===n.substring(o+1),n=n.substring(0,o),i?i=n:e=n),{moduleName:e,ext:i,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,i,n,s){var o,r,a,l=e.xdRegExp.exec(t);return l?(o=l[2],r=l[3],r=r.split(":"),a=r[1],r=r[0],!(o&&o!==i||r&&r.toLowerCase()!==n.toLowerCase()||(a||r)&&a!==s)):!0},finishLoad:function(t,i,n,s){n=i?e.strip(n):n,f.isBuild&&(p[t]=n),s(n)},load:function(t,i,n,s){if(s&&s.isBuild&&!s.inlineText)return void n();f.isBuild=s&&s.isBuild;var o=e.parseName(t),r=o.moduleName+(o.ext?"."+o.ext:""),a=i.toUrl(r),l=f.useXhr||e.useXhr;return 0===a.indexOf("empty:")?void n():void(!d||l(a,c,u,h)?e.get(a,function(i){e.finishLoad(t,o.strip,i,n)},function(t){n.error&&n.error(t)}):i([r],function(t){e.finishLoad(o.moduleName+"."+o.ext,o.strip,t,n)}))},write:function(t,i,n){if(p.hasOwnProperty(i)){var s=e.jsEscape(p[i]);n.asModule(t+"!"+i,"define(function () { return '"+s+"';});\n")}},writeFile:function(t,i,n,s,o){var r=e.parseName(i),a=r.ext?"."+r.ext:"",l=r.moduleName+a,d=n.toUrl(r.moduleName+a)+".js";e.load(l,n,function(){var i=function(t){return s(d,t)};i.asModule=function(t,e){return s.asModule(t,d,e)},e.write(t,l,i,o)},o)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),e.get=function(t,e,n){try{var s=i.readFileSync(t,"utf8");0===s.indexOf("")&&(s=s.substring(1)),e(s)}catch(o){n&&n(o)}}):"xhr"===f.env||!f.env&&e.createXhr()?e.get=function(t,i,n,s){var o,r=e.createXhr();if(r.open("GET",t,!0),s)for(o in s)s.hasOwnProperty(o)&&r.setRequestHeader(o.toLowerCase(),s[o]);f.onXhr&&f.onXhr(r,t),r.onreadystatechange=function(){var e,s;4===r.readyState&&(e=r.status||0,e>399&&600>e?(s=new Error(t+" HTTP status: "+e),s.xhr=r,n&&n(s)):i(r.responseText),f.onXhrComplete&&f.onXhrComplete(r,t))},r.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?e.get=function(t,e){var i,n,s="utf-8",o=new java.io.File(t),r=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),s)),l="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(r),i.append(n);l=String(i.toString())}finally{a.close()}e(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in n,e.get=function(t,e){var i,r,a,l={};o&&(t=t.replace(/\//g,"\\")),a=new FileUtils.File(t);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),i.init(a,1,0,!1),r=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),r.init(i,"utf-8",i.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(i.available(),l),r.close(),i.close(),e(l.value)}catch(d){throw new Error((a&&a.path||"")+": "+d)}}),e}),define("text!portal/templates/share.ejs.html",[],function(){return'<div class="portal-post-sharetools"></div>\n<div class="modal-pointer modal-pointer-right">\n  <div class="modal-pointer-conceal"></div>\n</div>'}),define("portal/views/share",["jquery/nyt","underscore/nyt","backbone/nyt","shared/sharetools/views/sharetools","portal/template_helpers","text!portal/templates/share.ejs.html"],function(t,e,i,n,s,o){if(n&&n.notImplemented)return{notImplemented:!0};var r=/(<([^>]+)>)/gi,a=/&nbsp;/gi,l=e.reduce({standard:'<%= (title) ? title + ": " : "" %><%= summaryText %>',quote:'"<%= summaryText %>"'},function(t,i,n){return t[n]=e.template(i),t},{}),d=i.View.extend({tagName:"div",className:"post-share-content modal",events:{mouseenter:"persist",mouseleave:"hide",click:"hide"},initialize:function(i){this.options=e.defaults(i||{},{trigger:t()}),this.post=this.options.post,this.template=e.template(o),this.render(),this.initSharetools(this.present())},initSharetools:function(i){var s=this.post.model,o=s.get("post_url"),r=[{type:"twitter",label:"Twitter"}],a=l[s.get("headline_style")]||l.standard,d=a(i),c={url:o,title:d,inlineTools:r};o&&r.unshift({type:"facebook",label:"Facebook"}),o&&!s.linkIsExternal()&&r.unshift({type:"email",label:"Email"}),t(".portal-post-sharetools",this.el).each(function(){var t=new n(e.extend({},c,{el:this}));(!o||s.linkIsExternal())&&(t.handleShortUrlShareAction=function(e){var i=window.open("",e.label+"Share","toolbar=0,status=0,height="+e.height+",width="+e.width+",scrollbars=yes,resizable=yes");t.shortUrlRedirect(o||"http://www.nytimes.com",e,i)})})},mergeSummaries:function(){return e.pluck(this.post.model.get("summaries")||[],"body").join(" ").replace(r,"").replace(a," ")},present:function(){var t={summaries:[],title:null,footer:null,summaryText:this.mergeSummaries(),headline_style:null};return this.post.model.present(t)},persist:function(){window.clearTimeout(this.hideId)},show:function(){this.persist(),this.position(),this.$el.fadeIn(200),this.post.$el.addClass("share-active")},hide:function(t){var e=this.$el,i=this.post.$el;"click"==t.type?(e.css("display","none"),i.removeClass("share-active")):this.hideId=window.setTimeout(function(){e.css("display","none"),i.removeClass("share-active")},300)},position:function(){var e=t(window),i=this.getPointer(),n=this.getMeasurements(),s=e.scrollTop(),o=s+e.height(),r=this.post.$el.offset(),a=this.options.trigger.offset().top,l=a+n.triggerMiddle,d=r.left-n.width,c=l-n.middle,u="auto",h="auto",p=5;s+p>c?(c=s+p,u=l-c-n.pointerMiddle,0>u&&(u=p)):c+n.height>o-p?(c=o-p-n.height,u=l-c-n.pointerMiddle,u>n.height-n.pointerHeight&&(u="auto",h=p)):u=n.middle-n.pointerMiddle,i.css({top:u,bottom:h}),this.$el.css({top:c,left:d-10})},getPointer:function(){return this.$pointer||(this.$pointer=this.$el.find(".modal-pointer")),this.$pointer},getMeasurements:function(){var t;return this.measurements||(t=this.getPointer(),this.$el.css({display:"block",visibility:"hidden"}),this.measurements={width:this.$el.outerWidth(),height:this.$el.outerHeight(),triggerHeight:this.options.trigger.outerHeight(),pointerHeight:t.outerHeight()},e.extend(this.measurements,{middle:this.measurements.height/2,pointerMiddle:this.measurements.pointerHeight/2,triggerMiddle:this.measurements.triggerHeight/2}),this.$el.css({display:"none",visibility:"visible"})),this.measurements},render:function(){this.$el[0].parentNode||this.$el.appendTo("body"),this.$pointer=null,this.measurements=null,this.$el.empty().append(t(this.template()))}});return d}),define("twitter_intents",["jquery/nyt"],function(t){function e(e){var i=t(e),n=i.is("a")?i:i.parents("a"),o=n.get(0);return o&&o.href.match(s)?o:null}function i(t,e){var i,n;t&&t.href&&(i=Math.round(d/2-r/2),n=0,l>a&&(n=Math.round(l/2-a/2)),e===!0?window.location.href=t.href:window.open(t.href,"intent",o+",width="+r+",height="+a+",left="+i+",top="+n))}function n(t){t=t||window.event;var n=e(t.target||t.srcElement);n&&(i(n),t.returnValue=!1,t.preventDefault&&t.preventDefault())}if(window.__twitterIntentHandler)return{enable:function(){}};var s=/twitter\.com(\:\d{2,4})?\/intent\/(\w+)/,o="scrollbars=yes,resizable=yes,toolbar=no,location=yes",r=550,a=420,l=screen.height,d=screen.width;return{enable:function(e){var i=t(e);i.length&&i.on("click",n)},getIntent:e,openIntent:i}}),function(t,e){"function"==typeof define&&define.amd?define("swfobject/vhs",e):t.swfobject=e()}(this,function(){var t=function(){function e(){if(!z){try{var t=F.getElementsByTagName("body")[0].appendChild(v("span"));t.parentNode.removeChild(t)}catch(e){return}z=!0;for(var i=Y.length,n=0;i>n;n++)Y[n]()}}function i(t){z?t():Y[Y.length]=t}function n(t){if(typeof N.addEventListener!=D)N.addEventListener("load",t,!1);else if(typeof F.addEventListener!=D)F.addEventListener("load",t,!1);else if(typeof N.attachEvent!=D)y(N,"onload",t);else if("function"==typeof N.onload){var e=N.onload;N.onload=function(){e(),t()}}else N.onload=t}function s(){V?o():r()}function o(){var t=F.getElementsByTagName("body")[0],e=v(A);e.setAttribute("type",I);var i=t.appendChild(e);if(i){var n=0;!function(){if(typeof i.GetVariable!=D){var s=i.GetVariable("$version");s&&(s=s.split(" ")[1].split(","),q.pv=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)])}else if(10>n)return n++,void setTimeout(arguments.callee,10);t.removeChild(e),i=null,r()}()}else r()}function r(){var t=j.length;if(t>0)for(var e=0;t>e;e++){var i=j[e].id,n=j[e].callbackFn,s={success:!1,id:i};if(q.pv[0]>0){var o=g(i);if(o)if(!_(j[e].swfVersion)||q.wk&&q.wk<312)if(j[e].expressInstall&&l()){var r={};r.data=j[e].expressInstall,r.width=o.getAttribute("width")||"0",r.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(r.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(r.align=o.getAttribute("align"));for(var u={},h=o.getElementsByTagName("param"),p=h.length,f=0;p>f;f++)"movie"!=h[f].getAttribute("name").toLowerCase()&&(u[h[f].getAttribute("name")]=h[f].getAttribute("value"));d(r,u,i,n)}else c(o),n&&n(s);else S(i,!0),n&&(s.success=!0,s.ref=a(i),n(s))}else if(S(i,!0),n){var m=a(i);m&&typeof m.SetVariable!=D&&(s.success=!0,s.ref=m),n(s)}}}function a(t){var e=null,i=g(t);if(i&&"OBJECT"==i.nodeName)if(typeof i.SetVariable!=D)e=i;else{var n=i.getElementsByTagName(A)[0];n&&(e=n)}return e}function l(){return!W&&_("6.0.65")&&(q.win||q.mac)&&!(q.wk&&q.wk<312)}function d(t,e,i,n){W=!0,C=n||null,k={success:!1,id:i};var s=g(i);if(s){"OBJECT"==s.nodeName?(E=u(s),T=null):(E=s,T=i),t.id=L,(typeof t.width==D||!/%$/.test(t.width)&&parseInt(t.width,10)<310)&&(t.width="310"),(typeof t.height==D||!/%$/.test(t.height)&&parseInt(t.height,10)<137)&&(t.height="137"),F.title=F.title.slice(0,47)+" - Flash Player Installation";var o=q.ie&&q.win?"ActiveX":"PlugIn",r="MMredirectURL="+N.location.toString().replace(/&/g,"%26")+"&MMplayerType="+o+"&MMdoctitle="+F.title;if(typeof e.flashvars!=D?e.flashvars+="&"+r:e.flashvars=r,q.ie&&q.win&&4!=s.readyState){var a=v("div");i+="SWFObjectNew",a.setAttribute("id",i),s.parentNode.insertBefore(a,s),s.style.display="none",function(){4==s.readyState?s.parentNode.removeChild(s):setTimeout(arguments.callee,10)}()}h(t,e,i)}}function c(t){if(q.ie&&q.win&&4!=t.readyState){var e=v("div");t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(u(t),e),t.style.display="none",function(){4==t.readyState?t.parentNode.removeChild(t):setTimeout(arguments.callee,10)}()}else t.parentNode.replaceChild(u(t),t)}function u(t){var e=v("div");if(q.win&&q.ie)e.innerHTML=t.innerHTML;else{var i=t.getElementsByTagName(A)[0];if(i){var n=i.childNodes;if(n)for(var s=n.length,o=0;s>o;o++)1==n[o].nodeType&&"PARAM"==n[o].nodeName||8==n[o].nodeType||e.appendChild(n[o].cloneNode(!0))}}return e}function h(t,e,i){var n,s=g(i);if(q.wk&&q.wk<312)return n;if(s)if(typeof t.id==D&&(t.id=i),q.ie&&q.win){var o="";for(var r in t)t[r]!=Object.prototype[r]&&("data"==r.toLowerCase()?e.movie=t[r]:"styleclass"==r.toLowerCase()?o+=' class="'+t[r]+'"':"classid"!=r.toLowerCase()&&(o+=" "+r+'="'+t[r]+'"'));var a="";for(var l in e)e[l]!=Object.prototype[l]&&(a+='<param name="'+l+'" value="'+e[l]+'" />');s.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+o+">"+a+"</object>",B[B.length]=t.id,n=g(t.id)}else{var d=v(A);d.setAttribute("type",I);for(var c in t)t[c]!=Object.prototype[c]&&("styleclass"==c.toLowerCase()?d.setAttribute("class",t[c]):"classid"!=c.toLowerCase()&&d.setAttribute(c,t[c]));for(var u in e)e[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&p(d,u,e[u]);s.parentNode.replaceChild(d,s),n=d}return n}function p(t,e,i){var n=v("param");n.setAttribute("name",e),n.setAttribute("value",i),t.appendChild(n)}function f(t){var e=g(t);e&&"OBJECT"==e.nodeName&&(q.ie&&q.win?(e.style.display="none",function(){4==e.readyState?m(t):setTimeout(arguments.callee,10)}()):e.parentNode.removeChild(e))}function m(t){var e=g(t);if(e){for(var i in e)"function"==typeof e[i]&&(e[i]=null);e.parentNode.removeChild(e)}}function g(t){var e=null;try{e=F.getElementById(t)}catch(i){}return e}function v(t){return F.createElement(t)}function y(t,e,i){t.attachEvent(e,i),H[H.length]=[t,e,i]}function _(t){var e=q.pv,i=t.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,e[0]>i[0]||e[0]==i[0]&&e[1]>i[1]||e[0]==i[0]&&e[1]==i[1]&&e[2]>=i[2]?!0:!1}function w(t,e,i,n){if(!q.ie||!q.mac){var s=F.getElementsByTagName("head")[0];if(s){var o=i&&"string"==typeof i?i:"screen";if(n&&(P=null,x=null),!P||x!=o){var r=v("style");r.setAttribute("type","text/css"),r.setAttribute("media",o),P=s.appendChild(r),q.ie&&q.win&&typeof F.styleSheets!=D&&F.styleSheets.length>0&&(P=F.styleSheets[F.styleSheets.length-1]),x=o}q.ie&&q.win?P&&typeof P.addRule==A&&P.addRule(t,e):P&&typeof F.createTextNode!=D&&P.appendChild(F.createTextNode(t+" {"+e+"}"))}}}function S(t,e){if(G){var i=e?"visible":"hidden";z&&g(t)?g(t).style.visibility=i:w("#"+t,"visibility:"+i)}}function b(t){var e=/[\\\"<>\.;]/,i=null!=e.exec(t);return i&&typeof encodeURIComponent!=D?encodeURIComponent(t):t}var E,T,C,k,P,x,D="undefined",A="object",M="Shockwave Flash",O="ShockwaveFlash.ShockwaveFlash",I="application/x-shockwave-flash",L="SWFObjectExprInst",R="onreadystatechange",N=window,F=document,U=navigator,V=!1,Y=[s],j=[],B=[],H=[],z=!1,W=!1,G=!0,q=function(){var t=typeof F.getElementById!=D&&typeof F.getElementsByTagName!=D&&typeof F.createElement!=D,e=U.userAgent.toLowerCase(),i=U.platform.toLowerCase(),n=/win/.test(i?i:e),s=/mac/.test(i?i:e),o=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,r=!1,a=[0,0,0],l=null;if(typeof U.plugins!=D&&typeof U.plugins[M]==A)l=U.plugins[M].description,!l||typeof U.mimeTypes!=D&&U.mimeTypes[I]&&!U.mimeTypes[I].enabledPlugin||(V=!0,r=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),a[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),a[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof N.ActiveXObject!=D)try{var d=new ActiveXObject(O);d&&(l=d.GetVariable("$version"),l&&(r=!0,l=l.split(" ")[1].split(","),a=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]))}catch(c){}return{w3:t,pv:a,wk:o,ie:r,win:n,mac:s}}();return!function(){q.w3&&((typeof F.readyState!=D&&"complete"==F.readyState||typeof F.readyState==D&&(F.getElementsByTagName("body")[0]||F.body))&&e(),z||(typeof F.addEventListener!=D&&F.addEventListener("DOMContentLoaded",e,!1),q.ie&&q.win&&(F.attachEvent(R,function(){"complete"==F.readyState&&(F.detachEvent(R,arguments.callee),e())}),N==top&&!function(){if(!z){try{F.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),q.wk&&!function(){return z?void 0:/loaded|complete/.test(F.readyState)?void e():void setTimeout(arguments.callee,0)}(),n(e)))}(),function(){q.ie&&q.win&&window.attachEvent("onunload",function(){for(var e=H.length,i=0;e>i;i++)H[i][0].detachEvent(H[i][1],H[i][2]);for(var n=B.length,s=0;n>s;s++)f(B[s]);for(var o in q)q[o]=null;q=null;for(var r in t)t[r]=null;t=null})}(),{registerObject:function(t,e,i,n){if(q.w3&&t&&e){var s={};s.id=t,s.swfVersion=e,s.expressInstall=i,s.callbackFn=n,j[j.length]=s,S(t,!1)}else n&&n({success:!1,id:t})},getObjectById:function(t){return q.w3?a(t):void 0},embedSWF:function(t,e,n,s,o,r,a,c,u,p){var f={success:!1,id:e};q.w3&&!(q.wk&&q.wk<312)&&t&&e&&n&&s&&o?(S(e,!1),i(function(){n+="",s+="";var i={};if(u&&typeof u===A)for(var m in u)i[m]=u[m];i.data=t,i.width=n,i.height=s;var g={};if(c&&typeof c===A)for(var v in c)g[v]=c[v];if(a&&typeof a===A)for(var y in a)typeof g.flashvars!=D?g.flashvars+="&"+y+"="+a[y]:g.flashvars=y+"="+a[y];if(_(o)){var w=h(i,g,e);i.id==e&&S(e,!0),f.success=!0,f.ref=w}else{if(r&&l())return i.data=r,void d(i,g,e,p);S(e,!0)}p&&p(f)})):p&&p(f)},switchOffAutoHideShow:function(){G=!1},ua:q,getFlashPlayerVersion:function(){return{major:q.pv[0],minor:q.pv[1],release:q.pv[2]}},hasFlashPlayerVersion:_,createSWF:function(t,e,i){return q.w3?h(t,e,i):void 0},showExpressInstall:function(t,e,i,n){q.w3&&l()&&d(t,e,i,n)},removeSWF:function(t){q.w3&&f(t)},createCSS:function(t,e,i,n){q.w3&&w(t,e,i,n)},addDomLoadEvent:i,addLoadEvent:n,getQueryParamValue:function(t){var e=F.location.search||F.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return b(e);for(var i=e.split("&"),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf("="))==t)return b(i[n].substring(i[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(W){var t=g(L);t&&E&&(t.parentNode.replaceChild(E,t),T&&(S(T,!0),q.ie&&q.win&&(E.style.display="block")),C&&C(k)),W=!1}}}}();return t}),function(t,e){"object"==typeof exports?module.exports=e(require("$"),require("swfobject")):"function"==typeof define&&define.amd?define("vhs",["jquery/nyt","swfobject/vhs"],e):t.VHS=e(t.$,t.swfobject)}(this,function(t,e){var i=t,n=function(e){return{ready:function(i){var n,s,o=t(e);o.bind("ready",function(t,e){i(e)}),o.each(function(e,i){s=t(i).data("ready"),s&&(n=t(i).data("instance"),t(i).trigger("ready",n))})},loaded:function(i){var n,s,o=t(e);o.bind("loaded",function(t,e){i(e)}),o.each(function(e,i){s=t(i).data("loaded"),s&&(n=t(i).data("instance"),t(i).trigger("loaded",n))})}}};return n.config={allowMultiplePlayers:!1},n.api=n.api||{},n.html=n.html||{},n.util={extend:function(t){function e(){}return Object.create?Object.create(t):(e.prototype=t,new e)},checkFlashSupport:function(){var t=e.getFlashPlayerVersion();return t&&t.major>=10},checkHtmlSupport:function(){var t=document.createElement("video"),e=document.createElement("canvas").getContext,i=!1;return t&&e&&(i=!0),i},supportH264:function(){var t=document.createElement("video"),e='video/mp4; codecs="avc1.42E01E"',i='video/mp4; codecs="avc1.42E01E, mp4a.40.2"',n=!1;return t.canPlayType&&(n=""!==(t.canPlayType(e)||t.canPlayType(i))),n},getDeviceType:function(){for(var t=null,e=navigator.userAgent.toLowerCase(),i=[["android_chrome","(android.*chrome)"],["android_firefox","(android.*firefox)"],["android_legacy","(android )(2|3)"],["android_ics","(android 4.0)"],["android_jellybean","(android 4.)(1|2|3)"],["android_kitkat","(android 4.4)"],["ie_mobile","(windows phone os).*(iemobile)"],["ipad","ipad"],["kindle","kindle"],["iphone","iphone"],["other mobile","(touchpad|blackberry|opera mobi)"]],n=0;n<i.length;n++){var s=new RegExp(i[n][1]),o=e.match(s);null!==o&&(t=i[n][0])}return t||"desktop"},isIphone:function(){var t=navigator.userAgent.toLowerCase(),e=t.match("iphone"),i=null!==e?!0:!1;return i}},n.api.Logger=function(t){this.debug=t.options.debug,this.canConsole=t.options.debug&&window.console},n.api.Logger.prototype={log:function(){this.canConsole&&window.console.log(arguments)},info:function(){this.canConsole&&window.console.info(arguments)},warn:function(){this.canConsole&&window.console.warn(arguments)},error:function(){this.canConsole&&window.console.error(arguments)}},n.plugin=function(t,e,i){var s=i||!1,o=n.api._plugins||{};return o[t]={enable:s,proto:e},n.api._plugins=o,o},n.api.Plugins=function(t){this.player=t,this._plugins=n.api._plugins,this._pluginInstances=[],this.register()},n.api.Plugins.prototype.register=function(){var t,e,i=this,n=this.player.options,s=function(){this._player=i.player,this._container=i.player.container,this._element=i.player.element,this._data=i.player._data,this._options=i.player.options,this._logger=i.player.logger};for(t in this._plugins)(n[t]===!0||this._plugins[t].enable===!0)&&(s.prototype=this._plugins[t].proto,e=new s,this._pluginInstances.push(e),"function"==typeof e._initialize&&e._initialize(),this.listeners(e))},n.api.Plugins.prototype.reload=function(){var t,e;for(t in this._pluginInstances)e=this._pluginInstances[t],e._data=this.player._data},n.api.Plugins.prototype.listeners=function(t){var e=function(e,i){"function"==typeof t[i]&&this.player.on(n.api.events[e],function(e){t[i](e)})},i={READY:"_ready",LOADED:"_loaded",PLAY:"_play",PAUSE:"_pause",MUTE:"_mute",SEEKED:"_seeked",ENDED:"_ended",PLAYING:"_playing",AD_STARTED:"_ad_started",AD_COMPLETED:"_ad_completed",AD_PAUSED:"_ad_paused",AD_RESUMED:"_ad_resumed",AD_SKIPPED:"_ad_skipped",GO_FULLSCREEN:"_go_fullscreen",EXIT_FULLSCREEN:"_exit_fullscreen",PROGRESS:"_progress",TIME_UPDATE:"_time_update",LOAD_START:"_loadstart",ERROR:"_error"};for(var s in i)i.hasOwnProperty(s)&&e.call(this,s,i[s])},n.plugin("webtrends",{_initialize:function(){this.utils=n.util,this.tracked=!1,this.firstPlay=!0,this.trackingHistory=[]},getId:function(){if(this._data||this._options.id){var t=this._data?this._data.id:this._options.id;return t}return this._logger.warn("VHS::PLUGIN::WEBTRENDS:: ID is not defined"),!1},getName:function(){if(this._data||this._options.name){var t=this._data?this._data.headline:this._options.name;return t}return this._logger.warn('VHS::PLUGIN::WEBTRENDS:: NAME is optional <video data-setup=\'{"name: "name_video"}\'></video>'),!1},getCategory:function(){var t;if(this._data)this._data.section&&(t=this._data.section.content);else{if(!this._options.category)return this._logger.warn('VHS::PLUGIN::WEBTRENDS:: CATEGORY is optional <video data-setup=\'{"category: "category_video"}\'></video>'),!1;t=this._options.category}return t},getSeries:function(){var t="";if(this._data)this._data.contentSeries&&(t=this._data.contentSeries.name);else{if(!this._options.series)return this._logger.warn('VHS::PLUGIN::WEBTRENDS:: SERIES is optional <video data-setup=\'{"series: "series_video"}\'></video>'),!1;t=this._options.series}return t},getParams:function(t){var e=["DCS.dcssip","www.nytimes.com","DCS.dcsuri","/video/"+this.getName()+"/"+t.action+".html","WT.ti","Video "+this.getName()+" "+t.ti,"WT.cg_n","Video","WT.videoCategory",this.getCategory(),"WT.videoEvent",t.event,"WT.videoLoad",t.load,"WT.videoName",this.getName(),"WT.z_gpt","Multimedia","WT.z_gpst","Video","WT.z_gpsst","Video-"+t.gpsst,"WT.z_vid",this.getId(),"WT.z_vpt",this._player.getPlayerType()+"|"+this.utils.getDeviceType(),"WT.z_vft",this.getSeries(),"WT.z_dcsm",1];return t.z_vaud&&"Audio"===t.action&&e.push("WT.z_vaud",t.z_vaud),e},track:function(t){if("undefined"!=typeof window.dcsMultiTrack){if(this._logger.info("VHS::PLUGIN::WEBTRENDS::",t),window.dcsMultiTrack.apply(this,t),this.trackingHistory.length>0){for(var e=0,i=this.trackingHistory.length;i>e;e++)window.dcsMultiTrack.apply(this,this.trackingHistory[e]);this.trackingHistory=[]}}else this.trackingHistory.push(t)},_play:function(){if(!this.tracked){var t;this._options.autoplay&&this.firstPlay?(t=this.getParams({action:"Play",event:"play",load:"auto",gpsst:"Play",ti:"PlayStart"}),this.firstPlay=!1):t=this.getParams({action:"Play",event:"play",load:"user",gpsst:"Play",ti:"Play"}),this.track(t),this.tracked=!0}},_mute:function(t){var e;e=this.getParams(t?{action:"Audio",event:"AudioOff",load:"null",gpsst:"Audio",ti:"Audio",z_vaud:"Off"}:{action:"Audio",event:"AudioOn",load:"null",gpsst:"Audio",ti:"Audio",z_vaud:"On"}),this.track(e)},_ended:function(){var t=this.getParams({action:"Finish",event:"finish",load:"null",gpsst:"Play",ti:"FinishStop"});this.track(t),this.tracked=!1},_go_fullscreen:function(){var t=this.getParams({action:"GoBig",event:"Go Big",load:"null",gpsst:"Play",ti:"GoBig"});this.track(t)},_exit_fullscreen:function(){var t=this.getParams({action:"GoSmall",event:"Go Small",load:"null",gpsst:"Play",ti:"GoSmall"});this.track(t)},_loadstart:function(){this.tracked=!1}},!0),n.plugin("comscore",{_initialize:function(){this.tracked=!1},loadLibrary:function(e){var i=("https:"===document.location.protocol?"https://sb":"http://b")+".scorecardresearch.com/beacon.js";t.getScript(i,e)},getParams:function(){var t=this._player.adPlaying()?"09":"02",e={c1:1,c2:"3005403",c3:"",c4:"",c5:t};return this._logger.log("VHS::PLUGIN::COMSCORE::",e),e},track:function(){var t=this.getParams();"undefined"!=typeof COMSCORE?COMSCORE.beacon(t):this.loadLibrary(function(){"undefined"!=typeof COMSCORE&&COMSCORE.beacon(t)})},_playing:function(){this.tracked||(this.track(),this.tracked=!0)},_ended:function(){this.tracked=!1},_ad_started:function(){this.track()},_loadstart:function(){this.tracked=!1}},!0),n.plugin("eventTracker",{_initialize:function(){this.util=n.util,this.ETEvents={USER_PLAY:"user-play",AUTO_PLAY_NEXT:"auto-play-next",AUTO_PLAY_START:"auto-play-start",VIDEO_COMPLETE:"video-complete",PAUSE:"pause",UNPAUSE:"unpause",GO_FULLSCREEN:"go-fullscreen",EXIT_FULLSCREEN:"exit-fullscreen",MUTED:"muted",UNMUTED:"unmuted",SKIP_AD:"skip-ad",AD_START:"ad-start",AD_COMPLETE:"ad-complete",PLAYER_LOAD:"player-load",PERCENT_25_VIEWED:"percent-25-viewed",PERCENT_50_VIEWED:"percent-50-viewed",PERCENT_75_VIEWED:"percent-75-viewed",SEEK:"seek",AD_PAUSE:"ad-pause",AD_RESUME:"ad-resume",MEDIA_ERROR:"media-error"},this.tracker=null,this.tracked=!1,this.tracked25Percent=!1,this.tracked50Percent=!1,this.tracked75Percent=!1,this.paused=!1,this.firstPlay=!0,this.trackingHistory=[],this.percentages={duration:0,calculate:function(t,e){if(!(1>t||e.length<1)){this.duration=t;
for(var i=e.length-1;i>=0;i--)this[e[i]]=.01*t*e[i];this.ready=!0}}}},isAdPlaying:function(){return this._player&&this._player.adsController&&(this._player.adsController.isContentPlaying||this._player.adsController.isInitializing)},getId:function(){if(this._data||this._options.id){var t=this._data?this._data.id:this._options.id;return t}return this._logger.warn("VHS::PLUGIN::EVENTTRACKER:: ID is not defined"),!1},getName:function(){if(this._data||this._options.name){var t=this._data?this._data.headline:this._options.name;return t}return this._logger.warn('VHS::PLUGIN::EVENTTRACKER:: NAME is optional <video data-setup=\'{"name: "name_video"}\'></video>'),!1},getCategory:function(){var t;if(this._data)this._data.section&&(t=this._data.section.content);else{if(!this._options.category)return this._logger.warn('VHS::PLUGIN::EVENTTRACKER:: CATEGORY is optional <video data-setup=\'{"category: "category_video"}\'></video>'),!1;t=this._options.category}return t},getSeries:function(){var t="";if(this._data)this._data.contentSeries&&(t=this._data.contentSeries.name);else{if(!this._options.series)return this._logger.warn('VHS::PLUGIN::EVENTTRACKER:: SERIES is optional <video data-setup=\'{"series: "series_video"}\'></video>'),!1;t=this._options.series}return t},getPrimaryPlaylistId:function(){var t;return this._data?(this._data.playlist&&(t=this._data.playlist.id),t):(this._logger.warn("VHS::PLUGIN::EVENTTRACKER:: playlistId missing _data"),!1)},getCurrentVideoPosition:function(){var t,e=0;return this._element&&this._element.length>0&&this._element[0].currentTime&&(t="function"==typeof this._element[0].currentTime?this._element[0].currentTime():this._element[0].currentTime,e=Math.round(t)),e},getErrorCode:function(t){var e="";return this._element&&this._element.length>0&&this._element[0].error?e=this._element[0].error.code:t&&t.error&&t.error.code&&(e=t.error.code),e},getTrackingObject:function(t){var e=this,i={subject:"video-nytv",url:window.location.href||"",referrer:document.referrer||"",playerType:e._player.getPlayerType()||"",device:e.util.getDeviceType(),tech:e._player.getType(),event:t||"",playerVersion:n._version,playerUsage:e._options.usage||"",playerMode:e._options.mode,videoDeliveryMethod:e._options.live?"live":"vod"};switch(t){case this.ETEvents.USER_PLAY:case this.ETEvents.AUTO_PLAY_START:case this.ETEvents.VIDEO_COMPLETE:case this.ETEvents.PAUSE:case this.ETEvents.UNPAUSE:case this.ETEvents.PERCENT_25_VIEWED:case this.ETEvents.PERCENT_50_VIEWED:case this.ETEvents.PERCENT_75_VIEWED:case this.ETEvents.PLAYER_LOAD:case this.ETEvents.SEEK:case this.ETEvents.MEDIA_ERROR:i=this.addBaseVideoProps(i),i=this.addVideoProps(i);break;case this.ETEvents.GO_FULLSCREEN:case this.ETEvents.EXIT_FULLSCREEN:case this.ETEvents.MUTED:case this.ETEvents.UNMUTED:i=this.addBaseVideoProps(i),i=this.addVideoProps(i),this.isAdPlaying()&&(i=this.addAdProps(i));break;case this.ETEvents.SKIP_AD:case this.ETEvents.AD_START:case this.ETEvents.AD_COMPLETE:case this.ETEvents.AD_PAUSE:case this.ETEvents.AD_RESUME:i=this.addBaseVideoProps(i),i=this.addAdProps(i)}return i},addVideoProps:function(t){var e=t;return e.videoFranchise=this.getSeries(),e.videoDuration=this._player.getDuration(),e.videoSection=this.getCategory(),e.videoSubSection="",e.videoPrimaryPlaylistId=this.getPrimaryPlaylistId(),e.videoTimeOfEvent=this.getCurrentVideoPosition(),e},addBaseVideoProps:function(t){var e=t;return e.videoId=this.getId(),e.videoName=this.getName(),e.videoType=this.isAdPlaying()?"ad":"video",e},addAdProps:function(t){var e=t,i=0;return this._player&&this._player.adsController&&this._player.adsController.currentSlot?i=this._player.adsController.currentSlot.getTotalDuration(!0)||0:this._player&&this._player.adDuration&&(i=this._player.adDuration()),e.adPosition="preroll",e.adDuration=Math.round(i),e},track:function(t){if(this._logger.info("VHS::PLUGIN::EVENTTRACKER::",t),this.tracker)this.tracker.track(t);else if("undefined"!=typeof window.NYTD&&window.NYTD.EventTracker){if(this.tracker=new window.NYTD.EventTracker,this.trackingHistory.length>0){for(var e=this.trackingHistory.length,i=e-1;i>=0;i--)this.tracker.track(this.trackingHistory[i]);this.trackingHistory=[]}this.tracker.track(t)}else this.trackingHistory.push(t)},_loadstart:function(){this._logger.info("VHS::PLUGIN::EVENTTRACKER::LOADSTART"),this.tracked=!1,this.tracked25Percent=!1,this.tracked50Percent=!1,this.tracked75Percent=!1,this.paused=!1},_play:function(){var t={};this.tracked?this.paused&&(t=this.getTrackingObject(this.ETEvents.UNPAUSE),this.track(t),this.paused=!1):(this._options.autoplay&&this.firstPlay?(t=this.getTrackingObject(this.ETEvents.AUTO_PLAY_START),this.firstPlay=!1):t=this.getTrackingObject(this.ETEvents.USER_PLAY),this.track(t),this.tracked=!0)},_pause:function(){if(this._player&&this._player.getDuration()>0){var t=this.getTrackingObject(this.ETEvents.PAUSE);this.track(t),this.paused=!0}},_seeked:function(){var t=this.getTrackingObject(this.ETEvents.SEEK);this.track(t)},_mute:function(t){var e;e=this.getTrackingObject(t?this.ETEvents.MUTED:this.ETEvents.UNMUTED),this.track(e)},_go_fullscreen:function(){var t=this.getTrackingObject(this.ETEvents.GO_FULLSCREEN);this.track(t)},_exit_fullscreen:function(){var t=this.getTrackingObject(this.ETEvents.EXIT_FULLSCREEN);this.track(t)},_ended:function(){var t=this.getTrackingObject(this.ETEvents.VIDEO_COMPLETE);this.track(t),this.tracked=!1,this.tracked25Percent=!1,this.tracked50Percent=!1,this.tracked75Percent=!1},_ad_started:function(){var t=this.getTrackingObject(this.ETEvents.AD_START);this.track(t)},_ad_completed:function(){var t=this.getTrackingObject(this.ETEvents.AD_COMPLETE);this.track(t),this.tracked=!1,this.tracked25Percent=!1,this.tracked50Percent=!1,this.tracked75Percent=!1},_ad_skipped:function(){var t=this.getTrackingObject(this.ETEvents.SKIP_AD);this.track(t),this.tracked=!1,this.tracked25Percent=!1,this.tracked50Percent=!1,this.tracked75Percent=!1},_ad_paused:function(){var t=this.getTrackingObject(this.ETEvents.AD_PAUSE);this.track(t)},_ad_resumed:function(){var t=this.getTrackingObject(this.ETEvents.AD_RESUME);this.track(t)},_loaded:function(){var t=this.getTrackingObject(this.ETEvents.PLAYER_LOAD);this.track(t)},_error:function(t){var e=this.getTrackingObject(this.ETEvents.MEDIA_ERROR);e.errorCode=this.getErrorCode(t),this.track(e)},_time_update:function(t){var e=this._player.getDuration(),i=Math.round(parseInt(t,10)),n=Math.round(parseInt(e,10));this.percentages.ready&&this.percentages.duration==n||this.percentages.calculate(n,[25,50,75]);var s={};i>0&&(i>=this.percentages[25]&&!this.tracked25Percent?(s=this.getTrackingObject(this.ETEvents.PERCENT_25_VIEWED),this.track(s),this.tracked25Percent=!0):i>=this.percentages[50]&&!this.tracked50Percent?(s=this.getTrackingObject(this.ETEvents.PERCENT_50_VIEWED),this.track(s),this.tracked50Percent=!0):i>=this.percentages[75]&&!this.tracked75Percent&&(s=this.getTrackingObject(this.ETEvents.PERCENT_75_VIEWED),this.track(s),this.tracked75Percent=!0))}},!0),n.plugin("conviva",{_initialize:function(){var t=this;this.utils=n.util,this.tracked=!1,this.CUSTOMER_ID="production"===this._options.env?"c3.NYTimes":"c3.NYTimes-Test",this.CUSTOMER_KEY="e58bb63661065df8cf5c24f7c80de524b6fad75a","function"==typeof Conviva&&Conviva.hasOwnProperty("LivePass")?(Conviva.LivePass.init("http://livepass.conviva.com",this.CUSTOMER_ID,function(e){t.livePassNotifier(e)}),Conviva.LivePass.toggleTraces(t._options.debug)):this.loadConvivaLibrary(function(){"function"==typeof Conviva&&Conviva.hasOwnProperty("LivePass")&&(Conviva.LivePass.init("http://livepass.conviva.com",t.CUSTOMER_ID,function(e){t.livePassNotifier(e)}),Conviva.LivePass.toggleTraces(t._options.debug))})},livePassNotifier:function(t){this._logger.info(0===t.code?"Conviva LivePass initialized successfully.":Conviva.LivePass.ready?"Conviva LivePass post-initialization feedback.\n 	Code: "+t.code+";\n 	Message: "+t.message:"Conviva LivePass failed to initialize!\n 	Conviva metrics will not be captured! 	Code: "+t.code+"; 	Message: "+t.message)},loadConvivaLibrary:function(e){var i="http://livepassdl.conviva.com/ver/2.77.0.16173/LivePass.js";t.getScript(i,e)},getSource:function(){var t="";return this._element&&(t=this._element.find("source:first").attr("src")),t},getPlayerName:function(){var t=this._options.name||"",e=t+"|"+this.utils.getDeviceType();return e},getParams:function(){var t={},e=this._data?this._data.headline:this._options.name,i=this._options.id?"["+this._options.id+"]"+e:e;return"function"==typeof Conviva&&Conviva.hasOwnProperty("ConvivaContentInfo")&&Conviva.ConvivaContentInfo&&(t=Conviva.ConvivaContentInfo.createInfoForLightSession(i),t.cdnName=Conviva.ConvivaContentInfo.CDN_NAME_AKAMAI,t.streamUrl=this.getSource(),t.isLive=!1,t.playerName=this._options.type,this._logger.info("VHS::PLUGIN::CONVIVA:: cdnName",t.cdnName),this._logger.info("VHS::PLUGIN::CONVIVA:: playerName",t.playerName),this._logger.info("VHS::PLUGIN::CONVIVA:: streamUrl",t.streamUrl)),t},_playing:function(){if(!this.tracked){var t,e=this._element[0],i={};"function"==typeof Conviva&&Conviva.hasOwnProperty("LivePass")&&(Conviva.LivePass.cleanupMonitoringSession(e),this._logger.info("VHS::PLUGIN::CONVIVA:: cleanup session"),i=this.getParams(),t=Conviva.LivePass.createSession(e,i),t.setContentLength(e.duration),this._logger.info("VHS::PLUGIN::CONVIVA:: creating session")),this.tracked=!0}}},!0),n.plugin("upt",{_initialize:function(){this.utils=n.util,this.body=t("body").first(),this.uptContainer=t(document.createElement("div")),this.hideElement(this.uptContainer),this.body.append(this.uptContainer),this.uptURL=[document.location.protocol,"//up.nytimes.com/"].join("");var e=window.dcsvid||t("meta[name='WT.dcsvid']").attr("content")||"";this.uid=encodeURIComponent(e),this.tracked=!1,this.trackedUptProgress=!1},getParams:function(t){var e=this._data&&this._data.publish_url?"http://www.nytimes.com"+encodeURIComponent(this._data.publish_url):"",i=encodeURIComponent(window.location.href),n=encodeURIComponent(t.event),s=encodeURIComponent(null!==t.value||"undefined"!==t.value&&""!==t.value?['{"',t.event,'":"',t.value,'"}'].join(""):""),o=["d=",0,"&m=","","&ui=",this.uid,"&u=",e,"&r=",i,"&e=",n,"&p=",s].join("");return o},track:function(e){if(!this._player.hasOwnProperty("adsController")||!this._player.adsController.isContentPlaying){this._logger.info("VHS::PLUGIN::UPT::",e);var i=t(document.createElement("img"));i.attr("src",this.uptURL+"?"+e),this.hideElement(i),this.uptContainer&&(this.uptContainer.empty(),this.uptContainer.append(i))}},hideElement:function(t){return t.css({width:"0px",height:"0px",border:"0px"}),t.hide(),t},_play:function(){if(!this.tracked){var t=this.getParams({event:"videoStart",value:""});this.track(t),this.tracked=!0}},_ended:function(){var t=this.getParams({event:"videoComplete",value:""});this.track(t),this.tracked=!1,this.trackedUptProgress=!1},_time_update:function(t){var e=this._player.getDuration(),i=Math.round(parseInt(t,10)),n=Math.round(parseInt(e,10)),s=Math.round(.75*n);if(i>0&&i===s&&!this.trackedUptProgress){var o=this.getParams({event:"videoWatched",value:"75%"});this.track(o),this.trackedUptProgress=!0}},_loadstart:function(){this.tracked=!1,this.trackedUptProgress=!1}},!0),n.plugin("playNext",{_initialize:function(){this.playlist=null,this.currentVideo=0},_ended:function(){var t=this;this.getPlaylistData(function(){var e=t.playlist.videos[t.currentVideo];t._data.id===e.id&&(t.currentVideo=t.currentVideo+1),t._options.poster="",t._player.load(e.id,!0),t.currentVideo=t.currentVideo+1})},getPlaylistData:function(t){var e=this;e.playlist?t():this._player.getData(this._data.playlist.id,"playlist",function(i){e.playlist=i,t()})}},!1),n.plugin("stats",{_initialize:function(){this.stats=!1,this.videoStats={droppedFrames:0,decodedFrames:0,videoDecodedBytes:0,audioDecodedBytes:0,bitrate:0,mimetype:"",volume:100,videoId:0,dimensions:{width:0,height:0},videoResolution:{width:0,height:0},streamType:"http",bandwidth:0,buffered:0,currentTime:0}},_loaded:function(){this._player.element[0],this.videoStats.videoId=this._data?this._data.id:this._options.id||-1},_time_update:function(t){var e=this._player.element[0];this.videoStats.decodedFrames=e.webkitDecodedFrameCount,this.videoStats.droppedFrames=e.webkitDroppedFrameCount,this.videoStats.videoDecodedBytes=e.webkitVideoDecodedByteCount,this.videoStats.audioDecodedBytes=e.webkitAudioDecodedByteCount,this.videoStats.currentTime=t,this.videoStats.volume=e.volume,this.videoStats.buffered=e.buffered,this.videoStats.videoResolution={width:e.videoWidth,height:e.videoHeight},this.videoStats.dimensions={width:this._container.width(),height:this._container.width()}}}),n.api.events={READY:"ready",LOADED:"loaded",PLAY:"play",PAUSE:"pause",MUTE:"mute",PLAYING:"playing",PROGRESS:"progress",SEEKED:"seeked",ENDED:"ended",DURATION_CHANGE:"durationchange",TIME_UPDATE:"timeupdate",GO_FULLSCREEN:"gofullscreen",EXIT_FULLSCREEN:"exitfullscreen",AD_STARTED:"adstarted",AD_PAUSED:"adpaused",AD_RESUMED:"adresumed",AD_COMPLETED:"adcompleted",AD_TIME_UPDATE:"adtimeupdate",AD_PROGRESS:"adprogress",AD_SKIPPED:"adskipped",AD_STOPPED:"adstopped",RENDITION_CHANGED:"renditionchanged",LOADED_DATA:"loadeddata",RENDERED:"rendered",LOAD_START:"loadstart",ERROR:"error",STALLED:"stalled",WAITING:"waiting",VIDEO_READY:"video:ready",VIDEO_LOADING:"video:loading"},n.api.Player=function(e,i){this.isIphone=n.util.isIphone(),this._data=null,this._evts={},this.poster=null,this.totalTimeToSkipAd=15,this.isReady=!1,this.isLoaded=!1,this.seeking=!1,this.readyCallbacks=[],this.loadedCallbacks=[],this.instance=i,this.isTouch="ontouchstart"in document.documentElement,this.status="paused",this.videoFullscreen=!1,this.listenersInitialized=!1,this.rendered=!1,this.adPaused=!1,this.renditions={medium:"video_xl_bb_mm",high:"video_xxxl_hb_mm",low:"video_l_3g_mob",library:"video_xxl_bb_mm",art:"video_xl_bb_art",well:"video_well_s_nb"};var s=this.isIphone?!1:!0;this.options=t.extend({id:"",name:null,category:null,element:null,container:null,type:null,src:null,source:null,render:!0,width:600,height:338,muted:!1,loop:!1,preload:"none",autoplay:!1,duration:null,controls:s,nativeControls:!1,ads:!1,freewheel:null,siteSection:null,skipAd:!1,playlist:!1,storyboard:!1,live:!1,ratio:"16:9",debug:!1,env:"production",api:!0,usage:"vanilla_js",mode:null,onReady:null,onLoaded:null},e),this.controlsIsVisible=!0,this.controlsRendered=!1,this.initialize()},n.api.Player.prototype={initialize:function(){this.logger=new n.api.Logger(this),this.setupEnvPaths(),this.swf=this.options.debug?"../../flash/vhs-debug.swf":this.staticBaseUrl+"video/vhs/build/flash/vhs.swf",this.device=n.util.getDeviceType(),this.firstPlay=!0,this.validate()&&this.create()},setupEnvPaths:function(){switch(this.options.env){case"development":this.apiBaseUrl="http://www.stg.nytimes.com/svc/video/api/v2/",this.staticBaseUrl="http://static.dev.nytimes.com/",this.fwAdManager="http://adm.fwmrm.net/p/nytimes_test/AdManager.swf",this.fwServer="http://fw.stg.nytimes.com/ad/g/1",this.fwNetworkId=379535,this.fwProfile="ny_times_brightcove_as3_test";break;case"staging":this.apiBaseUrl="http://www.stg.nytimes.com/svc/video/api/v2/",this.staticBaseUrl="http://static.stg.nytimes.com/",this.fwAdManager="http://adm.fwmrm.net/p/nytimes_test/AdManager.swf",this.fwServer="http://fw.stg.nytimes.com/ad/g/1",this.fwNetworkId=379535,this.fwProfile="ny_times_brightcove_as3_test";break;default:this.apiBaseUrl="http://www.nytimes.com/svc/video/api/v2/",this.staticBaseUrl="http://graphics8.nytimes.com/",this.fwAdManager="http://adm.fwmrm.net/p/nytimes_live/AdManager.swf",this.fwServer="http://fw.nytimes.com/ad/g/1",this.fwNetworkId=379536,this.fwProfile="ny_times_brightcove_as3_live"}},create:function(){var t=this,e=this.options.id,i=this.options.playlist===!0?"playlist":"video";this._currentVideo=0,this._currentVideoId=null,this.element=this.options.element||null,""!==this.options.id&&this.options.api?this.getData(e,i,function(e){t.options.playlist===!0?(t._playlist=e,t.setPlaylistCurrentVideo(),t.registerPlaylistEvents()):(t._data=e,t.renderPlayer())}):this.renderPlayer(),n.styleLoaded||this.loadControlsStyle(),this.fullScreenEvents()},destroy:function(t){this.element.bind("loadstart",t),this.element.attr("src",""),this.element.load(),this.container.remove(),delete window.vhs_instances[this.instance]},validate:function(){var t=!0;if(""===this.options.id&&null===this.options.src&&null===this.options.source)throw t=!1,new Error("ID, SRC or SOURCE should be provided");if(""===this.options.id&&null===this.options.name)throw t=!1,new Error("NAME should be provided");if(null===this.options.element&&null===this.options.container)throw t=!1,new Error("CONTAINER should be provided");return t},getData:function(e,i,n){var s=this.apiBaseUrl+i+"/"+e,o=e;for(var r in window.vhs_instances)e===window.vhs_instances[r].options.id&&(o=this.instance);t.ajax({url:s,cache:!0,dataType:"jsonp",context:this,jsonpCallback:"vhs_callback_"+o,success:n,error:function(t){this.logger.error("error",t)}})},getDuration:function(){var t=this._data&&this._data.duration?this._data.duration:this.options.duration;return t/1e3||0},renderPlayer:function(){this.on(n.api.events.RENDERED,function(){this._loaded()}),this.renderContainer(),this.options.render&&this.render(),this.options.ads&&this.options.skipAd&&this.renderSkipAd()},renderFakePoster:function(e){var i=this;this.poster=t("<div></div>").css({width:this.options.width,height:this.options.height,position:"absolute",top:0,left:0,"z-index":10,background:"url("+e+") center center no-repeat","background-size":"cover"}),this.container.append(this.poster),this.poster.bind("click",function(){i.play()}),this.on(n.api.events.PLAYING,function(){i.poster&&i.poster.hide()})},render:function(){},renderContainer:function(){var e=this,n=this.options.container;return this.element?(this.container=t("<div></div>"),this.container.insertAfter(this.element)):this.container=n instanceof i?n:t("#"+n),this.container.addClass("nytd-player-container"),this.container.css("16:9"===this.options.ratio&&"100%"===this.options.height&&"100%"===this.options.width?{background:"#000","padding-bottom":"56.25%",height:0,position:"relative",overflow:"hidden",width:this.options.width}:{width:this.options.width,height:this.options.height}),this.on("playing",function(){e.options.controls&&e.isTouch&&e.hideControls()}),this.container},loadControlsStyle:function(){var e=t("head"),i=this.staticBaseUrl+"video/vhs/build/vhs-"+n._version+".css";this.options.debug&&(i="../../vhs-latest.css"),n.styleLoaded||(e.append('<style type="text/css">.nytd-player-controls{ display: none; }</style>'),e.append('<link href="'+i+'" rel="stylesheet">'),n.styleLoaded=!0)},_skipAd:function(){this.skipAd(),this.trigger(n.api.events.AD_SKIPPED)},renderSkipAd:function(){var e=this;this.skipAdElement=t('<div class="nytd-player-ad-skip-ad"><span></span><a href="#">skip ad</a></div>'),this.container.append(this.skipAdElement),this.skipAdElement.find("a").bind("click",function(t){t.preventDefault(),e._skipAd()}),this.on(n.api.events.AD_STARTED,function(){e.skipAdElement&&(e.skipAdElement.find("span").show(),e.skipAdElement.find("a").hide(),e.skipAdElement.show())}),this.on(n.api.events.AD_COMPLETED,function(){e.skipAdElement&&e.skipAdElement.hide()}),this.on(n.api.events.AD_SKIPPED,function(){e.skipAdElement&&e.skipAdElement.hide()}),this.on(n.api.events.AD_STOPPED,function(){e.skipAdElement&&e.skipAdElement.hide()})},renderControls:function(e){if(this.controlsRendered||"android_legacy"===this.device||"ie_mobile"===this.device)return!1;var i=['<div class="nytd-player-controls">','<span class="nytd-player-controls-play vhs-icon-play"></span>','<span class="nytd-player-controls-reload vhs-icon-reload"></span>','<span class="nytd-player-controls-exclamation vhs-icon-exclamation"></span>','<div class="nytd-player-controls-ad-label">Advertisement</div>','<div class="nytd-player-controls-live-label">LIVE</div>','<div class="nytd-player-controls-error-msg">Error</div>','<div class="nytd-player-controls-current-time">00:00</div>','<div class="nytd-player-controls-progress">','<span class="nytd-player-controls-progress-marker vhs-icon-circle"></span>','<span class="nytd-player-controls-progress-time"></span>','<span class="nytd-player-controls-progress-buffer"></span>','<span class="nytd-player-controls-progress-scrubber"></span>',"</div>",'<span class="nytd-player-controls-fullscreen vhs-icon-resize-full"></span>','<span class="nytd-player-controls-volume vhs-icon-volume-up"></span>','<div class="nytd-player-controls-duration">00:00</div>',"</div>"].join("");this.controls=t(i),e&&this.controls.hide(),this.container.append(this.controls),this.bindControlsState(),this.bindControls(),this.controlsRendered=!0,this.options.live&&this.controlsConfigureLive()},controlsConfigureLive:function(){this.controls.addClass("nytd-player-live-controls")},controlsConfigureVOD:function(){this.controls.removeClass("nytd-player-live-controls")},bindControlsState:function(){var t,e=this,i=!1;this.container.bind("mouseenter",function(){i=!0,e.showControls()}),this.container.bind("mouseleave",function(){i=!1,e.hideControls()}),this.container.bind("mousemove",function(){clearTimeout(t),i&&e.adsController&&!e.adsController.isContentPlaying&&(t=setTimeout(function(){e.hideControls()},3e3)),i&&!e.controlsIsVisible&&e.showControls()})},bindControls:function(){function e(t){var e=parseInt(t,10),i=Math.floor(e/60),n=e-60*i;return 10>i&&(i="0"+i),10>n&&(n="0"+n),i+":"+n}function i(t){var i=Math.round(t*h.width()/r.duration());p.css({left:i-9}),m.css({width:i}),c.html(e(t))}function s(){for(var t,e=0;e<r.element[0].buffered.length;e++)t=Math.round(r.element[0].buffered.end(e)*h.width()/r.duration());f.css({width:t})}function o(t){r.seeking||i(t)}var r=this,a=this.controls.find(".nytd-player-controls-play"),l=this.controls.find(".nytd-player-controls-reload"),d=this.controls.find(".nytd-player-controls-volume"),c=this.controls.find(".nytd-player-controls-current-time"),u=this.controls.find(".nytd-player-controls-duration"),h=this.controls.find(".nytd-player-controls-progress"),p=this.controls.find(".nytd-player-controls-progress-marker"),f=this.controls.find(".nytd-player-controls-progress-buffer"),m=this.controls.find(".nytd-player-controls-progress-time"),g=this.controls.find(".nytd-player-controls-fullscreen"),v=(this.controls.find(".nytd-player-controls-settings"),this.controls.find(".nytd-player-controls-ad-label"),!1);a.bind("click",function(t){t.preventDefault(),t.stopPropagation(),r.togglePlay()}),l.bind("click",function(t){t.preventDefault(),t.stopPropagation(),r.reloadVideo()}),g.bind("click",function(t){t.preventDefault(),t.stopPropagation(),r.toggleFullscreen()}),d.bind("click",function(t){t.preventDefault(),t.stopPropagation(),r.toggleVolume()}),p.bind("click",function(t){t.preventDefault(),t.stopPropagation()}),h.bind("mousedown touchstart",function(t){t.stopPropagation(),v=!0}),h.bind("click",function(t){var e=-1*(h.offset().left-t.pageX),n=r.duration()*e/h.width();r.seek(n),i(n)}),t(document).bind("mouseup touchend",function(){v=!1,setTimeout(function(){r.seeking=!1},500)}),t(document).bind("mousemove touchmove",function(t){var e,n,s,o;v&&(n=0,s=0,o=0,e=r.isTouch?t.originalEvent.touches[0].pageX||t.originalEvent.changedTouches[0].pageX:t.pageX,s=-1*(h.offset().left-e),s>n&&s<h.width()?o=r.duration()*s/h.width():s>=h.width()&&(o=r.duration()),r.seek(o),i(o),r.seeking=!0)}),this.on(n.api.events.TIME_UPDATE,function(t){o(t)}),this.on(n.api.events.AD_TIME_UPDATE,function(t){var i=Math.floor(r.adDuration())||0,n=parseInt(t,10),s=i-n,o=r.totalTimeToSkipAd-n;0>i||(u.html(e(s)),r.skipAdElement&&(i<=r.totalTimeToSkipAd&&s>=1?r.skipAdElement.find("span").html("YOUR VIDEO WILL START IN "+(s>9?s:"0"+s)+" SECONDS"):i>r.totalTimeToSkipAd&&o>=1?r.skipAdElement.find("span").html("YOU CAN SKIP THIS AD IN "+(o>9?o:"0"+o)+" SECONDS"):(r.skipAdElement.find("span").hide(),r.skipAdElement.find("a").show())))}),this.on(n.api.events.PROGRESS,function(t){s(t)}),this.on(n.api.events.DURATION_CHANGE,function(t){var i=t||0;u.html(e(parseInt(i,10)))}),this.on(n.api.events.PLAY,function(){this.logger.log("Play Event"),r.status="playing",a.addClass("vhs-icon-pause"),a.removeClass("vhs-icon-play"),r.options.live&&r.hideLiveStreamDownMsg()}),this.on(n.api.events.PLAYING,function(){this.logger.log("Playing Event"),r.status="playing",a.addClass("vhs-icon-pause"),a.removeClass("vhs-icon-play"),r.options.live&&r.hideLiveStreamDownMsg()}),this.on(n.api.events.AD_RESUMED,function(){r.status="adplaying",a.addClass("vhs-icon-pause"),a.removeClass("vhs-icon-play")}),this.on(n.api.events.AD_STARTED,function(){r.status="adplaying",r.poster&&r.poster.hide(),r.controls.addClass("nytd-player-ad-controls"),a.addClass("vhs-icon-pause"),a.removeClass("vhs-icon-play"),r.isTouch&&r.showControls()}),this.on(n.api.events.AD_COMPLETED,function(){r.controls.removeClass("nytd-player-ad-controls"),r.isTouch&&r.hideControls()}),this.on(n.api.events.AD_SKIPPED,function(){r.controls.removeClass("nytd-player-ad-controls"),r.isTouch&&r.hideControls()}),this.on(n.api.events.AD_STOPPED,function(){r.status="paused",r.controls.removeClass("nytd-player-ad-controls"),a.addClass("vhs-icon-play"),a.removeClass("vhs-icon-pause"),r.isTouch&&r.hideControls()}),this.on(n.api.events.LOADED,function(){r.status="loaded",a.addClass("vhs-icon-play"),a.removeClass("vhs-icon-pause")}),this.on(n.api.events.PAUSE,function(){a.addClass("vhs-icon-play"),a.removeClass("vhs-icon-pause")}),this.on(n.api.events.AD_PAUSED,function(){a.addClass("vhs-icon-play"),a.removeClass("vhs-icon-pause")}),this.on(n.api.events.MUTE,function(t){t?(d.addClass("vhs-icon-volume-off"),d.removeClass("vhs-icon-volume-up")):(d.addClass("vhs-icon-volume-up"),d.removeClass("vhs-icon-volume-off"))}),this.on(n.api.events.ENDED,function(){r.status="ended",a.addClass("vhs-icon-play"),a.removeClass("vhs-icon-pause"),r.options.live&&r.showLiveStreamDownMsg()}),this.on(n.api.events.ERROR,function(t){this.logger.error("Play Error Event",t),r.options.live&&r.showLiveStreamDownMsg(t)}),this.on(n.api.events.STALLED,function(t){this.logger.error("Stalled Event",t)}),this.on(n.api.events.LOAD_START,function(){this.logger.log("Load Start"),r.options.live&&r.hideLiveStreamDownMsg()}),this.on(n.api.events.VIDEO_READY,function(){this.logger.log("Video Ready")}),this.on(n.api.events.VIDEO_LOADING,function(){this.logger.log("Video Loading")})},getErrorMessage:function(t){var e="This stream is not currently available.",i=t;if(i&&i.code)switch(i.code){case i.MEDIA_ERR_ABORTED:e="The video playback was aborted. Please refresh to resume playback.";break;case i.MEDIA_ERR_NETWORK:e="The video connection was lost. Please refresh to resume playback.";break;case i.MEDIA_ERR_DECODE:e="There was a video playback error. Please refresh to resume playback.";break;case i.MEDIA_ERR_SRC_NOT_SUPPORTED:""===this.element[0].canPlayType("application/x-mpegURL")&&(e="The video format is currently not supported in this browser.",this.controls.addClass("nytd-player-error-not-supported"))}return e},showLiveStreamDownMsg:function(){var t=this.controls.find(".nytd-player-controls-error-msg"),e=this.element[0].error,i=this.getErrorMessage(e);this.controls.addClass("nytd-player-error-controls"),t.html(i)},hideLiveStreamDownMsg:function(){var t=this.controls.find(".nytd-player-controls-error-msg");this.controls.removeClass("nytd-player-error-controls"),this.controls.removeClass("nytd-player-error-not-supported"),t.html("")},hideControls:function(){this.controlsIsVisible=!1,this.controls.fadeTo(400,0)},showControls:function(){this.controlsIsVisible=!0,this.controls.fadeTo(400,1)},renderStoryboard:function(){for(var e,i,s,o=0;o<this._data.renditions.length;o++)"video_l_bb_lib"===this._data.renditions[o].type&&(e=this._data.renditions[o].url,i=parseInt(this._data.duration,10)/1e3);s={width:160,height:90,duration:i,pageSize:25,maxTimeBetweenThumb:5,columns:5,videoUrl:"/"+e.split("/").slice(3).join("/")},this.storyboardContainer=t("<div></div>"),this.storyboardContainer.css({overflow:"hidden",width:s.width+"px",height:s.height+"px",position:"absolute",bottom:"50px"}),this.storyboardContainer.attr("id",this.instance+"storyboard"),this.container.append(this.storyboardContainer),s.container=this.storyboardContainer,this.storyboard=new n.api.Storyboard(s),this.bindStoryBoard()},bindStoryBoard:function(){var e=this,i=this.controls.find(".nytd-player-controls-progress");i.bind("mousemove",function(n){var s=-9,o=n.clientX-t(this).offset().left;if(e.storyboardContainer.length>0&&e.storyboardContainer.show(),o>s&&o<i.width()-9){var r=e.element[0].duration*o/i.width();e.storyboard&&(e.storyboard.showThumbByTime(r),e.storyboard.container.css({left:o}))}}),i.bind("mouseout",function(){e.storyboardContainer.length>0&&e.storyboardContainer.hide()})},_loaded:function(){"function"==typeof this.options.onLoaded&&this.options.onLoaded.apply(this);for(var t in this.loadedCallbacks)this.loadedCallbacks[t].apply(this);this.isLoaded=!0,this.plugins=new n.api.Plugins(this),this.container.data("loaded",!0),this.container.trigger(n.api.events.LOADED,this),this.trigger(n.api.events.LOADED)},loaded:function(t){this.isLoaded?t.apply(this):this.loadedCallbacks.push(t)},_ready:function(){"function"==typeof this.options.onReady&&this.options.onReady.apply(this);for(var t in this.readyCallbacks)this.readyCallbacks[t].apply(this);this.isReady=!0,this.container.data("ready",!0),this.container.trigger(n.api.events.READY,this),this.trigger(n.api.events.READY),this.readyCallbacks=[]},ready:function(t){this.isReady?t.apply(this):this.readyCallbacks.push(t)},on:function(t,e){if("function"!=typeof e)throw new Error("The callback argument should be a function");this._evts=this._evts||{},this._evts[t]=this._evts[t]||[],this._evts[t].push(e)},off:function(t){this._evts&&"object"==typeof this._evts&&this._evts.hasOwnProperty(t)&&delete this._evts[t]},trigger:function(t,e){if(this._evts&&"object"==typeof this._evts)for(var i in this._evts)if(i===t)for(var n=0;n<this._evts[i].length;n++)this._evts[i][n].call(this,e)},getPosterUrl:function(){var t,e="";if("undefined"!=typeof this.options.poster)e=this.options.poster;else if(this._data){t=this._data.images;for(var i in t)"videoSmall"===t[i].type&&(e=this.staticBaseUrl+t[i].url)}return e},setPlaylistCurrentVideo:function(){var t=this,e=this._playlist.videos[this._currentVideo].id;this.getData(e,"video",function(e){t._data=e,t._currentVideo>0?(t.render(),t.element.load(),t.play()):t.renderPlayer(),t._loaded()})},registerPlaylistEvents:function(){var t=this;this.on(n.api.events.ENDED,function(){t._currentVideo++,t.setPlaylistCurrentVideo()})},toggleFullscreen:function(){this.fullscreen(!this.isFullscreen())},isFullscreen:function(){return this.isFullscreenEnabled()},fullscreen:function(t){var e=t===!1?!1:!0;e&&this.poster&&this.poster.hide(),this.videoFullscreen=this.setFullscreen(e)},setContainerSize:function(t){this.container.width(t),this.element.css({width:"100%",height:"100%"})},getSiteSection:function(){function e(t){var e=""===t?"none":t;return e.replace(/[^a-zA-Z]/g,"").toLowerCase()}var i=t('meta[name="CG"]').attr("content")||"",n=t('meta[name="SCG"]').attr("content")||"",s=t('meta[name="PT"]').attr("content")||"",o=e(i)+"_"+e(n)+"_"+e(s);return o},getPlayerType:function(){var e=t('meta[name="PT"]').attr("content"),i=t('meta[name="PST"]').attr("content"),n=t('meta[name="slug"]').attr("content"),s=e&&i?e.toLowerCase()+"-"+i.toLowerCase():null,o=null;return this.options.type?o=this.options.type:"multimedia-interactive"===s&&n?o=s+"|"+n:s?o=s:this.logger.error("Player TYPE should be provided"),o},_fullScreenEventEsc:function(t){var e=t.keyCode?t.keyCode:t.which;27===e&&this.virtualExitFullScreen(self.container)},fullScreenEvents:function(){var e=this;this.fullScreenEventEsc=t.proxy(this._fullScreenEventEsc,this),t(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange vhs.virtualFullScreenChange",function(){var i=e.controls.find(".nytd-player-controls-fullscreen");e.isFullscreen()?(e.trigger(n.api.events.GO_FULLSCREEN),i.removeClass("vhs-icon-resize-full").addClass("vhs-icon-resize-default"),e.setContainerSize(t(document).width(),t(document).height()),e.videoFullscreen=!0):(e.trigger(n.api.events.EXIT_FULLSCREEN),i.removeClass("vhs-icon-resize-default").addClass("vhs-icon-resize-full"),e.setContainerSize(e.options.width,e.options.height),e.videoFullscreen=!1)}),t(window).on("resize",function(){t(this).trigger("vhs.fullscreen.resize")})},fullScreenResize:function(){if(this.isFullscreenEnabled()){var e,i,n,s=this,o=t(window).height(),r=t(window).width(),a=o*(16/9),l=r*(9/16),d=t(s.container.get(0));
r>o?(l=o,a>r&&(a=r,l=9*a/16),e=.5*(r-a),i=0>=e?.5*(o-l):0,n={width:a,height:l,"padding-bottom":0,left:e,top:i}):n={width:r,height:l,left:0,top:.5*(o-l)},d.css(n)}},virtualEnterFullScreen:function(){if(this.container&&!(this.container.length<1)){var e=this,i=t(this.container.get(0)),n=this.controls,s=1e5;i.data("style",i.attr("style")),i.css({position:"fixed",top:0,left:0,"z-index":s}),t('<div class="nytd-player-fullscreen"></div>').appendTo("body").css({width:"100%",height:"100%",background:"#000",position:"fixed",top:"0",left:"0",zIndex:s-1}),t("body").data("overflow",t("body").css("overflow")),t("body").css("overflow","hidden"),n.data("style",n.attr("style")),n.css("z-index",s+1),i.data("fullscreen",!0),this.fullScreenResize(),t(document).on("keydown",this.fullScreenEventEsc),t(window).on("vhs.fullscreen.resize",function(){e.fullScreenResize()}),t(document).trigger("vhs.virtualFullScreenChange")}},virtualExitFullScreen:function(){if(this.container&&!(this.container.length<1)&&this.isFullscreenEnabled()){var e=t(this.container.get(0)),i=this.controls;t("body").css("overflow",t("body").data("overflow")),e.attr("style",e.data("style")),i.attr("style",i.data("style")),e.data("fullscreen",!1),t(".nytd-player-fullscreen").fadeOut({complete:function(){t(this).remove()}}),t(document).off("keydown",this.fullScreenEventEsc),t(window).off("vhs.fullscreen.resize"),t(document).trigger("vhs.virtualFullScreenChange")}},enterFullscreen:function(){var t=this.container.get(0);return t?void("function"==typeof t.requestFullscreen?t.requestFullscreen():"function"==typeof t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):"function"==typeof t.webkitEnterFullScreen?t.webkitEnterFullScreen():"function"==typeof t.mozRequestFullScreen?t.mozRequestFullScreen():"function"==typeof t.msRequestFullScreen?(t.msRequestFullScreen(),this.container.addClass("ms-fullscreen")):this.virtualEnterFullScreen(this.container)):null},exitFullscreen:function(){var t=this.container.get(0);return t?void("function"==typeof document.exitFullscreen?document.exitFullscreen():"function"==typeof t.webkitCancelFullScreen?t.webkitCancelFullScreen():"function"==typeof document.webkitExitFullscreen?document.webkitExitFullscreen():"function"==typeof document.mozCancelFullScreen?document.mozCancelFullScreen():"function"==typeof document.msCancelFullScreen?(document.msCancelFullScreen(),this.container.removeClass("ms-fullscreen")):this.virtualExitFullScreen(this.container)):null},isFullscreenEnabled:function(){var t=this.container.get(0),e=this.container.data("fullscreen")===!0;return document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||t.webkitIsFullScreen||document.msIsFullScreen||e},setFullscreen:function(t){var e=this.container,i=!1;return t===!0?(this.enterFullscreen(e),i=!0):(this.exitFullscreen(e),i=!1),i},togglePlay:function(){"playing"!==this.status&&"adplaying"!==this.status?this.play():this.pause()}},n.api.HtmlFive=function(t,e){n.api.Player.call(this,t,e)},n.api.HtmlFive.prototype=n.util.extend(n.api.Player.prototype),n.api.HtmlFive.prototype.getType=function(){return"html5"},n.api.HtmlFive.prototype.load=function(t,e){var i=this,s=e||!1;this.getData(t,"video",function(t){i._data=t,i.plugins.reload(),i.renderSource(),i.renderPoster(),i.element.attr("src",i.element.find("source").attr("src")),i.element[0].load(),i.adPlaying()&&i.trigger(n.api.events.AD_STOPPED),i.adsController&&(i.adsController.isCompleted=!1,i.adsController.isContentPlaying=!1),s&&i.play()})},n.api.HtmlFive.prototype.render=function(){this.renderElement(),this.container.append(this.element),this.renderElementAttr(),this.renderSource(),this.renderPoster(),this.options.controls&&!this.options.nativeControls&&this.renderControls(),this.element.data("instance",this),this.registerListeners(),this.rendered=!0,this.trigger(n.api.events.RENDERED)},n.api.HtmlFive.prototype.renderElement=function(){if(this.options.element){var e=this.options.element;this.element=e.clone(!0),e.remove()}else this.element=t("<video />")},n.api.HtmlFive.prototype.renderPoster=function(){var t=null;this.poster&&this.poster.remove(),t=this.getPosterUrl(),this.element.attr("poster",t),this.isIphone||this.renderFakePoster(t)},n.api.HtmlFive.prototype.renderElementAttr=function(){var t=this.element.attr("id");this.getPosterUrl(),this.element.attr({preload:this.options.preload,"x-webkit-airplay":"allow"}),this.element.css({height:this.options.height,width:this.options.width}),"16:9"===this.options.ratio&&"100%"===this.options.height&&"100%"===this.options.width&&this.element.css({position:"absolute",top:0,left:0}),this.options.autoplay&&this.element.attr("autoplay","autoplay"),this.options.src&&this.element.attr("src",this.options.src),t&&""!==t||this.element.attr("id","video_"+(new Date).getTime()),(this.options.nativeControls||"android_legacy"===this.device||"ie_mobile"===this.device)&&this.element.attr("controls","controls"),this.options.muted&&this.mute(!0)},n.api.HtmlFive.prototype.renderSource=function(){var e,i,n,s,o,r;if(this._data&&this._data.renditions){e=this.renditions,i=this._data.renditions,n=this.element.width(),r=481>n?this.renditions.low:1024>n?this.renditions.medium:this.renditions.high;for(var a in i)i[a].type===r&&(o=i[a].url);o&&(s=t("<source />"),s.attr({src:o,type:"video/mp4"}),this.element.html(s))}if(this.options.source)for(var l in this.options.source)s=t("<source />"),s.attr({src:this.options.source[l],type:l}),this.element.append(s)},n.api.HtmlFive.prototype.adPlaying=function(){return this.adsController&&this.adsController.isContentPlaying?!0:!1},n.api.HtmlFive.prototype.adInitializing=function(){return this.adsController&&this.adsController.isInitializing?!0:!1},n.api.HtmlFive.prototype.adCompleted=function(){return this.adsController&&this.adsController.isCompleted?!0:!1},n.api.HtmlFive.prototype.fixForAndroidHSLBug=function(){"android_jellybean"===this.device&&this.firstPlay&&(this.pause(),this.play(),this.firstPlay=!1)},n.api.HtmlFive.prototype.registerListeners=function(){var t=this,e=this.element.attr("controls");this.video=this.element[0],this.listenersInitialized===!1&&(this.element.bind(n.api.events.LOADED_DATA,function(){t.options.autoplay!==!0||t.options.ads||(t.play(),t.trigger(n.api.events.AUTOPLAY)),t.options.muted&&t.mute(!0),t._ready()}),this.element.bind("play",function(){t.logger.log("html5 play event");var e="android_legacy"===this.device||"android_ics"===this.device?!1:!0;if(t.options.ads&&!t.adPlaying()&&!t.adCompleted()&&e?t.adsController?t.adsController.nextAd(function(){this.start()}):t.adsController=new n.html.Ads(t,function(){this.start()}):t.adPaused&&!t.adCompleted()?(t.adPaused=!1,t.trigger(n.api.events.AD_RESUMED)):t.adPlaying()||t.trigger(n.api.events.PLAY),!n.config.allowMultiplePlayers)for(var i in n._instances)t.instance!==i&&n._instances[i].pause();n.focused=t,t.status="playing"}),e||this.isTouch?this.element.bind("click",function(t){t.preventDefault()}):this.element.bind("click",function(e){e.stopPropagation(),t.togglePlay()}),this.element.bind("playing",function(){t.logger.log("html5 playing event"),t.status="playing",t.poster&&t.poster.hide(),t.adPlaying()||t.adInitializing()||t.trigger(n.api.events.PLAYING)}),this.element.bind("progress",function(e){t.adPlaying()?t.trigger(n.api.events.AD_PROGRESS,e):t.trigger(n.api.events.PROGRESS,e)}),this.element.bind("timeupdate",function(){t.adPlaying()?t.trigger(n.api.events.AD_TIME_UPDATE,t.video.currentTime):t.trigger(n.api.events.TIME_UPDATE,t.video.currentTime)}),this.element.bind("seeked",function(){t.logger.log("html5 seeked event"),t.adPlaying()||t.trigger(n.api.events.SEEKED)}),this.element.bind("pause",function(){t.logger.log("html5 pause event"),t.adPlaying()||t.adInitializing()?t.element&&t.element[0]&&!t.element[0].ended&&t.adPlaying()&&(t.adPaused=!0,t.trigger(n.api.events.AD_PAUSED)):t.element&&t.element[0]&&!t.element[0].ended&&t.trigger(n.api.events.PAUSE),t.status="paused"}),this.element.bind("durationchange",function(){t.trigger(n.api.events.DURATION_CHANGE,t.element[0].duration||0)}),this.element.bind("ended",function(){t.logger.log("html5 ended event"),t.adPlaying()||(t.status="ended",t.trigger(n.api.events.ENDED)),t.options.live&&t.fixForAndroidHSLBug()}),this.element.bind("loadstart",function(){t.logger.log("html5 loadstart event"),t.trigger(n.api.events.LOAD_START)}),this.element.bind(n.api.events.ERROR,function(e){t.logger.log("html5 error event",e),t.trigger(n.api.events.ERROR)}),this.element.bind(n.api.events.STALLED,function(e){t.logger.log("html5 stalled event",e),t.trigger(n.api.events.STALLED,e)}),this.element.bind(n.api.events.WAITING,function(){t.logger.log("html5 waiting event"),t.trigger(n.api.events.WAITING)}),this.listenersInitialized=!0)},n.api.HtmlFive.prototype.togglePlay=function(){"playing"!==this.status&&"adplaying"!==this.status?this.play():this.pause()},n.api.HtmlFive.prototype.reloadVideo=function(){this.element&&this.element.length>0&&(this.element[0].load(),this.element[0].play())},n.api.HtmlFive.prototype.toggleVolume=function(){this.mute(!this.isMuted())},n.api.HtmlFive.prototype.duration=function(){return this.element[0].duration||0},n.api.HtmlFive.prototype.play=function(){var t=this;this.options.render||this.rendered?this.element[0].play():"desktop"===n.util.getDeviceType()?(this.element.bind("loadstart",function(){t.element[0].play()}),this.render()):(this.render(),this.element[0].play())},n.api.HtmlFive.prototype.pause=function(){"paused"!==this.status&&(this.element[0].pause(),this.status="paused")},n.api.HtmlFive.prototype.mute=function(t){var e;e=t===!1?!1:!0,this.element[0].muted=e,this.trigger(n.api.events.MUTE,e)},n.api.HtmlFive.prototype.isMuted=function(){var t=this.element[0].muted;return t},n.api.HtmlFive.prototype.seek=function(t){var e=this.element[0];if("number"!=typeof t)throw new Error("time argument should be a Number");if(0>t||t>e.duration)throw new Error("time should be greater than 0 and lower than the duration of the video");e.currentTime=t},n.api.HtmlFive.prototype.skipAd=function(){this.adsController.stop()},n.api.HtmlFive.prototype.adDuration=function(){return this.element[0].duration},n.html.Ads=function(t,e){var i=this,s=!0;switch(this.player=t,this.callback=e,this.adsLoaded=!1,this.serverURL="http://fw.nytimes.com/ad/g/1",this.siteSectionId=this.player.options.siteSection||this.player.options.freewheel||this.player.getSiteSection(),this.isCompleted=!1,this.isContentPlaying=!1,this.currentSlot=null,this.isInitializing=!0,this.player.options.env){case"development":case"staging":this.networkId=379535,this.profileId="379535:ny_times_js_test",this.adManagerUrl="http://adm.fwmrm.net/p/nytimes_test/AdManager.js",this.serverURL="http://fw.stg.nytimes.com/ad/g/1",s=!1;break;default:this.networkId=379536,this.profileId="379536:ny_times_js_live",this.adManagerUrl="http://adm.fwmrm.net/p/nytimes_live/AdManager.js"}n.config.ts||(n.config.ts=!0,function(t){var e,i,n,s,o,r=window.location.search,a="",l="_ro",d=1;if(r){if(e=/[&?]tsdel=/.exec(r),!e){if(i=/[&?]tspid=([^&#]*)/.exec(r),!i)return;o=i[1],n=t?"tearsheet.fw.nytimes.com":"tearsheet.fw.stg.nytimes.com",a=encodeURIComponent(["Candidate-Ads=",o,";","Internal-Call;","Opt-Out;","Testing-Placement=true;","Commercial-Pattern=14852;;","Target-Server;","domain=",n,";","Reload-Ads=",o].join(""))}s=new Date,s.setTime(s.getTime()+24*d*60*60*1e3),document.cookie=l+"="+a+";expires="+s+";domain=.nytimes.com;path=/"}}(s)),this.player.element[0].pause(),this.loadAdManager(function(){i.adManager=new tv.freewheel.SDK.AdManager,i.adManager.setNetwork(i.networkId),i.adManager.setServer(i.serverURL),i.setupAdContext()})},n.html.Ads.prototype.nextAd=function(t){this.callback=t,this.isCompleted=!1,this.setupAdContext()},n.html.Ads.prototype.loadAdManager=function(e){var i=this;t.ajax({url:i.adManagerUrl,cache:!0,dataType:"script",success:function(){e.call(i)}})},n.html.Ads.prototype.setupAdContext=function(){var t=(this.player.element,this.player.element.attr("id"),this.player.container.attr("id")),e=this.player.getDuration(),i=this.player._data?this.player._data.id:this.player.instance;this.theContext&&(this.unregisterContextListeners(),this.theContext.dispose()),this.theContext=this.adManager.newContext(),this.theContext.registerVideoDisplayBase(t),this.theContext.setProfile(this.profileId),this.theContext.setVideoAsset(i,e,this.networkId),this.theContext.setSiteSection(this.siteSectionId,this.networkId),this.registerContextListeners(),this.theContext.setParameter(tv.freewheel.SDK.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT,1e4,tv.freewheel.SDK.PARAMETER_LEVEL_GLOBAL),this.theContext.setParameter(tv.freewheel.SDK.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT,1e4,tv.freewheel.SDK.PARAMETER_LEVEL_GLOBAL),this.theContext.setParameter(tv.freewheel.SDK.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE,!1,tv.freewheel.SDK.PARAMETER_LEVEL_GLOBAL),this.theContext.addTemporalSlot("Preroll_1",tv.freewheel.SDK.ADUNIT_PREROLL,0),this.theContext.submitRequest(2)},n.html.Ads.prototype.registerContextListeners=function(){this.theContext.addEventListener(tv.freewheel.SDK.EVENT_REQUEST_COMPLETE,t.proxy(this.onRequestComplete,this)),this.theContext.addEventListener(tv.freewheel.SDK.EVENT_SLOT_ENDED,t.proxy(this.onSlotEnded,this)),this.theContext.addEventListener(tv.freewheel.SDK.EVENT_SLOT_STARTED,t.proxy(this.onSlotStarted,this))},n.html.Ads.prototype.unregisterContextListeners=function(){this.theContext.removeEventListener(tv.freewheel.SDK.EVENT_REQUEST_COMPLETE),this.theContext.removeEventListener(tv.freewheel.SDK.EVENT_SLOT_ENDED),this.theContext.removeEventListener(tv.freewheel.SDK.EVENT_SLOT_STARTED)},n.html.Ads.prototype.onRequestComplete=function(t){if(this.adsLoaded=!0,this.prerollSlots=[],this.midrollSlots=[],this.overlaySlots=[],this.postrollSlots=[],t.success)for(var e=this.theContext.getTemporalSlots(),i=0,n=e.length;n>i;i++){var s=e[i];switch(s.getTimePositionClass()){case tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL:this.prerollSlots.push(s);break;case tv.freewheel.SDK.TIME_POSITION_CLASS_MIDROLL:this.midrollSlots.push(s);break;case tv.freewheel.SDK.TIME_POSITION_CLASS_OVERLAY:this.overlaySlots.push(s);break;case tv.freewheel.SDK.TIME_POSITION_CLASS_POSTROLL:this.postrollSlots.push(s)}}this.prerollSlots&&this.prerollSlots.length?this.callback(null,this.prerollSlots):this.callback(new Error("No prerolls available"))},n.html.Ads.prototype.getState=function(){return this.isCompleted},n.html.Ads.prototype.onSlotStarted=function(t){var e=t.slot.getTimePositionClass(),i=t.slot.getTotalDuration();if(i>0)switch(e){case tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL:this.isCompleted=!1,this.isContentPlaying=!0,this.setCurrentlyPlayingSlot(this.prerollSlots[0]),this.player.trigger(n.api.events.AD_STARTED)}},n.html.Ads.prototype.onSlotEnded=function(t){var e=t.slot.getTimePositionClass(),i=t.slot.getTotalDuration();switch(e){case tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL:this.prerollSlots.length&&(this.prerollSlots.shift(),this.prerollSlots.length?(this.prerollSlots[0].play(),this.setCurrentlyPlayingSlot(this.prerollSlots[0])):this.resumeContent(i));break;case tv.freewheel.SDK.TIME_POSITION_CLASS_POSTROLL:case tv.freewheel.SDK.TIME_POSITION_CLASS_MIDROLL:case tv.freewheel.SDK.TIME_POSITION_CLASS_OVERLAY:case tv.freewheel.SDK.TIME_POSITION_CLASS_DISPLAY:}},n.html.Ads.prototype.resumeContent=function(t){var e=this,i=this.player.element.find("source").attr("src");t&&t>0&&this.player.trigger(n.api.events.AD_COMPLETED),this.isCompleted=!0,this.isContentPlaying=!1,this.player.element.attr("src",i),this.player.element[0].load(),this.player.element[0].play(),this.setCurrentlyPlayingSlot(null),this.theContext.setVideoState(tv.freewheel.SDK.VIDEO_STATE_PLAYING),this.player.on(n.api.events.ENDED,function(){e.theContext.setVideoState(tv.freewheel.SDK.VIDEO_STATE_COMPLETED)})},n.html.Ads.prototype.setCurrentlyPlayingSlot=function(t){this.currentSlot=t},n.html.Ads.prototype.start=function(){this.isInitializing=!1,this.prerollSlots&&this.prerollSlots.length?(this.isCompleted=!1,this.isContentPlaying=!0,this.setCurrentlyPlayingSlot(this.prerollSlots[0]),this.prerollSlots[0].play()):this.resumeContent()},n.html.Ads.prototype.stop=function(){this.currentSlot&&this.currentSlot.stop()},n.html.Ads.prototype.pause=function(){this.player.element[0].pause()},n.html.Ads.prototype.resume=function(){this.player.element[0].play()},n.api.Flash=function(t,e){n.api.Player.call(this,t,e)},n.api.Flash.prototype=n.util.extend(n.api.Player.prototype),n.api.Flash.prototype.getType=function(){return"flash"},n.api.Flash.prototype.load=function(t,e){var i=this,n=e||!1;this.adPlaying()&&this.stopAd(),this.getData(t,"video",function(t){i._data=t,i.plugins.reload(),i.renderSource(),i.renderPoster(),n&&i.play()})},n.api.Flash.prototype.render=function(){this.options.element&&this.options.element.remove(),this.renderElement(),this.renderPoster(),this.options.controls&&!this.options.nativeControls&&this.renderControls()},n.api.Flash.prototype.renderElement=function(){var i="video_"+(new Date).getTime(),n={instance:this.instance},s=this,o=t("<div></div>");o.attr("id",i),this.container.html(o),this.options.muted&&(n.muted=!0),n.live=this.options.live,n.ads=this.options.ads,n.id=this.options.id||"",n.autoplay=this.options.autoplay,n.ads&&(n.mediaLocation=this.options.live?this.options.src:null,n.fwAdManager=this.fwAdManager,n.fwServer=this.fwServer,n.fwNetworkId=this.fwNetworkId,n.fwProfile=this.fwProfile,n.fwSiteSection=this.options.siteSection||this.options.freewheel||this.getSiteSection());var r={allowFullScreen:!0,allowScriptAccess:"always",wmode:"opaque",seamlessTabbing:!1,swliveconnect:!0,quality:"high",bgcolor:"#000000"},a={id:i},l=function(t){s.logger.log("Flash Render Callback",t)};e.embedSWF(this.swf,i,this.options.width,this.options.height,"10.1",null,n,r,a,l)},n.api.Flash.prototype.renderPoster=function(){var t=null;this.poster&&this.poster.remove(),t=this.getPosterUrl(),this.renderFakePoster(t)},n.api.Flash.prototype.externalInterface=function(){this.element=this.container.children(":first"),this.element.data("instance",this),this.video=this.element[0],this.renderSource(),this.registerListeners(),this.trigger(n.api.events.RENDERED),this._ready()},n.api.Flash.prototype.renderSource=function(){var t,e,i,s=this.element[0];if(this.options.src)i=this.options.src;else if(this.options.source)for(var o in this.options.source)"video/mp4"===o&&(i=this.options.source[o]);else if(this._data&&this._data.renditions){t=this.renditions,e=this._data.renditions;for(var r in e)e[r].type===this.renditions.medium&&(i=e[r].url)}if(!i)throw new Error("at least one rendition should be provided.");this.trigger(n.api.events.LOAD_START),s.loadPlayerData({url:i,type:"video/mp4",duration:this.getDuration()})},n.api.Flash.prototype.registerListeners=function(){},n.api.Flash.prototype.duration=function(){var t=this.element[0];return t.duration()||0},n.api.Flash.prototype.skipAd=function(){this.video&&this.video.skipAd()},n.api.Flash.prototype.stopAd=function(){this.video&&(this.video.stopAd(),this.trigger(n.api.events.AD_STOPPED))},n.api.Flash.prototype.playAd=function(){this.video&&this.video.playAd()},n.api.Flash.prototype.pauseAd=function(){this.video&&this.video.pauseAd()},n.api.Flash.prototype.play=function(){this.adPlaying()?this.playAd():this.video&&this.video.playVideo&&this.video.playVideo()},n.api.Flash.prototype.stop=function(){this.video&&this.video.stopVideo()},n.api.Flash.prototype.pause=function(){this.status="paused",this.adPlaying()?this.pauseAd():this.isContentPlaying()&&this.video&&this.video.pauseVideo()},n.api.Flash.prototype.isContentPlaying=function(){return this.video.isContentPlaying()},n.api.Flash.prototype.adPlaying=function(){return this.video.adPlaying()},n.api.Flash.prototype.adCompleted=function(){return this.video.adComplete()},n.api.Flash.prototype.adDuration=function(){return this.video.adDuration()},n.api.Flash.prototype.adCurrentTime=function(){return this.video.adCurrentTime()},n.api.Flash.prototype.seek=function(t){if("number"!=typeof t)throw new Error("time argument should be a Number");if(0>t||t>this.video.duration())throw new Error("time should be greater than 0 and lower than the duration of the video");this.video.seek({seconds:t})},n.api.Flash.prototype.togglePlay=function(){"playing"!==this.status&&"adplaying"!==this.status?this.play():this.pause()},n.api.Flash.prototype.reloadVideo=function(){this.renderSource();var t=this;this.on(n.api.events.VIDEO_READY,function(){t.logger.log("Flash VIDEO_READY"),t.play(),t.off(n.api.events.VIDEO_READY)})},n.api.Flash.prototype.mute=function(t){this.video&&(t?this.video.mute():this.video.unmute())},n.api.Flash.prototype.unmute=function(){this.video&&this.video.unmute()},n.api.Flash.prototype.toggleVolume=function(){this.video&&this.mute(!this.video.isMuted())},window.vhs_instances={},n.styleLoaded=!1,n.player=function(t){var e,i=(new Date).getTime(),s="player_"+Math.round(Math.random()*i),o=n.util;return t.mode=t.mode||"html5","html5"!==t.mode&&o.checkFlashSupport()||!o.supportH264()?(t.mode="flash",e=new n.api.Flash(t,s)):e=new n.api.HtmlFive(t,s),e&&(window.vhs_instances[s]=e),e},n.auto=function(){var e,i,s,o,r=t("figure[data-nytd]");if(r.length>0)for(e=0,i=r.length;i>e;e++)o=r.eq(e),s=o.data("setup")||{},s.id=s.nytd||o.data("nytd"),s.container=o,s.usage="figure_tag",n.player(s)},n.shortcuts=function(){var e=function(t){var e=n.focused;if(e)switch(32===t.keyCode&&t.preventDefault(),t.keyCode){case 32:e.togglePlay();break;case 102:case 70:e.fullscreen();break;case 38:break;case 40:break;case 37:e.seek(e.element[0].currentTime-10);break;case 39:e.seek(e.element[0].currentTime+10)}};t(document).unbind("keydown.vhs").bind("keydown.vhs",e),t(document).bind("click.vhs",function(){n.focused=null}),t(function(){n.auto()})}(),n._version="1.6.2",n}),function(t){"function"==typeof define&&define.amd?define("playerjs",[],t):t()}(function(t,e){function i(t){return function(){var e={method:t},i=Array.prototype.slice.call(arguments);/^get/.test(t)?(n.assert(i.length>0,"Get methods require a callback."),i.unshift(e)):(/^set/.test(t)&&(n.assert(0!==i.length,"Set methods require a value."),e.value=i[0]),i=[e]),this.send.apply(this,i)}}var n={};n.DEBUG=!1,n.VERSION="0.0.10",n.CONTEXT="player.js",n.POST_MESSAGE=!!t.postMessage,n.ENABLE_CONTEXT=!1,n.origin=function(e){return"//"===e.substr(0,2)&&(e=t.location.protocol+e),e.split("/").slice(0,3).join("/")},n.addEvent=function(t,e,i){t&&(t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i)},n.log=function(){n.log.history=n.log.history||[],n.log.history.push(arguments),t.console&&n.DEBUG&&t.console.log(Array.prototype.slice.call(arguments))},n.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)},n.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},n.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},n.isNone=function(t){return null===t||void 0===t},n.has=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.indexOf=function(t,e){if(null==t)return-1;var i=0,n=t.length;if(Array.prototype.IndexOf&&t.indexOf===Array.prototype.IndexOf)return t.indexOf(e);for(;n>i;i++)if(t[i]===e)return i;return-1},n.assert=function(t,e){if(!t)throw e||"Player.js Assert Failed"},n.Keeper=function(){this.init()},n.Keeper.prototype.init=function(){this.data={}},n.Keeper.prototype.getUUID=function(){return"listener-xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"===t?e:3&e|8;return i.toString(16)})},n.Keeper.prototype.has=function(t,e){if(!this.data.hasOwnProperty(t))return!1;if(n.isNone(e))return!0;for(var i=this.data[t],s=0;s<i.length;s++)if(i[s].id===e)return!0;return!1},n.Keeper.prototype.add=function(t,e,i,n,s){var o={id:t,event:e,cb:i,ctx:n,one:s};this.has(e)?this.data[e].push(o):this.data[e]=[o]},n.Keeper.prototype.execute=function(t,e,i,s){if(!this.has(t,e))return!1;for(var o=[],r=[],a=0;a<this.data[t].length;a++){var l=this.data[t][a];n.isNone(e)||!n.isNone(e)&&l.id===e?(r.push({cb:l.cb,ctx:l.ctx?l.ctx:s,data:i}),l.one===!1&&o.push(l)):o.push(l)}0===o.length?delete this.data[t]:this.data[t]=o;for(var d=0;d<r.length;d++){var c=r[d];c.cb.call(c.ctx,c.data)}},n.Keeper.prototype.on=function(t,e,i,n){this.add(t,e,i,n,!1)},n.Keeper.prototype.one=function(t,e,i,n){this.add(t,e,i,n,!0)},n.Keeper.prototype.off=function(t,e){var i=[];if(!this.data.hasOwnProperty(t))return i;for(var s=[],o=0;o<this.data[t].length;o++){var r=this.data[t][o];n.isNone(e)||r.cb===e?n.isNone(r.id)||i.push(r.id):s.push(r)}return 0===s.length?delete this.data[t]:this.data[t]=s,i},n.Player=function(t,e){return this instanceof n.Player?void this.init(t,e):new n.Player(t,e)},n.EVENTS={READY:"ready",PLAY:"play",PAUSE:"pause",ENDED:"ended",TIMEUPDATE:"timeupdate",PROGRESS:"progress",ERROR:"error"},n.EVENTS.all=function(){var t=[];for(var e in n.EVENTS)n.has(n.EVENTS,e)&&n.isString(n.EVENTS[e])&&t.push(n.EVENTS[e]);return t},n.METHODS={PLAY:"play",PAUSE:"pause",GETPAUSED:"getPaused",MUTE:"mute",UNMUTE:"unmute",GETMUTED:"getMuted",SETVOLUME:"setVolume",GETVOLUME:"getVolume",GETDURATION:"getDuration",SETCURRENTTIME:"setCurrentTime",GETCURRENTTIME:"getCurrentTime",SETLOOP:"setLoop",GETLOOP:"getLoop",REMOVEEVENTLISTENER:"removeEventListener",ADDEVENTLISTENER:"addEventListener"},n.METHODS.all=function(){var t=[];for(var e in n.METHODS)n.has(n.METHODS,e)&&n.isString(n.METHODS[e])&&t.push(n.METHODS[e]);return t},n.READIED=[],n.Player.prototype.init=function(i){var s=this;n.isString(i)&&(i=e.getElementById(i)),this.elem=i,this.origin=n.origin(i.src),this.keeper=new n.Keeper,this.isReady=!1,this.queue=[],this.events=n.EVENTS.all(),this.methods=n.METHODS.all(),n.POST_MESSAGE?n.addEvent(t,"message",function(t){s.receive(t)}):n.log("Post Message is not Available."),n.indexOf(n.READIED,i.src)>-1?s.loaded=!0:this.elem.onload=function(){s.loaded=!0}},n.Player.prototype.send=function(t,e,i){if(t.context=n.CONTEXT,t.version=n.VERSION,e){var s=this.keeper.getUUID();t.listener=s,this.keeper.one(s,t.method,e,i)}return this.isReady||"ready"===t.value?(n.log("Player.send",t,this.origin),this.loaded===!0&&this.elem.contentWindow.postMessage(JSON.stringify(t),this.origin),!0):(n.log("Player.queue",t),this.queue.push(t),!1)},n.Player.prototype.receive=function(t){if(n.log("Player.receive",t),t.origin!==this.origin)return!1;var e;try{e=JSON.parse(t.data)}catch(i){return!1}return n.ENABLE_CONTEXT&&e.context!==n.CONTEXT?!1:("ready"===e.event&&e.value&&e.value.src===this.elem.src&&this.ready(e),void(this.keeper.has(e.event,e.listener)&&this.keeper.execute(e.event,e.listener,e.value,this)))},n.Player.prototype.ready=function(t){if(this.isReady===!0)return!1;t.value.events&&(this.events=t.value.events),t.value.methods&&(this.methods=t.value.methods),this.isReady=!0,this.loaded=!0;for(var e=0;e<this.queue.length;e++){var i=this.queue[e];n.log("Player.dequeue",i),"ready"===t.event&&this.keeper.execute(i.event,i.listener,!0,this),this.send(i)}this.queue=[]},n.Player.prototype.on=function(t,e,i){var n=this.keeper.getUUID();return"ready"===t?this.keeper.one(n,t,e,i):this.keeper.on(n,t,e,i),this.send({method:"addEventListener",value:t,listener:n}),!0},n.Player.prototype.off=function(t,e){var i=this.keeper.off(t,e);if(n.log("Player.off",i),i.length>0)for(var s in i)return this.send({method:"removeEventListener",value:t,listener:i[s]}),!0;return!1},n.Player.prototype.supports=function(t,e){n.assert(n.indexOf(["method","event"],t)>-1,'evtOrMethod needs to be either "event" or "method" got '+t),e=n.isArray(e)?e:[e];for(var i="event"===t?this.events:this.methods,s=0;s<e.length;s++)if(-1===n.indexOf(i,e[s]))return!1;return!0};for(var s=0,o=n.METHODS.all().length;o>s;s++){var r=n.METHODS.all()[s];n.Player.prototype.hasOwnProperty(r)||(n.Player.prototype[r]=i(r))}return t.playerjs=n,n.addEvent(t,"message",function(t){var e;try{e=JSON.parse(t.data)}catch(i){return!1}return n.ENABLE_CONTEXT&&e.context!==n.CONTEXT?!1:void("ready"===e.event&&e.value&&e.value.src&&n.READIED.push(e.value.src))}),n.Receiver=function(t,e){this.init(t,e)},n.Receiver.prototype.init=function(i,s){var o=this;this.isReady=!1,this.origin=n.origin(e.referrer),this.methods={},this.supported={events:i?i:n.EVENTS.all(),methods:s?s:n.METHODS.all()},this.eventListeners={},this.reject=!(t.self!==t.top&&n.POST_MESSAGE),this.reject||n.addEvent(t,"message",function(t){o.receive(t)})},n.Receiver.prototype.receive=function(e){if(e.origin!==this.origin)return!1;var i={};if(n.isObject(e.data))i=e.data;else try{i=t.JSON.parse(e.data)}catch(s){n.log("JSON Parse Error",s)}if(n.log("Receiver.receive",e,i),!i.method)return!1;if(n.ENABLE_CONTEXT&&i.context!==n.CONTEXT)return!1;if(-1===n.indexOf(n.METHODS.all(),i.method))return this.emit("error",{code:2,msg:'Invalid Method "'+i.method+'"'}),!1;var o=n.isNone(i.listener)?null:i.listener;if("addEventListener"===i.method)this.eventListeners.hasOwnProperty(i.value)?-1===n.indexOf(this.eventListeners[i.value],o)&&this.eventListeners[i.value].push(o):this.eventListeners[i.value]=[o],"ready"===i.value&&this.isReady&&this.ready();else if("removeEventListener"===i.method){if(this.eventListeners.hasOwnProperty(i.value)){var r=n.indexOf(this.eventListeners[i.value],o);r>-1&&this.eventListeners[i.value].splice(r,1),0===this.eventListeners[i.value].length&&delete this.eventListeners[i.value]}}else this.get(i.method,i.value,o)},n.Receiver.prototype.get=function(t,e,i){var n=this;if(!this.methods.hasOwnProperty(t))return this.emit("error",{code:3,msg:'Method Not Supported"'+t+'"'}),!1;var s=this.methods[t];if("get"===t.substr(0,3)){var o=function(e){n.send(t,e,i)};s.call(this,o)}else s.call(this,e)},n.Receiver.prototype.on=function(t,e){this.methods[t]=e},n.Receiver.prototype.send=function(e,i,s){if(n.log("Receiver.send",e,i,s),this.reject)return n.log("Receiver.send.reject",e,i,s),!1;var o={context:n.CONTEXT,version:n.VERSION,event:e};n.isNone(i)||(o.value=i),n.isNone(s)||(o.listener=s);var r=JSON.stringify(o);t.parent.postMessage(r,""===this.origin?"*":this.origin)},n.Receiver.prototype.emit=function(t,e){if(!this.eventListeners.hasOwnProperty(t))return!1;n.log("Instance.emit",t,e,this.eventListeners[t]);for(var i=0;i<this.eventListeners[t].length;i++){var s=this.eventListeners[t][i];this.send(t,e,s)}return!0},n.Receiver.prototype.ready=function(){n.log("Receiver.ready"),this.isReady=!0;var e={src:t.location.toString(),events:this.supported.events,methods:this.supported.methods};this.emit("ready",e)||this.send("ready",e)},n.HTML5Adapter=function(t){return this instanceof n.HTML5Adapter?void this.init(t):new n.HTML5Adapter(t)},n.HTML5Adapter.prototype.init=function(t){n.assert(t,"playerjs.VideoJSReceiver requires a video element");var e=this.receiver=new n.Receiver;t.addEventListener("playing",function(){e.emit("play")}),t.addEventListener("pause",function(){e.emit("pause")}),t.addEventListener("ended",function(){e.emit("ended")}),t.addEventListener("timeupdate",function(){e.emit("timeupdate",{seconds:t.currentTime,duration:t.duration})}),t.addEventListener("progress",function(){e.emit("buffered",{percent:t.buffered.length})}),e.on("play",function(){t.play()}),e.on("pause",function(){t.pause()}),e.on("getPaused",function(e){e(t.paused)}),e.on("getCurrentTime",function(e){e(t.currentTime)}),e.on("setCurrentTime",function(e){t.currentTime=e}),e.on("getDuration",function(e){e(t.duration)}),e.on("getVolume",function(e){e(100*t.volume)}),e.on("setVolume",function(e){t.volume=e/100}),e.on("mute",function(){t.muted=!0}),e.on("unmute",function(){t.muted=!1}),e.on("getMuted",function(e){e(t.muted)}),e.on("getLoop",function(e){e(t.loop)}),e.on("setLoop",function(e){t.loop=e})},n.HTML5Adapter.prototype.ready=function(){this.receiver.ready()},n.JWPlayerAdapter=function(t){return this instanceof n.JWPlayerAdapter?void this.init(t):new n.JWPlayerAdapter(t)},n.JWPlayerAdapter.prototype.init=function(t){n.assert(t,"playerjs.JWPlayerAdapter requires a player object");var e=this.receiver=new n.Receiver;this.looped=!1,t.onPause(function(){e.emit("pause")}),t.onPlay(function(){e.emit("play")}),t.onTime(function(t){var i=t.position,n=t.duration;if(!i||!n)return!1;var s={seconds:i,duration:n};e.emit("timeupdate",s)});var i=this;t.onComplete(function(){i.looped===!0?t.seek(0):e.emit("ended")}),t.onError(function(){e.emit("error")}),e.on("play",function(){t.play(!0)}),e.on("pause",function(){t.pause(!0)}),e.on("getPaused",function(e){e("PLAYING"!==t.getState())}),e.on("getCurrentTime",function(e){e(t.getPosition())}),e.on("setCurrentTime",function(e){t.seek(e)}),e.on("getDuration",function(e){e(t.getDuration())
}),e.on("getVolume",function(e){e(t.getVolume())}),e.on("setVolume",function(e){t.setVolume(e)}),e.on("mute",function(){t.setMute(!0)}),e.on("unmute",function(){t.setMute(!1)}),e.on("getMuted",function(e){e(t.getMute()===!0)}),e.on("getLoop",function(t){t(this.looped)},this),e.on("setLoop",function(t){this.looped=t},this)},n.JWPlayerAdapter.prototype.ready=function(){this.receiver.ready()},n.MockAdapter=function(){return this instanceof n.MockAdapter?void this.init():new n.MockAdapter},n.MockAdapter.prototype.init=function(){var t={duration:20,currentTime:0,interval:null,timeupdate:function(){},volume:100,mute:!1,playing:!1,loop:!1,play:function(){t.interval=setInterval(function(){t.currentTime+=.25,t.timeupdate({seconds:t.currentTime,duration:t.duration})},250),t.playing=!0},pause:function(){clearInterval(t.interval),t.playing=!1}},e=this.receiver=new n.Receiver;e.on("play",function(){var e=this;t.play(),this.emit("play"),t.timeupdate=function(t){e.emit("timeupdate",t)}}),e.on("pause",function(){t.pause(),this.emit("pause")}),e.on("getPaused",function(e){e(!t.playing)}),e.on("getCurrentTime",function(e){e(t.currentTime)}),e.on("setCurrentTime",function(e){t.currentTime=e}),e.on("getDuration",function(e){e(t.duration)}),e.on("getVolume",function(e){e(t.volume)}),e.on("setVolume",function(e){t.volume=e}),e.on("mute",function(){t.mute=!0}),e.on("unmute",function(){t.mute=!1}),e.on("getMuted",function(e){e(t.mute)}),e.on("getLoop",function(e){e(t.loop)}),e.on("setLoop",function(e){t.loop=e})},n.MockAdapter.prototype.ready=function(){this.receiver.ready()},n.SublimeAdapter=function(t){return this instanceof n.SublimeAdapter?void this.init(t):new n.SublimeAdapter(t)},n.SublimeAdapter.prototype.events=[n.EVENTS.READY,n.EVENTS.PLAY,n.EVENTS.PAUSE,n.EVENTS.ENDED,n.EVENTS.TIMEUPDATE,n.EVENTS.ERROR],n.SublimeAdapter.prototype.methods=[n.METHODS.PLAY,n.METHODS.PAUSE,n.METHODS.GETDURATION,n.METHODS.SETCURRENTTIME,n.METHODS.GETCURRENTTIME,n.METHODS.REMOVEEVENTLISTENER,n.METHODS.ADDEVENTLISTENER],n.SublimeAdapter.prototype.init=function(t){n.assert(t,"playerjs.SublimeAdapter requires a player object");var e=this.receiver=new n.Receiver(this.events,this.methods);t.on("pause",function(){e.emit("pause")}),t.on("play",function(){e.emit("play")}),t.on("timeUpdate",function(t,i){var n=t.duration();if(!i||!n)return!1;var s={seconds:i,duration:n};e.emit("timeupdate",s)}),t.on("end",function(){e.emit("ended")}),e.on("play",function(){t.play()}),e.on("pause",function(){t.pause()}),e.on("getCurrentTime",function(e){e(t.playbackTime())}),e.on("setCurrentTime",function(e){t.seekTo(e)}),e.on("getDuration",function(e){e(t.duration())})},n.SublimeAdapter.prototype.ready=function(){this.receiver.ready()},n.VideoJSAdapter=function(t){return this instanceof n.VideoJSAdapter?void this.init(t):new n.VideoJSAdapter(t)},n.VideoJSAdapter.prototype.init=function(t){n.assert(t,"playerjs.VideoJSReceiver requires a player object");var e=this.receiver=new n.Receiver;t.on("pause",function(){e.emit("pause")}),t.on("play",function(){e.emit("play")}),t.on("timeupdate",function(){var i=t.currentTime(),n=t.duration();if(!i||!n)return!1;var s={seconds:i,duration:n};e.emit("timeupdate",s)}),t.on("ended",function(){e.emit("ended")}),t.on("error",function(){e.emit("error")}),e.on("play",function(){t.play()}),e.on("pause",function(){t.pause()}),e.on("getPaused",function(e){e(t.paused())}),e.on("getCurrentTime",function(e){e(t.currentTime())}),e.on("setCurrentTime",function(e){t.currentTime(e)}),e.on("getDuration",function(e){e(t.duration())}),e.on("getVolume",function(e){e(100*t.volume())}),e.on("setVolume",function(e){t.volume(e/100)}),e.on("mute",function(){t.volume(0)}),e.on("unmute",function(){t.volume(1)}),e.on("getMuted",function(e){e(0===t.volume())}),e.on("getLoop",function(e){e(t.loop())}),e.on("setLoop",function(e){t.loop(e)})},n.VideoJSAdapter.prototype.ready=function(){this.receiver.ready()},n}(window,document)),define("text!portal/templates/portal_post.ejs.html",[],function(){return'<div class="post-style-<%= headline_style %>">\n  <div class="post-loader">...</div>\n  <div class="post-rail">\n    <%= partial(\'pubdate\') %>\n    <div class="share-post">\n      <i class="share-post-icon"></i>\n    </div>\n  </div>\n  <%= partial(\'content\') %>\n  <% if (post_url) { %>\n  <a href="<%= post_url %>" class="post-link-mask"></a>\n  <% } %>\n</div>'}),define("text!portal/templates/post_content.ejs.html",[],function(){return"<div class=\"post-content\">\n  <%= partial('image') %>\n  <%= partial('button') %>\n  <%= partial('twitter_meta') %>\n  <% if (title) { %>\n  <header>\n    <% if (headline_style == 'video_live') { %>\n    <i class=\"post-style-badge\">Live</i>\n    <% } else if (headline_style == 'breaking') { %>\n    <i class=\"post-style-badge\">Breaking</i>\n    <% } %>\n    <%= title %>\n  </header>\n  <% } %>\n  <% if (summaries.length == 1) { %>\n  <p>\n    <% if (headline_style == 'quote') { %><q><% } %><% if (!title && headline_style == 'video_live') { %><i class=\"post-style-badge\">Live</i><% } else if (!title && headline_style == 'breaking') { %><i class=\"post-style-badge\">Breaking</i><% } %><%= (headline_style == 'twitter') ? linkTweetContent(linkUrls(trim(summaries[0].body, true))) : timesStyle(toSmartQuotes(trim(summaries[0].body, true))) %><% if (headline_style == 'quote') { %></q><% } %>\n  </p>\n  <% } else if (summaries.length > 1) { %>\n  <ul>\n    <% _.each(summaries, function(summary) { %>\n      <li><%= (headline_style == 'twitter') ? linkTweetContent(linkUrls(trim(summary.body, true))) : timesStyle(toSmartQuotes(trim(summary.body, true))) %></li>\n    <% }) %>\n  </ul>\n  <% } %>\n  <%= partial('footer') %>\n</div>"}),define("text!portal/templates/pubdate.ejs.html",[],function(){return"<% var pubdate = moment.unix(date_published); %>\n<% var isRecent = moment().diff(pubdate, 'minutes') < 5; %>\n<div class=\"post-timestamp\">\n  <i class=\"post-icon<%= (isRecent) ? ' recent' : '' %>\"><%= (headline_style == 'live') ? 'live' : '' %></i>\n  <time datetime=\"<%= date_published %>\" class=\"<%= (isRecent) ? 'recent' : '' %>\"><%= pubdate.fromNow(true) %></time>\n</div>"}),define("text!portal/templates/twitter_intents.ejs.html",[],function(){return'<div class="intents">\n  <% var tweetId = ((asset.url || \'\').match(/status\\/([0-9]+)/) || [])[1] %>\n  <a class="twitter-intent twitter-intent-reply" href="https://twitter.com/intent/tweet?in_reply_to=<%= tweetId %>">TW</a>\n  <a class="twitter-intent twitter-intent-retweet" href="https://twitter.com/intent/retweet?tweet_id=<%= tweetId %>">RT</a>\n  <a class="twitter-intent twitter-intent-favorite" href="https://twitter.com/intent/favorite?tweet_id=<%= tweetId %>">FAV</a>\n</div>'}),define("text!portal/templates/button.ejs.html",[],function(){return'<% if (call_to_action || button) { %>\n<div class="<%= buttonClass %>">\n  <% if (call_to_action) { %>\n  <%= call_to_action %>\n  <% } else if (button) { %>\n  <a href="<%= button.url %>"><%= button.text %></a>\n  <% } %>\n</div>\n<% } %>'}),define("text!portal/templates/post_image.ejs.html",[],function(){return'<% if (image) { %>\n<figure id="post-image-<%= id %>" class="post-image <%= \'youtube-\' + image.from_youtube %> <%= \'image-style-\' + image.image_style %><% if (!image.credit) { %> no-caption<% } %>">\n  <div class="post-image-frame">\n    <div id="post-image-frame-inner-<%= id %>" class="post-image-frame-inner">\n      <img src="<%= image.url %>"/>\n    </div>\n    <i class="playhead"><span><%= (linkIsExternal && !playsInline) ? \'Watch Video\' + ((footer) ? \' at \' + footer : \'\') : \'Play Video\' %></span></i>\n  </div>\n  <% if (display_asset_style == \'wide\' && image.credit) { %>\n  <figcaption>\n    <span class="credit"><%= image.credit %></span>\n  </figcaption>\n  <% } %>\n</figure>\n<% } %>'}),define("text!portal/templates/post_nytvideo.ejs.html",[],function(){return'<% if (nytvideo) { %>\n<figure class="post-video" id="video-<%= nytvideo.id %>" data-videoid="<%= nytvideo.id %>" data-media-action="modal" data-autoplay="false" data-video-url="">\n  <div class="post-video-frame">\n    <div class="post-video-frame-inner">\n      <img src="<%= nytvideo.url %>" />\n    </div>\n    <i class="playhead media-action-overlay"><span>Play Video</span></i>\n  </div>\n  <figcaption>\n    <span class="credit"><%= nytvideo.credit %></span>\n  </figcaption>\n</figure>\n<% } %>'}),define("text!portal/templates/footer.ejs.html",[],function(){return'<% if (footer) { %>\n  <footer><%= footer %><i class="external-icon"></i></footer>\n<% } %>'}),define("text!portal/templates/twitter_meta.ejs.html",[],function(){return'<% if (headline_style == \'twitter\' && asset.twitter_name) { %>\n\n  <div class="<%= buttonClass %>">\n    <a href="https://twitter.com/intent/user?screen_name=<%= asset.twitter_username %>">Follow</a>\n  </div>\n\n  <div class="twitter-meta">\n    <figure class="post-image image-style-headshot">\n      <div class="post-image-frame">\n        <img src="<%= asset.avatar %>" />\n      </div>\n    </figure>\n    <div class="tweet-credits">\n      <p class="tweet-name"><%= asset.twitter_name %></p>\n      <p class="tweet-username">@<%= asset.twitter_username %></p>\n    </div>\n    \n  </div>\n<% } %>'}),define("portal/views/post",["jquery/nyt","underscore/nyt","portal/views/base","undercut","moment","portal/views/share","portal/template_helpers","twitter_intents","vhs","playerjs","text!portal/templates/portal_post.ejs.html","text!portal/templates/post_content.ejs.html","text!portal/templates/pubdate.ejs.html","text!portal/templates/twitter_intents.ejs.html","text!portal/templates/button.ejs.html","text!portal/templates/post_image.ejs.html","text!portal/templates/post_nytvideo.ejs.html","text!portal/templates/footer.ejs.html","text!portal/templates/twitter_meta.ejs.html"],function(t,e,i,n,s,o,r,a,l,d,c,u,h,p,f,m,g,v,y){s.lang("en",{relativeTime:{future:"in %s",past:"%s ago",s:"now",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:"%dd",M:"1mo",MM:"%dmo",y:"1y",yy:"%dy"}});var _={postClass:"portal-post",buttonClass:"post-button"},w=i.extend({tagName:"li",className:_.postClass,events:{},requiresRender:["summaries","title","headline_style","display_asset","display_asset_style","button","call_to_action","footer","date_published"],id:function(){return _.postClass+"-"+this.model.id},initialize:function(t){this.options=e.defaults(t||{},{displayImages:!0,nytapp:null}),this.position=0,this.share=null,this.template=new n(c,{content:u,pubdate:h,twitter_intents:p,twitter_meta:y,button:f,image:m,footer:v},{playheadImg:'<%= image_path("playbutton_arrow.png") %>',moment:s,linkTweetContent:r.linkTweetContent,toSmartQuotes:r.toSmartQuotes,trim:r.trim,timesStyle:r.timesStyle,linkUrls:r.linkUrls}),this.useHiRes=window.devicePixelRatio>=2,this.videoPlayer=null,this.listen()},listen:function(){this.model.on("after-change",this.onChange,this),this.on("insert",this.adjustImageCrops)},getTrackingParams:function(t){var e=this.getSelectedImage(),i=this.model.linkIsExternal(t),n={module:"WatchingPortal",region:"c-column-middle-span-region",pgType:"Homepage",action:"click",mediaId:e?e.image_style:"none",state:this.model.get("headline_style"),contentPlacement:this.position+1,version:i?"external":"internal",contentCollection:this.model.getLinkHostname(t),contentId:t};return n},openLink:function(t,e){this.trigger("openLink",t,this.model),this.model.linkIsExternal(t)||e===!0?this.openNew(t):this.openHere(this.setQsParams(t,this.getTrackingParams(t)))},openIntent:function(t){a.openIntent(t)},openShare:function(t){return t.stopPropagation(),o.notImplemented?!1:(this.share||(this.share=new o({post:this,trigger:this.$el.find(".share-post-icon")})),void this.share.show())},closeShare:function(t){t.stopPropagation(),this.share&&this.share.hide(t)},onChange:function(){var t=e.keys(this.model.changedAttributes()||{});e.intersection(t,this.requiresRender).length&&this.render("updated")},onClick:function(i){var n=t(i.target),s=this.model.get("post_url"),o=e.bind(function(){s&&!this.elemIsIntent(i.target)&&this.openLink(s,this.isCmdClick(i))},this);n.is("a")||n.parents("a").length?this.onClickInlineLink(i):this.model.isVideo()&&!this.videoPlayer&&n.parents(".post-image .post-image-frame").length?this.activateVideo(i)||o():o()},onMouseover:function(e){t(e.target),this.elemIsShare(e.target)&&this.openShare(e)},onMouseout:function(t){this.elemIsShare(t.target)&&this.closeShare(t)},onClickInlineLink:function(e){var i=t(e.target),n=i.is("a")?i:i.parents("a"),s=n.attr("href"),o=a.getIntent(n);e.stopPropagation(),e.preventDefault(),o?this.openIntent(o):this.openLink(s,this.isCmdClick(e))},isCmdClick:function(t){return t.metaKey===!0||t.ctrlKey===!0},elemIsButton:function(e){return t(e).parent().hasClass(_.buttonClass)},elemIsIntent:function(e){return t(e).hasClass("twitter-intent")},elemIsShare:function(e){var i=t(e);return i.hasClass("share-post-icon")||i.hasClass("share-post")&&i.parents(".share-active").length},renderTimestamp:function(){var e=this.template.renderPartial("pubdate",this.present());this.$el.find(".post-timestamp").replaceWith(t(e))},getSelectedImage:function(t){var i,n,s=this.model.get("display_asset"),o=s?s.sectionFrontImages?s.sectionFrontImages[0].crops:s.crops:null,r={wide:"videoSmall",thumb:"thumbWide",thumb_square:"thumbStandard",wide2x:"videoLarge"},a=this.options.displayImages;return t=r[a]?t&&t!==a?null:a:t||this.model.get("display_asset_style"),a&&t&&s&&o?(i=o[r[t]],n=i?i:t==this.model.get("display_asset_style")?o.external:null,"wide"===t&&i&&this.useHiRes&&(n=o[r.wide2x]||n),n?e.extend({},n,{credit:s.credit,caption:s.caption,image_style:t,from_youtube:null!==n.url.match("ytimg.com")}):null):null},adjustImageCrops:function(){var t,e,i,n,s=this.getSelectedImage();s&&this.$el.parent().length&&(t=this.$el.find(".post-image img").filter(function(){return this.getAttribute("src")===s.url}),1==t.length&&(i=t.parent(),e=Math.round(i.width()/s.width*s.height),n=e-i.height(),n>0&&t.css("marginTop",-1*Math.floor(n/2))))},activateVideo:function(t){var e=this.model.getAssetProp("embed_html"),i=this.$el.find(".post-image"),n=!1;return(e||this.model.hasNYTVideo())&&i.length&&(n=e?this.activateExternalVideo(i):this.activateNYTVideo(i)),n&&t&&(t.preventDefault(),t.stopPropagation()),n},enlargeImage:function(t){t=t||this.$el.find(".post-image"),t.addClass("image-style-wide").removeClass("image-style-thumb_square")},activateNYTVideo:function(t){var e,i=t.find(".post-image-frame-inner"),n=i.height();return t.height()-n,this.enlargeImage(t),e=l.player({container:"post-image-"+this.model.id,id:this.model.get("video_id"),height:n,width:i.width(),preload:"auto",type:"watching",ads:!0,siteSection:"homepage_watching_homepage"}),this.trigger("addPlayer",e,!0),this.videoPlayer=!0,!0},activateExternalVideo:function(e){var i,n=this.$el.find(".post-image-frame"),s=n.find(".post-image-frame-inner"),o=t(this.model.getAssetProp("embed_html"));return this.enlargeImage(e),o.attr({height:s.height(),width:s.width()}),s.replaceWith(o),n.addClass("video-active"),i=d.Player(o[0]),this.trigger("addPlayer",i),this.videoPlayer=!0,!0},getNYTVideoFooter:function(){return this.model.isVideo()&&this.model.hasNYTVideo()&&!this.model.get("footer")?'The New York Times | Watch the full-size video <a href="'+this.model.get("post_url")+'">here</a>.':null},present:function(){var t={id:null,headline_style:"",asset:{},summaries:[],title:null,date_published:null,footer:this.getNYTVideoFooter(),image:this.getSelectedImage(),display_asset_style:null,button:null,call_to_action:null,buttonClass:_.buttonClass,isLinked:this.model.isLinked(),linkIsExternal:this.model.linkIsExternal(),playsInline:this.model.isVideo()&&(this.model.getAssetProp("embed_html")||this.model.get("video_id")),post_url:null};return this.model.present(t)},render:function(t){t=t?e.isArray(t)?t:[t]:[];var i=this.template.render(this.present());this.model.isLinked()&&t.push("linked-post"),this.model.linkIsExternal()&&t.push("external-link"),this.el.className=[this.className].concat(t).join(" "),this.$el.html(i).data("cid",this.model.id),this.videoPlayer&&this.activateVideo(),this.adjustImageCrops(),this.trigger("render")}},{className:_.postClass});return w}),function(t){"function"==typeof define&&define.amd?define("detect",[],t):t()}(function(){var t,e,i,n,s,o,r=window.navigator.userAgent,a=window.navigator.platform;return/MSIE/.test(r)?(t="Internet Explorer",/IEMobile/.test(r)&&(i=1),e=/MSIE \d+[.]\d+/.exec(r)[0].split(" ")[1]):/Chrome/.test(r)?(/CrOS/.test(r)&&(a="CrOS"),t="Chrome",e=/Chrome\/[\d\.]+/.exec(r)[0].split("/")[1]):/Opera/.test(r)?(t="Opera",(/mini/.test(r)||/Mobile/.test(r))&&(i=1)):/Android/.test(r)?(t="Android Webkit Browser",i=1,n=(/Android\s[\.\d]+/.exec(r)||[null])[0]):/Firefox/.test(r)?(t="Firefox",/Fennec/.test(r)&&(i=1),e=/Firefox\/[\.\d]+/.exec(r)[0].split("/")[1]):/Safari/.test(r)&&(t="Safari",(/iPhone/.test(r)||/iPad/.test(r)||/iPod/.test(r))&&(n="iOS",i=1)),e||(e=/Version\/[\.\d]+/.exec(r),e=e?e[0].split("/")[1]:(/Opera\/[\.\d]+/.exec(r)||[""])[0].split("/")[1]),"MacIntel"===a||"MacPPC"===a?(n="Mac OS X",s=(/10[\.\_\d]+/.exec(r)||[])[0],/[\_]/.test(s)&&(s=s.split("_").join("."))):"CrOS"===a?n="ChromeOS":"Win32"===a||"Win64"==a?(n="Windows",o=a.replace(/[^0-9]+/,"")):!n&&/Android/.test(r)?n="Android":!n&&/Linux/.test(a)?n="Linux":!n&&/Windows/.test(r)&&(n="Windows"),{browser:t,version:e,mobile:i,os:n,osversion:s,bit:o}}),define("portal/models/session",["jquery/nyt","underscore/nyt","backbone/nyt"],function(t,e,i){var n=i.Model.extend({constructor:function(t){if(i.Model.apply(this,null,t),t=t||{},this.key=t.key,!this.key)throw"Session cannot be initialized with a key (options.key).";this.storage=t.persistent===!0?window.localStorage:window.sessionStorage,this.set(this.getSession()),this.on("change",this.setSession),this.on("destroy",this.removeSession)},get:function(t){return this.getSession()[t]},getSession:function(){return this.storage?JSON.parse(this.storage.getItem(this.key)||"{}"):{}},setSession:function(){if(this.storage)try{this.storage.setItem(this.key,JSON.stringify(this.toJSON()))}catch(t){}},removeSession:function(){this.storage&&this.storage.removeItem(this.key),this.clear({silent:!0})}});return n}),define("portal/collections/players",["jquery/nyt","underscore/nyt","backbone/nyt","playerjs"],function(t,e,i){var n=i.Model.extend({defaults:{pausedAt:0,playing:!1,player:null,isNYT:!1},initialize:function(){this.isNYT=this.get("isNYT"),this.on("change:player",this.listen),this.onReady(this.listen)},listen:function(){var t=this.get("player"),e=this;t.on("play",function(){var t=e.get("pausedAt");e.set("playing",!0),e.setCurrentTime(t)}),t.on("pause",function(){e.set("playing",!1),e.getCurrentTime(function(t){e.set("pausedAt",t)})})},onReady:function(t){var i=this.get("player");i.on("ready",e.bind(t,this))},pause:function(){this.get("player").pause()},play:function(){this.get("player").on("ready",function(){this.play()})},getCurrentTime:function(t){this.get("player").getCurrentTime(t)},setCurrentTime:function(t){var e=this.get("player");e.on("ready",function(){e.setCurrentTime(t)})}}),s=n.extend({onReady:function(t){var i=this.get("player");i.loaded(e.bind(t,this))},pause:function(){this.get("player").pause()},play:function(){this.get("player").on("ready",function(){this.play()})},getCurrentTime:function(){},setCurrentTime:function(){}}),o=i.Collection.extend({model:n,initialize:function(){this.on("change:playing",function(t){t.get("playing")===!0&&this.pauseAll(t)})},add:function(t){var e=t.isNYT?new s(t):new n(t);i.Collection.prototype.add.apply(this,[e])},pauseAll:function(t){this.each(function(e){e!=t&&e.pause()})},hasActive:function(){return!!this.findWhere({playing:!0})}});return o}),function(t){"function"==typeof define&&define.amd?define("jquery.mousewheel",["jquery/nyt"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var r=e||window.event,a=l.call(arguments,1),d=0,u=0,h=0,p=0,f=0,m=0;if(e=t.event.fix(r),e.type="mousewheel","detail"in r&&(h=-1*r.detail),"wheelDelta"in r&&(h=r.wheelDelta),"wheelDeltaY"in r&&(h=r.wheelDeltaY),"wheelDeltaX"in r&&(u=-1*r.wheelDeltaX),"axis"in r&&r.axis===r.HORIZONTAL_AXIS&&(u=-1*h,h=0),d=0===h?u:h,"deltaY"in r&&(h=-1*r.deltaY,d=h),"deltaX"in r&&(u=r.deltaX,0===h&&(d=-1*u)),0!==h||0!==u){if(1===r.deltaMode){var g=t.data(this,"mousewheel-line-height");d*=g,h*=g,u*=g}else if(2===r.deltaMode){var v=t.data(this,"mousewheel-page-height");d*=v,h*=v,u*=v}if(p=Math.max(Math.abs(h),Math.abs(u)),(!o||o>p)&&(o=p,n(r,p)&&(o/=40)),n(r,p)&&(d/=40,u/=40,h/=40),d=Math[d>=1?"floor":"ceil"](d/o),u=Math[u>=1?"floor":"ceil"](u/o),h=Math[h>=1?"floor":"ceil"](h/o),c.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();f=e.clientX-y.left,m=e.clientY-y.top}return e.deltaX=u,e.deltaY=h,e.deltaFactor=o,e.offsetX=f,e.offsetY=m,e.deltaMode=0,a.unshift(e,d,u,h),s&&clearTimeout(s),s=setTimeout(i,200),(t.event.dispatch||t.event.handle).apply(this,a)}}function i(){o=null}function n(t,e){return c.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120===0}var s,o,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(t.event.fixHooks)for(var d=r.length;d;)t.event.fixHooks[r[--d]]=t.event.mouseHooks;var c=t.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var i=a.length;i;)this.addEventListener(a[--i],e,!1);else this.onmousewheel=e;t.data(this,"mousewheel-line-height",c.getLineHeight(this)),t.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=a.length;i;)this.removeEventListener(a[--i],e,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var i=t(e)["offsetParent"in t.fn?"offsetParent":"parent"]();return i.length||(i=t("body")),parseInt(i.css("fontSize"),10)},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),function(t){"function"==typeof define&&define.amd?define("jquery.mCustomScrollbar",["jquery/nyt"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){var e="mCustomScrollbar",i="mCS",n=".mCustomScrollbar",s={setWidth:!1,setHeight:!1,setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,autoHideScrollbar:!1,autoExpandScrollbar:!1,alwaysShowScrollbar:0,snapAmount:null,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1,disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{enable:!1,scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,advanced:{autoExpandHorizontalScroll:!1,autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:!0,updateOnSelectorChange:!1},theme:"light",callbacks:{onScrollStart:!1,onScroll:!1,onTotalScroll:!1,onTotalScrollBack:!1,whileScrolling:!1,onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0},live:!1,liveSelector:null},o=0,r={},a=function(t){r[t]&&(clearTimeout(r[t]),u._delete.call(null,r[t]))},l=window.attachEvent&&!window.addEventListener?1:0,d=!1,c={init:function(e){var e=t.extend(!0,{},s,e),l=u._selector.call(this);if(e.live){var d=e.liveSelector||this.selector||n,h=t(d);if("off"===e.live)return void a(d);r[d]=setTimeout(function(){h.mCustomScrollbar(e),"once"===e.live&&h.length&&a(d)},500)}else a(d);return e.setWidth=e.set_width?e.set_width:e.setWidth,e.setHeight=e.set_height?e.set_height:e.setHeight,e.axis=e.horizontalScroll?"x":u._findAxis.call(null,e.axis),e.scrollInertia=e.scrollInertia<17?17:e.scrollInertia,"object"!=typeof e.mouseWheel&&1==e.mouseWheel&&(e.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),e.mouseWheel.scrollAmount=e.mouseWheelPixels?e.mouseWheelPixels:e.mouseWheel.scrollAmount,e.mouseWheel.normalizeDelta=e.advanced.normalizeMouseWheelDelta?e.advanced.normalizeMouseWheelDelta:e.mouseWheel.normalizeDelta,e.scrollButtons.scrollType=u._findScrollButtonsType.call(null,e.scrollButtons.scrollType),u._theme.call(null,e),t(l).each(function(){var n=t(this);if(!n.data(i)){n.data(i,{idx:++o,opt:e,scrollRatio:{y:null,x:null},overflowed:null,bindEvents:!1,tweenRunning:!1,sequential:{},langDir:n.css("direction"),cbOffsets:null,trigger:null});var s=n.data(i).opt,r=n.data("mcs-axis"),a=n.data("mcs-scrollbar-position"),l=n.data("mcs-theme");r&&(s.axis=r),a&&(s.scrollbarPosition=a),l&&(s.theme=l,u._theme.call(null,s)),u._pluginMarkup.call(this),c.update.call(null,n)}})},update:function(e){var n=e||u._selector.call(this);return t(n).each(function(){var e=t(this);if(e.data(i)){var n=e.data(i),s=n.opt,o=t("#mCSB_"+n.idx+"_container"),r=[t("#mCSB_"+n.idx+"_dragger_vertical"),t("#mCSB_"+n.idx+"_dragger_horizontal")];if(!o.length)return;n.tweenRunning&&u._stop.call(null,e),e.hasClass("mCS_disabled")&&e.removeClass("mCS_disabled"),e.hasClass("mCS_destroyed")&&e.removeClass("mCS_destroyed"),u._maxHeight.call(this),u._expandContentHorizontally.call(this),"y"===s.axis||s.advanced.autoExpandHorizontalScroll||o.css("width",u._contentWidth(o.children())),n.overflowed=u._overflowed.call(this),u._scrollbarVisibility.call(this),s.autoDraggerLength&&u._setDraggerLength.call(this),u._scrollRatio.call(this),u._bindEvents.call(this);var a=[Math.abs(o[0].offsetTop),Math.abs(o[0].offsetLeft)];"x"!==s.axis&&(n.overflowed[0]?r[0].height()>r[0].parent().height()?u._resetContentPosition.call(this):u._scrollTo.call(this,e,a[0].toString(),{dir:"y",dur:0,overwrite:"none"}):(u._resetContentPosition.call(this),"y"===s.axis?u._unbindEvents.call(this):"yx"===s.axis&&n.overflowed[1]&&u._scrollTo.call(this,e,a[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==s.axis&&(n.overflowed[1]?r[1].width()>r[1].parent().width()?u._resetContentPosition.call(this):u._scrollTo.call(this,e,a[1].toString(),{dir:"x",dur:0,overwrite:"none"}):(u._resetContentPosition.call(this),"x"===s.axis?u._unbindEvents.call(this):"yx"===s.axis&&n.overflowed[0]&&u._scrollTo.call(this,e,a[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),u._autoUpdate.call(this)}})},scrollTo:function(e,n){if("undefined"!=typeof e&&null!=e){var s=u._selector.call(this);return t(s).each(function(){var s=t(this);if(s.data(i)){var o=s.data(i),r=o.opt,a={trigger:"external",scrollInertia:r.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},l=t.extend(!0,{},a,n),d=u._arr.call(this,e),c=l.scrollInertia<17?17:l.scrollInertia;d[0]=u._to.call(this,d[0],"y"),d[1]=u._to.call(this,d[1],"x"),l.moveDragger&&(d[0]*=o.scrollRatio.y,d[1]*=o.scrollRatio.x),l.dur=c,setTimeout(function(){null!==d[0]&&"undefined"!=typeof d[0]&&"x"!==r.axis&&o.overflowed[0]&&(l.dir="y",l.overwrite="all",u._scrollTo.call(this,s,d[0].toString(),l)),null!==d[1]&&"undefined"!=typeof d[1]&&"y"!==r.axis&&o.overflowed[1]&&(l.dir="x",l.overwrite="none",u._scrollTo.call(this,s,d[1].toString(),l))},60)}})}},stop:function(){var e=u._selector.call(this);return t(e).each(function(){var e=t(this);e.data(i)&&u._stop.call(null,e)})},disable:function(e){var n=u._selector.call(this);return t(n).each(function(){var n=t(this);if(n.data(i)){var s=n.data(i);s.opt,u._autoUpdate.call(this,"remove"),u._unbindEvents.call(this),e&&u._resetContentPosition.call(this),u._scrollbarVisibility.call(this,!0),n.addClass("mCS_disabled")}})},destroy:function(){var n=u._selector.call(this);return t(n).each(function(){var s=t(this);if(s.data(i)){var o=s.data(i),r=o.opt,l=t("#mCSB_"+o.idx),d=t("#mCSB_"+o.idx+"_container"),c=t(".mCSB_"+o.idx+"_scrollbar");r.live&&a(n),u._autoUpdate.call(this,"remove"),u._unbindEvents.call(this),u._resetContentPosition.call(this),s.removeData(i),u._delete.call(null,this.mcs),c.remove(),l.replaceWith(d.contents()),s.removeClass(e+" _"+i+"_"+o.idx+" mCS-autoHide mCS-dir-rtl mCS_no_scrollbar mCS_disabled").addClass("mCS_destroyed")}})}},u={_selector:function(){return"object"!=typeof t(this)||t(this).length<1?n:this},_theme:function(e){var i=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],n=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],s=["minimal","minimal-dark"],o=["minimal","minimal-dark"],r=["minimal","minimal-dark"];e.autoDraggerLength=t.inArray(e.theme,i)>-1?!1:e.autoDraggerLength,e.autoExpandScrollbar=t.inArray(e.theme,n)>-1?!1:e.autoExpandScrollbar,e.scrollButtons.enable=t.inArray(e.theme,s)>-1?!1:e.scrollButtons.enable,e.autoHideScrollbar=t.inArray(e.theme,o)>-1?!0:e.autoHideScrollbar,e.scrollbarPosition=t.inArray(e.theme,r)>-1?"outside":e.scrollbarPosition},_findAxis:function(t){return"yx"===t||"xy"===t||"auto"===t?"yx":"x"===t||"horizontal"===t?"x":"y"},_findScrollButtonsType:function(t){return"stepped"===t||"pixels"===t||"step"===t||"click"===t?"stepped":"stepless"},_pluginMarkup:function(){var n=t(this),s=n.data(i),o=s.opt,r=o.autoExpandScrollbar?" mCSB_scrollTools_onDrag_expand":"",a=["<div id='mCSB_"+s.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+s.idx+"_scrollbar mCS-"+o.theme+" mCSB_scrollTools_vertical"+r+"'><div class='mCSB_draggerContainer'><div id='mCSB_"+s.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+s.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+s.idx+"_scrollbar mCS-"+o.theme+" mCSB_scrollTools_horizontal"+r+"'><div class='mCSB_draggerContainer'><div id='mCSB_"+s.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],l="yx"===o.axis?"mCSB_vertical_horizontal":"x"===o.axis?"mCSB_horizontal":"mCSB_vertical",d="yx"===o.axis?a[0]+a[1]:"x"===o.axis?a[1]:a[0],c="yx"===o.axis?"<div id='mCSB_"+s.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",h=o.autoHideScrollbar?" mCS-autoHide":"",p="x"!==o.axis&&"rtl"===s.langDir?" mCS-dir-rtl":"";o.setWidth&&n.css("width",o.setWidth),o.setHeight&&n.css("height",o.setHeight),o.setLeft="y"!==o.axis&&"rtl"===s.langDir?"989999px":o.setLeft,n.addClass(e+" _"+i+"_"+s.idx+h+p).wrapInner("<div id='mCSB_"+s.idx+"' class='mCustomScrollBox mCS-"+o.theme+" "+l+"'><div id='mCSB_"+s.idx+"_container' class='mCSB_container' style='position:relative; top:"+o.setTop+"; left:"+o.setLeft+";' dir="+s.langDir+" /></div>");var f=t("#mCSB_"+s.idx),m=t("#mCSB_"+s.idx+"_container");"y"===o.axis||o.advanced.autoExpandHorizontalScroll||m.css("width",u._contentWidth(m.children())),"outside"===o.scrollbarPosition?("static"===n.css("position")&&n.css("position","relative"),n.css("overflow","visible"),f.addClass("mCSB_outside").after(d)):(f.addClass("mCSB_inside").append(d),m.wrap(c)),u._scrollButtons.call(this);var g=[t("#mCSB_"+s.idx+"_dragger_vertical"),t("#mCSB_"+s.idx+"_dragger_horizontal")];g[0].css("min-height",g[0].height()),g[1].css("min-width",g[1].width())},_contentWidth:function(e){return Math.max.apply(Math,e.map(function(){return t(this).outerWidth(!0)}).get())},_expandContentHorizontally:function(){var e=t(this),n=e.data(i),s=n.opt,o=t("#mCSB_"+n.idx+"_container");s.advanced.autoExpandHorizontalScroll&&"y"!==s.axis&&o.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(o[0].getBoundingClientRect().right+.4)-Math.floor(o[0].getBoundingClientRect().left),position:"relative"}).unwrap()},_scrollButtons:function(){var e=t(this),n=e.data(i),s=n.opt,o=t(".mCSB_"+n.idx+"_scrollbar:first"),r=["<a href='#' class='mCSB_buttonUp' oncontextmenu='return false;' />","<a href='#' class='mCSB_buttonDown' oncontextmenu='return false;' />","<a href='#' class='mCSB_buttonLeft' oncontextmenu='return false;' />","<a href='#' class='mCSB_buttonRight' oncontextmenu='return false;' />"],a=["x"===s.axis?r[2]:r[0],"x"===s.axis?r[3]:r[1],r[2],r[3]];s.scrollButtons.enable&&o.prepend(a[0]).append(a[1]).next(".mCSB_scrollTools").prepend(a[2]).append(a[3])},_maxHeight:function(){var e=t(this),n=e.data(i),s=(n.opt,t("#mCSB_"+n.idx)),o=e.css("max-height"),r=-1!==o.indexOf("%"),a=e.css("box-sizing");
if("none"!==o){var l=r?e.parent().height()*parseInt(o)/100:parseInt(o);"border-box"===a&&(l-=e.innerHeight()-e.height()+(e.outerHeight()-e.innerHeight())),s.css("max-height",Math.round(l))}},_setDraggerLength:function(){var e=t(this),n=e.data(i),s=t("#mCSB_"+n.idx),o=t("#mCSB_"+n.idx+"_container"),r=[t("#mCSB_"+n.idx+"_dragger_vertical"),t("#mCSB_"+n.idx+"_dragger_horizontal")],a=[s.height()/o.outerHeight(!1),s.width()/o.outerWidth(!1)],d=[parseInt(r[0].css("min-height")),Math.round(a[0]*r[0].parent().height()),parseInt(r[1].css("min-width")),Math.round(a[1]*r[1].parent().width())],c=l&&d[1]<d[0]?d[0]:d[1],u=l&&d[3]<d[2]?d[2]:d[3];r[0].css({height:c,"max-height":r[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":d[0]+"px"}),r[1].css({width:u,"max-width":r[1].parent().width()-10})},_scrollRatio:function(){var e=t(this),n=e.data(i),s=t("#mCSB_"+n.idx),o=t("#mCSB_"+n.idx+"_container"),r=[t("#mCSB_"+n.idx+"_dragger_vertical"),t("#mCSB_"+n.idx+"_dragger_horizontal")],a=[o.outerHeight(!1)-s.height(),o.outerWidth(!1)-s.width()],l=[a[0]/(r[0].parent().height()-r[0].height()),a[1]/(r[1].parent().width()-r[1].width())];n.scrollRatio={y:l[0],x:l[1]}},_onDragClasses:function(t,e,i){var n=i?"mCSB_dragger_onDrag_expanded":"",s=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag"],o=t.closest(".mCSB_scrollTools");"active"===e?(t.toggleClass(s[0]+" "+n),o.toggleClass(s[1]),t[0]._draggable=t[0]._draggable?0:1):t[0]._draggable||("hide"===e?(t.removeClass(s[0]),o.removeClass(s[1])):(t.addClass(s[0]),o.addClass(s[1])))},_overflowed:function(){var e=t(this),n=e.data(i),s=t("#mCSB_"+n.idx),o=t("#mCSB_"+n.idx+"_container"),r=null==n.overflowed?o.height():o.outerHeight(!1),a=null==n.overflowed?o.width():o.outerWidth(!1);return[r>s.height(),a>s.width()]},_resetContentPosition:function(){var e=t(this),n=e.data(i),s=n.opt,o=t("#mCSB_"+n.idx),r=t("#mCSB_"+n.idx+"_container"),a=[t("#mCSB_"+n.idx+"_dragger_vertical"),t("#mCSB_"+n.idx+"_dragger_horizontal")];if(u._stop(e),("x"!==s.axis&&!n.overflowed[0]||"y"===s.axis&&n.overflowed[0])&&a[0].add(r).css("top",0),"y"!==s.axis&&!n.overflowed[1]||"x"===s.axis&&n.overflowed[1]){var l=dx=0;"rtl"===n.langDir&&(l=o.width()-r.outerWidth(!1),dx=Math.abs(l/n.scrollRatio.x)),r.css("left",l),a[1].css("left",dx)}},_bindEvents:function(){function e(){r=setTimeout(function(){t.event.special.mousewheel?(clearTimeout(r),u._mousewheel.call(n[0])):e()},1e3)}var n=t(this),s=n.data(i),o=s.opt;if(!s.bindEvents){if(u._draggable.call(this),o.contentTouchScroll&&u._contentDraggable.call(this),o.mouseWheel.enable){var r;e()}u._draggerRail.call(this),u._wrapperScroll.call(this),o.advanced.autoScrollOnFocus&&u._focus.call(this),o.scrollButtons.enable&&u._buttons.call(this),o.keyboard.enable&&u._keyboard.call(this),s.bindEvents=!0}},_unbindEvents:function(){var e=t(this),n=e.data(i),s=i+"_"+n.idx,o=".mCSB_"+n.idx+"_scrollbar",r=t("#mCSB_"+n.idx+",#mCSB_"+n.idx+"_container,#mCSB_"+n.idx+"_container_wrapper,"+o+" .mCSB_draggerContainer,#mCSB_"+n.idx+"_dragger_vertical,#mCSB_"+n.idx+"_dragger_horizontal,"+o+">a"),a=t("#mCSB_"+n.idx+"_container");n.bindEvents&&(t(document).unbind("."+s),r.each(function(){t(this).unbind("."+s)}),clearTimeout(e[0]._focusTimeout),u._delete.call(null,e[0]._focusTimeout),clearTimeout(n.sequential.step),u._delete.call(null,n.sequential.step),clearTimeout(a[0].onCompleteTimeout),u._delete.call(null,a[0].onCompleteTimeout),n.bindEvents=!1)},_scrollbarVisibility:function(e){var n=t(this),s=n.data(i),o=s.opt,r=t("#mCSB_"+s.idx+"_container_wrapper"),a=r.length?r:t("#mCSB_"+s.idx+"_container"),l=[t("#mCSB_"+s.idx+"_scrollbar_vertical"),t("#mCSB_"+s.idx+"_scrollbar_horizontal")],d=[l[0].find(".mCSB_dragger"),l[1].find(".mCSB_dragger")];"x"!==o.axis&&(s.overflowed[0]&&!e?(l[0].add(d[0]).add(l[0].children("a")).css("display","block"),a.removeClass("mCS_no_scrollbar_y mCS_y_hidden")):(o.alwaysShowScrollbar?(2!==o.alwaysShowScrollbar&&d[0].add(l[0].children("a")).css("display","none"),a.removeClass("mCS_y_hidden")):(l[0].css("display","none"),a.addClass("mCS_y_hidden")),a.addClass("mCS_no_scrollbar_y"))),"y"!==o.axis&&(s.overflowed[1]&&!e?(l[1].add(d[1]).add(l[1].children("a")).css("display","block"),a.removeClass("mCS_no_scrollbar_x mCS_x_hidden")):(o.alwaysShowScrollbar?(2!==o.alwaysShowScrollbar&&d[1].add(l[1].children("a")).css("display","none"),a.removeClass("mCS_x_hidden")):(l[1].css("display","none"),a.addClass("mCS_x_hidden")),a.addClass("mCS_no_scrollbar_x"))),s.overflowed[0]||s.overflowed[1]?n.removeClass("mCS_no_scrollbar"):n.addClass("mCS_no_scrollbar")},_coordinates:function(t){var e=t.type;switch(e){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return[t.originalEvent.pageY,t.originalEvent.pageX];case"touchstart":case"touchmove":case"touchend":var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];return[i.pageY,i.pageX];default:return[t.pageY,t.pageX]}},_draggable:function(){function e(t){var e=m.find("iframe");if(e.length){var i=t?"auto":"none";e.css("pointer-events",i)}}function n(t,e,i,n){if(m[0].idleTimer=h.scrollInertia<233?250:0,s.attr("id")===f[1])var o="x",r=(s[0].offsetLeft-e+n)*c.scrollRatio.x;else var o="y",r=(s[0].offsetTop-t+i)*c.scrollRatio.y;u._scrollTo(a,r.toString(),{dir:o,drag:!0})}var s,o,r,a=t(this),c=a.data(i),h=c.opt,p=i+"_"+c.idx,f=["mCSB_"+c.idx+"_dragger_vertical","mCSB_"+c.idx+"_dragger_horizontal"],m=t("#mCSB_"+c.idx+"_container"),g=t("#"+f[0]+",#"+f[1]);g.bind("mousedown."+p+" touchstart."+p+" pointerdown."+p+" MSPointerDown."+p,function(i){if(i.stopImmediatePropagation(),i.preventDefault(),u._mouseBtnLeft(i)){d=!0,l&&(document.onselectstart=function(){return!1}),e(!1),u._stop(a),s=t(this);var n=s.offset(),c=u._coordinates(i)[0]-n.top,p=u._coordinates(i)[1]-n.left,f=s.height()+n.top,m=s.width()+n.left;f>c&&c>0&&m>p&&p>0&&(o=c,r=p),u._onDragClasses(s,"active",h.autoExpandScrollbar)}}).bind("touchmove."+p,function(t){t.stopImmediatePropagation(),t.preventDefault();var e=s.offset(),i=u._coordinates(t)[0]-e.top,a=u._coordinates(t)[1]-e.left;n(o,r,i,a)}),t(document).bind("mousemove."+p+" pointermove."+p+" MSPointerMove."+p,function(t){if(s){var e=s.offset(),i=u._coordinates(t)[0]-e.top,a=u._coordinates(t)[1]-e.left;if(o===i)return;n(o,r,i,a)}}).add(g).bind("mouseup."+p+" touchend."+p+" pointerup."+p+" MSPointerUp."+p,function(){s&&(u._onDragClasses(s,"active",h.autoExpandScrollbar),s=null),d=!1,l&&(document.onselectstart=null),e(!0)})},_contentDraggable:function(){function e(t,e){var i=[1.5*e,2*e,e/1.5,e/2];return t>90?e>4?i[0]:i[3]:t>60?e>3?i[3]:i[2]:t>30?e>8?i[1]:e>6?i[0]:e>4?e:i[2]:e>8?e:i[3]}function n(t,e,i,n,s,o){t&&u._scrollTo(v,t.toString(),{dur:e,scrollEasing:i,dir:n,overwrite:s,drag:o})}var s,o,r,a,l,c,h,p,f,m,g,v=t(this),y=v.data(i),_=y.opt,w=i+"_"+y.idx,S=t("#mCSB_"+y.idx),b=t("#mCSB_"+y.idx+"_container"),E=[t("#mCSB_"+y.idx+"_dragger_vertical"),t("#mCSB_"+y.idx+"_dragger_horizontal")],T=[],C=[],k=0,P="yx"===_.axis?"none":"all";b.bind("touchstart."+w+" pointerdown."+w+" MSPointerDown."+w,function(t){if(u._pointerTouch(t)&&!d){var e=b.offset();s=u._coordinates(t)[0]-e.top,o=u._coordinates(t)[1]-e.left}}).bind("touchmove."+w+" pointermove."+w+" MSPointerMove."+w,function(t){if(u._pointerTouch(t)&&!d){t.stopImmediatePropagation(),c=u._getTime();var e=S.offset(),i=u._coordinates(t)[0]-e.top,r=u._coordinates(t)[1]-e.left,a="mcsLinearOut";if(T.push(i),C.push(r),y.overflowed[0])var l=E[0].parent().height()-E[0].height(),h=s-i>0&&i-s>-(l*y.scrollRatio.y);if(y.overflowed[1])var p=E[1].parent().width()-E[1].width(),f=o-r>0&&r-o>-(p*y.scrollRatio.x);(h||f)&&t.preventDefault(),m="yx"===_.axis?[s-i,o-r]:"x"===_.axis?[null,o-r]:[s-i,null],b[0].idleTimer=250,y.overflowed[0]&&n(m[0],k,a,"y","all",!0),y.overflowed[1]&&n(m[1],k,a,"x",P,!0)}}),S.bind("touchstart."+w+" pointerdown."+w+" MSPointerDown."+w,function(t){if(u._pointerTouch(t)&&!d){t.stopImmediatePropagation(),u._stop(v),l=u._getTime();var e=S.offset();r=u._coordinates(t)[0]-e.top,a=u._coordinates(t)[1]-e.left,T=[],C=[]}}).bind("touchend."+w+" pointerup."+w+" MSPointerUp."+w,function(t){if(u._pointerTouch(t)&&!d){t.stopImmediatePropagation(),h=u._getTime();var i=S.offset(),s=u._coordinates(t)[0]-i.top,o=u._coordinates(t)[1]-i.left;if(!(h-c>30)){f=1e3/(h-l);var v="mcsEaseOut",w=2.5>f,E=w?[T[T.length-2],C[C.length-2]]:[0,0];p=w?[s-E[0],o-E[1]]:[s-r,o-a];var k=[Math.abs(p[0]),Math.abs(p[1])];f=w?[Math.abs(p[0]/4),Math.abs(p[1]/4)]:[f,f];var x=[Math.abs(b[0].offsetTop)-p[0]*e(k[0]/f[0],f[0]),Math.abs(b[0].offsetLeft)-p[1]*e(k[1]/f[1],f[1])];m="yx"===_.axis?[x[0],x[1]]:"x"===_.axis?[null,x[1]]:[x[0],null],g=[4*k[0]+_.scrollInertia,4*k[1]+_.scrollInertia];var D=parseInt(_.contentTouchScroll)||0;m[0]=k[0]>D?m[0]:0,m[1]=k[1]>D?m[1]:0,y.overflowed[0]&&n(m[0],g[0],v,"y",P,!1),y.overflowed[1]&&n(m[1],g[1],v,"x",P,!1)}}})},_mousewheel:function(){var e=t(this),n=e.data(i),s=n.opt,o=i+"_"+n.idx,r=t("#mCSB_"+n.idx),a=[t("#mCSB_"+n.idx+"_dragger_vertical"),t("#mCSB_"+n.idx+"_dragger_horizontal")];r.bind("mousewheel."+o,function(i,o){if(u._stop(e),!u._disableMousewheel(e,i.target)){var d="auto"!==s.mouseWheel.deltaFactor?parseInt(s.mouseWheel.deltaFactor):l&&i.deltaFactor<100?100:i.deltaFactor<40?40:i.deltaFactor||100;if("x"===s.axis||"x"===s.mouseWheel.axis)var c="x",h=[Math.round(d*n.scrollRatio.x),parseInt(s.mouseWheel.scrollAmount)],p="auto"!==s.mouseWheel.scrollAmount?h[1]:h[0]>=r.width()?.9*r.width():h[0],f=Math.abs(t("#mCSB_"+n.idx+"_container")[0].offsetLeft),m=a[1][0].offsetLeft,g=a[1].parent().width()-a[1].width(),v=i.deltaX||i.deltaY||o;else var c="y",h=[Math.round(d*n.scrollRatio.y),parseInt(s.mouseWheel.scrollAmount)],p="auto"!==s.mouseWheel.scrollAmount?h[1]:h[0]>=r.height()?.9*r.height():h[0],f=Math.abs(t("#mCSB_"+n.idx+"_container")[0].offsetTop),m=a[0][0].offsetTop,g=a[0].parent().height()-a[0].height(),v=i.deltaY||o;"y"===c&&!n.overflowed[0]||"x"===c&&!n.overflowed[1]||(s.mouseWheel.invert&&(v=-v),s.mouseWheel.normalizeDelta&&(v=0>v?-1:1),(v>0&&0!==m||0>v&&m!==g||s.mouseWheel.preventDefault)&&(i.stopImmediatePropagation(),i.preventDefault()),u._scrollTo(e,(f-v*p).toString(),{dir:c}))}})},_disableMousewheel:function(e,n){var s=n.nodeName.toLowerCase(),o=e.data(i).opt.mouseWheel.disableOver,r=["select","textarea"];return t.inArray(s,o)>-1&&!(t.inArray(s,r)>-1&&!t(n).is(":focus"))},_draggerRail:function(){var e=t(this),n=e.data(i),s=i+"_"+n.idx,o=t("#mCSB_"+n.idx+"_container"),r=o.parent(),a=t(".mCSB_"+n.idx+"_scrollbar .mCSB_draggerContainer");a.bind("touchstart."+s+" pointerdown."+s+" MSPointerDown."+s,function(){d=!0}).bind("touchend."+s+" pointerup."+s+" MSPointerUp."+s,function(){d=!1}).bind("click."+s,function(i){if(t(i.target).hasClass("mCSB_draggerContainer")||t(i.target).hasClass("mCSB_draggerRail")){u._stop(e);var s=t(this),a=s.find(".mCSB_dragger");if(s.parent(".mCSB_scrollTools_horizontal").length>0){if(!n.overflowed[1])return;var l="x",d=i.pageX>a.offset().left?-1:1,c=Math.abs(o[0].offsetLeft)-.9*d*r.width()}else{if(!n.overflowed[0])return;var l="y",d=i.pageY>a.offset().top?-1:1,c=Math.abs(o[0].offsetTop)-.9*d*r.height()}u._scrollTo(e,c.toString(),{dir:l,scrollEasing:"mcsEaseInOut"})}})},_focus:function(){var e=t(this),n=e.data(i),s=n.opt,o=i+"_"+n.idx,r=t("#mCSB_"+n.idx+"_container"),a=r.parent();r.bind("focusin."+o,function(){var i=t(document.activeElement),n=r.find(".mCustomScrollBox").length,o=0;i.is(s.advanced.autoScrollOnFocus)&&(u._stop(e),clearTimeout(e[0]._focusTimeout),e[0]._focusTimer=n?(o+17)*n:0,e[0]._focusTimeout=setTimeout(function(){var t=[i.offset().top-r.offset().top,i.offset().left-r.offset().left],n=[r[0].offsetTop,r[0].offsetLeft],l=[n[0]+t[0]>=0&&n[0]+t[0]<a.height()-i.outerHeight(!1),n[1]+t[1]>=0&&n[0]+t[1]<a.width()-i.outerWidth(!1)],d="yx"!==s.axis||l[0]||l[1]?"all":"none";"x"===s.axis||l[0]||u._scrollTo(e,t[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:d,dur:o}),"y"===s.axis||l[1]||u._scrollTo(e,t[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:d,dur:o})},e[0]._focusTimer))})},_wrapperScroll:function(){var e=t(this),n=e.data(i),s=i+"_"+n.idx,o=t("#mCSB_"+n.idx+"_container").parent();o.bind("scroll."+s,function(){o.scrollTop(0).scrollLeft(0)})},_buttons:function(){var e=t(this),n=e.data(i),s=n.opt,o=n.sequential,r=i+"_"+n.idx,a=(t("#mCSB_"+n.idx+"_container"),".mCSB_"+n.idx+"_scrollbar"),l=t(a+">a");l.bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r+" mouseup."+r+" touchend."+r+" pointerup."+r+" MSPointerUp."+r+" mouseout."+r+" pointerout."+r+" MSPointerOut."+r+" click."+r,function(i){function r(t,i){o.scrollAmount=s.snapAmount||s.scrollButtons.scrollAmount,u._sequentialScroll.call(this,e,t,i)}if(i.preventDefault(),u._mouseBtnLeft(i)){var a=t(this).attr("class");switch(o.type=s.scrollButtons.scrollType,i.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===o.type)return;d=!0,n.tweenRunning=!1,r("on",a);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===o.type)return;d=!1,o.dir&&r("off",a);break;case"click":if("stepped"!==o.type||n.tweenRunning)return;r("on",a)}}})},_keyboard:function(){var e=t(this),n=e.data(i),s=n.opt,o=n.sequential,r=i+"_"+n.idx,a=t("#mCSB_"+n.idx),l=t("#mCSB_"+n.idx+"_container"),d=l.parent(),c="input,textarea,select,datalist,keygen,[contenteditable='true']";a.attr("tabindex","0").bind("blur."+r+" keydown."+r+" keyup."+r,function(i){function r(t,i){o.type=s.keyboard.scrollType,o.scrollAmount=s.snapAmount||s.keyboard.scrollAmount,"stepped"===o.type&&n.tweenRunning||u._sequentialScroll.call(this,e,t,i)}switch(i.type){case"blur":n.tweenRunning&&o.dir&&r("off",null);break;case"keydown":case"keyup":var a=i.keyCode?i.keyCode:i.which,h="on";if("x"!==s.axis&&(38===a||40===a)||"y"!==s.axis&&(37===a||39===a)){if((38===a||40===a)&&!n.overflowed[0]||(37===a||39===a)&&!n.overflowed[1])return;"keyup"===i.type&&(h="off"),t(document.activeElement).is(c)||(i.preventDefault(),i.stopImmediatePropagation(),r(h,a))}else if(33===a||34===a){if((n.overflowed[0]||n.overflowed[1])&&(i.preventDefault(),i.stopImmediatePropagation()),"keyup"===i.type){u._stop(e);var p=34===a?-1:1;if("x"===s.axis||"yx"===s.axis&&n.overflowed[1]&&!n.overflowed[0])var f="x",m=Math.abs(l[0].offsetLeft)-.9*p*d.width();else var f="y",m=Math.abs(l[0].offsetTop)-.9*p*d.height();u._scrollTo(e,m.toString(),{dir:f,scrollEasing:"mcsEaseInOut"})}}else if((35===a||36===a)&&!t(document.activeElement).is(c)&&((n.overflowed[0]||n.overflowed[1])&&(i.preventDefault(),i.stopImmediatePropagation()),"keyup"===i.type)){if("x"===s.axis||"yx"===s.axis&&n.overflowed[1]&&!n.overflowed[0])var f="x",m=35===a?Math.abs(d.width()-l.outerWidth(!1)):0;else var f="y",m=35===a?Math.abs(d.height()-l.outerHeight(!1)):0;u._scrollTo(e,m.toString(),{dir:f,scrollEasing:"mcsEaseInOut"})}}})},_sequentialScroll:function(e,n,s){function o(t){var i="stepped"!==d.type,n=t?i?l.scrollInertia/1.5:l.scrollInertia:1e3/60,s=t?i?7.5:40:2.5,r=[Math.abs(c[0].offsetTop),Math.abs(c[0].offsetLeft)],h=[a.scrollRatio.y>10?10:a.scrollRatio.y,a.scrollRatio.x>10?10:a.scrollRatio.x],p="x"===d.dir[0]?r[1]+d.dir[1]*h[1]*s:r[0]+d.dir[1]*h[0]*s,f="x"===d.dir[0]?r[1]+d.dir[1]*parseInt(d.scrollAmount):r[0]+d.dir[1]*parseInt(d.scrollAmount),m="auto"!==d.scrollAmount?f:p,g=t?i?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",v=t?!0:!1;return t&&17>n&&(m="x"===d.dir[0]?r[1]:r[0]),u._scrollTo(e,m.toString(),{dir:d.dir[0],scrollEasing:g,dur:n,onComplete:v}),t?void(d.dir=!1):(clearTimeout(d.step),void(d.step=setTimeout(function(){o()},n)))}function r(){clearTimeout(d.step),u._stop(e)}var a=e.data(i),l=a.opt,d=a.sequential,c=t("#mCSB_"+a.idx+"_container"),h="stepped"===d.type?!0:!1;switch(n){case"on":if(d.dir=["mCSB_buttonRight"===s||"mCSB_buttonLeft"===s||39===s||37===s?"x":"y","mCSB_buttonUp"===s||"mCSB_buttonLeft"===s||38===s||37===s?-1:1],u._stop(e),u._isNumeric(s)&&"stepped"===d.type)return;o(h);break;case"off":r(),(h||a.tweenRunning&&d.dir)&&o(!0)}},_arr:function(e){var n=t(this).data(i).opt,s=[];return"function"==typeof e&&(e=e()),e instanceof Array?s=e.length>1?[e[0],e[1]]:"x"===n.axis?[null,e[0]]:[e[0],null]:(s[0]=e.y?e.y:e.x||"x"===n.axis?null:e,s[1]=e.x?e.x:e.y||"y"===n.axis?null:e),"function"==typeof s[0]&&(s[0]=s[0]()),"function"==typeof s[1]&&(s[1]=s[1]()),s},_to:function(e,n){if(null!=e&&"undefined"!=typeof e){var s=t(this),o=s.data(i),r=o.opt,a=t("#mCSB_"+o.idx+"_container"),l=a.parent(),d=typeof e;n||(n="x"===r.axis?"x":"y");var h="x"===n?a.outerWidth(!1):a.outerHeight(!1),p="x"===n?a.offset().left:a.offset().top,f="x"===n?a[0].offsetLeft:a[0].offsetTop,m="x"===n?"left":"top";switch(d){case"function":return e();case"object":if(e.nodeType)var g="x"===n?t(e).offset().left:t(e).offset().top;else if(e.jquery){if(!e.length)return;var g="x"===n?e.offset().left:e.offset().top}return g-p;case"string":case"number":if(u._isNumeric.call(null,e))return Math.abs(e);if(-1!==e.indexOf("%"))return Math.abs(h*parseInt(e)/100);if(-1!==e.indexOf("-="))return Math.abs(f-parseInt(e.split("-=")[1]));if(-1!==e.indexOf("+=")){var v=f+parseInt(e.split("+=")[1]);return v>=0?0:Math.abs(v)}if(-1!==e.indexOf("px")&&u._isNumeric.call(null,e.split("px")[0]))return Math.abs(e.split("px")[0]);if("top"===e||"left"===e)return 0;if("bottom"===e)return Math.abs(l.height()-a.outerHeight(!1));if("right"===e)return Math.abs(l.width()-a.outerWidth(!1));if("first"===e||"last"===e){var y=a.find(":"+e),g="x"===n?t(y).offset().left:t(y).offset().top;return g-p}if(t(e).length){var g="x"===n?t(e).offset().left:t(e).offset().top;return g-p}return a.css(m,e),void c.update.call(null,s[0])}}},_autoUpdate:function(e){function n(){clearTimeout(p[0].autoUpdate),p[0].autoUpdate=setTimeout(function(){return h.advanced.updateOnSelectorChange&&(f=r(),f!==w)?(a(),void(w=f)):(h.advanced.updateOnContentResize&&(m=[p.outerHeight(!1),p.outerWidth(!1),v.height(),v.width(),_()[0],_()[1]],(m[0]!==S[0]||m[1]!==S[1]||m[2]!==S[2]||m[3]!==S[3]||m[4]!==S[4]||m[5]!==S[5])&&(a(),S=m)),h.advanced.updateOnImageLoad&&(g=s(),g!==b&&(p.find("img").each(function(){o(this.src)}),b=g)),void((h.advanced.updateOnSelectorChange||h.advanced.updateOnContentResize||h.advanced.updateOnImageLoad)&&n()))},60)}function s(){var t=0;return h.advanced.updateOnImageLoad&&(t=p.find("img").length),t}function o(t){function e(t,e){return function(){return e.apply(t,arguments)}}function i(){this.onload=null,a()}var n=new Image;n.onload=e(n,i),n.src=t}function r(){h.advanced.updateOnSelectorChange===!0&&(h.advanced.updateOnSelectorChange="*");var e=0,i=p.find(h.advanced.updateOnSelectorChange);return h.advanced.updateOnSelectorChange&&i.length>0&&i.each(function(){e+=t(this).height()+t(this).width()}),e}function a(){clearTimeout(p[0].autoUpdate),c.update.call(null,l[0])}var l=t(this),d=l.data(i),h=d.opt,p=t("#mCSB_"+d.idx+"_container");if(e)return clearTimeout(p[0].autoUpdate),void u._delete.call(null,p[0].autoUpdate);var f,m,g,v=p.parent(),y=[t("#mCSB_"+d.idx+"_scrollbar_vertical"),t("#mCSB_"+d.idx+"_scrollbar_horizontal")],_=function(){return[y[0].is(":visible")?y[0].outerHeight(!0):0,y[1].is(":visible")?y[1].outerWidth(!0):0]},w=r(),S=[p.outerHeight(!1),p.outerWidth(!1),v.height(),v.width(),_()[0],_()[1]],b=s();n()},_snapAmount:function(t,e,i){return Math.round(t/e)*e-i},_stop:function(e){var n=e.data(i),s=t("#mCSB_"+n.idx+"_container,#mCSB_"+n.idx+"_container_wrapper,#mCSB_"+n.idx+"_dragger_vertical,#mCSB_"+n.idx+"_dragger_horizontal");s.each(function(){u._stopTween.call(this)})},_scrollTo:function(e,n,s){function o(t){return l&&d.callbacks[t]&&"function"==typeof d.callbacks[t]}function r(){return[d.callbacks.alwaysTriggerOffsets||_>=w[0]+b,d.callbacks.alwaysTriggerOffsets||-E>=_]}function a(){var t=[f[0].offsetTop,f[0].offsetLeft],i=[v[0].offsetTop,v[0].offsetLeft],n=[f.outerHeight(!1),f.outerWidth(!1)],o=[p.height(),p.width()];e[0].mcs={content:f,top:t[0],left:t[1],draggerTop:i[0],draggerLeft:i[1],topPct:Math.round(100*Math.abs(t[0])/(Math.abs(n[0])-o[0])),leftPct:Math.round(100*Math.abs(t[1])/(Math.abs(n[1])-o[1])),direction:s.dir}}var l=e.data(i),d=l.opt,c={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:d.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},s=t.extend(c,s),h=[s.dur,s.drag?0:s.dur],p=t("#mCSB_"+l.idx),f=t("#mCSB_"+l.idx+"_container"),m=d.callbacks.onTotalScrollOffset?u._arr.call(e,d.callbacks.onTotalScrollOffset):[0,0],g=d.callbacks.onTotalScrollBackOffset?u._arr.call(e,d.callbacks.onTotalScrollBackOffset):[0,0];switch(l.trigger=s.trigger,d.snapAmount&&(n=u._snapAmount(n,d.snapAmount,d.snapOffset)),s.dir){case"x":var v=t("#mCSB_"+l.idx+"_dragger_horizontal"),y="left",_=f[0].offsetLeft,w=[p.width()-f.outerWidth(!1),v.parent().width()-v.width()],S=[n,n/l.scrollRatio.x],b=m[1],E=g[1],T=b>0?b/l.scrollRatio.x:0,C=E>0?E/l.scrollRatio.x:0;break;case"y":var v=t("#mCSB_"+l.idx+"_dragger_vertical"),y="top",_=f[0].offsetTop,w=[p.height()-f.outerHeight(!1),v.parent().height()-v.height()],S=[n,n/l.scrollRatio.y],b=m[0],E=g[0],T=b>0?b/l.scrollRatio.y:0,C=E>0?E/l.scrollRatio.y:0}S[1]<0?S=[0,0]:S[1]>=w[1]?S=[w[0],w[1]]:S[0]=-S[0],clearTimeout(f[0].onCompleteTimeout),(l.tweenRunning||!(0===_&&S[0]>=0||_===w[0]&&S[0]<=w[0]))&&(u._tweenTo.call(null,v[0],y,Math.round(S[1]),h[1],s.scrollEasing),u._tweenTo.call(null,f[0],y,Math.round(S[0]),h[0],s.scrollEasing,s.overwrite,{onStart:function(){s.callbacks&&s.onStart&&!l.tweenRunning&&(o("onScrollStart")&&(a(),d.callbacks.onScrollStart.call(e[0])),l.tweenRunning=!0,u._onDragClasses(v),l.cbOffsets=r())},onUpdate:function(){s.callbacks&&s.onUpdate&&o("whileScrolling")&&(a(),d.callbacks.whileScrolling.call(e[0]))},onComplete:function(){if(s.callbacks&&s.onComplete){"yx"===d.axis&&clearTimeout(f[0].onCompleteTimeout);var t=f[0].idleTimer||0;f[0].onCompleteTimeout=setTimeout(function(){o("onScroll")&&(a(),d.callbacks.onScroll.call(e[0])),o("onTotalScroll")&&S[1]>=w[1]-T&&l.cbOffsets[0]&&(a(),d.callbacks.onTotalScroll.call(e[0])),o("onTotalScrollBack")&&S[1]<=C&&l.cbOffsets[1]&&(a(),d.callbacks.onTotalScrollBack.call(e[0])),l.tweenRunning=!1,f[0].idleTimer=0,u._onDragClasses(v,"hide")},t)}}}))},_tweenTo:function(t,e,i,n,s,o,r){function a(){t._mcsstop||(y||f.call(),y=u._getTime()-v,l(),y>=t._mcstime&&(t._mcstime=y>t._mcstime?y+p-(y-t._mcstime):y+p-1,t._mcstime<y+1&&(t._mcstime=y+1)),t._mcstime<n?t._mcsid=_request(a):g.call())}function l(){n>0?(t._mcscurrVal=h(t._mcstime,_,S,n,s),w[e]=Math.round(t._mcscurrVal)+"px"):w[e]=i+"px",m.call()}function d(){p=1e3/60,t._mcstime=y+p,_request=window.requestAnimationFrame?window.requestAnimationFrame:function(t){return l(),setTimeout(t,.01)},t._mcsid=_request(a)}function c(){null!=t._mcsid&&(window.requestAnimationFrame?window.cancelAnimationFrame(t._mcsid):clearTimeout(t._mcsid),t._mcsid=null)}function h(t,e,i,n,s){switch(s){case"linear":case"mcsLinear":return i*t/n+e;case"mcsLinearOut":return t/=n,t--,i*Math.sqrt(1-t*t)+e;case"easeInOutSmooth":return t/=n/2,1>t?i/2*t*t+e:(t--,-i/2*(t*(t-2)-1)+e);case"easeInOutStrong":return t/=n/2,1>t?i/2*Math.pow(2,10*(t-1))+e:(t--,i/2*(-Math.pow(2,-10*t)+2)+e);case"easeInOut":case"mcsEaseInOut":return t/=n/2,1>t?i/2*t*t*t+e:(t-=2,i/2*(t*t*t+2)+e);case"easeOutSmooth":return t/=n,t--,-i*(t*t*t*t-1)+e;case"easeOutStrong":return i*(-Math.pow(2,-10*t/n)+1)+e;case"easeOut":case"mcsEaseOut":default:var o=(t/=n)*t,r=o*t;return e+i*(.499999999999997*r*o+-2.5*o*o+5.5*r+-6.5*o+4*t)}}var p,r=r||{},f=r.onStart||function(){},m=r.onUpdate||function(){},g=r.onComplete||function(){},v=u._getTime(),y=0,_=t.offsetTop,w=t.style;"left"===e&&(_=t.offsetLeft);var S=i-_;t._mcsstop=0,"none"!==o&&c(),d()},_getTime:function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},_stopTween:function(){var t=this;null!=t._mcsid&&(window.requestAnimationFrame?window.cancelAnimationFrame(t._mcsid):clearTimeout(t._mcsid),t._mcsid=null,t._mcsstop=1)},_delete:function(t){try{delete t}catch(e){t=null}},_mouseBtnLeft:function(t){return!(t.which&&1!==t.which)},_pointerTouch:function(t){var e=t.originalEvent.pointerType;return!(e&&"touch"!==e&&2!==e)},_isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},h="https:"==document.location.protocol?"https:":"http:";t.event.special.mousewheel||t("head").append(decodeURI("%3Cscript src="+h+"//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.11/jquery.mousewheel.min.js%3E%3C/script%3E")),t.fn[e]=function(e){return c[e]?c[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist"):c.init.apply(this,arguments)},t[e]=function(e){return c[e]?c[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist"):c.init.apply(this,arguments)},t[e].defaults=s,window[e]=!0,t(window).load(function(){t(n)[e]()})}),define("text!portal/templates/portal.ejs.html",[],function(){return'<div>\n  <header class="portal-header">\n    <span class="updates-available-message">Scroll to the top</span>\n    <h4>Watching</h4>\n    <span class="updates-available"></span>\n  </header>\n  <div class="portal-posts-frame expanded">\n    <ul class="portal-posts-list"></ul>\n  </div>\n  <div class="styles-indicator"></div>\n  <footer class="portal-footer">\n    <p><a href="https://jfe.qualtrics.com/form/SV_42CUIzSVlPxLfFj">Send Feedback</a></p>\n  </footer>\n</div>'}),define("text!portal/templates/daybreak.ejs.html",[],function(){return'<li class="day-break">\n  <time datetime="<%= date_published %>"><%= formatted_date %></time>\n</li>'}),define("text!portal/templates/about_message.ejs.html",[],function(){return'<li class="<%= className %>">\n  <span>This is Watching, a new feature that highlights developing news from around the web. <a href="https://jfe.qualtrics.com/form/SV_42CUIzSVlPxLfFj">Send your feedback.</a></span>\n</li>'}),define("portal/views/main",["jquery/nyt","underscore/nyt","backbone/nyt","portal/views/base","undercut","portal/views/post","moment","detect","portal/models/session","portal/collections/players","foundation/views/page-manager","jquery.mousewheel","jquery.mCustomScrollbar","text!portal/templates/portal.ejs.html","text!portal/templates/daybreak.ejs.html","text!portal/templates/about_message.ejs.html"],function(t,e,i,n,s,o,r,a,l,d,c,u,h,p,f,m){var g={frame:".portal-posts-frame",updates:".updates-available",header:".portal-header",daybreak:".day-break",post:"li."+o.className,loadingPost:".portal-post-loading",aboutPost:".portal-post-about"},v=n.extend({events:{"click .portal-posts-list li.portal-post":"delegateToPost","mouseover .portal-posts-list li.portal-post":"delegateToPost","mouseout .portal-posts-list li.portal-post":"delegateToPost","click header":"scrollToTop"},initialize:function(n){this.options=e.defaults(n||{},{displayImages:!0,nytapp:null}),e.bindAll(this,"renderPosts","addPost","removePost","applyWaitingUpdates","setupScrolling","refreshScrollPane"),this.posts=this.options.posts,this.$posts=t(),this.session=new l({key:"nyt-watching-posts"}),this.postViews={},this.PostViewClass=o,this.players=new d,this.lastLatest=this.session.get("latestPost"),this.lastViewed=this.session.get("lastViewed"),this.template=new s(p),this.daybreakTemplate=e.template(f),this.listen(),this.groomPosts(),this.updates=new i.Collection,this.sortPending=!1,this.animateDuration=200,this.postClicksDisabled=!1,this.scrollPane=null,this.preventOverscrollHandler=function(){}},listen:function(){this.listenToOnce(this.posts,"sync",function(){this.render(),this.listenTo(this.posts,"reorder",this.renderPosts),this.listenTo(this.posts,"add",this.addPost),this.listenTo(this.posts,"remove",this.removePost),this.listenTo(this.posts,"sync",this.applyWaitingUpdates),this.listenTo(this.posts,"backfill",function(){this.renderPosts(!0,!0)}),this.listenTo(this.posts,"lastDay",function(){this.$el.find(g.loadingPost).remove(),this.callScrollPane("update")}),this.on("scroll",function(t){0===t&&this.applyWaitingUpdates(!0)})},this)},groomPosts:function(){var t=this;window.setInterval(function(){t.updateTimestamps(),t.checkLivePosts()},2e4)},updateTimestamps:function(){e.each(this.postViews,function(t){t.renderTimestamp()})},checkLivePosts:function(){this.posts.each(function(t){t.checkLiveWindow()})},stylesLoaded:function(){var e,i=new t.Deferred,n=this.$el,s=0,o=function(){var t=n.find(".styles-indicator"),o="none"==t.css("display"),r=s>60;return o?i.resolve():r&&i.reject(),(o||r)&&window.clearInterval(e),s+=1,o};return o()||(e=window.setInterval(o,500)),i.promise()},refresh:function(t,i){var n={success:e.isFunction(t)?t:null,error:e.isFunction(i)?i:null};this.posts.fetchCurrent(n)},expand:function(e){t(e.target).remove(),this.getFrame().addClass("expanded")},openStandalone:function(){this.options.standaloneUrl&&this.openHere(this.options.standaloneUrl)},removePost:function(t){var e=this.getPost(t);e&&(e.remove(),this.stopListening(e)),this.updates.remove(t),delete this.players[t.id],delete this.postViews[t.id]},getPost:function(t,i){var n=e.isObject(t)?t.id:t,s=this.postViews[n];return s||i!==!0||(s=this.addPost(t)),s},getPostElFromEl:function(e){var i=t(e);return i.is(g.post)?i:i.parents(g.post)},getPostEls:function(){return this.$el.find(g.post)},getPostFromElem:function(t){var e=this.getPostElFromEl(t);return this.postViews[e.data("cid")]},getPostElOffset:function(t){var e=this.getPost(t);return e?e.$el.position().top:null},addPost:function(t){var e=new this.PostViewClass({model:t,displayImages:this.options.displayImages,nytapp:this.options.nytapp});return e.position=this.posts.indexOf(t),this.trigger("addPost",e),e.render(),this.updates.add(t),this.postViews[t.id]=e,this.listenTo(e,"render",this.refreshScrollPane),this.listenTo(e,"openLink",function(t,i){this.trigger("openLink",t,i,e)}),this.listenTo(e,"addPlayer",function(e,i){var n=t.id,s=this.players.get(n);s?(s.set("player",e),s.get("playing")&&s.play(n)):(this.players.add({id:n,player:e,isNYT:i===!0}),this.players.get(n).play())}),e},delegateToPost:function(i,n){var s,o=this.getPostFromElem(t(i.target)),r=n||i.type;if(!o)return!1;switch(r){case"click":if(this.postClicksDisabled)return!1;o.onClick(i);break;default:s="on"+i.type.charAt(0).toUpperCase()+i.type.substring(1),e.isFunction(o[s])&&o[s](i)}},getFrame:function(){return this.$el.find(g.frame)},getFrameHeight:function(){return this.getFrame().height()},getHeader:function(){return this.$el.find(g.header)},getAboutMessage:function(){return this.$el.find(g.aboutPost)},setupScrolling:function(){var t=this;this.getFrame().mCustomScrollbar({theme:"dark-3",autoHideScrollbar:!1,scrollInertia:0,setTop:0,mouseWheel:{scrollAmount:"Windows"==a.os?40:3},advanced:{updateOnContentResize:!1},callbacks:{onScrollStart:function(){t.onScrollStart()},onScroll:function(){t.scrollPane=this.mcs,t.onScroll()}}}),this.preventOverscroll(),c.getViewport().top>0?this.restoreScrollPosition():this.resetScrollPosition()},onScroll:function(){this.setPostsShowing(),this.trackScrollPosition(),this.trigger("scroll",this.getScrollY())},onScrollStart:function(){this.trigger("scrollStart")},preventOverscroll:function(){var e=this.getFrame(),i=this.getFrameHeight(),n="DOMMouseScroll mousewheel";e.off(n,this.preventOverscrollHandler),this.preventOverscrollHandler=function(e){var n=t(this),s=this.scrollTop,o=this.scrollHeight,r="DOMMouseScroll"==e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,a=r>0,l=function(){return e.stopPropagation(),e.preventDefault(),e.returnValue=!1,!1};return!a&&-r>o-i-s?(n.scrollTop(o),l()):a&&r>s?(n.scrollTop(0),l()):void 0},e.on(n,this.preventOverscrollHandler)},callScrollPane:function(t,e,i){this.getFrame().mCustomScrollbar(t,e,i)},refreshScrollPane:function(){this.callScrollPane("update")},isScrolled:function(){return this.getScrollY()>0},scrollToTop:function(){this.players.pauseAll(),0===this.getScrollY()?this.trigger("scroll",0):this.scrollTo(0)},scrollTo:function(t,e){var i=e!==!1,n=i?{scrollInertia:this.animateDuration}:{},s=this;this.callScrollPane("scrollTo",t,n),i&&0===t&&window.setTimeout(function(){s.callScrollPane("scrollTo",0)},this.animateDuration)},scrollToPost:function(t){var e=this.getPost(t);this.scrollTo(e.$el)},getScrollY:function(){return this.scrollPane?Math.abs(this.scrollPane.top):0},restoreScrollPosition:function(){var t,e,i=this.session.get("atPost"),n=!1;i&&(i!=this.lastLatest&&(t=this.session.get("atPostOffsetDelta")||0,e=this.getPostElOffset(i),e&&(n=!0,this.scrollTo(e+t,!1))),this.signalNewSinceLastVisit(n))},resetScrollPosition:function(){this.trackScrollPosition()},applyWaitingUpdates:function(t){(this.updates.length>0||this.sortPending)&&this.renderPosts(!1,t===!0)
},renderAllPosts:function(){var i="portal-posts-list",n=t('<ul class="'+i+'"></ul>'),s=t("<li></li>").addClass(g.loadingPost.substr(1)),o=[],r=this;this.posts.each(function(t,e){var i=this.getPost(t,!0);i.position=e,n.append(i.$el),i.videoPlayer&&o.push(i)},this),n.append(s),this.addAboutMessage(n),this.$el.find("."+i).replaceWith(n),this.$posts=n,this.addDayBreaks(),e.delay(function(){e.each(r.postViews,function(t){t.trigger("insert")})})},addAboutMessage:function(i){var n,s,o=new l({key:"nyt-watching-prefs",persistent:!0});return o.get("dismissedAbout")?!1:(n=t(e.template(m,{className:g.aboutPost.substr(1)})),s=e.bind(function(t){t.target==n[0]&&(n.off("click",s),n.remove(),o.set("dismissedAbout",!0))},this),i.prepend(n),void n.on("click",s))},insertNewPosts:function(){var e=this.getAboutMessage();this.posts.each(function(i,n){var s=this.getPost(i,!0),o=n?this.getPost(this.posts.at(n-1)):null,r=function(e){for(var i=e.previousElementSibling;i;){if(t(i).is(g.post))return i;i=i.previousElementSibling}return null};s.position=n,0!==n||s.el.parentNode&&!s.el.previousElementSibling?o&&r(s.el)!=o.el&&(o.$el.after(s.$el),s.trigger("insert")):(e.length?e.after(s.$el):this.$posts.prepend(s.$el),s.trigger("insert"))},this),this.addDayBreaks()},dayBreakAt:function(e){var i=e.get("date_published");this.getPost(e).$el.before(t(this.daybreakTemplate({date_published:i,formatted_date:r.unix(i).format("MMMM DD, YYYY")})))},addDayBreaks:function(){this.$el.find(g.daybreak).remove(),this.posts.each(function(t,e){var i=e>0?this.posts.at(e-1):null,n=t.get("date_published"),s=r.unix(n),o=this.getPost(t),a=o.$el.prev(),l=i?s.isSame(r.unix(i.get("date_published")),"day"):!0;!i||i.get("sticky")!==!1||l||a.is(g.daybreak)||this.dayBreakAt(t)},this)},renderPosts:function(t,e){var i=this,n=function(){i.refreshScrollPane()},s=(this.posts.at(0)||{}).id;e!==!0&&(this.isScrolled()||this.players.hasActive())?this.sortPending=!0:(this.$posts.length?this.insertNewPosts():this.renderAllPosts(),t!==!0?(this.once("signalAdditions",n),this.signalAdditions(e)):n(),this.updates.reset(),this.sortPending=!1,this.session.set("lastViewed",s)),this.signalUpdatesPending(),this.session.set("latestPost",s)},signalUpdatesPending:function(){var e=this.getHeader(),i=t(g.updates,e);this.updates.length?(i.text(this.updates.length+" new"),e.addClass("pending")):e.removeClass("pending")},signalNewSinceLastVisit:function(t){var e=this.posts.indexOf(this.posts.get(this.lastViewed));e>0&&(this.updates.add(this.posts.slice(0,e)),t?(this.session.set("lastViewed",this.lastViewed),this.signalUpdatesPending()):this.signalAdditions(!0))},signalAdditions:function(e){var i=t(),n=this,s=function(){i.removeClass("loading").addClass("loaded"),window.setTimeout(function(){i.removeClass("loaded"),n.trigger("signalAdditions")},1e3)};this.updates.each(function(t){var e=this.postViews[t.id];e&&(i=i.add(e.$el))},this),e===!0?s():(i.addClass("loading"),window.setTimeout(s,1e3))},trackScrollPosition:function(){var t=this.getPostsShowing(),e=this.getScrollY(),i=e-(this.getPostElOffset(t[0])||0);t.length&&(this.session.set("atPost",t[0].id),this.session.set("atPostOffsetDelta",i))},trackViewedPosts:function(t){t===!0&&this.session.set("viewedPosts",[]),this.session.set("viewedPosts",e.uniq((this.session.get("viewedPosts")||[]).concat(e.pluck(this.getPostsShowing(),"id"))))},getPostsShowing:function(){return this.postsShowing||this.setPostsShowing(),this.postsShowing},setPostsShowing:function(){var t,i=this.getScrollY(),n=this.getFrameHeight()+i,s=function(t){return e.isNumber(t)?t:this.getPost(t).$el.position().top},o=e.sortedIndex(this.posts.models,i,s,this),r=o+e.sortedIndex(this.posts.models.slice(o),n,s,this)-1,a=this.getPost(this.posts.at(r)),l=a?a.$el:null;return l&&l.position().top+l.outerHeight()>n+10&&r>0&&(r-=1),t=this.posts.slice(o,r+1),this.postsShowing=t,t},setHackClasses:function(t){"Windows"==a.os&&t.addClass("no-bold-hack")},expandToFill:function(e,i,n,s){if(!e)return!1;var o=t(e).eq(0).height(),r=t(i),a=r.length?r.height():this.$el.parent().height(),l=o-a,d=this.getFrame(),c=this.$el.height(),u=d.height(),h=n&&c+l>n?u+n-c:s&&s>c+l?u+s-c:u+l;d.height(h),this.callScrollPane("update"),this.preventOverscroll()},preRender:function(){var e=t(this.template.render());return this.$el.empty().append(e),e.addClass("portal-container"),this.setHackClasses(e),e},render:function(){var e;this.callScrollPane("destroy"),e=this.preRender(),e.addClass("synced"),this.$posts=t(),this.renderPosts(!0),this.trigger("render"),this.stylesLoaded().done(this.setupScrolling)}});return v}),define("portal/views/mobile_post",["portal/views/post","twitter_intents","detect"],function(t,e,i){var n="iOS"===i.os,s=t.extend({openNew:function(e){n?this.openHere(e):t.prototype.openNew.call(this,e)},openIntent:function(t){e.openIntent(t,n)},activateExternalVideo:function(){return!1},getTrackingParams:function(e){var i=t.prototype.getTrackingParams.call(this,e);return delete i.region,_.extend(i,{module:"WatchingPortalMobile",pgType:this.inPromo?"Homepage":"StandaloneWatchingPortal"})}});return s}),define("jquery-blutack",["jquery/nyt"],function(t){function e(t){return t.data("tackProps")}function i(t,e){t.data("tackProps",e)}function n(n){if(!e(t(this))){var s=t(this),o=n.offsetTop,r=s.offset(),a=r.top-o,l=s.css("position")||"static",c={offsetTop:parseInt(o,10),offsetLeft:"static"!=l?r.left:"auto",tackAt:a,proxyId:v+g,keepWithin:n.keepWithin?t(n.keepWithin):null,height:s.outerHeight(),initial:{position:l,width:n.freezeWidth?s.css("width"):"auto",top:s.css("top")||"auto",right:s.css("right"),left:s.css("left")},options:n};i(s,c),m[a]?m[a].free.push(s):m[a]={free:[s],tacked:[]},g+=1,_+=1,f.push(this),1!=_||w||(w=!0,u()),d()}}function s(){var n,s=t(this),o=e(s)||{},r=s.hasClass(y)?"tacked":"free",l=m[o.tackAt];if(l)for(n=l[r].length-1;n>=0;n--)if(l[r][n].get(0)==this){l[r].splice(n,1),a(s),i(s,null),_-=1,t("#"+o.proxyId).remove();break}for(var n=f.length-1;n>=0;n--)if(f[n]==this){f.splice(n,1);break}}function o(i){var n=e(i),s=t("#"+n.proxyId);s.length||(s=t('<div id="'+n.proxyId+'"></div>'),s.insertBefore(i)),s.show(),i.css({position:"fixed",top:n.offsetTop,width:c(i),left:n.offsetLeft,right:"auto"}).addClass(y).data("isPinched",!1)}function r(t,i){var n=e(t);t.css({top:n.offsetTop+i}).data("isPinched",!0)}function a(i){var n=e(i);t("#"+n.proxyId).hide(),i.css(n.initial).removeClass(y)}function l(t,i){var n,s=e(t),a=s.keepWithin;a&&(n=a.offset().top+a.height()-i-(s.height+s.offsetTop),0>n?r(t,n):t.data("isPinched")&&n>=0&&o(t))}function d(e){var i,n,s,r,d,c,u=t(window).scrollTop(),h=e&&void 0!==p?u>p?"down":"up":null;if(e&&(p=u),!_)return!1;for(d in m)if(m.hasOwnProperty(d)){if(d=Number(d),i=m[d],s=i.tacked,r=i.free,"up"!=h&&u>d&&!i.fixing){for(i.fixing=!0,c=r.length-1;c>=0;c--)n=r.pop(),o(n),s.push(n);i.fixing=!1}else if("down"!=h&&d>=u&&!i.fixing){for(i.fixing=!0,c=s.length-1;c>=0;c--)n=s.pop(),a(n),r.push(n);i.fixing=!1}for(c=s.length-1;c>=0;c--)l(s[c],u)}}function c(t){var i=e(t),n="auto"!=i.initial.width?i.initial.width:t.parent().width()-(t.outerWidth()-t.width());t.width(n)}function u(){_&&(t(window).scroll(d),t(window).on("resize",S),t("body").on("orientationchange",S).on("touchend",d))}function h(e,i){var n,s,o,r,a,l={offsetTop:0,freezeWidth:!1},d=(t(e).data("blutack-options")||"").split(";"),c={};for(a=d.length-1;a>=0;a--)n=d[a].split(":"),2==n.length&&(s=t.trim(n[0]),void 0!==l[s]&&(o=t.trim(n[1]),r=o.match(/d+/),r&&r.length==o.length?o=Number(o):"false"===o?o=!1:"true"===o&&(o=!0),c[s]=o));return t.extend({},l,c,i)}var p,f=[],m={},g=0,v="blutack-proxy-",y="blutacked",_=0,w=!1;if(t.fn.blutack)return!1;var S=function(){var i;return function(){clearTimeout(i),i=setTimeout(function(){var i,o,r=[];for(o=f.length-1;o>=0;o--)i=f[o],r.push({elem:i,options:e(t(i)).options}),s.apply(i);for(o=r.length-1;o>=0;o--)n.apply(r[o].elem,[r[o].options])},200)}}();return t.fn.blutack=function(t){return"remove"==t?this.each(function(){s.apply(this)}):"tacked"==t?this.hasClass(y):this.each(function(){n.apply(this,[h(this,t)])})},t(document).ready(function(){t(".blutack").blutack()}),t}),define("portal/views/mobile",["jquery/nyt","underscore/nyt","detect","portal/views/main","portal/views/mobile_post","foundation/views/page-manager","jquery-blutack"],function(t,e,i,n,s,o){var r="iOS"===i.os,a=n.extend({events:{"click .portal-posts-list li.portal-post":"delegateToPost","mouseover .portal-posts-list li.portal-post":"mousey","mouseout .portal-posts-list li.portal-post":"mousey","click header":"scrollToTop"},initialize:function(e){this.$html=t("html, body"),e=e||{},e.isPromo&&(e.displayImages="thumb_square"),n.prototype.initialize.call(this,e),this.PostViewClass=s},addPost:function(t){var e=n.prototype.addPost.call(this,t);return e.inPromo=this.isPromo(),e},isPromo:function(){return!!this.options.isPromo},mousey:function(t){r&&"mouseover"==t.type&&this.delegateToPost(t,"click")},setupScrolling:function(){this.listenTo(o,"nyt:page-scroll-after",this.onScroll),this.listenTo(o,"nyt:page-scroll",e.debounce(function(){this.onScrollStart()},200,!0))},scrollTo:function(t,e){var i=this,n=e!==!1;n?(this.$html.animate({scrollTop:t},this.animateDuration),window.setTimeout(function(){i.applyWaitingUpdates(!0)},this.animateDuration)):this.$html.scrollTop(t)},scrollToTop:function(){this.isPromo()?this.openStandalone():this.scrollTo(0)},getScrollY:function(){return t(window).scrollTop()},isScrolled:function(){return this.getScrollY()>0},getFrameHeight:function(){return o.getViewport().height},render:function(){var t=["mobile-portal-container"];this.isPromo()&&t.push("mobile-portal-promo"),n.prototype.render.call(this),this.$el.children().eq(0).addClass(t.join(" ")),this.isPromo()||this.getHeader().blutack()},addAboutMessage:function(t){this.isPromo()||n.prototype.addAboutMessage.call(this,t)}});return a}),define("portal/app",["jquery/nyt","jquery-ajaxtransport-xdr","underscore/nyt","backbone/nyt","portal/tracker","qute","foundation/views/page-manager","portal/collections/posts","portal/views/main","portal/views/mobile"],function(t,e,i,n,s,o,r,a,l,d){var c=Date.parse(new Date),u=function(e,r){var a;return c+=1,this.id="portal_"+c,this.view=null,this.posts=null,this.interval=null,this.options=i.defaults(r||{},{env:"production_published",date:null,pollRate:6e4,poll:!0,mobile:!1,mobilePromo:!1,limit:0,displayImages:!0,standaloneUrl:null,nytapp:null}),i.defaults(this.options.matchHeight||{},{match:null,container:null,maxHeight:600,minHeight:400}),a={module:this.isDesktop()?"WatchingPortal":"WatchingPortalMobile",pgType:this.isDesktop()||this.options.mobilePromo?"Homepage":"StandaloneWatchingPortal"},this.isDesktop()&&(a.region="c-column-middle-span-region"),this.tracker=new s("WatchingPortal",a),this.$el=t(e),this.$el&&this.$el.length?(this.onReady=o(),this.onFail=o(),this.offset=this.$el.offset(),this.scrollDepth=new n.Model({percent:0,quartile:0,remaining:0,atPost:0}),this.setPosts(),this.setView(),void this.fetchPosts()):!1};u.prototype=i.extend({isDesktop:function(){return!this.options.mobile&&!this.options.mobilePromo},isMobile:function(){return this.options.mobile||this.options.mobilePromo},getQsParam:function(t){var e=window.location.search.indexOf(t),i=window.location.search.substr(e).match(/=([^&]+)/);return i?i[1]:null},getStream:function(){var t=this.getQsParam("portal_stream");return t?t:this.options.env},getDateParam:function(){var t=this.getQsParam("portal_date");return t?t:this.options.date},setPosts:function(){this.posts=new a(null,{feed:this.getStream(),limit:this.options.limit,date:this.getDateParam()})},setView:function(){var t,e={el:this.$el,posts:this.posts,standaloneUrl:this.options.standaloneUrl,nytapp:this.options.nytapp},n=this,s=i.once(function(){n.stopListening(r,"nyt:page-scroll-after"),n.tracker.track({action:"impression",priority:"true"},"impression")});t=this.view=this.options.mobilePromo===!0||this.options.mobile===!0?new d(i.extend(e,{isPromo:this.options.mobilePromo===!0})):new l(e),this.trackLinks(),this.trackScroll(),this.monitorVideos(),this.listenToOnce(t,"render",function(){var e=this.options.matchHeight;this.onReady.run(),t.stylesLoaded().done(function(){return n.options.mobilePromo===!0?!1:(e&&e.match&&t.expandToFill(e.match,e.container,e.maxHeight,e.minHeight),n.checkImpression(s)||n.listenTo(r,"nyt:page-scroll-after",function(){n.checkImpression(s)}),n.listenTo(t,"scrollStart",n.disableInactivityTimer),void n.listenTo(t,"scroll",function(t){this.catchScrollDepth(t),this.loadMore(t),this.enableInactivityTimer()}))})})},loadMore:function(){var t=this;!this.loadingMore&&this.scrollDepth.get("remaining")<1e3&&this.posts.canFetchPrevious()&&(this.posts.fetchPreviousDay().always(function(){t.loadingMore=!1}),this.loadingMore=!0)},enableInactivityTimer:function(){r.trigger("nyt:inactivity-timer-enable","watching")},disableInactivityTimer:function(){r.trigger("nyt:inactivity-timer-disable","watching")},monitorVideos:function(){this.listenTo(this.view.players,"change:playing",function(){this.view.players.hasActive()?this.disableInactivityTimer():this.enableInactivityTimer()})},catchScrollDepth:function(t){var e=this.viewHeight||this.view.getFrameHeight(),i=this.view.$posts.height(),n=t+e,s=n/i,o=Math.floor(4*s)/4*100,r=this.view.getPostsShowing(),a=this.posts.indexOf(r[r.length-1]);this.scrollDepth.set({percent:Math.round(100*s),quartile:o,remaining:i-n,atPost:a,fives:5*Math.floor(a/5)})},trackScroll:function(){var t=0;this.scrollDepth.on("change:atPost",i.bind(function(){var e=this.scrollDepth.get("atPost"),i=this.scrollDepth.get("fives"),n=this.scrollDepth.previous("atPost");e>n&&(0===n?this.tracker.track({action:"scroll",contentPlacement:e},"interaction"):i>t&&(t=i,this.tracker.track({action:"scroll",contentPlacement:i},"interaction")))},this))},trackLinks:function(){this.listenTo(this.view,"openLink",function(t,e,i){this.tracker.track(i.getTrackingParams(t),"interaction")})},checkImpression:function(t){var e=r.getViewport();return this.offset.top+150<e.bottom?(t(),!0):!1},fetchPosts:function(){var t=this,e=i.once(function(e){e||(t.stopAutoUpdates(),t.$el.remove(),t.onFail.run())});this.listenToOnce(this.posts,"sync",function(){e(!0)}),this.listenToOnce(this.posts,"error",function(){e(!1)}),this.options.poll===!1||0===this.options.pollRate||this.options.mobilePromo===!0?this.view.refresh():this.startAutoUpdates()},startAutoUpdates:function(){var t=this.options.pollRate,e=this,i=function(){e.view.refresh(n)},n=function(){e.stopAutoUpdates(),e.interval=window.setInterval(i,t)};i(),n()},stopAutoUpdates:function(){window.clearInterval(this.interval)}},n.Events);var h={portals:[],create:function(e,i){var n=t(e),s=this.get(n);return n.length&&!s&&(s=new u(n,i),s&&this.portals.push(s)),s},get:function(e){var n=t(e);return i.find(this.portals,function(t){return t.$el[0]==n[0]})}};return h});