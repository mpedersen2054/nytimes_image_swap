define(["jquery/nyt","underscore/nyt","backbone/nyt","http://js.nyt.com/js2/build/video/libs/brightcove/BrightcoveExperiences_All.js","videoFactory","foundation/base-mixin","shared/sharetools/views/sharetools"],function(e,t,n,r,i,s,o){var u={};return function(t){t.Extended=function(t){this.options=e.extend({name:"",token:"cE97ArV7TzqBzkmeRVVhJ8O6GWME2iG_bRvjBTlNb4o.",playerId:"2125004161001",publisherId:"1749339200",thumbWidth:110,thumbsVisible:3,thumbsDistance:6,thumbsMax:null,videoWidth:368,videoHeight:207,playerType:"homepage",moreVideos:"http://www.nytimes.com/video",debug:!1},t),this.element=this.options.container,this.video=null,this.rendered=!1,this.currentVideo=1,this.$allImgThumbs=null,this.$videoThumbsWrapper=null,this.scrollWindowWidth=0,this.thumbOuterWidth=0,this.initialize()},t.Extended.prototype={initialize:function(){var e=this;this.getData(function(t){e.playlist=t,e.setVideoIds(),e.render(),e.registerEvents(),e.setMoreVideosLink(),s.broadcast("nyt:video-playlist-ready"),e.options.onReady&&typeof e.options.onReady=="function"&&e.options.onReady.call(e)})},getStaticDomain:function(){var e=window.location.host,t="http://js.nyt.com/";if(this.options.debug)return"http://static.local.nytimes.com/";switch(e){case"localhost":t="http://static.local.nytimes.com/";break;case"video-int01.qprvt.nytimes.com":t="http://video-int01.qprvt.nytimes.com/video/";break;case"www.dev.nytimes.com":t="http://static.dev.nytimes.com/";break;case"www.stg.nytimes.com":t="http://static.stg.nytimes.com/";break;default:t="http://js.nyt.com/"}return t},getGraphicsDomain:function(){var e=window.location.host,t="http://graphics8.nytimes.com/";if(this.options.debug)return"http://static.local.nytimes.com/";switch(e){case"localhost":t="http://static.local.nytimes.com/";break;case"video-int01.qprvt.nytimes.com":t="http://video-int01.qprvt.nytimes.com/video/";break;case"www.dev.nytimes.com":t="http://static.dev.nytimes.com/";break;case"www.stg.nytimes.com":t="http://static.stg.nytimes.com/";break;default:t="http://graphics8.nytimes.com/"}return t},videoIds:[],registerEvents:function(){var t=this,n=".videoThumbs li";this.element.on("click",n,function(n){var r=e(this);t.selectThumb(r)})},getData:function(t){var n="http://api.brightcove.com/services/library?",r="name%2CshortDescription%2ClongDescription%2CvideoStillURL%2CthumbnailURL%2CreferenceId%2Ctags",i="command=find_playlist_by_reference_id&reference_id="+this.options.referenceId+"&token="+this.options.token+"&video_fields="+r+"&custom_fields=videourl&media_delivery=http";e.ajax({url:n,async:!1,type:"get",dataType:"jsonp",data:i,cache:!0,success:t})},selectThumb:function(e){var t=e.index(),n=this.playlist.videos[t];this.element.find(".videoThumbs li").removeClass("thumbSelected"),e.addClass("thumbSelected"),this.currentVideo=t,this.renderVideo(n),this.updateShareTool(n),this.scrollTo(e)},setVideoIds:function(){var e=this.playlist.videos,t=this.options.thumbsMax||e.length;for(var n=0;n<t;n++)this.videoIds.push(e[n].referenceId)},getKicker:function(e){var t=/nyto_([^,]+)/.exec(e.join(","))[1];return t||""},render:function(){this.renderThumbs(),this.renderVideo(),this.updateShareTool()},renderVideo:function(e){var t=this,n=e||this.playlist.videos[0];this.element.find(".videoDetails .kicker").html(this.getKicker(n.tags)),this.element.find(".videoDetails .shortDescription").attr("href",n.customFields.videourl).html(n.name),this.element.find(".videoDetails .longDescription").html(n.longDescription);if(this.rendered&&this.video&&this.video.videoModule){this.video.videoModule.loadVideo(n.referenceId,"referenceId");return}var r=e?!1:!0,o=r?!1:!0,u=r?!1:!0,a=this.options.thumbsMax||this.playlist.videos.length,f={backgroundImage:n.videoStillURL,buttonPosition:"bottomLeft",buttonAnimated:!0,buttonExpandBy:80,buttonFontColor:"#FFF",buttonFontSize:"12px",buttonPaddingLeftRight:20,buttonPaddingTopBottom:20,buttonHeight:42,buttonWidth:42},l=this.element.find(".extendedVideoPocketPlayerContainer");if(this.video)this.video.setVideoIds([n.referenceId]),this.video.poster.onClick();else{l.attr("id","video_"+n.referenceId),l.empty(),t.video=i.create({container:"video_"+n.referenceId,playerId:t.options.playerId,publisherId:t.options.publisherId,publisherReadToken:t.options.token,videoId:n.referenceId,width:t.options.videoWidth,height:t.options.videoHeight,autoStart:u,autoRender:o,playerType:t.options.playerType,adxAdPositions:"VideoPlayerAd,ADX_CLIENTSIDE",overlay:e?null:f,adCountdown:!0});var c=t.video.getSubscription();c.subscribe(i.VideoEvents.RENDERED,function(e){var n=t.element.find(".videoThumbs .thumbSelected");n.length===0&&t.element.find(".videoThumbs li:first").addClass("thumbSelected"),t.rendered=!0,t.video&&t.video.poster&&t.video.poster.onDestroyed()}),c.subscribe(i.VideoEvents.VIDEO_COMPLETE,function(){setTimeout(function(){if(a>t.currentVideo+1){var e=t.element.find(".videoThumbs .thumbSelected").next();t.selectThumb(e)}},100)}),c.subscribe(i.VideoEvents.MEDIA_BEGIN,function(e){s.broadcast("nyt:inactivity-timer-disable")}),c.subscribe(i.VideoEvents.VIDEO_START,function(e){s.broadcast("nyt:inactivity-timer-disable")}),c.subscribe(i.VideoEvents.VIDEO_STOP,function(e){s.broadcast("nyt:inactivity-timer-enable")}),c.subscribe(i.VideoEvents.VIDEO_PAUSED,function(e){s.broadcast("nyt:inactivity-timer-enable")}),c.subscribe(i.VideoEvents.AD_START,function(e){s.broadcast("nyt:inactivity-timer-disable")}),c.subscribe(i.VideoEvents.AD_COMPLETE,function(e){s.broadcast("nyt:inactivity-timer-enable")})}},renderThumbs:function(){var t=this.element.find("ul.videoThumbs"),n=this.playlist.videos,r=this.options.thumbsMax||n.length,i=parseInt(this.options.thumbWidth,10),s=[this.getGraphicsDomain(),"images/video/video-default-thumb-96x54-000000.png"].join("");for(var o=0;o<r;o++){var u,a,f,l,c;u=n[o].videoStillURL,a="",o<=this.options.thumbsVisible?(thumbImgSrc=u,a="videoImageLoaded"):(thumbImgSrc=s,a="videoImagePlaceholder"),f=e("<li></li>").css({width:i+4,"margin-right":this.options.thumbsDistance}),l=e('<img class="'+a+'" data-src="'+u+'" src="'+thumbImgSrc+'" />').css({width:i}).appendTo(f),c=e('<p class="shortDescription">'+n[o].name+"</p>").appendTo(f),t.append(f)}this.$allImgThumbs=e("img","#extVidPlayerThumbsWrapper .videoThumbs"),this.scrollWindowWidth=e("#extVidPlayerThumbsWrapper").width(),this.thumbOuterWidth=this.element.find(".videoThumbs li:first").outerWidth(),this.$videoThumbsWrapper=this.element.find(".videoThumbs"),this.setRegularScroll()},setThumbsSize:function(){var e=this.element.find("ul.videoThumbs"),t=this.playlist.videos,n=this.options.thumbsMax||t.length,r=parseInt(this.options.thumbWidth,10),i=n*(r+this.options.thumbsDistance+4);e.css("width",i+"px")},scrollTo:function(e){var t=this.element.find(".videoThumbs"),n=this.currentVideo*(this.element.find(".videoThumbs li:first").outerWidth()+this.options.thumbsDistance)*-1,r={duration:"slow",easing:"swing",complete:function(){animating=!1}};"ontouchstart"in window?this.scroll.scrollToElement(e[0],500):(this.arrowsState(n),t.animate({marginLeft:n},r)),this.checkImages(n,0)},arrowsState:function(e){var t=this.element.find(".videoThumbs"),n=t.find("li:first").outerWidth(),r=(n+this.options.thumbsDistance)*this.options.thumbsVisible,i=this.element.find(".extVidPlayerNav .previousVideo"),s=this.element.find(".extVidPlayerNav .nextVideo"),o=this.element.find(".extVidPlayerThumbsContainer");e>=0?i.addClass("previousVideoInactive"):i.removeClass("previousVideoInactive"),e*-1+r>=t.width()?(s.addClass("nextVideoInactive"),o.removeClass("thumbsShadow")):(s.removeClass("nextVideoInactive"),o.addClass("thumbsShadow"))},setRegularScroll:function(){var e=this,t=this.element.find(".videoThumbs"),n=this.element.find(".extVidPlayerNavContent").show(),r=this.element.find(".videoThumbs li:first").outerWidth(),i=(r+this.options.thumbsDistance)*this.options.thumbsVisible,s=this.playlist.videos.length,o=Math.ceil(s/this.options.thumbsVisible),u=this.playlist.videos.length%this.options.thumbsVisible,a=!1,f={duration:"slow",easing:"swing",complete:function(){a=!1}};this.setThumbsSize(),this.arrowsState(0),this.element.on("click",".extVidPlayerNav .previousVideo",function(n){n.preventDefault();var r=parseInt(t.css("marginLeft"),10),s=r*-1>i?r+i:r+r*-1;r<0&&!a&&(t.animate({marginLeft:s},f),a=!0),e.arrowsState(s)}),this.element.on("click",".extVidPlayerNav .nextVideo",function(n){n.preventDefault();var r=parseInt(t.css("marginLeft"),10),s=r-i;r*-1+i<t.width()&&!a&&(t.animate({marginLeft:s},f),a=!0),e.arrowsState(s),e.checkImages(s,0)})},checkImages:function(t,n){var r,i,s,o;i=e("img.videoImagePlaceholder",".videoThumbs"),s=t,scrollWindowWidthOffset=n||0,r=this,i.each(function(){var t,n,i;t=e(this),n=r.$allImgThumbs.index(t),i=(r.thumbOuterWidth+r.options.thumbsDistance)*n,o=i+s,o<r.scrollWindowWidth+scrollWindowWidthOffset&&r.loadImage(t)})},loadImage:function(e){var t;t=e.attr("data-src"),t&&e.attr("src",t).removeClass("videoImagePlaceholder").addClass("videoImageLoaded")},getScript:function(t,n){e.ajax({url:t,dataType:"script",cache:!0,success:n})},updateShareTool:function(e){var t=e||this.playlist.videos[0],n=this.element.find(".sharetools"),r=function(){n.data("title",t.name),n.data("description",t.longDescription),n.data("url",t.customFields.videourl||"http://www.nytimes.com/video")};n.removeClass("sharetools-init").empty(),r(),new o({el:n,showAllModalSettings:{tailDirection:"left",positionTailSide:!0,autoPosition:!0,toggleSpeed:1}})},setMoreVideosLink:function(){var e=this.element.find(".extVidPlayerSectionHeaderLink"),t=e.find("span");e.attr("href",this.options.moreVideos),t.html(this.options.name)}}}(u),u});