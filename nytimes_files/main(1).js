define("shared/ad/models/ad",["backbone/nyt"],function(e){var t=e.Model.extend({});return t}),define("shared/ad/collections/ads",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","foundation/hosts","shared/ad/models/ad"],function(e,t,i,s,n){var a=i.extend({deliveryProofParams:["adxforce","debug"],adForceLookup:{leaderboard:"728x90testnyt5",billboard:"970x90horiztest",pushdown:"testnyt5pushdown",halfpage:"mediamindhalfexptest",xxl:"nyt5xxltestpickletag",bigad:"middlerighttest"},initialize:function(e,i){return i?(this.options=i,t.isUndefined(this.pageManager.getMeta("adxPage"))?this.host=this.pageManager.getUrlParam("adx_campaign")||i.adx_campaign||"www.nytimes.com":(this.host="",this.options.page=this.pageManager.getMeta("adxPage")),this.interstitial=i.interstitial?1:0,void this.setPageParameter()):!1},setPageParameter:function(){var e;this.options.page||(e=location.pathname,e=e.replace(/\d{4}/,"yr").replace(/\d{2}/,"mo").replace(/\d{2}/,"day"),this.options.page=this.host+e)},model:n,url:s.adx+"/adx/bin/adxrun.html",sync:function(i,s,n){var a=this,o=["nyt5"];return n.dataType="jsonp",n.jsonp="jsonp",n.data={page:a.options.page,positions:a.options.positions.join(","),autoconfirm:a.options.autoconfirm||0,v:3,cpp:1,attributes:"nyt5",interstitials:this.interstitial},this.options.cpp===!1&&(delete n.data.interstitials,delete n.data.cpp),n.data=a.assignDeliveryProofParams(n.data),"undefined"!=typeof this.pageManager.getUrlParam("hp")&&o.push("hp"),"undefined"!=typeof this.pageManager.getUrlParam("src")&&o.push("src-"+this.pageManager.getUrlParam("src")),"undefined"!=typeof a.options.keywords&&(o=t.union(o,a.chainKeywords(a.options.keywords))),n.data.keywords=t.filter(o,function(e){return!("undefined"==typeof e||""===e)}).join(","),e.sync(i,s,n)},assignDeliveryProofParams:function(e){for(var i,s={},n=this.deliveryProofParams.length-1;n>=0;n-=1)i=this.pageManager.getUrlParam(this.deliveryProofParams[n]),"undefined"!=typeof i&&(s[this.deliveryProofParams[n]]=i||"1");return t.extend(e,s)},chainKeywords:function(e){var t,i,s=e.length,n=[],a=this;for(t=0;s>t;t+=1)i=a.adForceLookup[e[t]],n.push(i||e[t]);return"1"===this.pageManager.getUrlParam("rico")&&n.push(this.pageManager.getUrlParam("keywords")),n},parse:function(e){var i=e.ads;return i=t.map(i,function(e,t){var i=e.isInlineSafe;return e.name=t,e.isInlineSafe="Y"===i||"true"===i,e}),"undefined"!=typeof this.pageManager.getUrlParam("debug")&&(window.adx_debug_output=e,console.log("adx debug page: ",this.options.page),console.log("adx debug positions: ",this.options.positions.join(",")),console.log("adx debug output: ",e),console.log("adx debug keywords: ",this.chainKeywords(this.options.keywords).join(","))),i},getConfirmPixel:function(){return this.confirmPixel?this.confirmPixel.creative:void 0}});return a}),define("shared/ad/templates",["underscore/nyt"],function(_){var templates={};return templates.iFrameStyleSheet=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<style type="text/css">\nbody {\nmargin: 0;\noverflow: hidden;\n}a img {\nborder: none;\n}\n</style>';return __p},templates.interstitialModal=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div id="Interstitial" class="ad interstitial-ad"></div><p class="user-action dismiss-button">Continue &raquo;</p>';return __p},templates.ribbonInterstitial=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="ribbon-interstitial-ad-overlay">\n<h4 class="ad-heading"> Advertisement </h4>\n<div id="RibbonInterstitial" class="ad ribbon-interstitial-ad"> </div>\n</div>';return __p},templates}),define("shared/modal/templates",["underscore/nyt"],function(_){var templates={};return templates.modal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="overlay"></div>\n<div class="modal '+(null==(__t=id)?"":__t)+" "+(null==(__t=addlClasses)?"":__t)+'" style="'+(null==(__t=modalStyles)?"":__t)+'" role="dialog" aria-labelledby="'+(null==(__t=id)?"":__t)+'-modal-heading" tabindex="-1">\n<div class="modal-header">\n<h3 class="modal-heading" id="'+(null==(__t=id)?"":__t)+'-modal-heading">'+(null==(__t=modalTitle)?"":__t)+"</h3>\n"+(null==(__t=headerContent)?"":__t)+'\n</div>\n<div class="modal-content">\n'+(null==(__t=modalContent)?"":__t)+'\n</div>\n<button type="button" class="modal-close '+(null==(__t=closeClass)?"":__t)+'" aria-disabled="false"><i class="icon"></i><span class="visually-hidden">Close this modal window</span></button>\n<div class="modal-pointer '+(null==(__t="modal-pointer-"+tailDirection)?"":__t)+'"><div class="modal-pointer-conceal"></div></div>\n</div>';return __p},templates}),define("shared/modal/views/modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/templates"],function(e,t,i,s){var n=i.registerView("modal").extend({template:s.modal,className:"modal-container",events:{"click .modal-close, .modal-pointer, .dismiss-button":"close","mouseenter .modal":"handleMouseOutClose"},defaultSettings:{id:"default-modal",modalTitle:"",headerContent:"",modalContent:"",addlClasses:"",binding:"",tailDirection:"down",tailTopOffset:0,tailLeftOffset:0,fixedOverride:!1,hasOverlay:!1,hasCloseButton:!1,canOpenOnHover:!1,closeOnMouseOut:!1,mouseOutDelay:0,mouseEnterDelay:0,closeOnClick:!0,autoPosition:!1,positionTailSide:!1,toggleSpeed:300,focusOnShow:!0},initialize:function(e){t.bindAll(this,"close","open","mouseEnterOpen","mouseOutClose","handleClickClose","removeFromPage"),this.settings=t.extend({},this.defaultSettings,e),this.settings.modalStyles="width: "+e.width+";",this.render()},render:function(){var e=this.settings.id+"-container";return this.settings.closeClass=this.settings.hasCloseButton?"":"hidden",this.$el.hide().addClass(e).html(this.template(this.settings)),this.$modal=this.$el.find(".modal"),this.$el.find(".overlay").toggle(this.settings.hasOverlay),this},addToPage:function(e,t){var i="string"==typeof e?this.$body.find(e):this.$body;return t="function"==typeof i[t]?t:"append",i[t](this.$el),""!==this.settings.binding&&(this.$body.on("click",this.settings.binding,this.open),this.settings.canOpenOnHover&&(this.$body.on("mouseenter",this.settings.binding,this.mouseEnterOpen),this.$body.on("mouseleave",this.settings.binding,this.mouseOutClose))),this},removeFromPage:function(){return this.close(),this.$el.remove(),""!==this.settings.binding&&(this.$body.off("click",this.settings.binding,this.open),this.settings.canOpenOnHover&&(this.$body.off("mouseenter",this.settings.binding,this.mouseEnterOpen),this.$body.off("mouseleave",this.settings.binding,this.mouseOutClose))),this.remove()},updateTemplate:function(e){return this.$modal.find(".modal-content").html(e),this.positionDialog(!1),this},open:function(t){var i=this;return t?(t.returnValue=!1,t.preventDefault(),this.$target=e(t.currentTarget)):this.$target=e(this.settings.binding).eq(0),this.$el.fadeIn(this.settings.toggleSpeed,function(){i.broadcast("nyt:modal-show"),i.broadcast("nyt:modal-show-"+i.settings.id)}),this.settings.autoPosition?this.autoPosition():this.positionDialog(!0),(this.settings.openCallback||e.noop).call(this),this.subscribe("nyt:page-resize",this.positionDialog),this.subscribeOnce("nyt:page-key-esc",this.close),this.$body.on("click",this.handleClickClose),this.pageManager.isMobile()&&this.$body.css("cursor","pointer"),this.settings.focusOnShow&&this.$modal.focus(),this},mouseEnterOpen:function(e){window.clearTimeout(this.mouseLeaveTimeout),this.mouseEnterTimeout=t.delay(this.open,this.settings.mouseEnterDelay,e)},close:function(){var t=this;return this.$el.fadeOut(this.settings.toggleSpeed,function(){(t.settings.closeCallback||e.noop).call(t),t.broadcast("nyt:modal-hide"),t.broadcast("nyt:modal-hide-"+t.settings.id)}),this.stopSubscribing("nyt:page-resize",this.positionDialog),this.$body.off("click",this.handleClickClose),window.clearTimeout(this.mouseEnterTimeout),this.pageManager.isMobile()&&this.$body.css("cursor",""),this},mouseOutClose:function(t){var i=e(t.relatedTarget);i.is(this.$.target)||this.$modal.has(i).length>0||(window.clearTimeout(this.mouseEnterTimeout),this.$modal.is(":visible")&&(this.mouseLeaveTimeout=window.setTimeout(this.close,this.settings.mouseOutDelay)))},handleMouseOutClose:function(){this.settings.closeOnMouseOut&&this.$modal.on("mouseleave",this.close)},handleClickClose:function(e){this.settings.closeOnClick&&0===this.$modal.has(e.target).length&&this.$modal[0]!==e.target&&this.close()},positionDialog:function(t){var i,s,n,a,o,r=this.pageManager.getViewport(),l=this.$target,d=this.$modal,h="absolute",c=d.outerHeight(),u=d.outerWidth(),m={marginLeft:"0",marginTop:"0",top:"",left:""};switch(l&&l.length>0&&(a=l.outerHeight(),o=l.outerWidth(),s=l.offset().top+this.settings.tailTopOffset,n=l.offset().left+this.settings.tailLeftOffset),this.settings.tailDirection){case"up":m.top=s+a+14,m.left=n+Math.floor(.5*o)-Math.floor(.5*u)-9;break;case"up-right":m.top=s+a+14,m.left=n+Math.floor(.5*o)-(u-25);break;case"up-left":m.top=s+a+14,m.left=n+Math.floor(.5*o)-25;break;case"down":m.top=s-c-15,m.left=n+Math.floor(.5*o)-Math.floor(.5*u)-8;break;case"down-right":m.top=s-c-15,m.left=n+Math.floor(.5*o)-(u-25);break;case"down-left":m.top=s-c-15,m.left=n+Math.floor(.5*o)-25;break;case"left":m.top=s+Math.floor(.5*a)-Math.floor(.5*c)+5,m.left=n+o+15;break;case"left-bottom":m.top=s+Math.floor(.5*a)-(c-25),m.left=n+o+15;break;case"left-top":m.top=s+Math.floor(.5*a)-25,m.left=n+o+15;break;case"right":m.top=s+Math.floor(.5*a)-Math.floor(.5*c)+5,m.left=n-u-16;break;case"right-bottom":m.top=s+Math.floor(.5*a)-(c-25),m.left=n-u-16;break;case"right-top":m.top=s+Math.floor(.5*a)-25,m.left=n-u-16;break;case"centered":i=r.height,m.top=c>i?r.top+5:Math.floor(.5*(i-c))+r.top,m.left=Math.floor(.5*r.width-.5*u);break;case"fixed":default:h="fixed",u=this.settings.width||d.width(),c=this.settings.height||d.height(),m.top="50%",m.left="50%",m.marginLeft=-Math.floor(.5*u)+this.settings.tailLeftOffset+"px",m.marginTop=-Math.floor(.5*c)+this.settings.tailTopOffset+"px"}return l&&"fixed"===l.css("position")||this.settings.fixedOverride?(h="fixed",m.top-=r.top,this.$el.css("position","fixed")):this.$el.css("position",""),m.top+=e.isNumeric(m.top)?"px":"",m.left+=e.isNumeric(m.left)?"px":"",d.css("position",h),t===!0?d.css(m):d.stop().animate(m,"fast"),this},autoPosition:function(){var e,t,i,s=this.pageManager.getViewport(),n=this.$modal.outerHeight(),a=this.$modal.outerWidth();return this.settings.positionTailSide&&(i=this.$target.offset().left>s.width/2,this.settings.tailDirection=i?"right":"left"),this.positionDialog(!0),e=this.$target.offset(),this.settings.positionTailSide?(t=this.settings.tailDirection,e.top-s.top-.5*n<0?t+="-top":e.top-s.top+.5*n>s.height&&n-40<e.top-s.top&&(t+="-bottom")):(t=e.top-n<0?"up":"down",e.left+a>s.width?t+="-right":e.left<0&&(t+="-left")),this.$modal.find(".modal-pointer").attr("class","modal-pointer modal-pointer-"+t),this.settings.tailDirection=t,this.positionDialog(!0),this}});return n}),define("shared/ad/views/ads",["underscore/nyt","jquery/nyt","foundation/views/base-view","foundation/views/ad-view-manager","shared/ad/collections/ads","shared/ad/templates","shared/modal/views/modal"],function(e,t,i,s,n,a,o){var r=i.registerView("ads").extend({el:".ad",template:a,pushdownWidth:"970",billboardHeight:"90",navBreakPoint:10040,positions:null,blocking:!1,adShown:{},initialize:function(t){e.bindAll(this,"completeInterstitial","renderAd"),this.options=t||this.options||{},this.positions=[],this.preInitialize(),this.local(this,"nyt:ads-pre-initialize"),this.detectTragedy(),this.setAdParametersOnOptions(),this.scope=this.options.scope||this.scope,this.confirm=!0,this.ads=new n([],this.options),this.subscribe(this.ads,"sync",this.receiveAds),this.secondaryIframeClass="frame-for-"+this.scope,this.listenTo(this.pageManager,"nyt:page-breakpoint",this.responsive),this.postInitialize(),this.local(this,"nyt:ads-post-initialize"),this.subscribe("nyt:ads-new-placement",this.handleRemoteAdRequest),this.subscribe("nyt:ads-fire-ribbon-interstitial",this.fireRibbonInterstitial),this.subscribe("nyt:slideshow-ad",this.fireSlideShowAd),this.addAmazonKeywords?this.getAmazonAds():this.requestAds()},getAmazonAds:function(){window.amznads={updateAds:function(t){window.amazonAdData=t.ads,window.amazonAdSlots=e.keys(window.amazonAdData)}},this.getAmazonKeywordsAndRequestAds()},getAmazonKeywordsAndRequestAds:function(){var e=this,i="3030",s=encodeURIComponent(document.location);try{s=encodeURIComponent(""+window.top.location)}catch(n){}t.ajax({url:"//aax.amazon-adsystem.com/e/dtb/bid?src="+i+"&u="+s+"&cb="+Math.round(1e7*Math.random()),dataType:"script"}).done(function(){e.addAmazonKeywords()}).always(function(){e.requestAds()})},preInitialize:t.noop,postInitialize:t.noop,responsive:t.noop,setHtmlClasses:t.noop,requestAds:function(){this.options.response?(this.ads.reset(this.ads.parse(this.options.response)),this.ads.trigger("sync")):this.ads.fetch()},receiveAds:function(){this.hasInterstitial()||this.checkAds()},resizeTopAd:e.debounce(function(){var e=this.ads.findWhere({name:"TopAd"});if(e){var i=e.get("height");i&&90>i&&t("#TopAd").css("min-height",parseInt(i,10))}},1e3),checkAds:function(){var i,s,n,a,o,r=this;for(this.removeAds(),i=this.getReturnedAdNames(this.pageManager.isDomReady()),this.pageManager.isDomReady()||this.subscribe("nyt:page-ready",function(){r.getReturnedAdNames(!0)}),i&&i.length>0&&(this.pageManager.getMeta("ads_adNames")||this.pageManager.setMeta("ads_adNames",this.returnAdNames())),e.indexOf(i,"TopAd")<0?(o=t("#TopAd"),0===o.length&&o.addClass("hidden")):r.resizeTopAd(),a=this.getPositions(),s=0,n=a.length;n>s;s+=1)t("#"+a[s]).toggleClass("hidden",r.isAdUnavailable(i,a[s]));e.indexOf(this.options.positions,"Middle1C")>=0&&!this.ads.findWhere({name:"Middle1C"})&&t("#TopNavAd, .search-flyout-panel .ad").addClass("hidden"),e.defer(function(){r.broadcast("nyt:ads-rendered",r)}),r.setHtmlClasses(),e.delay(function(){r.loadGoogleAdScript()},1200)},loadGoogleAdScript:function(){if(0!==t("#SponLink, #SponLinkA, #SponLinkHP").length&&!this.pageManager.getMeta("googleAdScriptInjected")){var e="script",i=document.createElement(e),s=document.getElementsByTagName(e)[0];i.src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",s.parentNode.insertBefore(i,s),this.pageManager.setMeta("googleAdScriptInjected","true")}},renderAd:function(e){e.page=e.page||this.ads.options.page,e.frameStyle=e.frameStyle||this.template.iFrameStyleSheet(),e.secondaryIframeClass=e.secondaryIframeClass||this.secondaryIframeClass,s.render(e)},renderAdByPositionName:function(i,s){var n=t("#"+i);return s||(s=this.ads.where({name:i})[0]),n.length&&s||"ADX_CLIENTSIDE"===i?(this.isCreativeBlank(s)||n.removeClass("hidden"),e.defer(this.renderAd,{model:s,el:n}),!0):!1},handleRemoteAdRequest:function(e){this.ads.length>0&&this.renderAdByPositionName(e)},getPositions:function(){return this.options.positions},detectTragedy:function(){var e=this.pageManager.getMeta("ad_sensitivity");e&&(this.options.page="www.nytimes.com/"+e)},returnAdNames:function(){return this.ads.pluck("name")},cleanHtmlClasses:function(){this.htmlClasses&&this.$html.removeClass(e.values(this.htmlClasses).join(" "))},isDirectlySold:function(e){var t=this.ads.where({name:e})[0].attributes.isDirectlySold;return"true"===t},returnAdParametersObject:function(){var t=this.pageManager.getUrlParam("ad-keywords"),i=this.pageManager.getUrlParam("ad-positions");return{keywords:e.isString(t)?[t]:t,positions:e.isString(i)?[i]:i}},setAdParametersOnOptions:function(){var t=this.returnAdParametersObject();this.options.keywords=e.union(this.options.keywords,t.keywords),t.positions&&(this.options.positions=t.positions)},isPlaceholderInViewport:function(e){var i;return!e||e&&0===e.length?!1:(i=e.get(0).getBoundingClientRect(),i.top+e.height()>=0&&i.left+e.width()>=0&&i.bottom-e.height()<=t(window).height()&&i.right-e.width()<=t(window).width())},isCreativeBlank:function(e){var t=e.get("classification");return"blank"===t||"blank-but-count-imps"===t},handleApplicationAd:function(e){var t,i;return t=e.get("name"),i=this.renderAdByPositionName(t,e)},getReturnedAdNames:function(e){var t=this,i=[];return e="undefined"!=typeof e?e:!1,this.ads.length>0&&this.ads.each(function(s){e?t.handleApplicationAd(s)?i.push(s.get("name")):t.confirm=!1:i.push(s.get("name"))}),i},isAdUnavailable:function(t,i){return e.indexOf(t,i)<0||this.isCreativeBlank(this.ads.where({name:i})[0])},removeAds:function(){t("."+this.secondaryIframeClass).remove()},isHalfPage:function(e,t){return 300===parseInt(e,10)&&600===parseInt(t,10)},isPushdown:function(e,t){return e===this.pushdownWidth&&t!==this.billboardHeight},handleTopNav:function(i){var s,n,a,o,r=t("#SponsorAd"),l=r.find("iframe"),d=t("#TopNavAd"),h=d.find("iframe");return s=this.ads.findWhere({name:"Middle1C"}),a=i<this.navBreakPoint&&0===l.length,o=i>=this.navBreakPoint&&0===h.length,s&&(a||o)?(a?(n=r,h.remove()):(n=d,l.remove()),e.defer(this.renderAd,{el:n,model:s}),!0):!1},fireSlideShowAd:function(e){var i=this.ads.findWhere({name:e.position}),s=t('<div class="ad-wrapper"></div>');this.adShown[e.position]||"object"!=typeof i||(this.adShown[e.position]=!0,e.el.html(s),this.renderAd({el:s,model:i}),this.broadcast("nyt:slideshow-ad-render",i))},hasInterstitial:function(){var e,t=this.ads.findWhere({name:"Interstitial"});return t?(e=t.get("timeout")?1e3*parseInt(t.get("timeout"),10):15e3,this.createInterstitial(t,this.completeInterstitial,e),!0):!1},fireRibbonInterstitial:function(){var e=this.pageManager.getViewport();this.$shell.prepend(a.ribbonInterstitial()),this.renderAdByPositionName("RibbonInterstitial"),this.$shell.find("#main").addClass("visually-hidden").end().find(".ribbon-interstitial-ad-overlay").css("height",e.height-150).find("iframe").css("width","")},createInterstitial:function(e,t,i){var s=this;this.interstitialModal=new o({id:"interstitial-ad-modal",modalTitle:"advertisement",tailDirection:"fixed",hasOverlay:!0,hasCloseButton:!0,width:e.get("width"),height:e.get("height"),modalContent:a.interstitialModal(),closeCallback:t,openCallback:function(){s.renderAdByPositionName(e.get("name"))}}).addToPage().open(),i&&(s.closeTimeout=window.setTimeout(this.interstitialModal.close,i))},completeInterstitial:function(e){window.clearTimeout(this.closeTimeout),this.interstitialModal.removeFromPage(),this.ads.remove(e),this.checkAds()}});return r}),define("homepage/views/ads/ads",["jquery/nyt","underscore/nyt","shared/ad/views/ads"],function(e,t,i){var s=i.extend({nytEvents:{"nyt:masthead-search-toggle":"handleSearchSponsorship"},scope:"homepage",mothAd:null,options:{response:window.NYTADX?window.NYTADX.response:null,adx_campaign:".nytimes.com/index.html",positions:window.NYTADX?window.NYTADX.positions:[],autoconfirm:0,keywords:[]},preInitialize:function(){var e,t=this;e="global"===this.pageManager.getEdition()?"international-home":"homepage",this.options.adx_campaign=e+this.options.adx_campaign,this.pageManager.setMeta("adxPage",this.options.adx_campaign),this.subscribe("nyt:ads-rendered",this.handleAbsentAds),this.subscribe("nyt:moth-ad-container-rendered",function(){t.extractMothAd(),t.renderMothAd()})},receiveAds:function(){var e=this,t=function(){e.extractMothAd(),e.checkAds(),e.renderMothAd()};this.hasInterstitial()?(this.subscribe("nyt:check-ads-force",t),this.ads.remove(this.ads.findWhere({name:"Interstitial"}))):t()},handleAbsentAds:function(){var e=this.ads.where({name:"Right1"}),t=this.ads.where({name:"Box2"});e.length||t.length||this.$shell.find(".right1-box2-ads").addClass("hidden")},handleSearchSponsorship:function(){var e=this.ads.findWhere({name:"Middle1C"}),t=this.$shell.find("#SponsorAd");t.length&&(e?t.children().length||this.renderAd({el:t,model:e}):t.parent().addClass("hidden"))},hasInterstitial:function(){var e=this.ads.findWhere({name:"Interstitial"});return e?!0:!1},extractMothAd:function(){var e=this.ads.findWhere({name:"MOTHAd"});e&&(this.mothAd=e,this.ads.remove(e))},renderMothAd:function(){var t=e("#MOTHAd");this.mothAd&&t.length&&0===t.children().length&&(t.removeClass("hidden"),this.renderAd({el:t,model:this.mothAd,secondaryIframeClass:"frame-for-moth"}))}});return s}),define("homepage/instances/ad-manager",["homepage/views/ads/ads"],function(e){new e}),define("shared/account/templates",["underscore/nyt"],function(_){var templates={};return templates.logInModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="login-form-control form-control">\n<form id="login-form" class="login-form" role="form">\n<fieldset>\n<legend>Log in</legend>\n<h6 class="legend-sub-heading form-hint">Don\'t have an account? <a href="javascript:;" class="registration-modal-trigger">Register now</a></h6>\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="login-email" id="login-email-label">Email address</label>\n</div>\n<div class="field-container">\n<input type="text" id="login-email" name="login-email" class="text login-email" placeholder="Email address" aria-labelledby="login-email-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-email-description"><i class="icon"></i><span class="visually-hidden" id="clear-email-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="login-password" id="login-password-label">Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="login-password" name="login-password" class="text login-password" placeholder="Password" data-type="password" aria-labelledby="login-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control layout-horizontal">\n<div class="control checkbox-control">\n<div class="field-container">\n<input type="checkbox" id="login-remember" name="login-remember" class="checkbox login-remember" checked="checked" aria-labelledby="login-remember-label" aria-checked="true" />\n</div>\n<div class="label-container">\n<label for="login-remember" class="checkbox-label" id="login-remember-label">Remember me</label>\n</div>\n</div>\n<p class="form-hint password-hint">\n<a href="'+(null==(__t=hosts.www)?"":__t)+'/forgot">Forgot password?</a>\n</p>\n</div><!-- close control -->\n<div class="control last-control">\n<button id="login-send-button" class="button login-button" >Log in</button>\n</div>\n</fieldset>\n</form>\n</div><!-- close registration-form-control -->';return __p},templates.registrationModal=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="registration-form-control form-control">\n<form id="registration-form" class="registration-form" role="form">\n<fieldset>\n<legend>Register</legend>\n<h6 class="legend-sub-heading form-hint">Already have an account? <a href="javascript:;" class="login-modal-trigger">Log in</a></h6>\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="register-email" id="register-email-label">Email address</label>\n</div>\n<div class="field-container">\n<input type="email" id="register-email" name="register-email" class="text register-email" placeholder="Email address" aria-labelledby="register-email-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-email-description"><i class="icon"></i><span class="visually-hidden" id="clear-email-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="register-password" id="register-password-label">Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="register-password" name="register-password" class="text register-password" placeholder="Password" data-type="password" aria-labelledby="register-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="retype-password" id="retype-password-label">Retype Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="retype-password" name="retype-password" class="text retype-password" placeholder="Retype Password" data-type="password" aria-labelledby="retype-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-retyped-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-retyped-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control layout-horizontal">\n<div class="control checkbox-control">\n<div class="field-container">\n<input type="checkbox" id="receive-offers" name="receive-offers" class="checkbox receive-offers" checked="checked" aria-labelledby="receive-offers-label" aria-checked="true" />\n</div>\n<div class="label-container">\n<label for="receive-offers" class="checkbox-label" id="receive-offers-label">Receive occasional email updates and special offers for New York Times products and services.</label>\n</div>\n</div>\n</div><!-- close control -->\n<div class="control last-control">\n<button id="register-send-button" class="button register-button">Create Account</button>\n</div>\n</fieldset>\n</form>\n</div><!-- close registration-form-control -->\n<div class="modal-footer">\n<p class="disclaimer"><a href="http://www.nytimes.com/content/help/rights/terms/terms-of-service.html">Terms of Service</a> <a href="http://www.nytimes.com/content/help/rights/privacy/policy/privacy-policy.html">Privacy Policy</a></p>\n</div>';return __p},templates}),define("shared/account/helpers/account-modal-mixin",["jquery/nyt","underscore/nyt","foundation/lib/polyfills/placeholder"],function(e,t,i){var s={handleDefaultSubmit:function(e){e.preventDefault()},handleKeyUp:function(t){var i=e(t.target);i.parent().find(".clear-button").toggle(""!==i.val())},handleClearButton:function(t){var s=e(t.currentTarget),n=s.parent().find("input");s.toggle(!1),n.val(""),i()}};return s}),define("shared/account/views/login-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/modal/views/modal","shared/account/templates","foundation/lib/auth/userauth","foundation/hosts","shared/account/helpers/account-modal-mixin","foundation/lib/polyfills/placeholder"],function(e,t,i,s,n,a,o,r,l,d){var h=i.extend(t.extend({},l,{events:{"click .registration-modal-trigger":"handleRegisterClick","click #login-send-button":"handleLogInButton","submit #login-form":"handleDefaultSubmit","click .clear-button":"handleClearButton","keyup .text":"handleKeyUp"},nytEvents:{"nyt:loginmodal-open":"handleOpen"},defaultSettings:{id:"login-modal",addlClasses:"account-modal",modalContent:a.logInModal({hosts:r}),binding:".login-modal-trigger",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,tailLeftOffset:-40,tailTopOffset:-40},initialize:function(e){var i=this;this.modalSettings=t.extend({},this.defaultSettings,e),this.modalSettings.openCallback=function(){var e=i.modalTitle||this.$target.data("modal-title")||"Log in";i.hasPlaceholderSupport&&this.$modal.find(".login-email").focus(),this.$modal.find("legend").text(e),this.$modal.find(".field-container input").val(""),i.modalTitle=null},this.subscribe("nyt:modal-show-login-modal",d)},handleDomReady:function(){this.render()},render:function(){this.logInModal=new n(this.modalSettings).addToPage(),this.setElement(this.logInModal.$modal),this.local(this,"nyt:modal-login-modal-rendered")},handleOpen:function(e){e&&e.modalTitle&&(this.modalTitle=e.modalTitle),this.logInModal&&this.logInModal.open()},handleUserReady:function(){s.isLoggedIn()&&(this.logInModal?(this.logInModal.removeFromPage(),this.remove()):this.subscribeOnce(this,"nyt:modal-login-modal-rendered",this.handleUserReady))},handleRegisterClick:function(){this.logInModal.close(),this.trackingTrigger("loginmodal-register-click",{module:"Registration",action:"Click","WT.z_ract":"Regnow"})},handleLogInButton:function(){this.executeLogin()},executeLogin:function(){o.login({user:this.$el.find(".login-email").val(),password:this.$el.find(".login-password").val(),remember:this.$el.find(".login-remember").is(":checked")})}}));return h}),define("shared/account/views/registration-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/account/templates","foundation/lib/auth/userauth","shared/account/helpers/account-modal-mixin","foundation/lib/polyfills/placeholder"],function(e,t,i,s,n,a,o,r){var l=i.extend(t.extend({},o,{events:{"click .login-modal-trigger":"handleLoginClick","click #register-send-button":"handleRegistrationButton","submit #registration-form":"handleDefaultSubmit","click .clear-button":"handleClearButton","keyup .text":"handleKeyUp"},defaultSettings:{id:"registration-modal",addlClasses:"account-modal",modalContent:n.registrationModal(),binding:".registration-modal-trigger",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,tailLeftOffset:-40,tailTopOffset:-40},initialize:function(e){var i=this;this.modalSettings=t.extend({},this.defaultSettings,e),this.modalSettings.openCallback=function(){var e=this.$target.data("modal-title")||"Register";i.hasPlaceholderSupport&&this.$modal.find(".register-email").focus(),this.$modal.find("legend").text(e),this.$modal.find(".field-container input").val("")},this.subscribe("nyt:modal-show-registration-modal",r)},handleDomReady:function(){this.render()},render:function(){this.registrationModal=new s(this.modalSettings).addToPage(),this.setElement(this.registrationModal.$modal)},handleLoginClick:function(){this.registrationModal.close()},handleRegistrationButton:function(){this.executeRegistration()},executeRegistration:function(){a.register({email:this.$el.find(".register-email").val(),password:this.$el.find(".register-password").val(),confPassword:this.$el.find(".retype-password").val(),specialOffers:this.$el.find(".receive-offers").is(":checked")})}}));return l}),define("shared/account/instances/account",["shared/account/views/login-modal","shared/account/views/registration-modal","foundation/models/user-data"],function(e,t,i){i.isLoggedIn()||(new e,new t)}),define("shared/recommendations/templates",["underscore/nyt"],function(_){var templates={};return templates.mostPopular=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",collection.length?(__p+="<ol>",_.each(collection.slice(0,10),function(e){__p+='<li>\n<a class="story-link" href="'+(null==(__t=e.get("link"))?"":__t)+'">\n<article class="story">\n',e.getCrop("thumbStandard")&&(__p+='\n<div class="small-thumb">\n<img src="'+(null==(__t=e.getCrop("thumbStandard").url)?"":__t)+'" />\n</div>\n'),__p+="\n",e.get("kicker")&&(__p+='\n<h3 class="kicker">'+(null==(__t=e.get("kicker"))?"":__t)+"</h3>\n"),__p+='\n<h2 class="story-heading">\n'+(null==(__t=e.get("headline"))?"":__t)+"\n</h2>\n</article>\n</a>\n</li>"}),__p+="</ol>"):__p+='<p class="error-message">This article list is not currently available. Please try again later.</p>',__p+='<footer class="recommendations-footer">\n<p class="user-action"><a href="http://www.nytimes.com/gst/mostpopular.html">Go to Complete List &raquo;</a></p>\n<p class="user-toggle"><a class="show-recommended">Show My Recommendations</a></p>\n</footer>';return __p},templates.recommended=function(obj){{var __t,__p="";
Array.prototype.join}with(obj||{})__p+="",collection.length?(__p+="",isLoggedIn&&(__p+='<header class="recommendations-header">\n<div class="article-count"><span class="counter">'+(null==(__t=collection.getCount())?"":__t)+'</span> articles viewed recently</div>\n<div class="user-meta">\n',__p+=collection.getUserPictureUrl()?'\n<img class="avatar" src="'+(null==(__t=collection.getUserPictureUrl())?"":__t)+'" />\n':'\n<img class="avatar" src="http://i1.nyt.com/images/apps/timespeople/none.png" />\n',__p+='\n<span class="user-name">'+(null==(__t=collection.getUserDisplayName())?"":__t)+'</span><br />\n<a href="http://www.nytimes.com/recommendations">All Recommendations</a>\n</div>\n</header>'),__p+="<ol>",_.each(collection.slice(0,10),function(e){__p+='<li>\n<a class="story-link" href="'+(null==(__t=e.get("link"))?"":__t)+'">\n<article class="story">\n',e.getCrop("thumbStandard")&&(__p+='\n<div class="small-thumb">\n<img src="'+(null==(__t=e.getCrop("thumbStandard").url)?"":__t)+'" />\n</div>\n'),__p+="\n",e.get("kicker")&&(__p+='\n<h3 class="kicker">'+(null==(__t=e.get("kicker"))?"":__t)+"</h3>\n"),__p+='\n<h2 class="story-heading">\n'+(null==(__t=e.get("headline"))?"":__t)+"\n</h2>\n</article>\n</a>\n</li>"}),__p+="</ol>"):__p+='<p class="error-message">We don&rsquo;t have any personalized recommendations for you at this time. Please try again later.</p>',__p+='<footer class="recommendations-footer">',__p+=isLoggedIn?'<div class="user-actions">\n<p class="user-action"><a href="http://www.nytimes.com/recommendations">Go to Your Recommendations &raquo;</a></p>\n<ul class="menu layout-horizontal theme-links with-pipes">\n<li><a href="http://www.nytimes.com/content/help/extras/recommendations/recommendations.html">What&rsquo;s This?</a></li>\n<li><a class="hide-recommended">Don’t Show</a></li>\n</ul>\n</div><div id="recommendedAd" class="recommended-ad ad">\n<iframe scrolling="no" frameborder="0" src="http://www.nytimes.com/packages/html/recommendations/ad.html" width="168" height="40"></iframe>\n</div>':'<p class="user-message">Log in to discover more articles<br>based on what you&rsquo;ve read.</p><div id="recommendedAd" class="recommended-ad ad">\n<iframe scrolling="no" frameborder="0" src="http://www.nytimes.com/packages/html/recommendations/ad.html" width="168" height="40"></iframe>\n</div><div class="user-actions logged-out">\n<div class="user-tools-button-group">\n<button class="button login-button login-modal-trigger">Log In</button>\n<button class="button registration-button registration-modal-trigger">Register Now</button>\n</div>\n<ul class="menu layout-horizontal theme-links with-pipes">\n<li><a href="http://www.nytimes.com/content/help/extras/recommendations/recommendations.html">What&rsquo;s This?</a></li>\n<li><a class="hide-recommended">Don’t Show</a></li>\n</ul></div><!-- close user-actions -->',__p+="</footer>";return __p},templates}),define("shared/tabs/views/legacy/tabs",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/views/base-view"],function(e,t,i,s){var n=s.extend({activeTabClass:"selected",events:{"click .tabs li":"handleTabClick"},initialize:function(){t.bindAll(this,"handleTabClick");var e,i;this.$tabs=this.$el.find(".tabs li"),e=this.$tabs.filter(".selected"),this.$tabContent=this.$el.siblings(".tab-content"),this.resetState(),e.length>0?(i=e.eq(0).index(),this.activateTab(i)):this.activateTab(0)},handleTabClick:function(t){var i=e(t.currentTarget).closest("li");i.hasClass(this.activeTabClass)||t.preventDefault();var s=i.index();this.local(this,"nyt:tab-click",t,s),this.resetState(),this.activateTab(s)},activateTab:function(e){this.$tabs.eq(e).addClass(this.activeTabClass),this.$tabContent.eq(e).show()},resetState:function(){this.$tabs.removeClass(this.activeTabClass),this.$tabContent.hide()}});return n}),define("shared/data/models/article",["underscore/nyt","backbone/nyt"],function(e,t){var i=t.Model.extend({defaults:{title:"",kicker:"",pubdate:"",link:"",media:[{caption:"","media-metadata":[{url:""}]}],promotional_media:[{image:{image_crops:{}}}],processed:!1},initialize:function(){this.adjustKicker()},adjustKicker:function(){this.isOpinion()&&this.get("authors")&&this.set("kicker",this.get("authors")[0])},isOpinion:function(){return"Op-Ed Columnist"===this.get("kicker")||"Opinionator"===this.get("kicker")},getCrop:function(e){var t=this.get("promotional_media"),i="",s="image";try{if(t.type&&"image"!==t.type){switch(s=t.type){case"video":i="Play Video";break;case"slideshow":i="View Slideshow";break;case"interactive":i="View Interactive";break;default:i="View Media"}t=t.promotional_media}return t.image.image_crops[e].type=s,t.image.image_crops[e].typeName=i,t.image.image_crops[e]}catch(n){return}},createDateObject:function(e){var t,i,s=new Date(e);return s.getDate()||e.search(/\d+T\d+/)>=0&&(t=e.split("T")[0],i=t.split("-"),s=new Date(i[0],i[1]-1,i[2])),s},getFormattedDate:function(e){var t,i=["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."];return e=e||this.get("pubDate"),t=this.createDateObject(e),i[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()},getDatetime:function(e){var t;return e=e||this.get("pubDate"),t=this.createDateObject(e),t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}});return i}),define("shared/data/helpers/collection-mixin",["jquery/nyt","underscore/nyt"],function(){var e={hasFetched:!1,getNext:function(e,t){var i=e.indexOf(t),s=i===e.length?0:i+1;return e.at(s)},loadData:function(){return 0!==this.length||this.hasFetched||(this.hasFetched=!0,this.fetch()),this},getIdentifier:function(){return"rref="+this.sectionId},getName:function(){return this.sectionName},getUrl:function(){return this.sectionUrl}};return e}),define("shared/data/collections/most-popular",["backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","underscore/nyt","shared/data/helpers/collection-mixin"],function(e,t,i,s,n,a){var o=t.extend(n.extend({},a,{model:i,apis:{mostviewed:{url:s.s1+"/du/mostpopular/viewed/all_1.jsonp?v1",callback:"jsonCallbackViewed"},mostemailed:{url:s.s1+"/du/mostpopular/emailed/all_1.jsonp?v1",callback:"jsonCallbackEmailed"}},initialize:function(e,t){this.url=this.apis[t.type].url,this.callback=this.apis[t.type].callback},sync:function(t,i,s){return s.dataType="jsonp",s.jsonpCallback=this.callback,s.jsonp="callback",s.cache=!0,e.sync(t,i,s)},parse:function(e){var t=this,i=n.map(e.results,function(e){var i=[];return e.id&&(e.data_id=e.id,delete e.id),e.asset_id&&delete e.asset_id,""===e.media?delete e.media:i=e.media[0]["media-metadata"]||[],e.promotional_media={image:{image_crops:{thumbStandard:t.getCrop(i,"Standard Thumbnail"),mediumThreeByTwo210:t.getCrop(i,"mediumThreeByTwo210")}}},e.description=e.abstract,e.link=e.url,e.kicker=e.column,e.headline=e.title,e.authors=[e.byline.replace("By ","").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})],e.pubDate=e.published_date,e});return i},getCrop:function(e,t){var i,s;for(i=0,s=e.length;s>i;i+=1)if(e[i].format===t)return e[i]},getIdentifier:function(){return"src=me"}}));return o}),define("shared/data/instances/most-emailed",["jquery/nyt","foundation/views/page-manager","foundation/hosts","shared/data/collections/most-popular"],function(e,t,i,s){return new s([],{type:"mostemailed"})}),define("shared/data/instances/most-viewed",["jquery/nyt","foundation/views/page-manager","foundation/hosts","shared/data/collections/most-popular"],function(e,t,i,s){return new s([],{type:"mostviewed"})}),define("shared/data/collections/recommendations",["backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","underscore/nyt","shared/data/helpers/collection-mixin"],function(e,t,i,s,n,a){var o=t.extend(n.extend({},a,{model:i,url:s.du+"/svc/recommendations/v3/personalized.jsonp",sync:function(t,i,s){return s.dataType="jsonp",s.jsonpCallback="jsonRecommended",s.jsonp="callback",s.cache=!0,s.data={access_key:"776ACB1E-6C7F-4702-9E18-CF329376F5A3"},e.sync(t,i,s)},parse:function(e){var t=this,i=n.map(e.suggestions,function(e){var i=e.thumbs||{};return e.promotional_media={image:{image_crops:{thumbStandard:e.thumbnail,mediumThreeByTwo210:t.getCrop(i,"mediumThreeByTwo210")}}},e.kicker&&"Video"===e.item_type?e.kicker="Video | "+e.kicker:"Video"===e.item_type&&(e.kicker="Video"),e.authors=e.byline?[e.byline.replace("By ","").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})]:"",e.description=e.abstract,e.link=e.url,e.headline=e.title,e.pubDate=e.published_date,e});return this.num_articles=e.num_articles,this.uid=e.uid,this.user_displayname=e.user_displayname,this.user_pic_url=e.user_pic_url,i},getCount:function(){return this.num_articles||0},getUserId:function(){return this.uid||0},getUserDisplayName:function(){return this.user_displayname||null},getUserPictureUrl:function(){return this.user_pic_url||null},getCrop:function(e,t){var i,s;for(i=0,s=e.length;s>i;i+=1)if(e[i].type===t)return e[i].url=e[i].content,e[i]},getIdentifier:function(){return"src=recg"}}));return o}),define("shared/data/instances/recommendations",["jquery/nyt","foundation/views/page-manager","shared/data/collections/recommendations"],function(e,t,i){return new i}),define("shared/recommendations/views/recommendations",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/views/base-view","foundation/models/user-data","foundation/cookies","shared/recommendations/templates","shared/tabs/views/legacy/tabs","shared/data/instances/most-emailed","shared/data/instances/most-viewed","shared/data/instances/recommendations"],function(e,t,i,s,n,a,o,r,l,d,h){var c=s.extend({el:"#recommendations",events:{"click .hide-recommended":"handleHideClick","click .show-recommended":"handleShowClick"},collectionList:{"most-emailed":{name:"mostEmailedCollection",render:"renderMostEmailed",instance:l},"most-viewed":{name:"mostViewedCollection",render:"renderMostViewed",instance:d},recommended:{name:"recommendedCollection",render:"renderRecommended",instance:h}},initialize:function(){this.$tabsContainer=this.$el.find(".tabs-container");var t=new r({el:this.$tabsContainer});this.subscribe(t,"nyt:tab-click",function(t){var i=e(t.currentTarget).data("type");this.handleTabClick(i)});var i=a.readCookie("nyt-recommend");"0"===i?this.deactivateRecommended():i&&"1"!==i||this.activateRecommended()},handleTabClick:function(e){var t=this.collectionList[e];this[t.name]=t.instance.loadData(),this[t.name].length>0?this[t.render]():this.subscribeOnce(this[t.name],"sync",this[t.render])},renderMostEmailed:function(){this.$el.find(".tab-content.most-emailed").html(o.mostPopular({collection:this.mostEmailedCollection}))},renderMostViewed:function(){this.$el.find(".tab-content.most-viewed").html(o.mostPopular({collection:this.mostViewedCollection}))},renderRecommended:function(){this.recommendedCollection.length>0?(this.$el.find(".tab-content.recommended").html(o.recommended({collection:this.recommendedCollection,isLoggedIn:n.isLoggedIn()})),this.broadcast("nyt:ads-new-placement","recommendedAd")):(this.deactivateRecommended(),this.$el.addClass("recommended-no-results"))},handleHideClick:function(e){e.preventDefault(),this.deactivateRecommended(),a.writeCookie("nyt-recommend","0")},handleShowClick:function(e){e.preventDefault(),this.activateRecommended(),a.writeCookie("nyt-recommend","1")},deactivateRecommended:function(){this.$tabsContainer.find("li[data-type=most-emailed]").trigger("click"),this.$tabsContainer.find("li[data-type=recommended]").hide(),this.$el.removeClass("recommended-active")},activateRecommended:function(){this.$tabsContainer.find("li[data-type=recommended]").show().trigger("click"),this.$el.addClass("recommended-active")}});return c}),define("shared/recommendations/instances/recommendations",["shared/recommendations/views/recommendations"],function(e){new e}),define("shared/searchform/models/search-suggest",["foundation/models/base-model"],function(e){var t=e.extend({defaults:{query:"",results:[]}});return t}),define("shared/searchform/collections/search-suggest",["backbone/nyt","foundation/collections/base-collection","foundation/views/page-manager","shared/searchform/models/search-suggest","foundation/hosts"],function(e,t,i,s,n){var a=t.extend({model:s,mobileBaseUrl:n.mobileWeb,desktopBaseUrl:n.www,settings:{numOfSuggestions:7},query:"",sync:function(t,i,s){var n="/svc/suggest/v1/homepage?query="+this.query;return s.url=this.pageManager.getCurrentBreakpoint()<120?this.mobileBaseUrl+n:this.desktopBaseUrl+n,e.sync(t,i,s)},parse:function(e){return{query:e[0],results:e[1].slice(0,this.settings.numOfSuggestions)}},newQuery:function(e){this.query=e,this.fetch()}});return a}),define("shared/searchform/templates",["underscore/nyt"],function(_){var templates={};return templates.autoSuggest=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<li><a href="'+(null==(__t=queryUrl)?"":__t)+'">\n'+(null==(__t=suggest.replace(queryRegExp,"<strong>"+query+"</strong>"))?"":__t)+"\n</a></li>";return __p},templates}),define("shared/searchform/helpers/search-form-mixin",["jquery/nyt","underscore/nyt","foundation/lib/polyfills/placeholder","shared/searchform/collections/search-suggest","shared/searchform/templates","foundation/hosts"],function(e,t,i,s,n,a){var o=t.extend({},{collection:new s,searchBaseUrl:a.search+"/search/sitesearch/#/",searchMobileUrl:a.mobileWeb+"/search?query=",KEYS:{ENTER:13,ESC:27,UP_ARROW:38,DOWN_ARROW:40,LEFT_ARROW:37,RIGHT_ARROW:39},initialize:function(){var e=this.pageManager.getMeta("article:section")||"";t.bindAll(this,"handlePageClicks"),this.trackingBaseData={action:"click",contentCollection:e,region:"TopBar"}},handleDomReady:function(){this.$list=this.$el.find(".auto-suggest"),this.$clearButton=this.$el.find(".clear-button"),this.$overlay=this.$shell.find(".search-overlay"),this.$input=this.$el.find(".search-input"),this.$submitButton=this.$el.find(".submit-button"),this.$submitButton.addClass("disabled"),this.listenTo(this.collection,"sync change",this.render),this.throttledSuggestions=t.debounce(this.getAutoSuggestions,250),this.afterInitialize()},afterInitialize:e.noop,render:function(){var e,t="",i=this.collection.toJSON()[0],s=new RegExp(i.query,"ig"),a=n.autoSuggest,o=i.results.length;if(o>0&&this.getSearchValue().length>0){for(e=0;o>e;e+=1)t+=a({query:i.query,queryUrl:this.getSearchUrl(i.results[e]),suggest:i.results[e],queryRegExp:s});this.$list.show().find("ol").html(t)}else this.$list.hide()},handleKeyDown:function(e){var t=e.which;t===this.KEYS.ENTER&&e.preventDefault()},handleKeyUp:function(e){e.preventDefault();var t=e.which;t===this.KEYS.UP_ARROW||t===this.KEYS.DOWN_ARROW?this.navigateAutoSuggestions(t):t===this.KEYS.ENTER?this.handleEnterKey(e):t===this.KEYS.RIGHT_ARROW||t===this.KEYS.LEFT_ARROW?this.handleRightLeftKey(e):(this.$clearButton[this.getSearchValue().length>0?"fadeIn":"fadeOut"](200),this.getSearchValue().length?this.$submitButton.hasClass("disabled")&&this.$submitButton.removeClass("disabled"):this.$submitButton.addClass("disabled"),this.throttledSuggestions())},handleEnterKey:function(){this.submitSearch()},handleRightLeftKey:e.noop,handleClearButton:function(e){e.preventDefault(),this.setSearchValue(""),this.$clearButton.fadeOut(200),this.$submitButton.addClass("disabled"),this.$input.focus(),i()},setSearchValue:function(e){this.$input.val(e)},getSearchValue:function(){return e.trim(this.$input.val())},hideAutoSuggest:function(){this.$list.hide()},getAutoSuggestions:function(){var e=this.getSearchValue();e.length>1?this.collection.newQuery(e):this.hideAutoSuggest()},getSearchUrl:function(e){return this.pageManager.getCurrentBreakpoint()<120?this.searchMobileUrl+e+"&sort=rel":this.searchBaseUrl+e},navigateAutoSuggestions:function(e){var t,i;i=this.$list.find(".active"),t=i.parent().index()||0,t+=e===this.KEYS.UP_ARROW?-1:1,this.$list.find("a").removeClass("active").eq(t).addClass("active"),this.setSearchValue(this.$list.find("a").eq(t).text())},submitSearch:function(e){var t,i=this.getSearchValue();e&&e.preventDefault(),i&&(t=this.trackingAppendParams(this.getSearchUrl(i),{module:"SearchSubmit"}),this.$el.is(":visible")&&(window.location=t))},handlePageClicks:function(){this.hideAutoSuggest()}});return o}),define("shared/masthead/views/search",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/searchform/helpers/search-form-mixin"],function(e,t,i,s){var n=i.extend(t.extend({},s,{el:e("#masthead").find(".search-flyout-panel"),events:{"click .close-button":"close","keyup .search-input":"handleKeyUp","keydown .search-input":"handleKeyDown","click .submit-button":"submitSearch","click .clear-button":"handleClearButton"},nytEvents:{"nyt:masthead-search-click":"toggle","nyt:masthead-search-toggle":"handleSearchToggle","nyt:navigation-search-click":"toggle","nyt:search-close-ready":"close"},slideTiming:100,afterInitialize:function(){this.trackingBaseData["WT.nav"]="searchWidget",this.$input.removeAttr("placeholder")},open:function(){var e=this;this.$el.slideDown(this.slideTiming,function(){e.$el.find(".control").fadeIn(e.slideTiming).end().find(".search-input").val("").focus()}),this.broadcast("nyt:masthead-search-toggle",!0),this.$shell.on("click",this.handlePageClicks),this.subscribeOnce("nyt:page-key-esc",this.close),this.$overlay.fadeIn(200),this.$html.addClass("search-active")},close:function(){var e=this;this.$html.hasClass("search-active")&&(this.$el.find(".control").fadeOut(this.slideTiming,function(){e.$el.slideUp(e.slideTiming,function(){e.$html.removeClass("search-active")})}),this.broadcast("nyt:masthead-search-toggle",!1),this.$shell.off("click",this.handlePageClicks),this.setSearchValue(""),this.$overlay.fadeOut(200))},toggle:function(){this[this.$el.is(":visible")?"close":"open"]()},isSearchButton:function(t){var i=e(t).hasClass("search-button"),s=1===e(t).parents(".search-button").length;return i||s},isSearchFlyout:function(t){var i=e(t).hasClass("search-flyout-panel"),s=1===e(t).parents(".search-flyout-panel").length;return i||s},handlePageClicks:function(e){this.isSearchButton(e.target)||this.isSearchFlyout(e.target)||this.close(),this.hideAutoSuggest()},handleSearchToggle:function(e){e===!1&&(this.$el.find(".submit-button").addClass("disabled"),this.$el.find(".clear-button").hide())}}));return n}),define("shared/masthead/templates",["underscore/nyt"],function(_){var templates={};return templates.profileIcon=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="avatar" role="presentation">\n<a href="http://timespeople.nytimes.com/view/user/'+(null==(__t=userData.getUserId())?"":__t)+'/settings.html"><img src="'+(null==(__t=userData.getImageUrl())?"":__t)+'" alt="" /></a>\n</span>';return __p},templates.userName=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<button class="button user-name-button">\n<span class="button-text">'+(null==(__t=getTruncatedUserName(15))?"":__t)+'</span>\n<i class="icon user-icon"></i>\n<i class="icon caret-icon"></i>\n</button>';return __p},templates.userNameModalContent=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<ul>\n<li><a href="http://timespeople.nytimes.com/view/user/'+(null==(__t=userData.getUserId())?"":__t)+'/settings.html">My Profile</a></li>\n<li><a href="'+(null==(__t=hosts.myaccount)?"":__t)+'/membercenter/myaccount.html">My Account</a></li>\n<li><a href="'+(null==(__t="http:"+hosts.www)?"":__t)+'/saved">My Saved Items</a></li>\n<li><button class="button log-out-button">Log Out</button></li>\n</ul>';return __p},templates.userNameModalTitle=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",""!=userData.getImageUrl()&&(__p+='<span class="avatar">\n<a href="http://timespeople.nytimes.com/view/user/'+(null==(__t=userData.getUserId())?"":__t)+'/settings.html"><img src="'+(null==(__t=userData.getImageUrl())?"":__t)+'" /></a>\n</span>'),__p+='\n<span class="user-name-subscription">\n<span class="user-name">'+(null==(__t=userData.getUserName())?"":__t)+'</span>\n<span class="user-subscription"><a href="https://myaccount.nytimes.com/membercenter/myaccount.html">'+(null==(__t=subscription.label)?"":__t)+"</a></span>\n</span>";return __p},templates.userSettingsModal=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="menu edition-menu">\n<h5 class="modal-heading">Edition</h5>\n<ul>\n<li><a href="http://www.nytimes.com" data-edition="us">U.S.</a></li>\n<li><a href="http://global.nytimes.com" data-edition="global">International</a></li>\n<li><a href="http://cn.nytimes.com" data-edition="chinese">中文 (Chinese)</a></li>\n</ul>\n</div>\n<div class="menu help-menu">\n<h5 class="modal-heading">Help</h5>\n<ul>\n<li><a href="http://www.nytimes.com/content/help/front.html">FAQ</a></li>\n<li><a href="http://www.nytimes.com/content/help/contact/directory.html">Contact Us</a></li>\n</ul>\n</div>\n',showTypeSizer&&(__p+='\n<div class="menu type-sizer-menu">\n<h5 class="modal-heading">Type Size</h5>\n<ul>\n<li data-size="small" class="type-sizer-small"><a href="javascript:;">A <span class="visually-hidden">Type size small</span></a></li>\n<li data-size="medium" class="type-sizer-medium"><a href="javascript:;">A <span class="visually-hidden">Type size medium</span></a></li>\n<li data-size="large" class="type-sizer-large"><a href="javascript:;">A <span class="visually-hidden">Type size large</span></a></li>\n</ul>\n</div>\n'),__p+="";return __p},templates}),define("shared/masthead/views/user-settings-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/masthead/templates","foundation/cookies"],function(e,t,i,s,n){var a=i.extend({events:{"click .edition-menu a":"handleEditionClick","click .type-sizer-menu li":"handleFontSizeClick","click .help-menu a":"handleHelpMenuClick"},nytEvents:{"nyt:fontsizer-initialize":"handleFontSizeChange","nyt:fontsizer-change":"handleFontSizeChange"},defaultSettings:{id:"user-settings-modal",binding:".user-settings-button",tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"260px",toggleSpeed:1,showTypeSizer:!0,openCallback:function(){this.$target.addClass("active"),this.subscribeOnce("nyt:page-scroll",this.close)},closeCallback:function(){this.$target.removeClass("active")}},webTrendsNav:"user-settings-modalContainer",initialize:function(e){var i=this.pageManager.getMeta("article:section")||"";this.settings=t.extend({},this.defaultSettings,e),this.settings.modalContent=n.userSettingsModal({showTypeSizer:this.settings.showTypeSizer}),this.trackingBaseData={action:"click",region:"TopBar","WT.nav":this.webTrendsNav,contentCollection:i}},handleDomReady:function(){this.render()},render:function(){var e=new s(this.settings);this.setElement(e.$modal),e.$modal.find("a[data-edition="+this.pageManager.getEdition()+"]").addClass("selected"),e.addToPage(),this.handleFontSizeChange()},handleEditionClick:function(e){this.broadcast("nyt:masthead-edition-change",e,{"WT.nav":this.webTrendsNav})},handleHelpMenuClick:function(t){var i=e(t.target),s=i.attr("href");s&&(s=this.trackingAppendParams(s,{}),i.attr("href",s))},handleFontSizeClick:function(t){var i=e(t.currentTarget).data("size");this.broadcast("nyt:fontsizer-change",i)},handleFontSizeChange:function(e){var t="type-size-selected";e=e||this.pageManager.getMeta("fontsizer_typeSize"),this.$el.find(".type-sizer-menu li").removeClass(t),this.$el.find(".type-sizer-"+e).addClass(t)}});return a}),define("shared/masthead/views/user-name-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/masthead/templates","foundation/models/user-data","foundation/hosts"],function(e,t,i,s,n,a,o){var r=i.extend({events:{"click .premier-subscriber a":"handleUserSubscriptionClick","click li a":"handleUserOptionClick"},defaultSettings:{id:"user-name-modal",modalTitle:"",modalContent:"",binding:".user-name-button",tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"260px",toggleSpeed:1,openCallback:function(){this.$target.addClass("active"),this.listenToOnce(this.pageManager,"nyt:page-scroll",this.close)},closeCallback:function(){this.$target.removeClass("active")}},initialize:function(e){t.bindAll(this,"handleLogOut"),this.settings=t.extend({},this.defaultSettings,e),this.trackingBaseData={module:"ProfileDropdown",action:"click",region:"Masthead","WT.nav":"shell"}},handleUserReady:function(){var e,t=this.getSubscriptionLabel(a);this.settings.modalTitle=n.userNameModalTitle({userData:a,subscription:t}),this.settings.modalContent=n.userNameModalContent({userData:a,hosts:o}),this.render(),e=this.$el.find(".user-subscription"),""===t.label&&e.remove(),""!==t.className&&e.addClass(t.className),""!==t.link&&e.find("a").attr("href",t.link),"NYT Now Subscriber"===t.label&&e.find("a").after('<i class="icon dot-logo-icon"></i>'),this.listenToOnce(a,"nyt:user-image-loaded",this.handleProfileImage),this.$el.on("click",".log-out-button",this.handleLogOut)},getSubscriptionLabel:function(e){var t={label:"",className:"",link:""};return e.isPremierSubscriber()?(t.label="Times Premier Subscriber",t.className="premier-subscriber",t.link="http://www.nytimes.com/times-insider"):e.isWebSubscriber()&&e.isMobileSubscriber()?t.label="All Digital Access Subscriber":e.isTabletSubscriber()&&e.isWebSubscriber()?t.label="Tablet and Web Subscriber":e.isSmartphoneSubscriber()&&e.isWebSubscriber()?t.label="Smartphone and Web Subscriber":e.isWebSubscriber()?t.label="Web Subscriber":e.isNytNowSubscriber()&&e.isCookingSubscriber()?(t.label="NYT Now & Cooking Subscriber",t.link="http://www.nytnow.com"):e.isNytNowSubscriber()&&e.isOpinionSubscriber()?(t.label="NYT Now & NYT Opinion Subscriber",t.link="http://www.nytimes.com/content/help/mobile/mobile.html"):e.isNytNowSubscriber()?(t.label="NYT Now Subscriber",t.link="http://www.nytimes.com/content/help/mobile/nyt-now/nyt-now.html"):e.isOpinionSubscriber()&&e.isCookingSubscriber()?t.label="NYT Opinion & Cooking Subscriber":e.isCookingSubscriber()?t.label="Cooking Subscriber":e.isOpinionSubscriber()?(t.label="NYT Opinion Subscriber",t.link="http://www.nytimes.com/content/help/mobile/nyt-opinion/nyt-opinion.html"):e.isCrosswordsSubscriber()&&(t.label="Crosswords Subscriber"),t},render:function(){var e=new s(this.settings);this.setElement(e.$modal),e.addToPage()},handleProfileImage:function(){var e=n.profileIcon({userData:a});this.$el.find(".modal-heading").prepend(e)},handleUserSubscriptionClick:function(t){var i=e(t.currentTarget),s=this.trackingAppendParams(i.attr("href"),{contentCollection:"TimesPremier-InsideStory"});i.attr("href",s)},handleUserOptionClick:function(t){var i=e(t.target),s=i.text(),n=i.attr("href"),a={action:"Click",region:"TopBar","WT.nav":"shell"};n&&(s&&(a.module=s.replace(/\s/g,"")),n=this.trackingAppendParams(n,a),i.attr("href",n))},handleLogOut:function(){var e="http:"+o.www+"/logout";e=this.trackingAppendParams(e,{module:"LogOut",action:"Click",region:"TopBar","WT.nav":"shell"}),window.location=e}});return r}),define("homepage/views/masthead/masthead",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/hosts","foundation/models/user-data","shared/masthead/templates"],function(e,t,i,s,n,a){var o=i.registerView("masthead").extend({el:"#masthead",events:{"click .search-button":"handleSearchClick","click .sections-button":"handleSectionsClick","click .editions-menu a":"handleEditionClick","click .login-button":"handleLogInClick","click .masthead-menu a":"handleMenuClick"},nytEvents:{"nyt:messaging-critical-alerts-move-furniture":"handlePageAlerts","nyt:messaging-suggestions-move-furniture":"handlePageAlerts","nyt:masthead-search-toggle":"handleSearchToggle","nyt:masthead-edition-change":"handleEditionClick"},trackingRegion:"TopBar",handleDomReady:function(){var e=this.$el.find(".user-tools-button-group");n.ready(function(){n.isLoggedIn()?e.prepend(a.userName(n)):e.find(".login-button").removeClass("hidden")})},handlePageAlerts:function(t){t(this.$el),t(e("#announcements-container")),t(e("#masthead-placeholder"))},handleSearchToggle:function(e){this.$el.find(".search-button")[e?"addClass":"removeClass"]("active")},handleMenuClick:function(t){var i=e(t.currentTarget),s=i.data("collection"),n={action:"Click",module:"HPMiniNav",region:this.trackingRegion,"WT.nav":"page"};switch(s){case"todays-paper":n.contentCollection="TodaysPaper";break;case"weather":n.contentCollection="Weather";break;case"video":n.contentCollection="Video"}i.attr("href",this.trackingAppendParams(i.attr("href"),n))},handleEditionClick:function(i,s){var n=e(i.target),a=n.attr("href"),o=n.data("edition"),r={action:"Click",region:this.trackingRegion};switch(this.pageManager.setEdition(o),o){case"us":r.module="EditionToggleToUS";break;case"global":r.module="EditionToggleToGlobal";break;case"chinese":r.module="EditionToggleToCHNS"}a&&(r=t.extend(r,s),a=this.trackingAppendParams(n.attr("href"),r),n.attr("href",a))},handleSectionsClick:function(e){this.broadcast("nyt:masthead-section-click",e)},handleSearchClick:function(e){this.broadcast("nyt:masthead-search-click",e),this.trackingTrigger("masthead-search-click",{action:"Click",module:"SearchOpen",eventName:"OpenSearchBar",region:this.trackingRegion})},handleLogInClick:function(){this.trackingTrigger("masthead-login-click",{action:"Click",module:"LogIn","WT.nav":"shell",region:this.trackingRegion})}});return o}),define("homepage/templates",["underscore/nyt"],function(_){var templates={};return templates.embeddedSlideshowHP=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="content-container">\n<div class="image"></div>\n<nav class="arrow-navigation">\n<span class="counter"></span>\n',isMobile===!1&&(__p+='\n<button class="arrow-navigation-previous" >\n<span class="visually-hidden">Go to previous slide</span>\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n</button>\n<button class="arrow-navigation-next">\n<span class="visually-hidden">Go to next slide</span>\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</button>\n'),__p+='\n</nav><figcaption class="caption" itemprop="description"></figcaption>\n</div>';return __p},templates.image=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<nav class="image-navigation previous">\n<span class="visually-hidden">Go to previous slide</span>\n</nav>\n<nav class="image-navigation next">\n<span class="visually-hidden">Go to next slide</span>\n</nav>\n<img src="'+(null==(__t=src)?"":__t)+'" data-caption="" style="display:none;" />';return __p},templates.imageInfo=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="caption-control" style="display:none;">\n<span class="caption-text">\n'+(null==(__t=caption)?"":__t)+'\n</span>\n<span class="credit" itemprop="copyrightHolder">\n<span class="visually-hidden">Credit</span>\n'+(null==(__t=credit)?"":__t)+"\n</span>\n</span>";return __p},templates.miniNavigationPlaceholder=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="mini-navigation-placeholder"></div>';return __p},templates.mothAd=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div id="MOTHAd" class="ad moth-ad"></div>';return __p},templates.weather=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<a class="button weather-button" ',isDesktop&&(__p+=' href="'+(null==(__t=mainWeatherPageUrl)?"":__t)+'" '),__p+='>\n<i class="icon weather-icon '+(null==(__t="icon-weather-"+currentWeather.getIcon())?"":__t)+' w24"></i>'+(null==(__t=currentWeather.getTemp())?"":__t)+"&deg;"+(null==(__t=currentWeather.getTempUnit())?"":__t)+"\n</a>";return __p},templates.weatherModalContent=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="section today">\n<h5 class="section-heading">Today</h5>\n<i class="icon weather-icon '+(null==(__t="icon-weather-"+currentWeather.getIcon())?"":__t)+' w50"></i>\n<div class="weather-detail">\n<h4 class="weather-heading">\n<span>'+(null==(__t=currentWeather.getTemp())?"":__t)+"&deg;"+(null==(__t=currentWeather.getTempUnit())?"":__t)+'</span>\n<span class="phrase">'+(null==(__t=currentWeather.getDescription())?"":__t)+'</span>\n</h4>\n<span class="temperature high-temperature"><span class="visually-hidden">High Temperature</span>'+(null==(__t=currentWeather.getHighTemp())?"":__t)+'&deg;</span>\n<span class="temperature low-temperature"><span class="visually-hidden">Low Temperature</span>'+(null==(__t=currentWeather.getLowTemp())?"":__t)+'&deg;</span>\n<p class="summary">'+(null==(__t=currentWeather.getPhrase())?"":__t)+'</p>\n</div>\n</div>\n<div class="section this-week">\n<h5 class="section-heading">This week</h5>\n<ul>\n',_.each(weatherCollection.getFourDayForecast(),function(e){__p+='\n<li>\n<i class="icon weather-icon '+(null==(__t="icon-weather-"+e.getIcon())?"":__t)+' w50">\n<span class="visually-hidden">'+(null==(__t=e.getDescription())?"":__t)+'</span>\n</i>\n<span class="day">'+(null==(__t=e.getDisplayDay())?"":__t)+'</span>\n<span class="temperature high-temperature"><span class="visually-hidden">High Temperature</span>'+(null==(__t=e.getHighTemp())?"":__t)+'&deg;</span>\n<span class="temperature low-temperature"><span class="visually-hidden">Low Temperature</span>'+(null==(__t=e.getLowTemp())?"":__t)+"&deg;</span>\n</li>\n"
}),__p+='\n</ul>\n</div>\n<div class="footer">\n<p class="user-action"><a class="button user-action-button" href="'+(null==(__t=mainWeatherPageUrl)?"":__t)+'">More &raquo;</a></p>\n</div>';return __p},templates.weatherModalHeader=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<p class="user-action"><a href="'+(null==(__t=editWeatherUrl)?"":__t)+'">Edit</a></p>';return __p},templates}),define("homepage/views/masthead/in-content-theme",["jquery/nyt","underscore/nyt","foundation/views/base-view","homepage/templates"],function(e,t,i){var s=i.extend({el:"#masthead",events:{"click .user-name-button, .user-settings-button":"handleUserButtonClick"},nytEvents:{"nyt:page-scroll":"toggleTheme"},defaultSettings:{themeClass:"theme-in-content",themeEventName:"nyt:masthead-contenttheme"},mastheadOffset:null,initialize:function(e){t.bindAll(this,"determineCloseAbility"),this.settings=t.extend({},this.defaultSettings,e),this.mastheadOffset=this.$el.offset().top+this.$el.height()},handleDomReady:function(){this.toggleTheme()},toggleTheme:function(){var e=this.pageManager.getViewport().top,t=this.$el.hasClass(this.settings.themeClass),i=e>this.mastheadOffset;i&&!t?(this.addTheme(),this.broadcast(this.settings.themeEventName,!0)):!i&&t&&(this.removeTheme(),this.broadcast(this.settings.themeEventName,!1))},addTheme:function(){this.signalSearchCloseReady(),this.$el.addClass(this.settings.themeClass)},removeTheme:function(){this.signalSearchCloseReady(),this.$el.removeClass(this.settings.themeClass)},signalSearchCloseReady:function(){this.broadcast("nyt:search-close-ready")},handleUserButtonClick:function(){this.$html.hasClass("search-active")&&!this.$el.hasClass(this.settings.themeClass)&&(window.scrollTo(0,0),this.signalSearchCloseReady())},determineCloseAbility:function(e,i){var s=10,n=i-this.$body.scrollTop();Math.abs(n)<=s||this.$html.hasClass("search-active")?e.subscribeOnce("nyt:page-scroll",t.partial(this.determineCloseAbility,e,i)):e.close()}});return s}),define("shared/data/models/weather",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/models/base-model","foundation/helpers/utils"],function(e,t,i,s){var n=s.extend({defaults:{city:"",state:"",country:"",temp:"",high:"",low:"",temp_unit:"",image:"",icon:"",phrase:"",description:""},dayAbbreviations:{Monday:"MON",Tuesday:"TUES",Wednesday:"WED",Thursday:"THURS",Friday:"FRI",Saturday:"SAT",Sunday:"SUN"},getCity:function(){return this.get("city")},getState:function(){return this.get("state")},getCountry:function(){return this.get("country")},getDisplayLocation:function(){var e=this.getCity(),t=this.getState(),i=this.getCountry();return"United States"===i?e+", "+t:e+", "+i},getTemp:function(){return this.get("temp")},getHighTemp:function(){return this.get("high")},getLowTemp:function(){return this.get("low")},getTempUnit:function(){return this.get("temp_unit")},getDay:function(){return this.get("day")},getDisplayDay:function(){return this.dayAbbreviations[this.getDay()]},getIconURL:function(){return this.get("image")},getIcon:function(){return this.get("icon")},getPhrase:function(){return this.get("phrase")},getDescription:function(){var e=this.getIcon();return this.get("description")||this.getWeatherDescriptionFromIcon(e)},getWeatherDescriptionFromIcon:function(e){var t={"01":"Sunny","02":"Mostly Sunny","03":"Partly Sunny","04":"Partly Cloudy","05":"Hazy","06":"Mostly Cloudy","07":"Cloudy","08":"Overcast",11:"Foggy",12:"Showers",13:"Scattered Showers",14:"Isolated Showers",15:"Thunderstorms",16:"Scattered Thunderstorms",17:"Isolated Thunderstorms",18:"Rain",19:"Flurries",20:"Scattered Flurries",21:"Isolated Flurries",22:"Snow",23:"Scattered Snow",24:"Ice",25:"Sleet",26:"Freezing Rain",29:"Mixed Rain and Snow",30:"Hot",31:"Cold",32:"Windy",33:"Clear",34:"Mostly Clear",35:"Partly Cloudy",36:"Partly Cloudy",37:"Hazy",38:"Mostly Cloudy",39:"Isolated Showers",40:"Scattered Showers",41:"Isolated Thunderstorms",42:"Scattered Thunderstorms",43:"Scattered Flurries",44:"Scattered Snow"};return t[e]||""}});return n}),define("shared/data/collections/weather",["backbone/nyt","foundation/collections/base-collection","underscore/nyt","shared/data/helpers/collection-mixin","foundation/helpers/utils","shared/data/models/weather"],function(e,t,i,s,n,a){var o=t.extend(i.extend({},s,{model:a,url:"",initialize:function(e){this.settings=i.extend({},this.defaultSettings,e)},loadData:function(e){this.url=n.getHostBasedOnEdition()+"/svc/weather/v2/current-and-five-day-forecast/"+e+".jsonp",this.fetch()},sync:function(t,i,s){return s.url=this.url,s.dataType="jsonp",s.jsonpCallback="jsonWeather",s.jsonp="callback",s.cache=!0,e.sync(t,i,s)},parse:function(e){var t,i,s=["description","temp","temp_unit","icon"];if(e&&e.results){t=e.results.five_day_forecast,i=e.results.current[0];for(var n in s)s.hasOwnProperty(n)&&(t[0][s[n]]=i[s[n]]);return t}return[]},getFourDayForecast:function(){return i.rest(this.models,1)},getCurrentWeather:function(){return this.models[0]}}));return o}),define("shared/data/instances/weather-collection",["shared/data/collections/weather"],function(e){return new e}),define("homepage/views/masthead/weather",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","homepage/templates","foundation/cookies","foundation/hosts","shared/data/instances/weather-collection"],function(e,t,i,s,n,a,o,r){var l=i.extend({el:e("#masthead").find(".weather"),isDesktop:!1,userLocation:"",keepModalOpen:!1,weatherModalSettings:{id:"weather-modal",binding:".weather-button",tailDirection:"up",tailTopOffset:-5,hoverIntentDelay:300,closeIntentDelay:1e3},initialize:function(){var e,t=a.readCookie("NYT_W2");this.isDesktop=this.pageManager.isDesktop(),t&&(e=t.split("|"),e.length>0&&(this.userLocation=e[0],this.subscribeOnce(r,"sync",this.renderWeather),r.loadData(this.userLocation)))},renderWeather:function(){var e=r.getCurrentWeather(),t=n.weather({currentWeather:e,mainWeatherPageUrl:o.www+"/weather",isDesktop:this.isDesktop});this.$el.html(t),this.weatherModalSettings.modalTitle=e.getDisplayLocation(),this.weatherModalSettings.headerContent=n.weatherModalHeader({editWeatherUrl:o.www+"/gst/weather.html?saction=updatePrimary",currentWeather:e}),this.weatherModalSettings.modalContent=n.weatherModalContent({weatherCollection:r,currentWeather:e,mainWeatherPageUrl:o.www+"/weather"}),this.renderWeatherModal()},renderWeatherModal:function(){var t,i,n,a,o,r=this,l=function(){t=window.setTimeout(function(){r.hoverIntentTimerCallback()},r.weatherModalSettings.hoverIntentDelay)},d=function(){i=window.setTimeout(function(){r.closeIntentTimerCallback()},r.weatherModalSettings.closeIntentDelay)},h=function(){i&&window.clearTimeout(i)},c=function(){t&&window.clearTimeout(t)};this.weatherModal=new s(this.weatherModalSettings),this.weatherModal.addToPage(),n=e(".weather-button"),a=e(".weather-modal-container"),o=e("div.modal.weather-modal"),this.isDesktop&&(e(".weather-button").on("click",function(){var e=r.trackingAppendParams(this.getAttribute("href"),{action:"Click",region:"TopBar",module:"HPMiniNav",contentCollection:"Weather","WT.nav":"page"});window.location.href=e}).on("mouseenter",function(){h(),"block"!==a.css("display")&&l()}).on("mouseleave",function(){c(),d()}),o.on("mouseenter",function(){h()}).on("mouseleave",function(){d()}))},hoverIntentTimerCallback:function(){e(".weather-button").addClass("active"),this.weatherModal.open()},closeIntentTimerCallback:function(){e(".weather-button").removeClass("active"),this.weatherModal.close()}});return l}),define("homepage/instances/masthead",["jquery/nyt","underscore/nyt","shared/masthead/views/search","shared/masthead/views/user-settings-modal","shared/masthead/views/user-name-modal","homepage/views/masthead/masthead","homepage/views/masthead/in-content-theme","homepage/views/masthead/weather"],function(e,t,i,s,n,a,o,r){{var l=(new a,new o);new i}new s({showTypeSizer:!1,fixedOverride:!1,tailLeftOffset:-5,openCallback:function(){this.$target.addClass("active"),this.subscribeOnce("nyt:page-scroll",t.partial(l.determineCloseAbility,this,this.$body.scrollTop()))}}),new n({fixedOverride:!1,openCallback:function(){this.$target.addClass("active"),this.subscribeOnce("nyt:page-scroll",t.partial(l.determineCloseAbility,this,this.$body.scrollTop()))}}),new r}),define("shared/messaging/templates",["underscore/nyt"],function(_){var templates={};return templates.message=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="",closeButton&&(__p+='\n<button class="button close-message">\n<i class="icon"></i>\n<span class="visually-hidden">Close alert</span>\n</button>\n'),__p+="",sub_type&&(sub_type=sub_type.replace(/([A-Z])/g,"-$1").toLowerCase(),"-"===sub_type.charAt(0)&&(sub_type=sub_type.substr(1))),__p+='<div class="message '+(null==(__t=sub_type)?"":__t)+'" data-messageId="'+(null==(__t=id)?"":__t)+'"><i class="icon"></i>',label&&(__p+='\n<span class="label">'+(null==(__t=label)?"":__t)+"</span>\n"),__p+='<span class="message-content">\n<span class="message-title">'+(null==(__t=title)?"":__t)+"</span>\n",buttons.length>0){__p+="\n";for(var i=0;i<buttons.length;i++)buttons[i].url&&(__p+='\n<a href="'+(null==(__t=buttons[i].url)?"":__t)+'" class="button message-button action-button">'+(null==(__t=buttons[i].text)?"":__t)+"</a>\n");__p+="\n"}if(__p+="\n",1===display_type_id&&start_time){var minutes,hours,formatted,date=new Date(1e3*start_time);hours=date.getHours(),minutes=date.getMinutes(),minutes=9>=minutes?"0"+minutes:minutes,ampm=hours>=12?"PM":"AM",hours=hours>12?hours-12:hours,formatted=""+hours+":"+minutes+" "+ampm,__p+='\n<span class="timestamp">\n'+(null==(__t=formatted)?"":__t)+"\n</span>\n"}__p+="\n",4===display_type_id&&(__p+="\n<a href='#' class=\"close-message\">"+(null==(__t=payload.dsm_cpy)?"":__t)+"</a>\n"),__p+="\n</span></div>"}return __p},templates.messenger=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="message-bed"></div>';return __p},templates.notificationModals=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="",__p+=notification_type?'\n<div class="message comment-'+(null==(__t=notification_type)?"":__t)+'-message">\n':'\n<div class="message">\n',__p+='\n<a href="'+(null==(__t=link)?"":__t)+'">'+(null==(__t=title)?"":__t)+"\n","reply"===notification_type&&(__p+="\n"+(null==(__t=referenced_comment)?"":__t)+"\n"),__p+='\n</a>\n<span class="message-metadata">\n<i class="icon"></i>\n',created){__p+="\n";var hours,formatted;__p+="\n";var time=created.split(/[- :]/);__p+="\n";var date=new Date(time[0],time[1]-1,time[2],time[3],time[4],time[5]);__p+="\n",hours=date.getHours()>12?date.getHours()-12:date.getHours(),__p+="\n",formatted=""+hours+":"+date.getMinutes()+" "+(date.getHours()>=12?"PM":"AM")+" E.S.T.",__p+='\n<time class="timestamp" datetime="'+(null==(__t=created)?"":__t)+'">'+(null==(__t=formatted)?"":__t)+"</time>\n"}__p+="\n</span>\n</div>"}return __p},templates.notificationsModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="","default"===show)__p+='\n<div class="message default-message">\n<span class="message-content">Notifications related to your NYTimes activity will be collected for you here.</span>\n</div>\n';else{if(__p+="\n",__p+=notification_type?'\n<div class="message comment-'+(null==(__t=notification_type)?"":__t)+'-message">\n':'\n<div class="message">\n',__p+="\n",user_avatar&&(__p+='\n<span class="avatar"><img src="'+(null==(__t=user_avatar)?"":__t)+'" /></span>\n'),__p+='<div class="message-content">\n',__p+=link?'\n<a class="link" href="'+(null==(__t=link)?"":__t)+'">'+(null==(__t=title)?"":__t)+"</a>\n":"\n"+(null==(__t=title)?"":__t)+"\n",__p+="",("recommendation"===notification_type||"published"===notification_type)&&(__p+="\n",referenced_comment&&(__p+='\n<p class="referenced-comment">'+(null==(__t=referenced_comment)?"":__t)+"</p>\n"),__p+="\n"),__p+='\n<i class="icon"></i>\n',created){__p+="\n";var hours,formatted;__p+="\n";var time=created.split(/[- :]/);__p+="\n";var date=new Date(time[0],time[1]-1,time[2],time[3],time[4],time[5]);__p+="\n",hours=date.getHours()>12?date.getHours()-12:date.getHours(),__p+="\n",formatted=""+hours+":"+date.getMinutes()+" "+(date.getHours()>=12?"PM":"AM")+" E.S.T.",__p+='\n<time class="timestamp" datetime="'+(null==(__t=created)?"":__t)+'">'+(null==(__t=formatted)?"":__t)+"</time>\n"}__p+="\n</div>\n</div>\n"}__p+=""}return __p},templates}),define("shared/messaging/views/message",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/templates"],function(e,t,i,s){var n=i.registerView("messaging").extend({className:"message-container hidden",events:{"click .close-message":"dismissed","mousedown .action-button":"acknowledged","mousedown .action-link":"acknowledged"},defaults:{closeButton:!0,dismissAcknowledged:!0,hiddenClass:"hidden",revealClass:"",show:function(){this.$el.removeClass(this.settings.hiddenClass).addClass(this.settings.revealClass)},hide:function(){this.$el.removeClass(this.settings.revealClass).addClass(this.settings.hiddenClass)}},initialize:function(e){this.settings=t.extend({},this.defaults,e),this.template=s[this.settings.template],this.subscribe(this,"nyt:messaging-message-expired",this.expired)},render:function(){return this.$el.html(this.template(t.extend(this.model.toJSON(),this.settings))).addClass(this.settings.hiddenClass),this.model.get("links")&&this.insertLinks(),this},replaceBetween:function(e,t,i,s){return s.substring(0,e)+i+s.substring(t)},insertLinks:function(){var e,t,i,s,n=this.$el.find(".message-title"),a=n.html(),o=this.model.get("links");o.length>1&&o.sort(function(e,t){return t.start-e.start});for(var r=0;r<o.length;r++)if(e=o[r].offset,i=o[r].count,s=decodeURI(o[r].url),e+i&&(t=e+i),s&&"null"!==s)if("undefined"!=typeof e&&"undefined"!=typeof t){if(o[r-1]&&t>o[r-1].start)break;var l=a.substring(e,t),d='<a class="action-link" href="'+s+'">'+l+"</a>";a=this.replaceBetween(e,t,d,a)}else a='<a class="action-link" href="'+s+'">'+a+"</a>";n.html(a)},reveal:function(e){e?this.settings.show.call(this):this.settings.hide.call(this)},dimensions:function(){return{width:this.$el.outerWidth(),height:this.$el.outerHeight()}},displayed:function(t){var i=this.$el.find(".message");t=t||0,i.hasClass("theme-new")&&window.setTimeout(function(){i.removeClass("theme-new").addClass("theme-read").delay(t).queue(function(){e(this).addClass("no-transition").dequeue()})},t),this.model.displayed()},showOnce:function(){this.model.showOnce()},acknowledged:function(){this.settings.dismissAcknowledged&&this.model.acknowledged(),this.local(this,"nyt:messaging-message-view-acknowledged",this)},expired:function(){this.model.expired(),this.local(this,"nyt:messaging-message-view-expired",this)},dismissed:function(e){this.model.dismissed(),this.local(this,"nyt:messaging-message-view-dismissed",this),e.preventDefault()}});return n}),define("shared/messaging/collections/websockets-mixin",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/lib/sockjs","foundation/collections/base-collection","shared/messaging/collections/messages","foundation/hosts"],function(e,t,i,s){var n={reconnectAttempt:0,initializeWebSockets:function(e,t,i){var n=this,a={debug:!0};s&&this.url&&(this.webSocket=new s(this.url,null,a),this.webSocket.onopen=function(){n.local(n,"nyt:messaging-websocket-connected"),n.onOpen(function(){n.settings.webSocketsLogin&&n.settings.webSocketsLogin(n)})},this.webSocket.onmessage=function(e){n.local(n,"nyt:messaging-websocket-message-received"),n.reconnectAttempt=0,n.receive(e,i)},this.webSocket.onclose=function(e){n.local(n,"nyt:messaging-websocket-disconnected"),n.reconnect(e)})},onOpen:function(e){e()},receive:function(e,t){var i=this.parse(e),s=this;i&&(s.add(i),t.success&&t.success(s,e))},publish:function(e){this.webSocket&&this.webSocket.readyState===s.OPEN&&"undefined"!=typeof s&&null!==s&&this.webSocket.send(JSON.stringify(e))},reconnect:function(e){var t=e.wasClean,i=this;t?this.initWebSockets():(this.reconnectAttempt+=1,this.reconnectAttempt>5?this.switchToHTTP():window.setTimeout(function(){i.initWebSockets()},3e3))}};return n}),define("shared/messaging/models/message",["backbone/nyt","foundation/models/base-model","foundation/models/page-storage"],function(e,t,i){var s=t.extend({defaults:{display_type_id:"1",id:"",title:"",status:"new",sub_type:"",label:"",pub_date:"",start_time:"",end_time:"",links:[],buttons:[],payload:{}},showOnce:function(){this.saveToLocalStorage()},displayed:function(){this.set("status","displayed")},acknowledged:function(){this.set("status","acknowledged"),this.saveToLocalStorage()},expired:function(){this.set("status","expired"),this.saveToLocalStorage()},dismissed:function(){this.set("status","dismissed"),this.saveToLocalStorage()},saveToLocalStorage:function(){var e=this.get("id"),t=this.get("version"),s=(new Date).getTime(),n=i.get("messaging"),a=n?n+","+e:e;t&&(a=a+"-"+t+"-"+s),i.set("messaging",a)}});return s}),define("shared/messaging/collections/messages",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","shared/messaging/collections/websockets-mixin","shared/messaging/models/message","foundation/hosts","foundation/cookies","foundation/models/page-storage"],function(e,t,i,s,n,a,o,r,l){var d=s.extend(t.extend({},n,{model:a,url:o.msg+"/svc/message/v1/list/global.json",pageStorageKey:"messaging",defaultSettings:{webSockets:!0,webSocketsInfoUrl:o.msgSocket+"/endpoints.json?jsoncallback=?",webSocketsLogin:function(e){var t=r.readCookie("NYT-S")||"";e.publish({action:"login",client_app:"hermes.push",cookies:{"nyt-s":t}})},longPoll:!1,fauxLongPoll:!1,interval:10},initialize:function(e){var i=/nytimes.com((\/\?)|(\/?$)|(\?))/i;window.location.href.match(i)&&(this.isHomepage=!0),this.cleanLocalStorage(),this.settings=t.extend({},this.defaultSettings,e),t.bindAll(this,"fetch","fetchSuccess","handleSave","stopSaving"),this.received={},this.pageManager.isDomReady()?this.initConnection():(this.subscribe(this.pageManager,"nyt:page-ready",this.initConnection),this.subscribe(this,"nyt:messaging-websocket-connected",this.handleSave),this.subscribe(this,"nyt:messaging-websocket-disconnected",this.stopSaving))},initConnection:function(){this.isHomepage?(this.settings.fauxLongPoll=!0,this.settings.webSockets=!1,this.makeHTTPRequest()):this.initWebSockets()},initWebSockets:function(){var t=this;e.ajax({dataType:"json",url:this.settings.webSocketsInfoUrl,success:function(e){e.http_sockjs_url&&(t.url=e.http_sockjs_url,t.fetch({success:t.fetchSuccess}))},error:function(){t.switchToHTTP()}})},makeHTTPRequest:function(){var e=this;this.url=o.msg+"/svc/message/v1/list/global.json",this.fetch({success:function(t,i){e.fetchSuccess(t,i)},error:function(){}})},switchToHTTP:function(){this.settings.fauxLongPoll=!0,this.settings.webSockets=!1,this.makeHTTPRequest()},fetch:function(e){return this.settings.webSockets?(e=e?t.clone(e):{},this.sync("read",this,e)):i.Collection.prototype.fetch.call(this,e)},sync:function(e,t,s){return this.settings.webSockets?void this.initializeWebSockets(e,t,s):this.settings.longPoll?(s.timeout=2e3,i.sync(e,t,s)):(s.cache=!1,i.sync(e,t,s))},parse:function(e){var t;if(this.settings.webSockets){if(t=e.data,t&&t.body)return"start"!==t.type&&"finish"!==t.type?JSON.parse(t.body):!1}else if(e.results)return e.results.messages},fetchSuccess:function(e,t){var i,s,n,a,o,r,l,d={},h=e||this;if(t){for(i=0,s=h.length;s>i;i+=1)n=h.at(i),a=n.get("id"),o=n.get("title"),r=this.categorizeMessage(n),d[r]=d[r]||[],a&&o&&(this.expired(n)||this.inactive(n)||this.isInLocalStorage(n)||this.exists(a)||this.titleExists(o)||(this.received[a]=o,d[r].push(this.get(n.id))));for(r in d)h.trigger(r,d[r]);l=t.count,l&&h.trigger("nyt:messaging-count-received",l)}this.settings.fauxLongPoll&&window.setTimeout(function(){h.makeHTTPRequest()},1e3*h.settings.interval)},categorizeMessage:function(e){var t,i=e.get("display_type_id");switch(i){case 1:e.get("label")||e.set("label","Breaking News"),t="nyt:messaging-breaking-news-received";break;case 2:e.get("label")||e.set("label","Account Alert"),t="nyt:messaging-account-alert-received";break;case 3:e.get("label")||e.set("label","Live Video"),t="nyt:messaging-video-received";break;case 4:t="nyt:messaging-velcro-received";break;case 5:t="nyt:messaging-notification-received";break;default:t="nyt:messaging-message-received"}return t},expired:function(e){var t,i=e.get("end_time"),s=(new Date).getTime();return i?(t=new Date(1e3*i).getTime(),s>t?!0:!1):void 0},exists:function(e){return e in this.received},titleExists:function(i){var s=t.values(this.received);return e.inArray(i,s)>-1},inactive:function(e){return"dismissed"===e.get("status")||"expired"===e.get("status")||"acknowledged"===e.get("status")},isInLocalStorage:function(i){var s=[],n=[],a=l.get(this.pageStorageKey),o=i.get("id").toString();return a?(s=a.split(","),n=t.map(s,function(e){return e.split("-")[0]}),e.inArray(o,n)>-1):!1},cleanLocalStorage:function(){var e,t,i,s,n,a,o,r=l.get(this.pageStorageKey);if(r)for(e=r.split(","),i=0;i<e.length;i++)t=e[i],s=t.split("-")[2],n=(new Date).getTime(),s&&(a=(n-s)/1e3,o=Math.floor(a/86400),o>7&&this.deleteInLocalStorage(t))},deleteInLocalStorage:function(e){var t=l.get(this.pageStorageKey),i=new RegExp(e+",?"),s=t.replace(i,"");l.set(this.pageStorageKey,s)},handleSave:function(){this.listenTo(this,"change:status",function(e){this.saveMessage(e)})},stopSaving:function(){this.stopListening(this,"change:status")},saveMessage:function(e){var t=e.get("status"),i=e.get("id");this.settings.webSockets&&this.publish({action:"send",client_app:"hermes.push",message:{status:t,messageId:i}})}}));return d}),define("shared/messaging/instances/messages",["shared/messaging/collections/messages"],function(e){return new e}),define("shared/messaging/views/messenger-mixin",["jquery/nyt","underscore/nyt","shared/messaging/views/message","shared/messaging/instances/messages","shared/messaging/templates","foundation/cookies"],function(e,t,i,s,n){var a={template:n.messenger,mixinSettings:{id:null,notifyWhen:null,messageType:null,parent:null,template:"message",newestFirst:!0,closeButton:!0,expiration:!1,animationSpeed:200,expirationAfterPause:null,fadeOutDelay:1500,dismissAcknowledged:!0,trackingVersion:""},events:{"click .action-link":"trackLinkClicks","click .action-button":"trackLinkClicks"},initialize:function(e){this.options=t.extend({},this.mixinSettings,this.defaultSettings,e),this.subscribe(this,"nyt:messaging-message-rendered",this.afterMessageReceived),this.subscribe(this,"nyt:messaging-message-removed",this.afterMessageRemoved),this.subscribe(this,"nyt:messaging-message-"+this.options.id+"-displayed nyt:messaging-message-cleared",this.addLastMessageClass),this.subscribe(this,"nyt:messaging-message-"+this.options.id+"-displayed",this.trackImpressions),this.delegateEvents(),this.collection=s,this.active={messages:{}},this.notActive={messages:{}},this.received={messages:{}},this.pageManager.isDomReady()?this.render():this.subscribe(this.pageManager,"nyt:page-ready",this.render),this.trackingBaseData={module:"Notification",version:this.options.trackingVersion,region:"FixedTop"},this.local(this,"nyt:messaging-messenger-initialized")},render:function(){return this.$parent=this.options.parent?this.options.parent():this.$body,this.rendered||(this.$el.hide().addClass(this.options.id).append(this.template(this.options)),this.$parent.prepend(this.$el),this.rendered=!0,this.local(this,"nyt:messaging-messenger-rendered"),this.prepareView(),this.subscribe(this.collection,this.options.notifyWhen,this.notify)),this},notify:function(i){var s,n,a=this,o=[];t.each(i||[],function(e){n=e.get("id"),n&&o.push(e)}),s=o.length>0?function(){a.createMessageViews(o)}:e.noop,this.pageManager.isDomReady()?s():this.subscribe(this.pageManager,"nyt:page-ready",t.debounce(s,0))},createMessageViews:function(e){return e&&t.each(e||[],function(e){var t;t=new i({model:e,template:this.options.template,closeButton:this.options.closeButton,dismissAcknowledged:this.options.dismissAcknowledged}),this.subscribe(t,"nyt:messaging-message-view-expired",this.removeMessage),this.subscribe(t,"nyt:messaging-message-view-dismissed",this.removeMessage),this.subscribe(t,"nyt:messaging-message-view-dismissed",this.trackDismissal),this.addMessage(t)},this),this},addMessage:function(e){if(e){var t,i=this.options.newestFirst?"prepend":"append",s=e.model.get("id");this.received.messages[s]=e,this.active.messages[s]=e,t=this.countMessages(),this.$(".message-bed")[i](e.render().$el),e.$el.data("messageId",s),this.local(this,"nyt:messaging-message-rendered",e,t)}},removeMessage:function(e){var t,i;e&&(t=e.model.get("id"),this.notActive.messages[t]=e,this.active.messages[t]&&delete this.active.messages[t],i=this.countMessages(),this.local(this,"nyt:messaging-message-removed",e,i))},addLastMessageClass:function(){this.$(".message-container").removeClass("last-message-container").last().addClass("last-message-container")},dimensions:function(){return{width:this.$el.find(".message-bed").outerWidth(!0),height:this.$el.find(".message-bed").outerHeight(!0)}},countMessages:function(){return t.size(this.active.messages)},trackImpressions:function(e){var t,i;e=e||"",t=this.received.messages[e],i=this.getcontentCollection(t)||"",this.trackingTriggerImpression("messaging-impression",{action:"Impression",contentCollection:i,eventName:"Impression",contentID:e})},trackDismissal:function(e){var t=e.model.get("id"),i=this.getcontentCollection(e);this.trackingTrigger("messaging-dismissal",{action:"Click",contentCollection:i,eventName:"DismissNotification",contentID:t})},trackLinkClicks:function(t){var i=e(t.currentTarget),s=i.parents(".message-container").data("messageId"),n=this.received.messages[s],a=this.getcontentCollection(n),o=this.trackingAppendParams(i.attr("href"),{action:"Click",contentCollection:a,contentID:s});i.attr("href",o)},getcontentCollection:function(e){return e.model.get("sub_type")?e.model.get("sub_type"):""}};return a}),define("shared/messaging/views/move-furniture-mixin",["jquery/nyt","underscore/nyt"],function(e){var t={moveFurniture:function(t,i,s){var n,a,o,r=this,l=this.options.animationSpeed||200;"add"===i?n="+="+t:"subtract"===i&&(n="-="+t),a=function(e){e.animate({marginTop:n},l)},o=function(t){t.promise().done(function(){e(this).css({marginTop:n})})},s?(this.$el.promise().done(function(){e(this).css("height",n),r.broadcast("nyt:messaging-"+r.options.messageType+"-after")}),this.messagesHeight=this.dimensions().height,this.broadcast("nyt:messaging-"+this.options.messageType+"-move-furniture",o,n,this)):(this.$el.animate({height:n},l,function(){r.messagesHeight=r.dimensions().height,r.broadcast("nyt:messaging-"+r.options.messageType+"-after")}),this.broadcast("nyt:messaging-"+this.options.messageType+"-move-furniture",a,n,this))}};return t}),define("shared/messaging/views/critical-alerts",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/views/move-furniture-mixin","shared/messaging/templates"],function(e,t,i,s,n){var a=i.registerView("messaging").extend(t.extend({},n,s,{defaultSettings:{messageType:"critical-alerts",parent:function(){return 0===e("#critical-alerts").length&&e("body").prepend('<div id="critical-alerts"></div>'),e("#critical-alerts")}},prepareView:function(){this.options.id;this.messagesHeight=0,this.$el.addClass("alerts"),this.$el.parent("#critical-alerts").addClass("critical-alerts messenger"),this.$el.css("height","0")},afterMessageReceived:function(e,t){var i,s=0;e&&t>0&&(this.broadcast("nyt:messaging-message-"+this.options.id+"-received",e,this),1===t&&(s+=this.openMessenger()),e.reveal(!0),e.displayed(),s+=e.dimensions().height,this.moveFurniture(s,"add"),i=e.model.get("id"),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",i),this.createMessageClone(e),this.alignMessages(),this.options.expiration&&this.startTimer(e))},startTimer:function(e){var t;window.setTimeout(function(){t=e.model.get("status"),t&&"dismissed"!==t&&"expired"!==t&&e.trigger("nyt:messaging-message-expired")},60*this.options.expiration*1e3)},openMessenger:function(){var e;return this.$el.show(),this.$el.find(".message-bed").show(),e=this.dimensions().height,this.subscribe(this.pageManager,"nyt:page-resize",this.handleWindowResize),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this),e},afterMessageRemoved:function(e,t){var i=0;e&&null!==t&&(i+=e.dimensions().height,e.$el.hide(),this.local(this,"nyt:messaging-message-cleared"),0===t&&(i+=this.closeMessenger()),this.broadcast("nyt:messaging-message-"+this.options.id+"-closed",e,this),this.moveFurniture(i,"subtract",!0))},closeMessenger:function(){var t=this.dimensions().height,i=this;return this.$el.hide(),this.$el.find(".message-bed").hide(),this.stopListening(this.pageManager,"nyt:page-resize"),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-closed",this),this.$el.promise().done(function(){e(this).siblings(".alerts").is(":hidden")&&i.broadcast("nyt:messaging-message-"+i.options.messageType+"-closed",i)}),t},createMessageClone:function(e){e.$el.find(".message").clone().addClass("hidden-message").wrapInner('<div class="message-wrap" />').appendTo(e.$el)},handleWindowResize:function(){var e,t,i,s=this;this.$el.promise().done(function(){t=s.dimensions().height,i=s.messagesHeight,t>i?(e=t-i,s.moveFurniture(e,"add",!0),s.messagesHeight=t):i>t&&(e=i-t,s.moveFurniture(e,"subtract",!0),s.messagesHeight=t),s.alignMessages()})},maxMessageWidth:function(){var e=this.$(".message-container").width();this.$(".message:not(.hidden-message)").css({"max-width":e+"px"})},alignMessages:function(){var e=0,i=this.active.messages;t.size(i)>0&&(t.each(i,function(t){var i=t.$el.find(".hidden-message .message-wrap").outerWidth();i>e&&(e=i)}),this.$el.find(".message:not(.hidden-message)").css({width:e+2+"px"}),this.maxMessageWidth())}}));return a}),define("shared/messaging/views/suggestions",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/views/move-furniture-mixin","shared/messaging/templates"],function(e,t,i,s,n){var a=i.registerView("messaging").extend(t.extend({},n,s,{nytEvents:{"nyt:masthead-storytheme":"toggleTheme","nyt:masthead-contenttheme":"toggleTheme","nyt:messaging-message-breaking-news-alerts-received":"hideMessenger","nyt:messaging-message-account-alerts-received":"hideMessenger"},defaultSettings:{messageType:"suggestions",closeButton:!1,trackingVersion:"Velcro"},prepareView:function(){this.messagePresent=!1,this.stayHidden=!1,this.$el.addClass("messenger"),this.$el.css("height","0")},afterMessageReceived:function(t){var i,s,n=e("#account-alerts"),a=e("#breaking-news-alerts"),o=e("#masthead");t&&this.$el.is(":hidden")&&n.is(":hidden")&&a.is(":hidden")&&(this.stayHidden||this.messagePresent||(t.reveal(!0),t.displayed(),t.showOnce(),this.messagePresent=!0,o.hasClass("theme-in-story")||(this.openMessenger(),i=this.dimensions().height,this.moveFurniture(i,"add"),s=t.model.get("id"),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",s))))},openMessenger:function(){this.$el.show(),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this)},afterMessageRemoved:function(e){var t=this.dimensions().height;e&&(e.$el.hide(),this.moveFurniture(t,"subtract",!0),this.broadcast("nyt:messaging-message-"+this.options.id+"-closed",e,this),this.closeMessenger())},closeMessenger:function(){this.$el.hide(),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-closed",this)},hideMessenger:function(){var e=this.dimensions().height;this.$el.is(":visible")&&(this.$el.hide(),this.moveFurniture(e,"subtract",!0)),this.broadcast("nyt:messaging-message-"+this.options.id+"-hidden",this),this.stayHidden=!0},showMessenger:function(){var e=this.dimensions().height;this.moveFurniture(e,"add"),this.broadcast("nyt:messaging-message-"+this.options.id+"-shown",this),this.$el.show()
},toggleTheme:function(t){var i,s=e("#account-alerts"),n=e("#breaking-news-alerts"),a=t?"hide":"show";"hide"===a&&this.$el.is(":visible")?(i=this.dimensions().height,this.moveFurniture(i,"subtract",!0),this.$el.addClass("theme-changed"),this.$el.hide()):"show"===a&&this.$el.is(":hidden")&&s.is(":hidden")&&!this.stayHidden&&this.messagePresent&&s.is(":hidden")&&n.is(":hidden")&&(this.$el.show(),i=this.dimensions().height,this.moveFurniture(i,"add",!0),this.$el.removeClass("theme-changed")),this.broadcast("nyt:messaging-message"+this.options.id+a,i,this)}}));return a}),define("shared/messaging/views/announcements",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/templates"],function(e,t,i,s){var n=i.registerView("messaging").extend(t.extend({},s,{nytEvents:{"nyt:page-resize":"adjustWidth"},defaultSettings:{messageType:"announcements",parent:function(){return e("#masthead").find(".container")},animationSpeed:400,expiration:30,expirationAfterPause:3,trackingVersion:"LiveVideo"},prepareView:function(){var e=this,t=1e3*this.options.expirationAfterPause;this.messagePresent=!1,this.timer=null,this.currentMessageId=null,this.widthDiff=45,this.$el.addClass("messenger"),this.adjustWidth(),this.$el.on("mouseenter",function(){e.clearTimer()}),this.$el.on("mouseleave",function(){e.startTimer(t)})},afterMessageReceived:function(e){var t=e.model.get("id"),i=this,s=1e3*this.options.expiration;e&&(this.messagePresent?window.setTimeout(function(){i.afterMessageReceived(e)},s):(e.reveal(!0),e.displayed(),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",t),this.messagePresent=!0,this.openMessenger(),this.currentMessageId=t,this.startTimer(s)))},startTimer:function(e){var t=this.currentMessageId,i=this.active.messages[t],s=function(){i&&i.trigger("nyt:messaging-message-expired")};e=e||5e3,this.timer=window.setTimeout(s,e)},clearTimer:function(){window.clearTimeout(this.timer)},openMessenger:function(){var e=this.options.animationSpeed||500;this.$el.stop(!0).show().animate({top:0},e),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this)},afterMessageRemoved:function(e){e&&this.closeMessenger(e)},closeMessenger:function(t){var i=this.dimensions().height,s=this.options.animationSpeed||500,n=this;t&&this.$el.stop(!0).animate({top:"-"+i},s,function(){e(this).hide(),t.$el.hide(),n.messagePresent=!1,n.broadcast("nyt:messaging-messenger-"+n.options.id+"-closed",n)})},adjustWidth:function(){var t,i=e("#masthead"),s=i.width(),n=this.widthDiff,a=this.pageManager.getCurrentBreakpoint(),o=0;a>1020?(10060>=a&&(o=parseInt(i.css("margin-left"),10)),t=s-(2*n+o),this.$el.css("width",t+"px"),this.$el.css("left",n+"px")):(this.$el.css("left","0px"),this.$el.css("width","100%"))}}));return n}),define("homepage/instances/messaging",["jquery/nyt","foundation/views/page-manager","shared/messaging/views/critical-alerts","shared/messaging/views/suggestions","shared/messaging/views/announcements","foundation/models/user-data"],function(e,t,i,s,n){t.$html.hasClass("lt-ie9")||(new s({id:"suggestions",notifyWhen:"nyt:messaging-velcro-received"}),new i({id:"breaking-news-alerts",notifyWhen:"nyt:messaging-breaking-news-received",expiration:20,dismissAcknowledged:!1,trackingVersion:"BreakingNews"}),new i({id:"account-alerts",notifyWhen:"nyt:messaging-account-alert-received",expiration:10,trackingVersion:"UserAccounts"}),new n({id:"announcements",notifyWhen:"nyt:messaging-video-received",parent:function(){return e("#announcements-container")}}))}),define("shared/navigation/templates",["underscore/nyt"],function(_){var templates={};return templates.mobileNav=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<section class="edition-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li class="'+(null==(__t="global"!==pageManager.getEdition()?"active":"")?"":__t)+'"><a href="http://mobile.nytimes.com/"><span>U.S. Edition</span></a></li>\n</ul>\n<ul class="menu">\n<li class="'+(null==(__t="global"===pageManager.getEdition()?"active":"")?"":__t)+'"><a href="http://mobile.nytimes.com/international/"><span>International Edition</span></a></li>\n</ul>\n</section>\n<section class="primary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/"><span>Home</span></a></li>\n<li><a href="http://mobile.nytimes.com/world/"><span>World</span></a></li>\n<li><a href="http://mobile.nytimes.com/national/"><span>U.S.</span></a></li>\n<li><a href="http://mobile.nytimes.com/politics/"><span>Politics</span></a></li>\n<li><a href="http://mobile.nytimes.com/nyregion/"><span>N.Y. / Region</span></a></li>\n<li><a href="http://mobile.nytimes.com/business/"><span>Business Day</span></a></li>\n<li><a href="http://mobile.nytimes.com/technology/"><span>Technology</span></a></li>\n<li><a href="http://mobile.nytimes.com/sports/"><span>Sports</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/opinion/"><span>Opinion</span></a></li>\n<li><a href="http://mobile.nytimes.com/science/"><span>Science</span></a></li>\n<li><a href="http://mobile.nytimes.com/health/"><span>Health</span></a></li>\n<li><a href="http://mobile.nytimes.com/arts/"><span>Arts</span></a></li>\n<li><a href="http://mobile.nytimes.com/style/"><span>Style</span></a></li>\n<li><a href="http://mobile.nytimes.com/photos/"><span>Photos</span></a></li>\n<li><a href="http://mobile.nytimes.com/video/"><span>Video</span></a></li>\n<li><a href="http://mobile.nytimes.com/most-emailed/"><span>Most Emailed</span></a></li>\n</ul>\n</section>\n<section class="secondary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/automobiles/"><span>Automobiles</span></a></li>\n<li><a href="http://mobile.nytimes.com/blogs/"><span>Blogs</span></a></li>\n<li><a href="http://mobile.nytimes.com/books/"><span>Books</span></a></li>\n<li><a href="http://mobile.nytimes.com/dining/"><span>Dining &amp; Wine</span></a></li>\n<li><a href="http://mobile.nytimes.com/education/"><span>Education</span></a></li>\n<li><a href="http://mobile.nytimes.com/garden/"><span>Home &amp; Garden</span></a></li>\n<li><a href="http://mobile.nytimes.com/magazine/"><span>Magazine</span></a></li>\n<li><a href="http://mobile.nytimes.com/movies/"><span>Movies</span></a></li>\n<li><a href="http://mobile.nytimes.com/music/"><span>Music</span></a></li>\n<li><a href="http://mobile.nytimes.com/business/media/"><span>Media &amp; Advertising</span></a></li>\n<li><a href="http://mobile.nytimes.com/obituaries/"><span>Obituaries</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/publiceditor/"><span>Public Editor</span></a></li>\n<li><a href="http://mobile.nytimes.com/realestate/"><span>Real Estate</span></a></li>\n<li><a href="http://mobile.nytimes.com/opinion/sundayreview/"><span>Sunday Review</span></a></li>\n<li><a href="http://mobile.nytimes.com/tmagazine/"><span>T Magazine</span></a></li>\n<li><a href="http://mobile.nytimes.com/television/"><span>Television</span></a></li>\n<li><a href="http://mobile.nytimes.com/theater/"><span>Theater</span></a></li>\n<li><a href="http://mobile.nytimes.com/timeswire/"><span>Times Wire</span></a></li>\n<li><a href="http://mobile.nytimes.com/travel/"><span>Travel</span></a></li>\n<li><a href="http://mobile.nytimes.com/weddings/"><span>Weddings / Celebrations</span></a></li>\n<li><a href="http://mobile.nytimes.com/corrections/"><span>Corrections</span></a></li>\n</ul>\n</section>\n<section class="tertiary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/recommendations/"><span>Recommendations</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/saved/"><span>Saved</span></a></li>\n</ul>\n</section>\n<section class="settings '+(null==(__t=userData.isLoggedIn()?"":"hidden")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><span class="label">Account:</span> '+(null==(__t=userData.getUserName())?"":__t)+'</li>\n</ul>\n</section>\n<section class="logout '+(null==(__t=userData.isLoggedIn()?"":"hidden")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/logout"><span>Log out</span></a></li>\n</ul>\n</section>\n<section class="account '+(null==(__t=userData.isLoggedIn()?"hidden":"")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://www.nytimes.com/mowweb/ftnotlog"><span>Subscribe</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="https://myaccount.nytimes.com/mobile/login/smart/index.html?EXIT_URI='+(null==(__t=encodeURIComponent(window.location))?"":__t)+'"><span>Log In</span></a></li>\n</ul>\n</section>';return __p},templates.navigationModalContent=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="secondary-container">\n'+(null==(__t=secondary)?"":__t)+'\n</div>\n<div class="tertiary-container">\n'+(null==(__t=tertiary)?"":__t)+"\n</div>";return __p},templates}),define("shared/navigation/views/navigation",["module","jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/views/page-manager","foundation/hosts","shared/modal/views/modal","shared/navigation/templates"],function(e,t,i,s,n,a,o,r){var l=s.registerView("navigation").extend({module:e,el:"#navigation",navTemplate:r.navigation,modalTemplate:r.navigationModalContent,events:{mouseleave:"delayedClose",mouseenter:"cancelDelayedClose","mouseenter li a":"tryPrimaryHover","mouseleave li a.expandable":"delayedModalClose","click li a":"activatePrimaryItem","click .menu a[href]":"handlePrimaryNavigationClick"},nytEvents:{"nyt:masthead-section-click":"toggle","nyt:navigation-toggle-ready":"toggle","nyt:navigation-edge-click":"open","nyt:navigation-edge-mouse-enter":"delayedOpen","nyt:navigation-edge-mouse-leave":"cancelDelayedOpen","nyt:messaging-critical-alerts-move-furniture":"moveNav","nyt:messaging-suggestions-move-furniture":"moveNav","nyt:a11y-enabled":"enableA11Nav","nyt:a11y-disabled":"disableA11yNav"},defaultSettings:{panelwidth:210,navTimeout:500,navAnimation:150,hoverTimeout:500,intentRangeLower:10,intentRangeUpper:170,maxMouseLocs:2,a11yEnabled:!1},modalSettings:{id:"navigation-modal",modalTitle:"",modalContent:"",tailDirection:"left-top",closeOnClick:!1,fixedOverride:!0,autoPosition:!0,positionTailSide:!0,toggleSpeed:1},mouseLocs:[],navIds:{REAL_ESTATE:"navId-92720057-BCB6-4BDB-9351-12F29393259F",OPINION_DOMESTIC:"navId-09736473-CB3F-4B2F-9772-3AF128ABE12D",OPINION_INTERNATIONAL:"navId-AD8090D7-4137-4D71-84C8-70DA3BD89778"},navLevels:{PRIMARY:1,SECONDARY:2,TERTIARY:3},initialize:function(e){i.bindAll(this,"tryPrimaryHover","trySecondaryHover","open","close","render","saveMousePosition","delayedOpen","delayedClose","cancelDelayedOpen","cancelDelayedClose","delayedModalOpen","delayedModalClose","cancelDelayedModalOpen","cancelDelayedModalClose","delayedPrimaryHover","cancelDelayedPrimaryHover","delayedSecondaryHover","cancelDelayedSecondaryHover","handleClickClose","handleTapClose","detectFalsePositive"),this.settings=i.extend({},this.defaultSettings,e),this.singlePanelWidth=this.settings.panelwidth+"px",this.singlePanelPartlyShut=this.settings.panelwidth-20+"px",this.isNavAnimating=!1,this.timer={},this.render(),this.$document.on("click","#navigation-modal a[href]",i.bind(this.handleModalClick,this)),this.trackingBaseData={module:"SectionsNav",action:"click",version:"BrowseTree",region:"TopBar"}},handlePrimaryNavigationClick:function(e){var i=t(e.currentTarget),s=this.trackingAppendParams(i.attr("href"),{contentCollection:t.trim(i.text())});i.attr("href",s)},handleModalClick:function(e){var i=t(e.currentTarget),s=t.trim(t("#navigation-modal").find(".secondary-container .header").text()),n=this.trackingAppendParams(i.attr("href"),{contentCollection:s+"/"+t.trim(i.text()),contentPlacement:i.closest("ul").hasClass("secondary")?2:3});i.attr("href",n)},moveNav:function(e){e(this.$el)},render:function(){var e=this,t=this.$body.find(".navigation-modal"),i=t.find(".secondary-container"),s=t.find(".tertiary-container");t.eq(0).remove(),this.modalSettings.modalContent=r.navigationModalContent({secondary:i.html(),tertiary:s.html()}),this.navigationModal=new o(this.modalSettings),this.navigationModal.addToPage(),this.navigationModal.$modal.on("mouseover",".secondary li a",e.trySecondaryHover).on("click",".secondary li a.expandable",e.activateSecondaryItem).on("mouseenter",".tertiary-container",e.cancelDelayedSecondaryHover).on("mouseenter",function(){e.cancelDelayedClose(),e.cancelDelayedModalClose(),e.cancelDelayedPrimaryHover()}).on("mouseleave",function(){e.delayedClose(),e.delayedModalClose()})},toggle:function(){this.$el.hasClass("active")?this.close():this.open()},open:function(){var e=this,t={width:e.singlePanelPartlyShut,display:"block",opacity:"0"},i={width:e.singlePanelWidth,opacity:"1"};this.isNavAnimating||this.$el.hasClass("active")!==!1||(this.$el.css(t),this.$el.toggleClass("active"),this.$html.toggleClass("navigation-active"),this.isNavAnimating=!0,this.$el.animate(i,this.settings.navAnimation,function(){e.isNavAnimating=!1,e.$body.on("click",e.handleTapClose)}),this.pageManager.isMobile()&&this.$body.css("cursor","pointer"),this.settings.a11yEnabled&&this.toggleFocusEvents(!0),this.broadcast("nyt:navigation-opened",this),this.$document.on("mousemove",this.saveMousePosition))},close:function(){var e,t,i;this.isNavAnimating||this.$el.hasClass("active")!==!0||(e=this,t=this.$el.css("marginTop"),i={width:this.singlePanelPartlyShut,opacity:"0"},this.navigationModal.close(),this.resetNav(this.navLevels.SECONDARY),this.isNavAnimating=!0,this.$el.animate(i,this.settings.navAnimation,function(){e.$el.toggleClass("active"),e.$html.toggleClass("navigation-active"),e.$body.off("click",e.handleClickClose),e.$body.off("click",e.handleTapClose),e.$el.removeAttr("style"),e.$el.css("marginTop",t),e.$el.find("a").removeClass("active"),e.isNavAnimating=!1}),this.pageManager.isMobile()&&this.$body.css("cursor",""),this.settings.a11yEnabled&&this.toggleFocusEvents(!1),this.broadcast("nyt:navigation-closed",this),this.$document.off("mousemove",this.saveMousePosition))},resetNav:function(e){var t=this.navigationModal.$modal;e===this.navLevels.SECONDARY&&t.find(".section").removeClass("active"),t.find(".secondary a").removeClass("active"),t.find(".tertiary").removeClass("active"),t.find(".modal-content").removeClass("expanded"),t.find(".section-heading a").removeClass("active")},activatePrimaryItem:function(e){var i,s,n,a,o,r,l=t(e.target).closest("a");e.stopPropagation(),l.hasClass("active")||this.isNavAnimating!==!1||(l.hasClass("expandable")?(i=this.navigationModal,s=i.$modal.find('[data-parent="'+l.attr("id")+'"]').find("li").length,n=55,a=29*s,o=a+n,l.attr("id")===this.navIds.REAL_ESTATE?o=175:(l.attr("id")===this.navIds.OPINION_DOMESTIC||l.attr("id")===this.navIds.OPINION_INTERNATIONAL)&&(o=400),this.cancelDelayedModalClose(),this.resetNav(this.navLevels.SECONDARY),i.$modal.height(o),e.currentTarget=e.target,i.open(e),this.moveModalArrow(),this.$el.find("a").removeClass("active").attr("aria-expanded","false"),l.addClass("active").attr("aria-expanded","true"),i.$modal.find(".secondary").removeClass("active"),r=i.$modal.find(".secondary-container .section-heading"),this.setHeadingText(l,r),i.$modal.find('[data-parent="'+l.attr("id")+'"]').addClass("active"),this.broadcast("nyt:navigation-level-one-open",i.$modal)):this.modalClose())},setHeadingText:function(e,t){t.html(e.attr("href")?'<a href="'+e.attr("href")+'" tabinxdex="0" role="menuitem" class="active">'+e.text()+"</a>":e.text())},moveModalArrow:function(){var e,i,s,n=this.navigationModal.$modal,a=12,o=18,r=39,l=this.settings.panelwidth-10;t("html").hasClass("viewport-large-70")&&(l+=t("#navigation-edge").width()),n.css("left",l+"px"),e=n.find(".modal-pointer"),e.hasClass("modal-pointer-left")?(i=Math.floor(n.outerHeight()/2)-o,e.css("top",i+"px")):e.hasClass("modal-pointer-left-top")?e.css("top",a,"px"):e.hasClass("modal-pointer-left-bottom")&&(s=n.outerHeight()-r,e.css("top",s+"px"))},activateSecondaryItem:function(e){var i,s,n=t(e.target).closest("a");n.hasClass("active")||this.isNavAnimating!==!1||(e.preventDefault(),i=this.navigationModal.$modal,n.hasClass("expandable")?(this.resetNav(this.navLevels.TERTIARY),i.find(".modal-content").addClass("expanded"),s=i.find(".tertiary-container .section-heading"),this.setHeadingText(n,s),i.find("[data-parent='"+n.attr("id")+"']").eq(0).addClass("active"),n.addClass("active").attr("aria-expanded","true"),this.broadcast("nyt:navigation-level-two-open",i.find(".tertiary-container"))):(this.resetNav(this.navLevels.TERTIARY),n.addClass("active")))},tryPrimaryHover:function(e){var i,s=t(e.target).closest("a"),n=s.hasClass("expandable");this.cancelDelayedClose(),n&&this.cancelDelayedModalClose(),this.cancelDelayedPrimaryHover(),this.$el.find("li a.active").length>0?(i=this.getAngle(this.mouseLocs[0],this.mouseLocs[1]),i>this.defaultSettings.intentRangeLower&&i<this.defaultSettings.intentRangeUpper?this.delayedPrimaryHover(e):this.activatePrimaryItem(e)):this.activatePrimaryItem(e)},trySecondaryHover:function(e){var t;this.cancelDelayedClose(),this.cancelDelayedModalClose(),this.cancelDelayedSecondaryHover(),this.navigationModal.$modal.find(".modal-content").hasClass("expanded")?(t=this.getAngle(this.mouseLocs[0],this.mouseLocs[1]),t>this.defaultSettings.intentRangeLower&&t<this.defaultSettings.intentRangeUpper?this.delayedSecondaryHover(e):this.activateSecondaryItem(e)):this.activateSecondaryItem(e)},getAngle:function(e,t){if(e&&t){var i=e.x,s=e.y,n=t.x,a=t.y,o=n-i,r=a-s,l=Math.round(180*Math.atan2(o,r)/Math.PI*10)/10;return l}return null},delayedOpen:function(){this.timer.navOpen=window.setTimeout(this.open,this.defaultSettings.navTimeout)},delayedClose:function(){this.timer.navClose=window.setTimeout(this.close,this.defaultSettings.navTimeout)},cancelDelayedOpen:function(){window.clearTimeout(this.timer.navOpen)},cancelDelayedClose:function(){window.clearTimeout(this.timer.navClose)},delayedModalOpen:function(){this.timer.modalOpen=window.setTimeout(this.navigationModal.open,this.defaultSettings.navTimeout)},delayedModalClose:function(){var e=this;this.cancelDelayedPrimaryHover(),this.cancelDelayedSecondaryHover(),this.timer.modalClose=window.setTimeout(function(){e.modalClose()},this.defaultSettings.navTimeout)},modalClose:function(){this.$el.find("a").removeClass("active"),this.navigationModal.close()},cancelDelayedModalOpen:function(){window.clearTimeout(this.timer.modalOpen)},cancelDelayedModalClose:function(){window.clearTimeout(this.timer.modalClose)},delayedPrimaryHover:function(e){var t=this;t.timer.primaryHoverIntent=window.setTimeout(function(){t.activatePrimaryItem(e)},this.defaultSettings.hoverTimeout)},cancelDelayedPrimaryHover:function(){window.clearTimeout(this.timer.primaryHoverIntent)},delayedSecondaryHover:function(e){var t=this;t.timer.secondaryHoverIntent=window.setTimeout(function(){t.activateSecondaryItem(e)},this.defaultSettings.hoverTimeout)},cancelDelayedSecondaryHover:function(){window.clearTimeout(this.timer.secondaryHoverIntent)},handleClickClose:function(e){0===t(e.target).closest("#navigation, #navigation-modal").length&&this.close()},handleTapClose:function(e){0===t(e.target).closest("#navigation, #navigation-modal").length&&this.close()},saveMousePosition:function(e){this.mouseLocs.length>1?(this.mouseLocs[1].x!==e.pageX||this.mouseLocs[1].y!==e.pageY)&&(this.mouseLocs.push({x:e.pageX,y:e.pageY}),this.mouseLocs.length>this.defaultSettings.maxMouseLocs&&this.mouseLocs.shift()):this.mouseLocs.push({x:e.pageX,y:e.pageY})},toggleFocusEvents:function(e){var t=e?"subscribe":"stopSubscribing";this[t]("nyt:page-key-tab nyt:page-key-up-a11y nyt:page-key-down-a11y",this.handleFocusKey),this[t]("nyt:page-key-esc-a11y nyt:page-key-left-a11y",this.handleCollapseKey),this[t]("nyt:page-key-enter nyt:page-key-right-a11y",this.handleExpandKey),this[t]("nyt:navigation-level-one-open nyt:navigation-level-two-open",this.addFocusableElements),e?(this.focusableElements=[],this.addFocusableElements(),this.$document.on("mousemove",this.detectFalsePositive)):delete this.focusableElements},addFocusableElements:function(e){var t,s;this.settings.a11yEnabled&&(e&&e.length>0?s=".active a[role=menuitem]:visible, .section-heading a.active[role=menuitem]:visible":(e=this.$el,s="a[role=menuitem]:visible, .section-heading a.active[role=menuitem]:visible"),t=e.find(s).toArray(),this.focusableElements.push({first:t[0],all:t,last:i.last(t)}),t[0].focus())},handleFocusKey:function(e){var t=i.last(this.focusableElements),s=this.getKeyDirection(e),n=document.activeElement;if(n===t.last&&"forward"===s)t.first.focus();else if(n===t.first&&"backward"===s)t.last.focus();else if("forward"===s)t.all[i.indexOf(t.all,n)+1].focus();else{if("backward"!==s)return;t.all[i.indexOf(t.all,n)-1].focus()}e.preventDefault()},handleCollapseKey:function(){var e;this.focusableElements.pop(),e=i.last(this.focusableElements),this.focusableElements.length>1?(this.resetNav(this.navLevels.TERTIARY),e.active.focus()):this.focusableElements.length>0?(this.modalClose(),e.active.focus()):this.close()},handleExpandKey:function(e){var s=t(document.activeElement),n=i.last(this.focusableElements);n.active=s,s.hasClass("expandable")&&(e.preventDefault(),s.closest(".secondary").length>0?this.activateSecondaryItem(e):this.activatePrimaryItem(e))},detectFalsePositive:i.throttle(function(e){t(e.target).is('a[role="menuitem"], li[role="presentation"')&&this.disableA11yNav()},1e3),getKeyDirection:function(e){var t="",i=this.pageManager.KEYS,s=e&&e.keyCode?e.keyCode:null;switch(s){case i.UP:case i.LEFT:t="backward";break;case i.DOWN:case i.RIGHT:case i.TAB:t="forward"}return t},enableA11Nav:function(){this.settings.a11yEnabled=!0},disableA11yNav:function(){this.settings.a11yEnabled=!1,this.toggleFocusEvents(!1),this.$document.off("mousemove",this.detectFalsePositive)}});return l}),define("homepage/views/navigation/mini",["underscore/nyt","jquery/nyt","foundation/views/base-view","foundation/models/user-data"],function(e,t,i,s){var n=i.extend({el:"#mini-navigation",events:{"click .all-sections-button":"handleSectionsClick","click .sections-button":"handleSectionsClick"},shortcuts:{crosswords:"3300eb4c-284f-4484-af31-0d7d1dba4f4c",timespremier:"99c17804-a343-4a76-bf04-f5793ada48d1"},initialize:function(){e.bindAll(this,"distinguishOptions")},handleDomReady:function(){s.ready(this.distinguishOptions)},distinguishOptions:function(){s.isLoggedIn()&&this.handleLoggedInOptions()},handleLoggedInOptions:function(){s.isPremierSubscriber()&&this.$el.find(".mini-navigation-menu .shortcuts-"+this.shortcuts.timespremier).addClass("enabled"),s.isCrosswordsSubscriber()&&!s.isPremierSubscriber()&&this.$el.find(".mini-navigation-menu .shortcuts-"+this.shortcuts.crosswords).addClass("enabled")},handleSectionsClick:function(e){this.broadcast("nyt:navigation-toggle-ready",e)},handleSearchClick:function(e){this.broadcast("nyt:navigation-search-click",e)}});return n}),define("homepage/views/navigation/in-content-theme",["jquery/nyt","underscore/nyt","foundation/views/base-view","homepage/templates"],function(e,t,i){var s=i.extend({el:"#mini-navigation",nytEvents:{"nyt:page-scroll":"toggleTheme"},defaultSettings:{themeClass:"theme-in-content",themeEventName:"nyt:mini-navigation-contenttheme"},navOffset:null,initialize:function(e){this.settings=t.extend({},this.defaultSettings,e),this.navOffset=this.$el.offset().top},handleDomReady:function(){this.toggleTheme()},toggleTheme:function(){var e=this.pageManager.getViewport().top,t=this.$el.hasClass(this.settings.themeClass),i=e>this.navOffset;i&&!t?(this.addTheme(),this.broadcast(this.settings.themeEventName,!0)):!i&&t&&(this.removeTheme(),this.broadcast(this.settings.themeEventName,!1))},addTheme:function(){this.$el.addClass(this.settings.themeClass)},removeTheme:function(){this.$el.removeClass(this.settings.themeClass)}});return s}),define("homepage/instances/navigation",["shared/navigation/views/navigation","homepage/views/navigation/mini","homepage/views/navigation/in-content-theme"],function(e,t,i){new e,new t,new i}),define("homepage/views/inside-nyt/inside-nyt",["underscore/nyt","jquery/nyt","foundation/views/base-view","homepage/templates"],function(e,t,i,s){var n=i.extend({el:"#inside-nyt-browser",settings:{visibleItems:6},hammerSettings:{drag_block_vertical:!0,swipe_velocity:.7,drag_min_distance:3},events:{"click .navigation-control .next:not(.deactivated)":"handleNextArrowClick","click .navigation-control .previous:not(.deactivated)":"handlePreviousArrowClick","dragstart .carousel":"handleDragStart","drag .carousel":"handleDrag","swipe .carousel":"handleSwipe"},nytEvents:{"nyt:ads-rendered":"checkMothAdRendered"},currentPosition:0,mothAdPosition:4,initialize:function(){this.trackingBaseData={action:"click",region:"inside-nyt-region",version:"Moth"}},handleDomReady:function(){this.$carousel=this.$el.find(".carousel"),this.$menu=this.$carousel.find(".menu"),this.injectMothAdContainer(),this.$items=this.$menu.find("li"),this.totalItems=this.$items.length,this.itemWidth=this.$items.eq(1).width()+parseInt(this.$items.eq(1).css("margin-left"),10),this.totalWidth=this.$items.length*this.itemWidth,this.isAnimating=!1,this.pointer=1,this.$menu.css("width",this.totalWidth+"px"),this.assignCustomEasing(),this.totalItems<=this.settings.visibleItems&&this.$el.find(".navigation-control").hide();var e=Math.max(this.$menu.height(),this.$carousel.height())+3;this.$carousel.height(e),this.$items.height(e)},animateToPointer:function(e){var t=this,i=(e-1)*this.itemWidth;t.isAnimating=!0,t.$menu.animate({left:"-"+i+"px"},function(){t.isAnimating=!1,t.activateArrows(e)})},activateArrows:function(e){var i=t(".navigation-control"),s=this.totalItems-this.settings.visibleItems+1;i.find("button").removeClass("deactivated"),1===e?i.find(".previous").addClass("deactivated"):e===s&&i.find(".next").addClass("deactivated")},getNextRemainingItems:function(){return this.totalItems-this.pointer-this.settings.visibleItems},getPreviousRemainingItems:function(){return this.pointer-1},getNextPointerValue:function(){return this.getNextRemainingItems()<this.settings.visibleItems?this.pointer+this.getNextRemainingItems()+1:this.pointer+this.settings.visibleItems},getPreviousPointerValue:function(){return this.getPreviousRemainingItems()<this.settings.visibleItems?this.pointer-this.getPreviousRemainingItems():this.pointer-this.settings.visibleItems},next:function(){var e=this.getNextPointerValue();this.pointer!==e&&(this.animateToPointer(e),this.pointer=e)},previous:function(){var e=this.getPreviousPointerValue();this.pointer!==e&&(this.animateToPointer(e),this.pointer=e)},handleNextArrowClick:function(){this.isAnimating===!1&&this.next(),this.trackingTrigger("moth-forwardscroll-click",{module:"inside-nyt-region",eventName:"MOTH-ForwardScroll"})},handlePreviousArrowClick:function(){this.isAnimating===!1&&this.previous(),this.trackingTrigger("moth-backwardscroll-click",{module:"inside-nyt-region",eventName:"MOTH-BackwardScroll"})},handleDragStart:function(){this.currentPosition=this.$menu.css("left")},handleDrag:function(e){e.gesture.preventDefault(),this.stopSwipeAnimation();var t=parseInt(this.currentPosition,10),i=this.checkLeftValue(t+e.gesture.deltaX);this.$menu.css("left",i+"px")},handleSwipe:function(e){var t,i,s,n,a=this,o=2e3;e.gesture.preventDefault(),this.stopSwipeAnimation(),t=1+e.gesture.distance/a.$el.width(),i=e.gesture.deltaX*t,n=o/e.gesture.velocityX,s=this.checkLeftValue(parseInt(a.$menu.css("left"),10)+i);var r={duration:n,easing:"easeOutCirc"};this.animateSwipe(s,r)},animateSwipe:function(e,t){this.$menu.animate({left:e},t)},stopSwipeAnimation:function(){this.$menu.stop()},checkLeftValue:function(e){var t=-1*(this.totalWidth-this.settings.visibleItems*this.itemWidth);return e>0&&(e=0),t>e&&(e=t),e},assignCustomEasing:function(){return t.easing.easeOutCirc=function(e,t,i,s,n){return s*Math.sqrt(1-(t=t/n-1)*t)+i},this},injectMothAdContainer:function(){var e,t,i=this.$menu.children();this.$html.hasClass("has-moth-ad")&&i.length>=4&&(e=i.eq(this.mothAdPosition-1),t=e.clone(),t.html(s.mothAd()),e.after(t),this.broadcast("nyt:moth-ad-container-rendered"))}});return n}),define("homepage/instances/inside-nyt",["homepage/views/inside-nyt/inside-nyt"],function(e){new e}),define("homepage/views/embedded-slideshow/embedded-slideshow",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/base-view","homepage/templates"],function(e,t,i,s,n,a){var o=n.extend({speed:400,firstSlide:!0,hammerSettings:{tap_max_touchtime:400,swipe_velocity:.1,drag_min_distance:3},truncateCaptions:!0,slideshowType:"mixed",events:{"click .arrow-navigation-previous":"prevAsset","click .arrow-navigation-next":"nextAsset","click .image-navigation.previous":"prevAsset","click .image-navigation.next":"nextAsset","mouseenter .image-navigation.previous":"lightPrevArrow","mouseleave .image-navigation.previous":"unLightPrevArrow","mouseenter .image-navigation.next":"lightNextArrow","mouseleave .image-navigation.next":"unLightNextArrow",drag:"handleDrag",swipeleft:"nextAsset",swiperight:"prevAsset"},initialize:function(e){this.assetIndex=0,t.bindAll(this,"prevAsset","nextAsset","lightPrevArrow","unLightPrevArrow","lightNextArrow","unLightNextArrow"),e.showOnInit||this.$el.hide(),this.$body.off("click",".slideshow"),this.isMobile=this.pageManager.isMobile(),this.isLede=this.isSlideshowLede(),this.trackingBaseData={module:"Slideshow",action:"click",contentCollection:this.pageManager.getMeta("article:section"),version:"Embedded",region:"Body"},this.captionList=e.captionList,this.cropList=e.cropList,this.template=e.template||"embeddedSlideshow",this.truncateCaptions=e.truncateCaption},handleDomReady:function(){var e=a[this.template];this.getAssetsFromJSON(this.$el,this.captionList,this.cropList),this.setSlideshowClass(),this.$el.append(e({headline:this.headline,collection:this.collection,isMobile:this.isMobile,isLede:this.isLede})),this.render(),this.setCounter(),this.$el.fadeIn(this.speed),this.trackingBaseData.contentID=this.assetID},findBasedOnList:function(e,t){for(var i=0;i<=t.length;i+=1)if(e.hasOwnProperty(t[i]))return e[t[i]];return{}},getImageShape:function(e,t){var i=1.5,s=1.1,n=.9,a=e/t;return a>i?"ratio-panoramic":a>s?"ratio-landscape":a>n?"ratio-square":"ratio-portrait"},getAssetsFromJSON:function(i,n,a){var o,r,l,d=this,h=i.find("script").get(0).innerHTML,c=e.parseJSON(h),u=!0,m=!0,p=0;this.headline=c.headline||"",this.assetID=c.id;try{c=t.map(c.imageslideshow.slides,function(e){return o=d.findBasedOnList(e.image_crops,a),r=d.findBasedOnList(e.caption,n),l=d.getImageShape(o.width,o.height),p=p>o.height?p:o.height,"ratio-portrait"!==l&&(u=!1),"ratio-square"!==l&&(m=!1),o?{src:o.url,caption:r,credit:e.credit,imageShape:l}:void console.error("Missing crop for image with caption "+r)})}catch(g){c=[]}c=t.filter(c,function(e){return!!e}),u?this.slideshowType="allPortrait":m&&(this.slideshowType="allSquare"),this.tallestImageHeight=p,this.collection=new s,this.collection.reset(c)},render:function(){var t,i,s,n,o,r=new Image,l=this.$el.find(".image"),d=this.$el.find(".caption"),h=this.$el.find(".loader-container"),c=this;return t=this.collection.at(this.assetIndex),i=e(a.image({src:t.get("src")})),s=e(a.imageInfo({caption:t.get("caption"),credit:t.get("credit")})),l.html(i),this.isMobile||l.css("height",this.tallestImageHeight),h.css("margin-bottom",0),d.html(s),s.fadeIn(this.speed),o=t.get("imageShape"),this.$el.find(".container").removeClass("ratio-panoramic ratio-landscape ratio-square ratio-portrait").addClass(o),r.onload=function(){i.fadeIn(c.speed,function(){c.toggleLoader(!1)
}),c.truncateCaptions&&(n=c.$el.find(".caption-text"),c.truncateText(n,50,!0))},r.src=t.get("src"),this},nextAsset:function(e){e.stopPropagation(),this.moveIndex(1),this.render(),this.setCounter();var t=this.assetIndex+1;this.trackingTrigger("embedded-slideshow-next-image",{eventName:"NextAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}})},prevAsset:function(e){e.stopPropagation(),this.moveIndex(-1),this.render(),this.setCounter();var t=this.assetIndex+1;this.trackingTrigger("embedded-slideshow-prev-image",{eventName:"PrevAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}})},setCounter:function(){var e;this.$counter=this.$el.find(".counter"),e=this.assetIndex,this.$counter.html(e+1+" of "+this.collection.length)},moveIndex:function(e){var t=this.assetIndex,i=this.collection.length;t+=e,t===i?t=0:-1===t&&(t=i-1),this.assetIndex=t},handleDrag:function(e){("right"===e.gesture.direction||"left"===e.gesture.direction)&&e.gesture.preventDefault()},isSlideshowLede:function(){return this.$el.hasClass("lede")},findFirstCapitalLetter:function(e){for(var t=0;t<e.length;t++)if(/[A-Z]/.test(e.charAt(t)))return t;return-1},setSlideshowClass:function(){var e=this.slideshowType,t=this.findFirstCapitalLetter(e);if("allPortrait"===e||"allSquare"===e){var i=e[t].toLowerCase(),s=e.substring(0,t)+"-"+i+e.substring(t+1);this.$el.addClass(s)}},toggleLoader:function(e){var t=this.$el.find(".loader-container");e?t.show():t.hide()},lightPrevArrow:function(){var e=this.$el.find(".arrow-navigation-previous");e.addClass("hover")},unLightPrevArrow:function(){var e=this.$el.find(".arrow-navigation-previous");e.removeClass("hover")},lightNextArrow:function(){var e=this.$el.find(".arrow-navigation-next");e.addClass("hover")},unLightNextArrow:function(){var e=this.$el.find(".arrow-navigation-next");e.removeClass("hover")}});return o}),define("homepage/instances/embedded-slideshow",["jquery/nyt","homepage/views/embedded-slideshow/embedded-slideshow"],function(e,t){var i,s;e("body").find(".slideshow").each(function(n,a){"inline"===e(this).data("media-action")&&(s=["largeWidescreen573","largeHorizontal375"],e(this).data("crop")&&(s=[e(this).data("crop")]),i={el:a,captionList:["short"],cropList:s,showOnInit:!0,template:"embeddedSlideshowHP"},new t(i))})}),define("homepage/instances/classifieds-tabs",["jquery/nyt","shared/tabs/views/legacy/tabs"],function(e,t){e(".classifieds").find(".tabs-container").each(function(e,i){new t({el:i})})}),define("shared/page/helpers/page-mixin",["jquery/nyt"],function(e){var t={handleSwipe:function(e){this.broadcast("nyt:app-swipe",e,e.gesture.direction)},handleSwipeStartEnd:function(e){var t="swipestart"===e.type?"start":"end";this.broadcast("nyt:app-swipe",e,t)},handleDrag:function(t){!t||e(t.srcElement).closest(".slideshow").length>0||this.broadcast("nyt:app-drag",t,t.gesture.direction)},handleDragStartEnd:function(t){var i="dragstart"===t.type?"start":"end";!t||e(t.srcElement).closest(".slideshow").length>0||this.broadcast("nyt:app-drag",t,i)},truncateCaptionText:function(){var t=this;this.$el.find("figure").each(function(){var i,s,n=88,a=e(this);a.hasClass("layout-small-vertical")||a.hasClass("layout-small-horizontal")||a.hasClass("has-adjacency layout-large-horizontal")?(s=a.find(".caption-text"),s>=1&&s.html().indexOf("<")<0&&t.truncateText(s,n,!0)):a.hasClass("layout-large-horizontal")?(i=a.find("img").height()-n,s=a.find(".caption-text"),s>=1&&s.html().indexOf("<")<0&&t.truncateText(s,i,!0)):a.hasClass("photo")&&a.hasClass("inline")&&(s=a.find(".caption-text"),s>=1&&s.html().indexOf("<")<0&&t.truncateText(s,n,!0))})}};return t}),define("shared/page/helpers/inactivity-timer-mixin",["underscore/nyt","jquery/nyt"],function(e,t){var i={inactivityTimerTimeout:null,inactivityTimerDuration:6e5,inactivityTimerEnabled:!1,inactivityTimerLocked:!1,bindInactivityTimerEvents:function(){e.bindAll(this,"startInactivityTimer","enableInactivityTimer","disableInactivityTimer","reenableInactivityTimer","completeInactivityTimer"),this.subscribe("nyt:inactivity-timer-enable",this.handleTimerEnable),this.subscribe("nyt:inactivity-timer-disable",this.handleTimerDisable),this.subscribe("nyt:user-activity",this.reenableInactivityTimer)},handleTimerEnable:function(){this.unlockInactivityTimer(),this.preInactivityTimerEnableDuration?setTimeout(this.enableInactivityTimer,this.preInactivityTimerEnableDuration):this.enableInactivityTimer()},handleTimerDisable:function(){this.disableInactivityTimer(),this.lockInactivityTimer()},startInactivityTimer:function(){var e=this;this.inactivityTimerTimeout&&this.stopInactivityTimer(),this.inactivityTimerTimeout=window.setTimeout(function(){e.disableInactivityTimer(),e.lockInactivityTimer(),e.completeInactivityTimer()},this.inactivityTimerDuration)},enableInactivityTimer:function(){this.inactivityTimerEnabled||this.inactivityTimerLocked||(this.inactivityTimerEnabled=!0,this.startInactivityTimer())},disableInactivityTimer:function(){this.inactivityTimerEnabled&&!this.inactivityTimerLocked&&(this.inactivityTimerEnabled=!1,this.stopInactivityTimer())},reenableInactivityTimer:function(){this.inactivityTimerEnabled&&!this.inactivityTimerLocked&&(this.disableInactivityTimer(),this.enableInactivityTimer())},stopInactivityTimer:function(){window.clearTimeout(this.inactivityTimerTimeout),this.inactivityTimerTimeout=null},lockInactivityTimer:function(){this.inactivityTimerLocked=!0},unlockInactivityTimer:function(){this.inactivityTimerLocked=!1},completeInactivityTimer:t.noop};return i}),define("shared/community/models/static-comment-service",["foundation/models/base-model"],function(e){var t=e.extend({defaults:{assetID:0,assetURL:"",createDate:0,commentCount:0,canSubmit:0},canSubmit:function(){return parseInt(this.get("canSubmit"),10)>0}});return t}),define("shared/community/collections/static-comment-service",["foundation/collections/base-collection","shared/community/models/static-comment-service","foundation/hosts","foundation/helpers/utils"],function(e,t,i){var s=e.extend({url:i.s1+"/ugc/comments/commentData.json",model:t,parse:function(e){return e&&e.results?e.results.assets:[]},getCommentCountByURL:function(e){return this.findWhere({assetURL:e})?this.findWhere({assetURL:e}).get("commentCount"):-1}});return s}),define("homepage/instances/comment-counts",["shared/community/collections/static-comment-service"],function(e){return new e}),define("shared/data/collections/nyt-now",["backbone/nyt","foundation/collections/base-collection","foundation/helpers/utils","underscore/nyt","shared/data/helpers/collection-mixin"],function(e,t,i,s,n){var a=t.extend(s.extend({},n,{url:i.getHostBasedOnEdition()+"/services/json/channels/nytnow.json",sync:function(t,i,s){return s.dataType="json",s.cache=!0,e.sync(t,i,s)},parse:function(e){var t=s.map(e.NytNow.urls,function(e){var t={url:e};return t});return t}}));return a}),define("shared/data/instances/nyt-now",["shared/data/collections/nyt-now"],function(e){return new e}),define("homepage/views/homepage",["underscore/nyt","jquery/nyt","foundation/models/user-data","foundation/helpers/utils","foundation/views/base-view","shared/page/helpers/page-mixin","shared/page/helpers/inactivity-timer-mixin","homepage/instances/comment-counts","shared/data/instances/nyt-now","foundation/cookies"],function(e,t,i,s,n,a,o,r,l,d){var h=n.extend(a).extend(o).extend({el:"body",events:{"click #markets-search-label":"handleMarketsSearchClick","click .top-news a, .pocket-region a, .region .opinion a":"handleTopNewsClick","click .region .day-part a, .region .markets .story":"handleDayPartClick","click .classifieds .real-estate .story, .classifieds .job-market .story":"handleTopNewsClick","click .well a":"handleWellClick","click #recommendations .most-emailed a":"handleMostEmailedClick","click #recommendations .most-viewed a":"handleMostViewedClick","click #recommendations .recommended a":"handleRecommendedClick","click #mobile-banner a":"removeMobileCookie"},nytEvents:{"nyt:video-play":"handleVideoPlay","nyt:video-ad-start":"handleVideoPlay","nyt:video-video-paused":"handleVideoStop","nyt:video-complete":"handleVideoStop"},sectionMapping:{World:"world",BusinessDay:"business",Opinion:"opinion","U.S.":"us",Technology:"technology",Arts:"arts",Politics:"politics",Sports:"sports",Movies:"movies","N.Y./Region":"nyregion",Obituaries:"obituaries",Theater:"theater",Science:"science",Travel:"travel",Television:"television",Health:"health","Dining&Wine":"dining",Books:"books",Education:"education","Home&Garden":"garden",SundayReview:"opinion",RealEstate:"realestate","Fashion&Style":"fashion",Magazine:"magazine",Automobiles:"automobiles",TMagazine:"t-magazine",TheUpshot:"upshot",InternationalOpinion:"opinion",InternationalArts:"arts",InternationalBusiness:"business",InternationalStyle:"fashion",InternationalSports:"sports","GreatHomes&Destinations":"realestate","U.S.Politics":"politics"},inactivityTimerDuration:6e4,preInactivityTimerEnableDuration:42e4,timestampCounter:0,initialize:function(){var e=this.pageManager.getUrlParam("activity-rate"),t=this.pageManager.getUrlParam("inactivity-rate");e&&(this.preInactivityTimerEnableDuration=e),t&&(this.inactivityTimerDuration=t)},handleDomReady:function(){this.loadNytNowData(),this.bindInactivityTimerEvents(),this.updateCommentCounts(),this.updateTimestamps(),this.determineMobileVersionVisibility(),setTimeout(this.enableInactivityTimer,this.preInactivityTimerEnableDuration)},updateTimestamps:function(){var e=this,i=t("section:not(.times-wire) .timestamp"),s=6e4;e.timestampCounter+=1,e.timestampCounter<=20&&(s=1e3),this.renderTimestamps(i,!1),setTimeout(function(){e.updateTimestamps()},s)},renderTimestamps:function(e,i){var s,n=this,a=function(e){return e>=3600?!0:void 0};e.each(function(){var e=t(this).data("utc-timestamp"),o=Math.ceil(Math.log(e+1)/Math.LN10),r=13;e=r>o?e*Math.pow(10,r-o):e,s=n.prettyDate(e,i,a),s&&t(this).text(s)})},loadNytNowData:function(){l.loadData(),l.length>0?this.renderNytNow():this.subscribeOnce(l,"sync",this.renderNytNow)},renderNytNow:function(){this.$diamonds=this.$el.find(".product-label.theme-nyt-now.hidden"),this.$diamonds.each(function(){var e,i,s=t(this),n=s.siblings("a");0===n.length&&(n=s.closest("a.story-link")),e=n.attr("href").match(/[^?#]+/)||[],i=l.findWhere({url:e[0]}),i&&s.removeClass("hidden")})},updateCommentCounts:function(){r.length>0?this.renderCommentCounts():(r.fetch(),this.subscribeOnce(r,"sync",this.renderCommentCounts))},renderCommentCounts:function(){var e,i;this.$linkList=this.$el.find(".comments-link"),this.$linkList.each(function(){if(e=t(this).attr("href").match(/[^?#]+/)[0],i=r.getCommentCountByURL(e),i>0){var s=1===i?" Comment":" Comments";t(this).find(".comment-count").html(i+s)}})},handleMarketsSearchClick:function(){t(".markets-search").addClass("active")},completeInactivityTimer:function(){var e=window.location.href,t={"WT.z_jog":"1"},i=s.appendQueryParams(e,t);window.location.href=i},handleAnchorClick:function(e,i){var n,a=t(e.target);i=i||{},a.is("a")||(a=a.parents("a")),n=a.attr("href"),n&&(n=s.appendQueryParams(n,i),a.attr("href",n))},handleTopNewsClick:function(e){this.handleAnchorClick(e,{hp:""})},handleDayPartClick:function(e){this.handleAnchorClick(e,{src:"dayp"})},handleWellClick:function(e){var i=t(e.target),s=i.closest("ul").prev().children("a").text().replace(/\u00bb|\s+/g,""),n=this.sectionMapping[s]||"";this.handleAnchorClick(e,{hpw:"",rref:n})},handleMostEmailedClick:function(e){this.handleAnchorClick(e,{src:"me"})},handleMostViewedClick:function(e){this.handleAnchorClick(e,{src:"mv"})},handleRecommendedClick:function(e){this.handleAnchorClick(e,{src:"rechp"})},handleVideoPlay:function(e){t(e.container).closest(".video").find(".caption").fadeTo(200,0),this.broadcast("nyt:inactivity-timer-disable")},handleVideoStop:function(){this.broadcast("nyt:inactivity-timer-enable")},determineMobileVersionVisibility:function(){var e=d.readCookie("nyt-mobile");"0"===e&&t("#mobile-banner").removeClass("hidden")},removeMobileCookie:function(){d.deleteCookie("nyt-mobile")},handleUserReady:function(){var e=i.isCrosswordsSubscriber(),s=i.isPremierSubscriber();(e||s)&&(t(".c-column .c-column-top-span-region .user-subscriptions").removeClass("hidden"),e&&s?t("#times-premier-crossword-subscription").removeClass("hidden"):e?t("#crossword-subscription").removeClass("hidden"):s&&t("#times-premier-subscription").removeClass("hidden"))}});return h}),define("homepage/instances/homepage",["homepage/views/homepage"],function(e){new e}),define("homepage/views/tracking/tracking",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){var s=i.extend({el:"body",events:{"click .region a":"handleStoryClick","click .site-index-navigation a":"handleSiteIndexClick","click .mini-navigation a":"handleMiniNavClick","click .most-emailed a":"handleMostEmailedClick","click .most-viewed a":"handleMostViewedClick","click .recommended a":"handleRecommendedClick"},nytEvents:{"nyt:page-scroll-after":"handleScroll"},initialize:function(){this.lastScrollTop=0,this.maxScrollDepth=0,this.maxScrollTop=this.$body.height()-this.$window.height(),this.trackingBaseData={action:"click",pgtype:"Homepage"}},handleStoryClick:function(t){var i={},s=e(t.currentTarget),n=s.closest(".region").attr("class").match(/[A-z-]+region/)[0],a=this.getTrackingVersion(s);a&&(i.version=a);var o=this.getModRef(s);o&&(i.modref=o),i.module=n,i.region=this.getGeographicalRegionMappingBasedOnScoopRegion(n),i["WT.nav"]=this.getGeographicalRegionMappingBasedOnScoopRegion(n);var r=this.trackingAppendParams(s.attr("href"),i);s.attr("href",r)},getGeographicalRegionMappingBasedOnScoopRegion:function(e){var t=e;switch(e){case"well-region":t="bottom-well";break;case"first-column-region":case"second-column-region":case"third-column-region":case"span-ab-top-region":case"span-ab-bottom-region":case"photo-spot-region":case"span-ab-lede-package-region":case"a-lede-package-region":case"b-lede-package-region":t="top-news"}return t},getTrackingVersion:function(e){var t,i=e.closest("article").data("collection-renderstyle"),s=e.closest("li");return t="Moth"===i?s.index()<=5?"Moth-Visible":"Moth-Hidden":i,t||""},getModRef:function(e){var t=this.getReferType(e);return 0!==e.closest(".theme-comments").length?"HPCommentsRefer":0!==e.closest(".refer").length?t:""},getReferType:function(e){var t=e.find(".icon");return t.hasClass("video")?"HPVideoRefer":t.hasClass("audio")?"HPAudioRefer":t.hasClass("interactive")?"HPInteractiveRefer":t.hasClass("slideshow")?"HPSlideshowRefer":t.hasClass("graphic")?"HPGraphicRefer":t.hasClass("map")?"HPMapRefer":""},handleMiniNavClick:function(t){var i=e(t.currentTarget),s=this.trackingAppendParams(i.attr("href"),{region:"TopBar",module:"HPMiniNav",contentCollection:i.html(),"WT.nav":"page"});i.attr("href",s)},handleSiteIndexClick:function(t){var i=e(t.currentTarget),s=this.trackingAppendParams(i.attr("href"),{region:"SiteIndex",module:"SiteIndex",contentCollection:i.html(),"WT.nav":"footer-nav"});i.attr("href",s)},handleMostEmailedClick:function(t){var i=e(t.currentTarget),s=this.trackingAppendParams(i.attr("href"),{region:"CColumn",module:"MostEmailed",version:"Full",src:"me","WT.nav":"MostEmailed"});i.attr("href",s)},handleMostViewedClick:function(t){var i=e(t.currentTarget),s=this.trackingAppendParams(i.attr("href"),{region:"CColumn",module:"MostViewed",version:"Full",src:"mv","WT.nav":"MostViewed"});i.attr("href",s)},handleRecommendedClick:function(t){var i=e(t.currentTarget),s=this.trackingAppendParams(i.attr("href"),{region:"CColumn",module:"Recommendation",src:"rechp","WT.nav":"RecEngine"});i.attr("href",s)},updateScrollDepth:function(){var e=this.lastScrollTop/this.maxScrollTop*100,t=25*Math.floor(e/25);t>this.maxScrollDepth&&(this.maxScrollDepth=t,this.trackingTriggerRaw("scroll-depth",{module:"Page",depth:t},"interaction"))},handleScroll:function(){var e=this.$window.scrollTop(),t=e-this.lastScrollTop;100>t||(this.lastScrollTop=e,this.updateScrollDepth())}});return s}),define("homepage/instances/tracking",["homepage/views/tracking/tracking"],function(e){new e}),define("shared/video/views/video-playlist",["jquery/nyt","foundation/views/base-view"],function(e,t){var i=t.extend({visibleItems:6,hammerSettings:{drag_block_vertical:!0,swipe_velocity:.7,drag_min_distance:3},events:{"dragstart #extVidPlayerThumbsWrapper":"handleDragStart","drag #extVidPlayerThumbsWrapper":"handleDrag","swipe #extVidPlayerThumbsWrapper":"handleSwipe"},nytEvents:{"nyt:video-playlist-ready":"setup"},currentPosition:0,initialize:function(e){var t={container:e.el,referenceId:e.playlistID,token:e.apiToken,playerId:e.playerID,publisherId:e.publisherID,thumbWidth:90,videoWidth:"100%",videoHeight:"100%"};require(["videoPlaylist"],function(e){new e.Extended(t)})},setup:function(){this.$carousel=e("#extVidPlayerThumbsWrapper"),this.$menu=e("#extVidPlayerThumbs"),this.$items=this.$menu.find("li"),this.totalItems=this.$items.length,this.itemWidth=this.$items.eq(1).width()+parseInt(this.$items.eq(1).css("margin-right"),10),this.totalWidth=this.$items.length*this.itemWidth+20,this.isAnimating=!1,this.pointer=1,this.$menu.css("width",this.totalWidth+"px"),this.assignCustomEasing()},handleDragStart:function(){this.currentPosition=this.$menu.css("left")},handleDrag:function(e){var t=parseInt(this.currentPosition,10),i=this.checkLeftValue(t+e.gesture.deltaX);e.gesture.preventDefault(),this.stopSwipeAnimation(),this.$menu.css("left",i+"px")},handleSwipe:function(e){var t,i,s,n,a,o=this,r=2e3;e.gesture.preventDefault(),this.stopSwipeAnimation(),t=1+e.gesture.distance/o.$el.width(),i=e.gesture.deltaX*t,n=r/e.gesture.velocityX,s=this.checkLeftValue(parseInt(o.$menu.css("left"),10)+i),a={duration:n,easing:"easeOutCirc"},this.animateSwipe(s,a)},animateSwipe:function(e,t){this.$menu.animate({left:e},t)},stopSwipeAnimation:function(){this.$menu.stop()},checkLeftValue:function(e){var t=-1*(this.totalWidth-this.visibleItems*this.itemWidth);return e>0&&(e=0),t>e&&(e=t),e},assignCustomEasing:function(){return e.easing.easeOutCirc=function(e,t,i,s,n){return s*Math.sqrt(1-(t=t/n-1)*t)+i},this}});return i}),define("shared/video/instances/video-playlist",["jquery/nyt","underscore/nyt","foundation/views/page-manager","shared/video/views/video-playlist"],function(e,t,i,s){var n,a=function(){window.clearTimeout(n),i.stopListening(i,"nyt:ads-rendered",a),e(".extendedVideoPlayerModule").each(function(){new s({el:e(this),playlistID:e(this).data("playlist-id"),apiToken:e(this).data("api-token"),playerID:e(this).data("player-id"),publisherID:e(this).data("publisher-id")})})};i.getMeta("ads_adNames")?a():(i.listenToOnce(i,"nyt:ads-rendered",a),n=window.setTimeout(a,1500))}),define("shared/video/models/video",["backbone/nyt","foundation/models/base-model"],function(e,t){var i=t.extend({playerPositions:{POSITION_LEDE:"position_lede",POSITION_INLINE:"position_inline",POSITION_EMBEDDED:"position_embedded",POSITION_PHOTOSPOT:"position_photospot"},videoEvents:{TEMPLATE_READY:"nyt:video-template-ready",VIDEO_COMPLETE:"nyt:video-complete",PLAY_CLICKED:"nyt:video-play-clicked",VIDEO_PLAY:"nyt:video-play",VIDEO_PAUSED:"nyt:video-video-paused",AD_START:"nyt:video-ad-start",AD_COMPLETE:" nyt:video-ad-complete",VIDEO_FULLSCREEN:"nyt:video-fullscreen",VIDEO_EXIT_FULLSCREEN:"nyt:video-exit-fullscreen",KILL_VIDEO:"nyt:video-kill",HIDE_VIDEO_END_CARD:"nyt:video-end-card-hide",MEDIA_CHANGE:"nyt:video-media-change"},clickableElements:[".video-share span",".video-share i.icon",".video-share a"],defaults:{playerId:"2368596073001",publisherId:"1749339200",publisherReadToken:"cE97ArV7TzqBzkmeRVVhJ8O6GWME2iG_bRvjBTlNb4o.",noShareToolsPlayerId:"3692909326001"},initialize:function(){this.videoObject=null,this.isVideoFullscreen=!1,this.isAdPlaying=!1},pause:function(){var e=this.get("videoObject");if(e){var t=e.getVideoModule();t&&t.pause(!0)}},kill:function(){this.local(this,this.videoEvents.KILL_VIDEO,this.videoObject)},hideVideoEndCard:function(){this.local(this,this.videoEvents.HIDE_VIDEO_END_CARD,this)}});return i}),define("shared/video/models/video-end-card",["backbone/nyt","foundation/models/base-model"],function(e,t){var i=t.extend({PAUSE_STATE:"pause",COMPLETE_STATE:"complete",maxThumbs:4,autoplayTimeout:5,currentPlaylistIndex:0,cachedPlaylist:null,defaults:{permalink:"http://www.nytimes.com/video",videoTitle:"NYTimes Video",videoDescription:"",videoStillImgUrl:"http://graphics8.nytimes.com/images/section/video/library/default-video-posterframe.png",playlistDisplayName:"Latest Video",playlistId:1194811622182,playlistUrl:"http://www.nytimes.com/video/landing/latest-video/1194811622182/index.html",tags:[]},initialize:function(e){this.videoModel=e.videoModel,this.videoId=this.videoModel.get("videoId"),this.videoObject=this.videoModel.get("videoObject"),this.videoInnerContainer=this.videoModel.get("videoInnerContainer"),this.playlistVideosDataModel=null,this.playlistMetaDataModel=null}});return i}),define("shared/video/templates",["underscore/nyt"],function(_){var templates={};return templates.video=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div id="'+(null==(__t=outerId)?"":__t)+'" class="video-bind">\n<div id="'+(null==(__t=innerId)?"":__t)+'" class="video-container"></div>\n</div>';return __p},templates.videoEndCard=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="video-end-card layout-small"><button class="video-end-card-play-button"><i class=\'icon\'></i><span>Replay Video</span></button><div class="video-share sharetools theme-classic" data-shares="show-all|Share" data-url="'+(null==(__t=permalink)?"":__t)+'" data-title="'+(null==(__t=videoTitle)?"":__t)+'" data-description="'+(null==(__t=videoDescription)?"":__t)+'">\n</div><div class="video-end-card-videos">\n<h5 class="video-end-card-section-heading video-end-card-section-heading-loading">\n<a href="'+(null==(__t=playlistUrl)?"":__t)+'" style="opacity: 1;">More in '+(null==(__t=playlistDisplayName)?"":__t)+' &raquo;</a>\n</h5>\n<div class="video-end-card-thumbs">\n<span class="video-end-card-loader"></span>\n</div>\n</div>\n</div>';return __p},templates.videoEndCardIcon=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<i class="icon"></i><span>'+(null==(__t=iconText)?"":__t)+"</span>";return __p},templates.videoEndCardThumb=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="video-end-card-thumb item-'+(null==(__t=itemIndex)?"":__t)+" "+(null==(__t=itemOrdinal)?"":__t)+'">\n<a href="'+(null==(__t=thumbLink)?"":__t)+'" alt="'+(null==(__t=thumbDesc)?"":__t)+'" title="'+(null==(__t=thumbDesc)?"":__t)+'" data-videoid="'+(null==(__t=thumbVideoId)?"":__t)+'" data-index="'+(null==(__t=thumbIndex)?"":__t)+'">\n',"first"==itemOrdinal&&(__p+='\n<p class="autoplayMeta off '+(null==(__t=thumbAutoPlayPaused)?"":__t)+'">\n<span class="countdownControl"></span>\n<span class="countdown">Playing in <span>'+(null==(__t=thumbAutoPlayRemainingTime)?"":__t)+"</span>...</span>\n</p>\n"),__p+='\n<span class="video-end-card-thumb-image">\n<img src="'+(null==(__t=thumbImg)?"":__t)+'">\n</span>\n<h4 class="video-headline">'+(null==(__t=thumbDesc)?"":__t)+"</h4>\n</a>\n</div>";return __p},templates}),define("shared/video/models/playlist-videos",["backbone/nyt","foundation/models/base-model"],function(e,t){var i=t.extend({url:"http://api.brightcove.com/services/library",brightcoveApiData:{token:"cE97ArV7TzqBzkmeRVVhJ8O6GWME2iG_bRvjBTlNb4o.",reference_id:1194811622182,command:"find_playlist_by_reference_id",playlist_fields:"referenceId,name,videos",video_fields:"referenceId,name,videoStillURL",custom_fields:"videourl",media_delivery:"http"},fetchData:function(e,t,i,s){var n=this;this.success=t,this.error=i,this.passThroughCallback=s,e.token=e.token||this.brightcoveApiData.token,e.reference_id=e.reference_id||this.brightcoveApiData.reference_id,e.command=e.command||this.brightcoveApiData.command,e.playlist_fields=e.playlist_fields||this.brightcoveApiData.playlist_fields,e.video_fields=e.video_fields||this.brightcoveApiData.video_fields,e.custom_fields=e.custom_fields||this.brightcoveApiData.custom_fields,e.media_delivery=e.media_delivery||this.brightcoveApiData.media_delivery,this.fetch({data:e,success:function(e){n.success&&(n.passThroughCallback&&"function"==typeof n.passThroughCallback?n.success(e,n.passThroughCallback):n.success(e))},error:function(e){n.error&&n.error(e)}})},sync:function(t,i,s){return s.dataType="jsonp",s.timeout=1e4,e.sync(t,i,s)}});return i}),define("shared/video/models/playlist-metadata",["backbone/nyt","foundation/models/base-model"],function(e,t){var i=t.extend({url:"http://www.nytimes.com/svc/video/api/v2/playlists",initialize:function(e){this.allPlaylistData=null,this.apiEnv=e.apiEnv||"production","staging"===this.apiEnv&&(this.url="http://www.stg.nytimes.com/svc/video/api/v2/playlists")},sync:function(t,i,s){return s.dataType="json",s.timeout=1e4,s.cache=!0,e.sync(t,i,s)},getPlaylistMetaData:function(e,t,i){var s=this;this.playlistId=e,this.success=t,this.error=i,this.allPlaylistData?this.findPlaylistById(this.allPlaylistData,this.playlistId,this.success,this.error):this.fetch({success:function(e){s.allPlaylistData=e,s.findPlaylistById(e,s.playlistId,s.success,s.error)},error:function(e){s.error&&s.error(e)}})},getPlaylistNode:function(e,t){var i;if(e)for(var s in e)if(i=e[s],parseInt(i.knews_id,10)===t)return i;return{}},findPlaylistById:function(e,t,i,s){var n,a,o,r;if(n=this,this.playlistId=t,this.success=i,this.error=s,a=e.toJSON(),o=a.plst_all,r=this.getPlaylistNode(o,this.playlistId)){if(!this.success)return r;this.success(r)}else this.error&&this.error({message:"Could not find playlist in all playlists data."})}});return i}),define("shared/video/models/video-thumb",["backbone/nyt","foundation/models/base-model"],function(e,t){var i=t.extend({defaults:{itemIndex:"",itemOrdinal:"",thumbLink:"",thumbImg:"",thumbDesc:"",thumbAutoPlayPaused:"",thumbAutoPlayRemainingTime:"5"}});return i}),define("shared/video/collections/video-thumbs",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","shared/video/models/video-thumb"],function(e,t,i,s){var n=i.extend({model:s});return n}),define("shared/video/views/video-thumb",["jquery/nyt","underscore/nyt","backbone/nyt","shared/video/templates","foundation/views/base-view"],function(e,t,i,s,n){var a=n.extend({thumbTemplate:s.videoEndCardThumb,render:function(){return this.thumbTemplate(this.model.toJSON())}});return a}),define("shared/sharetools/templates",["underscore/nyt"],function(_){var templates={};return templates.emailModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<iframe src="'+(null==(__t=emailThisUrl)?"":__t)+(null==(__t=dataUrl)?"":__t)+'" title="Email This" id="emailthis" scrolling="'+(null==(__t=scrolling)?"":__t)+'" marginheight="0" marginwidth="0" frameborder="0"></iframe>';return __p},templates.savemodal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<ul class="instructions">\n<li>This item has been saved to read later from any device. </li>\n<li>Access saved items through your user name at the top of the page.</li>\n</ul>\n<p><a href="'+(null==(__t=link)?"":__t)+'">View Saved Items</a><p>\n<button class="button dismiss-button">OK</button>';return __p},templates.shareTool=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<a href="javascript:;" data-share="'+(null==(__t=id)?"":__t)+'"><i class="icon"></i><span class="sharetool-text '+(null==(__t=isLabelHidden===!0?"visually-hidden":"")?"":__t)+'">'+(null==(__t=label)?"":__t)+"</span></a>";return __p},templates.shareTools=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="<ul>\n",_.each(shares,function(e){__p+='\n<li class="sharetool '+(null==(__t=e.type)?"":__t)+"-sharetool "+(null==(__t=config[e.type].loginRequired?"login-modal-trigger":"")?"":__t)+'" data-modal-title="'+(null==(__t=config[e.type].loginModalText||"")?"":__t)+'">\n<a href="javascript:;" data-share="'+(null==(__t=e.type)?"":__t)+'"><i class="icon"></i><span class="sharetool-text">'+(null==(__t=e.label)?"":__t)+"</span></a>\n</li>\n"}),__p+="\n</ul>";return __p},templates.shareToolsModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="section share">\n<ul class="sharetools-menu">\n'+(null==(__t=standardToolsList)?"":__t)+'\n</ul>\n<form class="short-url-form">\n<div class="control">\n<div class="label-container"><label for="short-url-input">Permalink</label></div>\n<div class="field-container">\n<input id="short-url-input" class="short-url-input text" type="text" name="short-url-input" value="'+(null==(__t=shortUrl)?"":__t)+'" readonly="readonly" />\n</div>\n</div>\n</form>\n</div><!--close section -->\n<div class="section tools">\n<h4 class="modal-heading">Tools</h4>\n<ul class="sharetools-menu">\n'+(null==(__t=articleToolsList)?"":__t)+'\n</ul>\n</div><!--close section -->\n<div class="modal-footer">\n<div class="ad show-all-sharetool-modal-ad hidden">\n<small class="ad-sponsor">Article Tools Sponsored By</small>\n</div>\n</div><!-- close modal footer -->';return __p},templates.showAllSharetoolModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="section share">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllLinkList)?"":__t)+'\n</ul>\n<form class="short-url-form">\n<div class="control">\n<div class="label-container"><label for="short-url-input">Permalink</label></div>\n<div class="field-container">\n<input id="short-url-input" class="short-url-input text" type="text" name="short-url-input" value="'+(null==(__t=shortUrl)?"":__t)+'" readonly/>\n</div>\n</div>\n</form>\n</div> <!--close section -->\n<div class="section tools">\n<h5 class="modal-heading"> Tools </h5>\n<ul class="sharetools-menu">\n'+(null==(__t=showAllToolList)?"":__t)+'\n</ul>\n</div> <!--close section -->\n<div  class="modal-footer">\n<div class="ad show-all-sharetool-modal-ad hidden">\n<small class="ad-sponsor">Article Tools Sponsored By</small>\n</div>\n</div> <!-- close modal footer -->';return __p},templates.showallLinks=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<li class="sharetool '+(null==(__t=shareObj.type)?"":__t)+"-sharetool "+(null==(__t=config.loginRequired?"login-modal-trigger":"")?"":__t)+'" data-modal-title="'+(null==(__t=config.loginModalText||"")?"":__t)+'">\n<a href="javascript:;" data-share="'+(null==(__t=shareObj.type)?"":__t)+'"><i class="icon"></i>'+(null==(__t=shareObj.label)?"":__t)+"</a>\n</li>";return __p},templates}),define("shared/sharetools/views/email",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/views/base-view","shared/modal/views/modal","shared/sharetools/templates"],function(e,t,i,s,n,a){var o=s.extend({template:a.emailModal,className:"email-view-container",frameSize:{small:507,full:867,ad:285},defaultSettings:{emailThisUrl:"https:"+i.www+"/mem/email-this.html?url=",scrolling:window.Modernizr.postmessage?"no":"yes"},defaultModalSettings:{id:"email-share-modal",modalTitle:"Email This Article",binding:".email-sharetool",tailDirection:"centered",hasOverlay:!0,hasCloseButton:!0,modalContent:""},initialize:function(e){var i=this;t.bindAll(this,"handlePostMessage","responsive"),this.settings=t.extend({},this.defaultSettings,e),this.frameState="full",this.modalSettings=t.extend({},this.defaultModalSettings,{openCallback:function(){window.Modernizr.postmessage&&(window.addEventListener?window.addEventListener("message",i.handlePostMessage,!1):window.attachEvent("onmessage",i.handlePostMessage)),i.listenTo(i.pageManager,"nyt:page-breakpoint",i.responsive)},closeCallback:function(){this.removeFromPage(),window.addEventListener?window.removeEventListener("message",i.handlePostMessage,!1):window.detachEvent("onmessage",i.handlePostMessage),i.stopListening(i.pageManager,"nyt:page-breakpoint",i.responsive)}}),this.render()
},render:function(){this.modalSettings.modalContent=this.template(this.settings),this.emailModal=new n(this.modalSettings),this.emailModal.addToPage(),t.defer(this.responsive,this.pageManager.getCurrentBreakpoint())},responsive:function(e){var t=this.emailModal.$modal.find("iframe");1010>=e&&"full"===this.frameState&&(t.css("height",t.height()+this.frameSize.ad+"px").width(this.frameSize.small),this.frameSize.state="small",this.emailModal.positionDialog()),e>1010&&"small"===this.frameState&&(t.css("height",t.height()-this.frameSize.ad+"px").width(this.frameSize.full),this.frameState="full",this.emailModal.positionDialog())},handlePostMessage:function(e){var t;/\.nytimes\.com$/.test(e.origin)&&(t=e.data.match(/(.+)\:(.+)/),t&&"frameheight"===t[1]?this.$el.css("height",t[2]):t&&"closewindow"===t[1]?this.emailModal.close():t&&"loginredirect"===t[1]&&(window.location=i.myaccount+"/auth/login?URI="+encodeURIComponent(window.location.href)))}});return o}),define("shared/sharetools/helpers/sharetools-config",["jquery/nyt","foundation/hosts"],function(){var e={};return e.common={mainClassName:"shareTools",itemClassName:"shareToolsItem",defaultActiveShares:"email,facebook,twitter,save,show-all|more,ad",defaultShowAllShares:"facebook|Share,email|Email,twitter|Tweet,linkedin|LinkedIn,google|Google+,reddit|Reddit,save|Save,reprints|Reprints,print|Print,ad",defaultUrl:window.location.href.replace(/#.*/,""),defaultTitle:document.title,defaultDescription:"",defaultAdPosition:"Frame4A",defaultOverlayAdPosition:"Frame6A",defaultWidth:600,defaultHeight:450,defaultTransition:"fade",labelSpecialChar:"|",hasAd:!1,loadedAdPositions:[],shortUrlApi:"http://www.nytimes.com/svc/bitly/shorten.jsonp",emailThisUrl:"https://www.nytimes.com/mem/email-this.html?url=",count:0},e.tools={facebook:{active:!0,onShowAll:!0,label:"Facebook",postUrl:"http://www.facebook.com/sharer.php",postType:"popup",shareParameters:{url:"u"},smid:"fb-share",width:655,height:430},twitter:{active:!0,onShowAll:!0,label:"Twitter",postUrl:"https://twitter.com/share",postType:"popup",shareParameters:{url:"url",title:"text",via:"via"},smid:"tw-share",width:600,height:450},google:{active:!0,onShowAll:!0,label:"Google+",postUrl:"https://plus.google.com/share",postType:"popup",shareParameters:{url:"url"},urlParameters:{hl:"en-US"},smid:"go-share",width:600,height:600},tumblr:{active:!0,onShowAll:!0,label:"Tumblr",postUrl:"http://www.tumblr.com/share/link",postType:"popup",shareParameters:{url:"url",title:"name",description:"description"},smid:"tu-share",width:560},linkedin:{active:!0,onShowAll:!0,label:"Linkedin",postUrl:"http://www.linkedin.com/shareArticle",postType:"popup",shareParameters:{url:"url",title:"title",description:"summary"},urlParameters:{mini:"true",source:"The New York Times"},smid:"li-share",width:750,height:450},reddit:{active:!0,onShowAll:!0,label:"Reddit",postUrl:"http://www.reddit.com/submit",postType:"popup",shareParameters:{url:"url",title:"title"},smid:"re-share",width:854,height:550},email:{loginModalText:"Log in to Email",active:!0,onShowAll:!0,label:"Email",loginRequired:!0},permalink:{active:!0,onShowAll:!0,label:"Permalink",postUrl:"http://www.nytimes.com/export_html/common/new_article_post.html",postType:"popup",shareParameters:{url:"url",title:"title",description:"summary"},smid:"pl-share",width:460,height:380},"show-all":{active:!0,onShowAll:!1,label:"Show All"},reprints:{active:!0,onShowAll:!1,label:"Reprints",postUrl:"https://s100.copyright.com/AppDispatchServlet",postType:"popup",shareParameters:{url:"contentID"},urlParameters:{publisherName:"The New York Times",publication:"nytimes.com",token:"",orderBeanReset:"true",postType:"",wordCount:"",title:document.title,publicationDate:"",author:""}},save:{loginModalText:"Log in to Save",active:!0,onShowAll:!1,label:"Save",postUrl:e.common.defaultUrl.replace(/\?.*/,""),loginRequired:!0},print:{active:!0,onShowAll:!1,label:"Print",postUrl:e.common.defaultUrl,postType:"link",urlParameters:{pagewanted:"print"}},ad:{active:!0,onShowAll:!1,label:"Advertisement"}},e}),define("shared/sharetools/collections/cross-platform-save",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/hosts","foundation/lib/auth/userauth"],function(e,t,i,s,n,a){var o=s.extend({COMMAND:{save:"add",check:"list"},url:n.du+"/svc/profile/reading-list/v1/",save:function(e){var t=this;this.sync(this.COMMAND.save,e).done(function(i){t.add(i),t.trigger("nyt:xps-saved",e,i)}).fail(function(){t.trigger("nyt:xps-failed",e)})},sync:function(t,i){var s=new e.Deferred,n=setTimeout(function(){s.reject()},5e3),o={url:i},r={type:"GET",jsonp:"callback",jsonpCallback:"xpsCallback",dataType:"jsonp",cache:!0,url:this.url+t+".jsonp",data:"",success:function(e){clearTimeout(n),e&&e.assets?s.resolve(e.assets):s.reject()}};return a.getToken().done(function(t,i,s){t&&i&&"undefined"!=typeof s&&(r.data+="&token="+t),r.data+="&data="+JSON.stringify(o),e.ajax(r)}),s.promise()}});return o}),define("shared/sharetools/instances/cross-platform-save",["shared/sharetools/collections/cross-platform-save"],function(e){return new e}),define("shared/sharetools/collections/short-url",["jquery/nyt","backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","underscore/nyt"],function(e,t,i){var s=i.extend({url:"http://www.nytimes.com/svc/bitly/shorten.jsonp",initialize:function(){this.currentUrlRequest="",this.addCurrentPage()},sync:function(e,i,s){return s.dataType="jsonp",s.jsonpCallback="shortUrlCallback",s.jsonp="callback",s.cache=!0,s.data={url:this.currentUrlRequest},t.sync(e,i,s)},parse:function(e){return{url:this.currentUrlRequest,shortUrl:e.payload?e.payload.short_url:""}},addCurrentPage:function(){var t,i=this.pageManager.getCanonical();t="1"===this.pageManager.getUrlParam("rico")&&"undefined"!=typeof this.pageManager.getUrlParam("share_url")?this.pageManager.getUrlParam("share_url"):e("#masthead").find(".story-short-url").text(),i&&t&&this.add({url:i,shortUrl:t})},getRicoUrl:function(e){var t=this.pageManager.getUrlParam("share_url"),i=document.createElement("a");return i.href=e,i.pathname===location.pathname&&t&&7===t.indexOf("r-i.co/")?t:void 0},requestUrl:function(e){var t,i=this.findWhere({url:e});return i?i.get("shortUrl"):(t=this.getRicoUrl(e))?t:(this.currentUrlRequest=e,void this.fetch())}});return s}),define("shared/sharetools/instances/short-url",["shared/sharetools/collections/short-url"],function(e){return new e}),define("shared/sharetools/helpers/sharetools-mixin",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/sharetools/templates","shared/ad/views/ads","shared/sharetools/views/email","shared/modal/views/modal","shared/sharetools/instances/cross-platform-save","foundation/models/page-storage","foundation/hosts","foundation/models/user-data","shared/sharetools/helpers/sharetools-config","shared/sharetools/instances/short-url"],function(e,t,i,s,n,a,o,r,l,d,h,c,u){var m={getDataAttrs:function(e,i){var s,n=i||this.$el.data(),a=(n.shares||c.common[e?"defaultShowAllShares":"defaultActiveShares"]).split(","),o=[],r=c.common.hasAd;e&&(c.common.defaultUrl.indexOf("aponline")>-1||c.common.defaultUrl.indexOf("reuters")>-1)&&(a=t.without(a,"reprints|Reprints"));for(var l=0,d=a.length;d>l;l+=1)a[l].indexOf("|")>0?(s=a[l].split("|"),o.push({type:s[0],label:s[1]})):"ad"===a[l]?r=!0:o.push({type:a[l],label:a[l]});return c.tools.reprints.urlParameters.publicationDate=n.publishDate,t.extend({},{inlineTools:o,ad:r,url:c.common.defaultUrl,title:c.common.defaultTitle,description:c.common.defaultDescription},n)},setUpConfigOptions:function(){c.common.defaultTitle=this.pageManager.getMeta("og:title")||document.title,c.common.defaultDescription=this.pageManager.getMeta("description")||""},isMobileSharetools:function(){return this.pageManager.getCurrentBreakpoint()<1e3},openMailToLink:function(){var e="%0A%0A",t=encodeURIComponent(this.settings.title),i=encodeURIComponent(this.settings.description),s=encodeURIComponent(this.settings.url),n="NYTimes.com: "+t,a="From The New York Times:"+e+t+e+i+e+s;window.location="mailto:?subject="+n+"&body="+a},handleShortUrlShareAction:function(t,i){var s,n=this,a=window.open("",t.label+"Share","toolbar=0,status=0,height="+t.height+",width="+t.width+",scrollbars=yes,resizable=yes"),o=i||this.settings.url,r=this.createAnchor(o);t.smid&&(r.search+=0===r.search.indexOf("?")?"&":"?",r.search+="smid="+t.smid,o=r.href),s=u.requestUrl(o)||"",s?this.shortUrlRedirect(s,t,a):this.listenToOnce(u,"add",function(){var e=u.findWhere({url:o});e&&n.shortUrlRedirect(e.get("shortUrl"),t,a)}),navigator.userAgent.match(/iPad/i)&&navigator.userAgent.match(/Safari/i)&&this.shortUrlRedirect(e("#masthead").find(".story-short-url").text(),t,a)},shortUrlRedirect:function(i,s,n){var a,o,r=[],l=t.extend({},this.settings);if(s.shareParameters&&l){var d=this.getTrackingParam();d&&(s.shareParameters.smv=d,l.smv=null),e.each(s.shareParameters,function(e,t){a="url"===e?i:l[e],a?r.push(t+"="+encodeURIComponent(a)):null===a&&r.push(t)})}r=r.join("&"),o=s.postUrl+this.paramChar(s.postUrl)+r,this.shoveUrlToNewWindow(o,n)},shoveUrlToNewWindow:function(e,t){t.document.location=e,t.document.close()},itemSaved:function(){l.get("sharetools_hasSaves")!==!0?(this.firstTimeSaveModal(),l.set("sharetools_hasSaves",!0)):this.growlSaveModal()},growlSaveModal:function(){var e=new o({id:"save-item-growl-modal",modalTitle:'<i class="icon"></i>Saved',tailDirection:"centered",openCallback:function(){window.setTimeout(this.removeFromPage,2e3)}}).addToPage();t.defer(e.open)},firstTimeSaveModal:function(){var e=new o({id:"save-item-modal",modalTitle:'<i class="icon"></i>Saved',modalContent:s.savemodal({link:d.www+"/saved"}),hasOverlay:!0,hasCloseButton:!0,tailDirection:"centered",closeCallback:function(){this.removeFromPage()}}).addToPage();t.defer(e.open)},saveAction:function(){var e=r.where({url:this.settings.url});return h.isLoggedIn()?void(0===e.length?(this.subscribeOnce(r,"nyt:xps-saved",this.itemSaved),r.save(this.settings.url)):this.growlSaveModal()):!0},paramChar:function(e){return-1!==e.indexOf("?")?"&":"?"},buildUrl:function(i,s){var n,a,o=c.tools[i],r=[],l=o.postUrl,d=t.extend({},s||this.settings),h=this.getTrackingParam();if(h&&(o.urlParameters=o.urlParameters||{},o.urlParameters[h]=null),n=u.getRicoUrl(d.url),n&&"email"!==i&&(d.url=n),a=this.createAnchor(d.url),o.smid&&(a.search+=0===a.search.indexOf("?")?"&":"?",a.search+="smid="+o.smid,d.url=a.href),o.shareParameters&&d){var m;e.each(o.shareParameters,function(e,t){m=d[e],r.push(t+"="+encodeURIComponent(m))})}return o.urlParameters&&e.each(o.urlParameters,function(e,t){r.push(null!==t?e+"="+encodeURIComponent(t):e)}),r=r.join("&"),l=l+this.paramChar(l)+r},popupShareAction:function(e,t){var i=c.tools[e],s=i.width?i.width:c.common.defaultWidth,n=i.height?i.height:c.common.defaultHeight,a=this.buildUrl(e,t);window.open(a,e+"Share","toolbar=0,status=0,height="+n+",width="+s+",scrollbars=yes,resizable=yes")},getTrackingParam:function(){var e=this.isUserVariant("articleSharetools"),t="smv"+e;return"string"==typeof e?t:void 0}};return m}),define("shared/sharetools/views/showall",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/ad/views/ads","shared/sharetools/templates","shared/sharetools/helpers/sharetools-config","shared/sharetools/helpers/sharetools-mixin","shared/sharetools/views/email","foundation/models/user-data","shared/sharetools/instances/short-url"],function(e,t,i,s,n,a,o,r,l,d,h){var c=i.extend(t.extend({},r,{events:{"click .sharetool":"handleLinkClick","click .short-url-input":"handleInputSelect"},className:"show-all-view-container",defaultModalSettings:{id:"show-all-sharetool-modal",modalTitle:"share",binding:".show-all-sharetool",tailDirection:"up",hasOverlay:!1,hasCloseButton:!1,positionTailSide:!1,autoPosition:!1,modalContent:"",tailLeftOffset:0,tailTopOffset:0,openCallback:function(){this.$target.addClass("active")},closeCallback:function(){this.$target.removeClass("active"),this.removeFromPage()}},articleTools:["save","print","reprints"],initialize:function(e,i){var s;t.bindAll(this,"handleShortUrl"),this.settings=t.extend({},this.getDataAttrs(!0,i)),this.modalSettings=t.extend({},this.defaultModalSettings,e),this.isMobileSharetools()&&(this.modalSettings=t.extend({},this.modalSettings,{tailDirection:"centered",hasCloseButton:!0,hasOverlay:!0,positionTailSide:!1,autoPosition:!1})),s=this.createAnchor(this.settings.url),s.search+=0===s.search.indexOf("?")?"&":"?",s.search+="smid=pl-share",this.settings.permalinkUrlWithSmid=s.href,this.settings.shortUrl=h.requestUrl(this.settings.permalinkUrlWithSmid)||"",this.settings.shortUrl||this.listenToOnce(h,"add",this.handleShortUrl),this.render(),this.trackingBaseData={module:"ShareTools",action:"click",contentCollection:this.pageManager.getMeta("article:section")}},render:function(){var e=this.settings.ad?"Frame6A":"";this.modalSettings.modalContent=a.showAllSharetoolModal(this.buildShareHTML()),this.showAllModal=new s(this.modalSettings),this.setElement(this.showAllModal.$modal),this.showAllModal.$modal.find(".show-all-sharetool-modal-ad").attr("id",e),this.showAllModal.addToPage(),this.settings.ad&&this.pageManager.getCurrentBreakpoint()>=1e3&&new n({positions:[e],scope:"modal",autoconfirm:0})},buildShareHTML:function(){for(var e,i=this.settings.inlineTools,s="",n="",r=0,l=i.length;l>r;r+=1)e=a.showallLinks({shareObj:i[r],config:o.tools[i[r].type]}),t.indexOf(this.articleTools,i[r].type)>=0?n+=e:s+=e;return{shortUrl:this.settings.shortUrl,showAllLinkList:s,showAllToolList:n}},handleShortUrl:function(){var e=h.findWhere({url:this.settings.permalinkUrlWithSmid});e&&(this.settings.shortUrl=e.get("shortUrl"),this.showAllModal.$modal.find(".short-url-input").val(this.settings.shortUrl))},handleInputSelect:function(e){e.target.select()},handleLinkClick:function(t){var i=e(t.target),s=i.data("share")||i.parent().data("share"),n="popup"===o.tools[s].postType?"popup":s;this.showAllModal.close();var a={version:this.settings.contentType||"Content",region:"ToolsMenu"};switch("save"===s||"reprints"===s||"print"===s?(a.module="ArticleTools",a.eventName="ArticleTool-"+s):a.eventName="Share-"+s,this.trackingTrigger("share-tools-click",a),n){case"email":this.isMobileSharetools()?this.openMailToLink():d.isLoggedIn()&&new l({dataUrl:this.settings.url});break;case"popup":"twitter"===s?this.handleShortUrlShareAction(o.tools[s]):this.popupShareAction(s);break;case"save":this.saveAction();break;case"reprints":this.popupShareAction(s);break;case"print":window.print()}}}));return c}),define("shared/sharetools/views/sharetools",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/sharetools/templates","shared/sharetools/views/email","shared/sharetools/views/showall","shared/sharetools/instances/cross-platform-save","foundation/models/user-data","shared/sharetools/helpers/sharetools-config","shared/sharetools/helpers/sharetools-mixin"],function(e,t,i,s,n,a,o,r,l,d){var h=i.registerView("sharetools").extend(t.extend({},d,{events:{"click .sharetool":"handleShareAction"},defaultModalData:{shares:"facebook|Share,email|Email,twitter|Tweet,linkedin|LinkedIn,google|Google+,reddit|Reddit,save|Save,reprints|Reprints,print|Print,ad"},initialize:function(e){0===this.$el.length||this.$el.hasClass("sharetools-init")||(this.settings=t.extend({},this.getDataAttrs(),e),this.modalSettings=t.extend({},e.showAllModalSettings),this.modalData=t.extend({},this.$el.data(),this.defaultModalData,e.showAllModalData),this.$el.addClass("sharetools"),this.setUpConfigOptions(),this.render(),this.trackingBaseData={module:"ShareTools",version:this.$el.data("content-type")||"Content",action:"click",contentCollection:this.pageManager.getMeta("article:section"),pgtype:this.pageManager.getMeta("PT")})},render:function(){var t,i=(this.$el.find(".middle-left-ad"),this.$el.find(".sharetools-inline-article-ad")),n=s.shareTools({shares:this.settings.inlineTools,config:l.tools});return this.$el.addClass("sharetools-init"),i.length>0?e(n).insertBefore(this.$el.find(".sharetools-inline-article-ad")):this.$el.append(n),this.settings.ad&&(t=this.pageManager.getCurrentBreakpoint()<=1020?"Position1":"Frame4A",this.$el.find(".sharetools-inline-article-ad").attr("id",t),this.broadcast("nyt:ads-new-placement",t)),this.runABTest(),this},handleShareAction:function(t){var i=e(t.target),s=i.data("share")||i.parent().data("share"),o="popup"===l.tools[s].postType?"popup":s,d=this.trackingBaseData;switch(i.parents(".video-player-region").size()>0?d.region="video-player-region":i.parents("#main").size()>0?d.region="Body":i.parents("#masthead").size()>0&&(d.region="TopBar"),"show-all"===s?d.eventName="Share-ShowAll":"save"===s||"reprints"===s||"print"===s?(d.module="ArticleTools",d.eventName="ArticleTool-"+s):d.eventName="Share-"+s,this.trackingTrigger("share-tools-click",d),o){case"email":this.isMobileSharetools()?this.openMailToLink():r.isLoggedIn()&&new n({dataUrl:this.settings.url});break;case"save":this.saveAction();break;case"popup":"twitter"===s?this.handleShortUrlShareAction(l.tools[s]):this.popupShareAction(s);break;case"show-all":new a(this.modalSettings,this.modalData)}},changeActiveState:function(){this.$(".show-all-sharetool").hasClass("active")?this.$(".show-all-sharetool").removeClass("active"):this.$(".show-all-sharetool").addClass("active")},runABTest:function(){var t="articleSharetools",i=this.isUserVariant(t),s=e(".sharetools .facebook-sharetool .sharetool-text"),n=e(".sharetools .twitter-sharetool .sharetool-text");("2"===i||"3"===i||"6"===i||"7"===i)&&("facebook"===s.text()&&s.text("share"),"twitter"===n.text()&&n.text("tweet")),("4"===i||"5"===i||"6"===i||"7"===i)&&e("#sharetools-masthead .show-all-sharetool .sharetool-text").text("More")}}));return h}),function(e,t){"function"==typeof define&&define.amd?define("shared/video/libs/countdown-timer",["jquery/nyt"],t):e.amdWeb=t(e.$)}(this,function(e){function t(t,i){this.timeout=1e3*t,this.interval=1e3*i||1e3,this.running=!1,this.startTime=0,this.ticks=0,this.pauseTime=0,this.runTime=0,this.intervalId=null,this.resumeId=null,this.active=!0,this.$emitter=e({}),this.tick=e.proxy(this.tick,this)}return t.prototype.start=function(){if(this.active){var e=this,t=0;this.pauseTime?(t=this.interval-this.runTime%this.interval,this.pauseTime=0,this.emit("resume")):this.emit("start"),this.running=!0,this.startTime=(new Date).getTime(),this.resumeId=setTimeout(function(){t>0&&e.tick(),e.running&&(e.intervalId=setInterval(e.tick,e.interval))},t)}},t.prototype.tick=function(){var e;this.ticks++,e=this.timeout-this.ticks*this.interval,0>=e?this.complete():this.emit({type:"tick",timeLeft:e/1e3})},t.prototype.on=function(e,t){this.$emitter.on(e,t)},t.prototype.emit=function(e,t){this.$emitter.trigger(e,t)},t.prototype.complete=function(){this.emit("complete"),this.stop()},t.prototype.stop=function(){clearInterval(this.intervalId),clearInterval(this.resumeId),this.emit("stop"),this.$emitter.off(),this.running=!1,this.startTime=0,this.pauseTime=0,this.runTime=0,this.ticks=0},t.prototype.pause=function(){this.running&&(clearInterval(this.intervalId),clearInterval(this.resumeId),this.emit("pause"),this.running=!1,this.pauseTime=(new Date).getTime(),this.runTime+=this.pauseTime-this.startTime)},t}),define("shared/video/views/video-end-card",["jquery/nyt","underscore/nyt","shared/video/templates","foundation/views/base-view","shared/video/models/playlist-videos","shared/video/models/playlist-metadata","shared/video/collections/video-thumbs","shared/video/views/video-thumb","shared/sharetools/views/sharetools","foundation/views/page-manager","shared/video/libs/countdown-timer"],function(e,t,i,s,n,a,o,r,l,d,h){var c=s.extend({initialize:function(e){t.bindAll(this,"processPlaylistVideos","processPlaylistVideosError","processPlaylistMetaData","processPlaylistMetaDataError","replayVideo","resumeVideo","onClickVideoOverlayHandler","onMouseEnterVideoOverlayHandler","onMouseLeaveVideoOverlayHandler","onThumbClicked","changeVideo","initializeAutoPlayCountdown","hideVideoEndCard","stopAutoPlayCountdown"),this.videoModel=this.model.videoModel,this.videoObject=this.model.videoObject,this.currentPlaylistIndex=this.model.currentPlaylistIndex,this.enableAutoPlayCountdown=e.enableAutoPlayCountdown,this.cachedPlaylist=this.model.cachedPlaylist,this.autoplayTimeout=this.model.autoplayTimeout,this.enableAutoPlayCountdown&&(this.countdown=new h(this.autoplayTimeout)),this.brightcoveApiTokenStaging="H6UlUdhFuVkQ7psHVaB6piV4wlUSGB2Cj7S9ltzknlI.",this.brightcoveApiTokenCurrent=this.pageManager.getMeta("video:publisherReadToken"),this.excludedAutoplayPlaylists=[1194812888716,0x5af310a56ca7],this.apiEnv="production",this.brightcoveApiTokenCurrent===this.brightcoveApiTokenStaging&&(this.excludedAutoplayPlaylists=[1194812888716,0x5af310a5dfd7],this.apiEnv="staging"),this.videoEndCardTemplate=i.videoEndCard,this.iconTextTemplate=i.videoEndCardIcon,this.iconTextReplayHTML=this.iconTextTemplate({iconText:"Replay Video"}),this.iconTextResumeHTML=this.iconTextTemplate({iconText:"Resume Video"}),this.$videoInnerContainer=this.model.videoInnerContainer,this.$videoEndCard=null,this.$videoEndCardThumbsContainer=null,this.$videoEndCardVideosSectionHeading=null,this.$videoEndCardVideosSectionHeadingLink=null,this.$videoEndCardVideosReplayButton=null,this.registerListeners(),this.getVideoData(),this.listenTo(this.videoModel,this.videoModel.videoEvents.KILL_VIDEO,this.onKill),this.listenTo(this.videoModel,this.videoModel.videoEvents.HIDE_VIDEO_END_CARD,this.hideVideoEndCard),this.listenTo(this.pageManager,"nyt:page-breakpoint",this.onBreakpoint)},registerListeners:function(){var e=this.videoModel.videoEvents;this.listenTo(this.pageManager,e.VIDEO_COMPLETE,this.onVideoComplete),this.listenTo(this.pageManager,e.PLAY_CLICKED,this.onVideoPlayClicked),this.listenTo(this.pageManager,e.VIDEO_PLAY,this.onVideoPlay),this.listenTo(this.pageManager,e.VIDEO_PAUSED,this.onVideoPaused),this.listenTo(this.pageManager,e.AD_START,this.onAdStart)},unregisterListeners:function(){var e=this.videoModel.videoEvents;this.stopListening(this.pageManager,e.VIDEO_COMPLETE,this.onVideoComplete),this.stopListening(this.pageManager,e.PLAY_CLICKED,this.onVideoPlayClicked),this.stopListening(this.pageManager,e.VIDEO_PLAY,this.onVideoPlay),this.stopListening(this.pageManager,e.VIDEO_PAUSED,this.onVideoPaused),this.stopListening(this.pageManager,e.AD_START,this.onAdStart)},onVideoComplete:function(e){e===this.videoModel.get("videoObject")&&this.showVideoEndCard(this.model.COMPLETE_STATE)},onVideoPlayClicked:function(e){e===this.videoModel.get("videoObject")&&(this.videoModel.isAdPlaying||this.videoObject.videoModule.isPlaying()||this.showVideoEndCard(this.model.PAUSE_STATE))},onVideoPaused:function(e){e===this.videoModel.get("videoObject")&&(this.videoModel.isAdPlaying||this.videoObject.isAdInitializing||this.showVideoEndCard(this.model.PAUSE_STATE))},onVideoPlay:function(e){e===this.videoModel.get("videoObject")&&this.hideVideoEndCard()},onAdStart:function(e){e===this.videoModel.get("videoObject")&&this.hideVideoEndCard()},getVideoData:function(){var e;this.videoObject&&this.videoObject.videoModule&&(e=this.videoObject.videoModule.getCurrentVideo(),e&&(e.customFields&&this.model.set("permalink",e.customFields.videourl),this.model.set("videoTitle",e.displayName),this.model.set("videoDescription",e.longDescription),this.model.set("videoStillImgUrl",e.videoStillURL),e.tags&&this.model.set("playlistId",this.getPlaylistId(e.tags))))},getPlaylistId:function(e){var t=/nytp_([^,]+)/.exec(e.join(","))[1];return parseInt(t,10)||1194811622182},showVideoEndCard:function(e){var t,i=this;if(t=e,!this.videoModel.isVideoFullscreen){if(!this.$videoEndCard){this.render(),this.$videoEndCard=this.$videoInnerContainer.find(".video-end-card"),this.$videoEndCardThumbsContainer=this.$videoEndCard.find(".video-end-card-thumbs"),this.$videoEndCardVideosSectionHeading=this.$videoEndCard.find(".video-end-card-section-heading"),this.$videoEndCardVideosSectionHeadingLink=this.$videoEndCardVideosSectionHeading.find("a");try{new l({el:this.$videoEndCard.find(".video-share"),showAllModalSettings:{hasOverlay:!0,tailDirection:"fixed",hasCloseButton:!0},showAllModalData:{shares:"facebook|Facebook,email|Email,twitter|Twitter,linkedin|LinkedIn,google|Google+,reddit|Reddit,save|Save,ad"}})}catch(s){this.$videoEndCard.find(".video-share").hide()}}this.$videoEndCard&&(this.onSetEndCardTemplateClass(this.videoModel.get("videoOuterContainer")),this.$videoEndCardVideosReplayButton=this.$videoEndCard.find(".video-end-card-play-button"),t===this.model.COMPLETE_STATE?this.$videoEndCardVideosReplayButton.removeClass("video-end-card-resume-button").html(this.iconTextReplayHTML).on("click",this.replayVideo):t===this.model.PAUSE_STATE&&this.$videoEndCardVideosReplayButton.addClass("video-end-card-resume-button").html(this.iconTextResumeHTML).on("click",this.resumeVideo),this.$videoEndCard.fadeIn(500),null===this.cachedPlaylist?(this.getVideoData(),this.fetchPlaylistVideos(function(){i.initializeAutoPlayCountdown(t)}),this.fetchPlaylistMetaData()):i.initializeAutoPlayCountdown(t),this.$videoEndCard.on("click",this.onClickVideoOverlayHandler),this.$videoEndCard.on("mouseenter",this.onMouseEnterVideoOverlayHandler),this.$videoEndCard.on("mouseleave",this.onMouseLeaveVideoOverlayHandler))}},onBreakpoint:function(){this.onSetEndCardTemplateClass(this.videoModel.get("videoOuterContainer"))},initializeAutoPlayCountdown:function(e){function t(e){o.text(e.timeLeft)}function i(){a.remove(),r.changeVideo(l.data("videoid"),l.data("index"),!1)}function s(){l.off("click",r.onThumbClicked),l.on("click",function(e){a.toggleClass("paused"),a.hasClass("paused")?r.countdown.pause():r.countdown.start(),e.stopPropagation(),e.preventDefault()})}function n(){l.off("click"),l.on("click",r.onThumbClicked),o.text(r.autoplayTimeout),a.addClass("off"),a.removeClass("paused")}if(this.enableAutoPlayCountdown&&e!==this.model.PAUSE_STATE&&-1===this.excludedAutoplayPlaylists.indexOf(this.model.get("playlistId"))){var a,o,r=this,l=this.$videoEndCard.find(".video-end-card-thumb.first a");a=this.$videoEndCard.find(".video-end-card-thumb.first .autoplayMeta"),o=a.find(".countdown span"),a.removeClass("off"),this.countdown.on("tick",t),this.countdown.on("complete",i),this.countdown.on("start",s),this.countdown.on("stop",n),this.countdown.start()}},stopAutoPlayCountdown:function(){this.enableAutoPlayCountdown&&this.countdown.stop()},onSetEndCardTemplateClass:function(e){var t=e,i="layout-large",s="layout-medium",n="layout-small";if(t&&this.$videoEndCard){var a=t.width();a>=720?this.$videoEndCard.removeClass("hidden").addClass(n).addClass(s).addClass(i):a>=600?this.$videoEndCard.removeClass("hidden").addClass(n).addClass(s).removeClass(i):a>=450?this.$videoEndCard.removeClass("hidden").addClass(n).removeClass(s).removeClass(i):this.$videoEndCard.addClass("hidden"),this.videoObject&&this.videoObject.videoModule&&this.videoObject.videoModule.isPlaying()&&this.hideVideoEndCard()}},onClickVideoOverlayHandler:function(t){var i=this.videoModel.clickableElements,s=i.join(", "),n=e(t.target).is(s);n||t.stopPropagation()},onMouseEnterVideoOverlayHandler:function(){this.$videoEndCardVideosReplayButton&&this.$videoEndCardVideosReplayButton.addClass("expand")},onMouseLeaveVideoOverlayHandler:function(){this.$videoEndCardVideosReplayButton&&this.$videoEndCardVideosReplayButton.removeClass("expand")},hideVideoEndCard:function(t,i){t=t||500,this.stopAutoPlayCountdown();var s;this.$videoEndCard&&this.$videoEndCard.is(":visible")&&(s=this,this.$videoEndCard.fadeOut(t,function(){e(this).hide(),s.$videoEndCardVideosReplayButton.off("click"),s.$videoEndCard.off("click"),i&&i()}))},fetchPlaylistVideos:function(e){this.model.playlistVideosDataModel||(this.model.playlistVideosDataModel=new n,this.model.playlistVideosDataModel.fetchData({reference_id:this.model.get("playlistId"),token:this.pageManager.getMeta("video:publisherReadToken")},this.processPlaylistVideos,this.processPlaylistVideosError,e))},processPlaylistVideos:function(t,i){var s,n,a,l,d,h,c,u;if(n=t.toJSON(),s=this,n)if(null===this.cachedPlaylist&&(this.cachedPlaylist=t),this.$videoEndCardThumbsContainer.empty(),n.videos){if(a=n.videos.length,this.currentPlaylistIndex>=a)return;for(l=0,this.videoThumbs=new o,c=this.videoModel.get("playerType"),h=this.currentPlaylistIndex;a>h;h++)if(d=n.videos[h],d.referenceId!==this.videoModel.get("videoId")){if(!(l<this.model.maxThumbs))break;u={itemIndex:l,itemOrdinal:0===l?"first":l===this.model.maxThumbs-1?"last":"",thumbLink:d.customFields.videourl,thumbImg:d.videoStillURL,thumbDesc:d.name,thumbVideoId:d.referenceId,thumbIndex:h,thumbAutoPlayRemainingTime:this.autoplayTimeout},this.videoThumbs.add(u),l+=1}this.currentPlaylistIndex=h,this.videoThumbs.each(function(t){var i=new r({model:t}),n=e(i.render()),a=parseInt(t.get("itemIndex"),10),o=250*a;s.$videoEndCardThumbsContainer.append(n),n.find("a").on("click",s.onThumbClicked),setTimeout(function(){n.addClass("fade-in")},o)}),i&&"function"==typeof i&&i()}else this.processPlaylistError()},onThumbClicked:function(t){t.preventDefault(),t.stopPropagation();var i=e(t.currentTarget),s=i.data("videoid"),n=i.data("index");this.changeVideo(s,n,!0)},changeVideo:function(e,t,i){var s=this;this.hideVideoEndCard(200,function(){s.currentPlaylistIndex=t+1,"function"==typeof s.videoObject.setUserInitiatedNext&&s.videoObject.setUserInitiatedNext(i),s.videoObject.videoModule.loadVideo(e,"referenceId"),s.processPlaylistVideos(s.cachedPlaylist)})},processPlaylistVideosError:function(){this.$videoEndCardThumbsContainer.empty(),this.$videoEndCardThumbsContainer.append('<p class="error">There was an error retrieving more videos.</p>')},fetchPlaylistMetaData:function(){this.model.playlistMetaDataModel||(this.model.playlistMetaDataModel=new a({apiEnv:this.apiEnv}),this.model.playlistMetaDataModel.getPlaylistMetaData(this.model.get("playlistId"),this.processPlaylistMetaData,this.processPlaylistMetaDataError))},processPlaylistMetaData:function(e){var t=e;t&&t.publish_url&&t.display_name&&(this.model.set("playlistUrl",["http://www.nytimes.com",t.publish_url].join("")),this.model.set("playlistDisplayName",t.display_name),this.$videoEndCardVideosSectionHeadingLink.attr("href",this.model.get("playlistUrl")).html("More in "+this.model.get("playlistDisplayName"))),this.$videoEndCardVideosSectionHeading.css({opacity:0}).removeClass("video-end-card-section-heading-loading").fadeTo(200,1)},processPlaylistMetaDataError:function(){this.$videoEndCardVideosSectionHeading.css({opacity:0}).removeClass("video-end-card-section-heading-loading").fadeTo(200,1)},replayVideo:function(){this.videoObject.videoModule.play(),this.hideVideoEndCard()},resumeVideo:function(){this.videoObject.videoModule.pause(!1),this.hideVideoEndCard()},render:function(){var e;return this.$videoEndCard||(this.$videoInnerContainer.find(".video-end-card").remove(),e=this.videoEndCardTemplate(this.model.toJSON()),this.$videoInnerContainer.append(e)),this},onKill:function(){this.stopListening(this.videoModel,this.videoModel.videoEvents.KILL_VIDEO,this.onKill),this.unregisterListeners(),this.$videoEndCard&&this.$videoEndCard.remove(),this.model.clear(),this.remove()}});return c}),define("shared/video/views/video",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/base-view","shared/video/models/video-end-card","shared/video/views/video-end-card","foundation/views/page-manager","shared/video/templates","shared/video/models/video"],function(e,t,i,s,n,a,o,r,l){var d=n.extend({initialize:function(){t.bindAll(this,"handleVideoFactoryLoad","onTemplateReady","onKillVideo","onVideoComplete","onVideoPlay","onPlayClicked","onVideoPaused","onAdStart","onAdComplete","onFullscreen","onExitFullscreen","onClickVideoHandler","onMediaChange");var e=this.model.get("videoId"),i=this.model.get("width"),s=this.model.get("height"),n=this.model.get("videoFigure"),a=this.model.get("pagePosition")||"position_embedded",o=this.model.get("autoStart")||!0,r=this.model.get("autoRender")||!0,d=this.model.get("playerType")||"article",h=this.model.get("adxAdPositions")||"VideoPlayerAd,ADX_CLIENTSIDE",c=(this.model.get("modal")||!1,"video_inner_"+a+"_"),u="video_outer_"+a+"_",m="player_"+a+"_",p=this.model.get("userInitiatedPlay")||!1,g=this.model.get("videoEmbedded")||!1,v=this.pageManager.getMeta("video:playerId")||this.model.get("playerId"),f=this.pageManager.getMeta("video:publisherId")||this.model.get("publisherId"),y=this.pageManager.getMeta("video:publisherReadToken")||this.model.get("publisherReadToken"),b=this.pageManager.getMeta("video:noShareToolsPlayerId")||this.model.get("noShareToolsPlayerId");
g&&b&&(v=b);var w=l.video,_=w({outerId:u+e,innerId:c+e});n.prepend(_),this.videoConfig={container:c+e,id:m+e,width:i,height:s,videoId:e,playerId:v,publisherId:f,publisherReadToken:y,autoStart:o,autoRender:r,playerType:d,adxAdPositions:h,userInitiatedPlay:p},require(["videoFactory","http://js.nyt.com/js2/build/video/libs/brightcove/BrightcoveExperiences_All.js"],this.handleVideoFactoryLoad)},handleVideoFactoryLoad:function(e){var t,i=this.model.get("videoId"),s=this.model.get("videoFigure"),n=s.find(".video-bind"),a=s.find(".video-container");this.video=e.create(this.videoConfig),this.video&&(this.model.set("videoObject",this.video),this.model.set("videoId",i),this.model.set("videoInnerContainer",a),this.model.set("videoOuterContainer",n),t=this.video.getSubscription(),t.subscribe("template_ready",this.onTemplateReady)),s.on("click",this.onClickVideoHandler)},onClickVideoHandler:function(t){var i=this.model.clickableElements,s=i.join(", "),n=e(t.target).is(s);n||t.stopPropagation()},createVideoEndCard:function(){this.videoEndCardModel=new a({videoModel:this.model}),this.videoEndCardView=new o({model:this.videoEndCardModel,enableAutoPlayCountdown:this.model.get("pagePosition")===this.model.playerPositions.POSITION_LEDE})},onTemplateReady:function(){this.registerVideoEvents(),this.model.get("videoEmbedded")||this.createVideoEndCard(),this.video&&this.broadcast(this.model.videoEvents.TEMPLATE_READY,this.video),this.listenTo(this.model,this.model.videoEvents.KILL_VIDEO,this.onKillVideo)},onKillVideo:function(){var e=this.model.get("videoObject"),t=this.model.get("videoFigure"),i=this.model.get("videoOuterContainer");this.stopListening(this.model,this.model.videoEvents.KILL_VIDEO,this.onKillVideo),this.unregisterVideoEvents(),e&&e.kill(),t.off("click"),i.remove(),t.remove(),this.remove()},registerVideoEvents:function(){var e,t,i;this.video&&(e=this.video.getSubscription(),e.subscribe("video_complete",this.onVideoComplete),e.subscribe("play",this.onVideoPlay),"html5"!==this.video.type&&(i=this.video.getModuleExperience(),i&&(t=i.getElementByID("playButton"),t&&t.addEventListener("elementClick",this.onPlayClicked))),e.subscribe("video_paused",this.onVideoPaused),e.subscribe("ad_start",this.onAdStart),e.subscribe("ad_complete",this.onAdComplete),e.subscribe("fullscreen",this.onFullscreen),e.subscribe("exit_fullscreen",this.onExitFullscreen),e.subscribe("media_change",this.onMediaChange))},unregisterVideoEvents:function(){var e,t,i;this.video&&(e=this.video.getSubscription(),e.cancel("template_ready",this.onTemplateReady),e.cancel("video_complete",this.onVideoComplete),e.cancel("play",this.onVideoPlay),"html5"!==this.video.type&&(i=this.video.getModuleExperience(),i&&(t=i.getElementByID("playButton"),t&&t.removeEventListener("elementClick",this.onPlayClicked))),e.cancel("video_paused",this.onVideoPaused),e.cancel("ad_start",this.onAdStart),e.cancel("ad_complete",this.onAdComplete),e.cancel("fullscreen",this.onFullscreen),e.cancel("exit_fullscreen",this.onExitFullscreen),e.cancel("media_change",this.onMediaChange))},onVideoComplete:function(){this.broadcast(this.model.videoEvents.VIDEO_COMPLETE,this.video)},onVideoPlay:function(){this.model.isAdPlaying=!1,this.broadcast(this.model.videoEvents.VIDEO_PLAY,this.video)},onPlayClicked:function(){this.broadcast(this.model.videoEvents.PLAY_CLICKED,this.video)},onVideoPaused:function(){this.broadcast(this.model.videoEvents.VIDEO_PAUSED,this.video)},onAdStart:function(){this.model.isAdPlaying=!0,this.broadcast(this.model.videoEvents.AD_START,this.video)},onAdComplete:function(){this.model.isAdPlaying=!1,this.broadcast(this.model.videoEvents.AD_COMPLETE,this.video)},onFullscreen:function(){this.model.isVideoFullscreen=!0,this.broadcast(this.model.videoEvents.VIDEO_FULLSCREEN,this.video)},onExitFullscreen:function(){this.model.isVideoFullscreen=!1,this.broadcast(this.model.videoEvents.VIDEO_EXIT_FULLSCREEN,this.video)},onMediaChange:function(){this.broadcast(this.model.videoEvents.MEDIA_CHANGE,this.video)}});return d}),define("shared/mediaviewer/templates",["underscore/nyt"],function(_){var templates={};return templates.bigAd3=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div id="BigAd3" class="ad big-ad3" style="display:none;"></div>';return __p},templates.continueButton=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="media-viewer-continue" style="display:none;">\n<span class="continue-text"> '+(null==(__t=message)?"":__t)+' </span>\n<div class="continue-arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</div>';return __p},templates.image=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<figure class="media-viewer-asset" style="visibility:hidden;">\n<img src="'+(null==(__t=src)?"":__t)+'" data-caption="" style="opacity:0;" />\n<nav class="image-navigation previous">\n<span class="visually-hidden">Go to previous slide</span>\n</nav>\n<nav class="image-navigation next">\n<span class="visually-hidden">Go to next slide</span>\n</nav>\n<figcaption class="caption" style="display:none;">\n<span class="caption-text">\n'+(null==(__t=caption)?"":__t)+'\n</span>\n<span class="credit">\n'+(null==(__t=credit)?"":__t)+"\n</span>\n</figcaption>\n</figure>";return __p},templates.mediaViewer=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<aside id="media-viewer" class="media-viewer" style="display:none;">\n<button class="button close-button"><i class="icon"></i><span class="visually-hidden">Close this overlay</span></button>\n<h2 class="media-viewer-headline"></h2>\n<div class="media-viewer-wrapper"></div>\n<nav class="media-viewer-nav">\n<div class="media-viewer-counter"></div>\n<div class="media-viewer-previous">\n<span class="visually-hidden">Go to previous</span>\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n</div>\n<div class="media-viewer-next">\n<span class="visually-hidden">Go to next</span>\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</div></nav>\n<div class="loader-container" style="display:none;">\n<div class="loader"><span class="visually-hidden">Loading...</span></div>\n</div>\n</aside>';return __p},templates.mediaViewerIcon=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="'+(null==(__t=classes)?"":__t)+'">\n<i class="icon"></i>\n</div>';return __p},templates.video=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<figure class="media-viewer-asset media-viewer-video media video" data-videoId="'+(null==(__t=videoId)?"":__t)+'" style="visibility:hidden;">\n<figcaption class="caption">\n<span class="credit">\n'+(null==(__t=credit)?"":__t)+"\n</span>\n</figcaption>\n</figure>";return __p},templates}),define("shared/mediaviewer/views/media-viewer",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/base-view","shared/mediaviewer/templates","shared/ad/views/ads"],function(e,t,i,s,n,a,o){var r=n.registerView("media-viewer").extend({templates:a,collection:new s,speed:400,assetIndex:0,stepsTaken:0,marginForImage:160,clickableElements:["img","nav div",".caption",".credit",".media-viewer-video",".video-share span",".video-share i.icon",".video-share a",".image-navigation"],candidateClass:"media-viewer-candidate",overlayClass:"media-action-overlay",slideshowClass:"slideshow.promo",isVideo:!1,videoId:0,contentType:"",$prevArrow:e(),$nextArrow:e(),settings:{minWidth:700,minHeight:550,topMargin:60,basicMargin:30,captionGutter:15,navGutter:45,captionRatio:.8,imageAspectRatio:1.3},events:{"click .media-viewer-previous":"prevAsset","click .media-viewer-next":"nextAsset","click .image-navigation.previous":"prevAsset","click .image-navigation.next":"nextAsset","click .media-viewer-asset img":"nextAsset",click:"decideClose","mouseenter .image-navigation.previous":"lightPrevArrow","mouseleave .image-navigation.previous":"unLightPrevArrow","mouseenter .image-navigation.next":"lightNextArrow","mouseleave .image-navigation.next":"unLightNextArrow"},nytEvents:{"nyt:page-key-esc":"forceClose","nyt:page-resize-after":"renderFromResize","nyt:mediaviewer-left":"prevAsset","nyt:mediaviewer-right":"nextAsset","nyt:open-media-viewer":"renderForEmbeddedSlideshow","nyt:route:slideshow":"initFromDeepLink"},initialize:function(){t.bindAll(this,"renderForSlideshow","renderFromSymbol","renderFromClick","writeVideoTemplateToViewer","nextAsset","prevAsset","pinchClose"),this.pageManager.addRoute("slideshow/:slideshowId(/:imageId)","slideshow"),this.setElement(this.templates.mediaViewer()),this.subscribe("nyt:slideshow-ad-render",this.renderSlideshowAd)},handleDomReady:function(){this.$body.on("click","."+this.slideshowClass,this.renderForSlideshow).on("click","."+this.overlayClass,this.renderFromSymbol).on("click","."+this.candidateClass,this.renderFromClick),this.hammer&&(this.hammer(this.el).on("swiperight",this.prevAsset),this.hammer(this.el).on("swipeleft",this.nextAsset),this.hammer(this.el).on("pinch",this.pinchClose)),this.$candidates=e("."+this.candidateClass),this.$headline=this.$(".media-viewer-headline"),this.$wrapper=this.$(".media-viewer-wrapper"),this.$counter=this.$(".media-viewer-counter"),this.$nav=this.$(".media-viewer-nav"),this.$body.find("#main").append(this.$el),this.$prevArrow=this.$el.find(".media-viewer-previous"),this.$nextArrow=this.$el.find(".media-viewer-next"),this.addViewerIcon(),this.trackingBaseData={action:"click",contentCollection:this.pageManager.getMeta("article:section"),region:"Body"},this.pageManager.checkRoute()},initFromDeepLink:function(t){var i,s=t[0],n=t.length>1?parseInt(t[1],10):null,a=e("#slideshow-"+s);return a.size()>0?(this.getAssetsFromJSON(a),n&&(i=this.collection.findWhere({id:n})),"undefined"==typeof i&&(i=this.collection.at(0)),this.$el.addClass("theme-dark"),this.contentType="slideshow",this.assetIndex=this.collection.indexOf(i),void this.render(i)):void 0},addViewerIcon:function(){var t=this.templates.mediaViewerIcon({classes:this.overlayClass});this.$candidates.each(function(){e(this).after(t)})},getDimension:function(e,t,i,s){var n=this.pageManager.getViewport(),a=n.width-i,o=n.height-s;return e>a&&(t*=a/e,e=a),t>o&&(e*=o/t,t=o),{width:Math.round(e),height:Math.round(t)}},getAssetsFromJSON:function(i){var s,n,a=i.find("script").get(0).innerHTML,o=e.parseJSON(a),r=o.id;this.headline=o.headline,o=t.map(o.imageslideshow.slides,function(t){return t.caption.full?(s=e("<div>").html(t.caption.full),n=e(s).find("p").length>1?s:t.caption.full):n=e("<div>").html(t.caption.short),{id:t.data_id,src:t.image_crops.superJumbo.url,caption:e(n).html(),credit:t.credit}}),this.collection.reset(o),this.collection.slideshowId=r},getAssetsFromDOM:function(){var i,s=[];this.$candidates.each(function(){i={src:e(this).data("mediaviewer-src"),caption:e(this).data("mediaviewer-caption"),credit:e(this).data("mediaviewer-credit")},s.push(i)}),this.collection.reset(t.uniq(s,function(e){return e.src}))},broadcastAd:function(){var e="",t=0===this.assetIndex,i=this.collection.length,s=this.end();if(t&&!s)e="Slideshow_int";else{if(!(i>3&&s))return!1;e="Slideshow_end"}return this.broadcast("nyt:slideshow-ad",{el:this.$wrapper,position:e}),this.adRendered},renderSlideshowAd:function(t){if("slideshow"===this.contentType){var i=this,s=this.pageManager.getCurrentBreakpoint(),n=this.$wrapper.find(".ad-wrapper"),a=2*parseInt(n.css("padding-left"),10),o=parseInt(t.get("width"),10),r=parseInt(t.get("height"),10),l=e(this.templates.continueButton({message:this.end()?"RETURN TO ARTICLE":"CONTINUE SLIDE SHOW"}));this.$adBtn=l,n.append(l).css({width:o,height:r,"margin-left":-(o+a)/2,"margin-top":-(r+a)/2}),this.$nav.find(".media-viewer-previous").hide(),this.$counter.hide(),this.$headline.text(this.headline||""),this.adRendered=!0,this.toggleLoader(!1),this.start(),this.active(!0),l.show().on("click",function(e){e.stopPropagation(),e.preventDefault(),i.renderAfterAd()}),s>=1e3&&1030>s&&l.hide()}},renderAfterAd:function(){this.dismissAd(),this.render()},dismissAd:function(){this.$adBtn.off("click").hide(),this.$wrapper.html(""),this.$counter.show(),this.$nav.find(".media-viewer-previous").show(),this.adRendered=!1},renderForSlideshow:function(t){if(!e(t.target).hasClass("skip-to-text-link")){var i=e(t.currentTarget);this.assetIndex=0,this.$el.addClass("theme-dark"),this.getAssetsFromJSON(i),this.contentType="slideshow",this.render()}},renderForEmbeddedSlideshow:function(e,t){this.assetIndex=t,this.$el.addClass("theme-dark"),this.getAssetsFromJSON(e),this.contentType="embedded-slideshow",this.render()},renderFromSymbol:function(t){e(t.currentTarget).siblings("."+this.candidateClass).trigger("click")},renderFromResize:function(){if(!this.adRendered)if(this.isActive&&this.isVideo){var t=e("figure.media-viewer-video");this.handleVideo(t)}else this.isActive&&this.render()},renderFromClick:function(t){var i;this.getAssetsFromDOM(),i=this.collection.findWhere({src:e(t.target).data("mediaviewer-src")}),this.assetIndex=this.collection.indexOf(i),this.contentType="images",this.render(i)},renderForVideo:function(e,t){this.videoModel=e,this.videoCallback=t,this.$el.addClass("theme-dark"),this.isVideo=!0,this.render(e)},writeVideoTemplateToViewer:function(){var t=this.videoModel?this.videoModel.get("videoId"):this.videoId,i=this.$body.find("figure[data-videoid="+t+"] .video-credit"),s=e(this.templates.video({videoId:t,credit:i.html()}));this.handleVideo(s),this.$wrapper.html(s),this.pageManager.isMobile()?"function"==typeof this.videoCallback&&this.videoCallback():this.broadcast("nyt:mediaviewer-open")},render:function(e){var t=this;if(t.toggleLoader(!0),!this.broadcastAd()){if(this.isVideo)this.renderVideo();else{if(this.end())return t.toggleLoader(!1),void this.close(!0);this.renderImage(e)}return this.active(!0),this.$body.css("overflow","hidden"),this.$document.on("touchmove",function(e){e.preventDefault()}),this.setCounter(),this.toggleNav(),this}},renderVideo:function(){var e,t=this;this.pageManager.isMobile()?(this.start(),this.writeVideoTemplateToViewer()):this.start(this.writeVideoTemplateToViewer),t.toggleLoader(!1),e={module:"Video",version:"MediaViewer",eventName:"PlayVideo"},this.trackingTrigger("media-viewer-play-video",e),this.trackingComscorePVC(e)},renderImage:function(t){t=t||this.collection.at(this.assetIndex);var i,s,n,a=this,o=this.collection.slideshowId,r=t.get("id");if(this.isActive||(this.start(),this.$headline.text(this.headline||""),this.broadcast("nyt:mediaviewer-open"),n={module:this.getTrackingModule(),version:this.getTrackingVersion(),eventName:this.getTrackingOpenEventName(),mdata:{currentSlide:this.assetIndex+1,totalSlides:this.collection.length}},this.trackingTrigger("media-viewer-opened",n),this.trackingComscorePVC(n)),i=e(this.templates.image({src:t.get("src"),caption:t.get("caption"),credit:t.get("credit")})),s=e(this.templates.bigAd3()),i.find("img").load(function(){a.handleImg(i,s),a.toggleLoader(!1)}),o&&r){var l="slideshow/"+o+"/"+r;this.pageManager.navigateRoute(l,{trigger:!1,replace:!0})}this.$wrapper.html(i),this.$wrapper.append(s)},start:function(e){e=e||function(){},this.$el.fadeIn(this.speed,e)},toggleNav:function(){var e=this.$("nav");1===this.collection.length||this.isVideo?e.hide():e.show()},toggleLoader:function(e){var t=this.$el.find(".loader-container");e?t.show():t.hide()},handleImg:function(i,s){var n,a,o,r,l,d,h,c,u=this.settings,m=i.find("img"),p=i.find(".caption"),g=e("nav.media-viewer-nav"),v={},f=this.getElementDimensions(g),y=this.getElementDimensions(m),b=t.extend({},this.pageManager.getViewport()),w=b.width,_=this.$html.hasClass("tone-feature"),C=y.width/y.height,k=b.width/(b.height-f.height-u.topMargin-u.basicMargin),T=C>k?"below":"right";b.height=b.height<150?150:b.height,b.width=b.width<100?100:b.width,this.$headline.css({"margin-right":0}),w>=1280&&_&&"slideshow"===this.contentType&&(b.width=w-330,this.$headline.css({"margin-right":330}),this.loadBigAd(),s.show(),C>u.imageAspectRatio&&(T="below")),"right"===T?(h=this.getImageSizeAvailable(p,f,T,b),c=this.getCaptionSize(p,f,T),v=this.getScaledImage(y,h),a=h.width/h.height,a>C?(i.css({height:h.height,width:v.width}),p.css({left:v.width+u.captionGutter,width:c.width,height:c.height}),(b.width-2*u.basicMargin-v.width)/2>c.width?(r=Math.round((b.width-v.width)/2),i.css({left:r,top:u.topMargin}),s.css({"margin-top":u.topMargin}),o=r<2*(f.width+u.basicMargin),d=u.topMargin+h.height+u.navGutter+f.height+u.basicMargin>b.height,n=o&&d?f.height+u.navGutter+u.basicMargin:u.basicMargin,p.css({bottom:n,width:c.width})):(r=Math.round((b.width-(v.width+c.width))/2),i.css({left:r,top:u.topMargin}),s.css({"margin-top":u.topMargin}),p.css({bottom:u.basicMargin,width:c.width,height:c.height}))):(l=Math.round((b.height-v.height-u.topMargin)/2),l=Math.max(l,u.topMargin),r=Math.round((b.width-(h.width+c.width+u.captionGutter))/2),i.css({width:h.width,height:v.height,left:r,top:l}),s.css({"margin-top":l}),p.css({width:c.width,bottom:u.basicMargin,left:h.width+u.captionGutter}))):(c=this.getCaptionSize(p,f,T),h=this.getImageSizeAvailable(p,f,T,b),v=this.getScaledImage(y,h),a=h.width/h.height,a>C?(r=Math.round((b.width-v.width)/2),i.css({height:h.height,width:v.width,left:r,top:u.topMargin}),s.css({"margin-top":u.topMargin}),p.css({"max-width":550,width:h.width-f.width,"margin-settings.topMargin-top":u.captionGutter})):(r=Math.round((b.width-h.width)/2),l=Math.round((b.height-(v.height+c.height+u.captionGutter)-u.topMargin)/2),l=Math.max(l,u.topMargin),i.css({height:v.height,width:h.width,left:r,top:l}),s.css({"margin-top":l}),p.css({width:h.width,"margin-topmargin-top":u.captionGutter}))),i.css({visibility:"visible"}),s.css({width:300,height:250,"margin-left":30,"margin-right":30,"float":"right"}),p.css({display:"block",opacity:0}).animate({opacity:1},this.speed),m.animate({opacity:1},this.speed)},loadBigAd:t.debounce(function(){new o({positions:["BigAd3"],scope:"slideshow"})},100),getElementDimensions:function(e){return{width:e.width(),height:e.height()}},getScaledImage:function(e,t){return{width:Math.round(e.width/e.height*t.height),height:Math.round(e.height/e.width*t.width)}},getImageSizeAvailable:function(e,t,i,s){var n=this.getCaptionSize(e,t),a=this.settings,o=s.height-a.topMargin-a.basicMargin,r=s.width-2*a.basicMargin;return"right"===i?r-=n.width+a.captionGutter:"below"===i&&(o-=n.height+a.captionGutter),{width:r,height:o}},getCaptionSize:function(e,t,i){var s=this.getElementDimensions(e),n=this.settings;return s.width=Math.floor(Math.sqrt(s.width*s.height)),s.height=s.width,s.width=Math.max(s.width,t.width),"right"===i?(s.height=Math.round(s.height*(1/n.captionRatio)),s.width=Math.max(Math.round(s.width*n.captionRatio),t.width)):"below"===i&&(s.height=e.height(),s.width=Math.round(s.width*(1/n.captionRatio))),s},handleVideo:function(e){var t=this.pageManager.getViewport(),i=Math.round(t.width),s=Math.round(t.width*(9/16)),n=this.getDimension(i,s,0,70);e.css({visibility:"visible",width:n.width,height:n.height,"margin-left":-n.width/2,"margin-top":-(n.height/2-30),opacity:1})},lightPrevArrow:function(){this.unLightNextArrow(),this.$prevArrow.addClass("hover")},unLightPrevArrow:function(){this.$prevArrow.removeClass("hover")},lightNextArrow:function(){this.unLightPrevArrow(),this.$nextArrow.addClass("hover")},unLightNextArrow:function(){this.$nextArrow.removeClass("hover")},nextAsset:function(e){if(e&&(this.doClose="swipeleft"!==e.type),this.adRendered)return void this.renderAfterAd();this.moveIndex(1),this.render();var t=this.assetIndex+1,i={module:this.getTrackingModule(),version:this.getTrackingVersion(),eventName:"NextAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}};this.trackingTrigger("media-viewer-next-image",i),this.trackingComscorePVC(i)},prevAsset:function(e){e&&(this.doClose="swiperight"!==e.type),this.moveIndex(-1),this.render();var t=this.assetIndex+1,i={module:this.getTrackingModule(),version:this.getTrackingVersion(),eventName:"PrevAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}};this.trackingTrigger("media-viewer-prev-image",i),this.trackingComscorePVC(i)},moveIndex:function(e){var t=this.assetIndex,i=this.collection.length;t+=e,this.stepsTaken+=e,t===i?t=0:-1===t&&(t=i-1),this.assetIndex=t},setCounter:function(e,t){e=e||this.assetIndex,t=t||this.collection.length,this.$counter.html(e+1+" of "+t)},pinchClose:function(){this.close(!0)},decideClose:function(t){var i=this.clickableElements.join(", "),s=e(t.target).is(i);s||this.close(!0)},forceClose:function(){this.close(!0)},close:function(e){var t=this.$el;return this.isVideo&&(this.videoId=0,this.isVideo=!1),e&&(this.doClose=!0),this.doClose?(this.adRendered&&this.dismissAd(),this.active(!1),this.stepsTaken=0,this.assetIndex=0,this.destroyHeadline(),this.$body.css("overflow",""),this.$document.off("touchmove"),this.pageManager.clearRoute(),void this.$el.fadeOut(this.speed,function(){t.removeClass("theme-dark")})):void(this.doClose=!0)},destroyHeadline:function(){this.$headline.empty(),this.headline=null},end:function(){return Math.abs(this.stepsTaken)===this.collection.length},active:function(e){this.broadcast("nyt:mediaviewer-visibility",e),this.pageManager.setMeta("mediaviewer_isVisible",e),this.isActive=e},getTrackingModule:function(){var e="";return"images"===this.contentType?e="ImageViewer":("embedded-slideshow"===this.contentType||"slideshow"===this.contentType)&&(e="Slideshow"),e},getTrackingVersion:function(){var e="";return"slideshow"===this.contentType?e="MediaViewer-Promo":"embedded-slideshow"===this.contentType?e="MediaViewer-NonPromo":"images"===this.contentType&&(e="MediaViewer"),e},getTrackingOpenEventName:function(){return"images"===this.contentType?"OpenImageViewer":"OpenSlideshow"}});return r}),define("shared/mediaviewer/instances/media-viewer",["shared/mediaviewer/views/media-viewer"],function(e){return new e}),define("shared/video/views/embedded-videos",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/base-view","shared/video/models/video","shared/video/views/video","shared/mediaviewer/instances/media-viewer","foundation/views/page-manager"],function(e,t,i,s,n,a,o,r){var l=n.extend({className:"video",el:e("figure.video .image"),videos:new s,events:{click:"embedVideo"},modalVideoModel:null,defaultSettings:{posterSelector:".image",videoContainerSelector:"figure.video",posterPhotoCreditSelector:".photo-credit",posterVideoCreditSelector:".video-credit",minInlinePlayWidth:370},initialize:function(e){this.settings=t.extend({},this.defaultSettings,e),this.subscribe("nyt:mediaviewer-open",this.onMediaViewerOpen),t.bindAll(this,"onVideoMediaViewerOpen"),this.genericVideoModel=new a,this.pageManager.isMobile()||this.subscribe(this.genericVideoModel.videoEvents.MEDIA_CHANGE,this.onMediaChange),this.pageManager.isDomReady()?this.handlePageReady():this.subscribeOnce("nyt:page-ready",this.handlePageReady)},handlePageReady:function(){this.pageManager.isDesktop()&&this.checkForAutoplay()},checkForAutoplay:function(){var t,i,s,n,r,l,d,h,c=e("body").find("figure.video.lede").eq(0);c&&c.data("autoplay")===!0&&(s=c.find(this.settings.posterSelector),n=c.find(this.settings.posterPhotoCreditSelector),r=c.find(this.settings.posterVideoCreditSelector),c&&s&&(l=c.attr("data-videoid"),h=c.data("embedded")||!1,s.width()>=this.settings.minInlinePlayWidth&&l&&(d={videoId:l,videoFigure:c,autoStart:!0,width:"100%",height:"100%",modal:!1,pagePosition:this.genericVideoModel.playerPositions.POSITION_LEDE,playerType:"article-lede",userInitiatedPlay:!1,videoEmbedded:h},t=new a(d),s.hide(),i=new o({model:t}),this.videos.add(t))))},embedVideo:function(t){var i,s,n,l,d,h,c,u,m,p="100%",g="100%",v=this.genericVideoModel.playerPositions.POSITION_EMBEDDED,f=!1;return t&&(t.preventDefault(),this.$target=e(t.currentTarget),n=this.$target.closest(this.settings.videoContainerSelector),l=this.$target.closest(this.settings.posterSelector),c=n.find(this.settings.posterPhotoCreditSelector),u=n.find(this.settings.posterVideoCreditSelector),n&&(d=n.attr("data-videoid"),m=n.data("embedded")||!1,n.hasClass("lede")?v=this.genericVideoModel.playerPositions.POSITION_LEDE:n.hasClass("inline")?v=this.genericVideoModel.playerPositions.POSITION_INLINE:"photospot"===n.data("position")&&(v=this.genericVideoModel.playerPositions.POSITION_PHOTOSPOT),l.width()<this.settings.minInlinePlayWidth&&(f=!0),d&&(h={videoId:d,videoFigure:n,autoStart:!0,width:p,height:g,modal:f,pagePosition:v,userInitiatedPlay:!0,videoEmbedded:m},v===this.genericVideoModel.playerPositions.POSITION_INLINE||f?(h.playerType="article-modal",this.modalVideoModel=new a(h),this.pageManager.isMobile()||this.subscribeOnce("nyt:mediaviewer-open",this.onVideoMediaViewerOpen),r.renderForVideo(this.modalVideoModel,this.onVideoMediaViewerOpen)):(h.playerType=v===this.genericVideoModel.playerPositions.POSITION_LEDE?"article-lede":v===this.genericVideoModel.playerPositions.POSITION_PHOTOSPOT?"photospot":"article-embedded",i=new a(h),l.hide(),s=new o({model:i}),this.videos.add(i),this.pageManager.isMobile()&&this.primeVideoForMobile(i),this.trackClickVideo())))),this},trackClickVideo:function(){this.manualTrackEventTracker(),this.manualTrackWebTrends()},manualTrackEventTracker:function(){var e,t,i=window.NYTD||i||{};e={contentCollection:this.pageManager.getMeta("article:section"),pgtype:this.pageManager.getMeta("PT"),region:"Body",module:"Video",version:"Embedded",eventName:"PlayVideo",action:"click",eventtimestamp:(new Date).getTime()},t={subject:"module-interactions",moduleData:JSON.stringify(e),url:window.location.href||"",referrer:window.referrer||""},"function"==typeof i.EventTracker&&(this.tracker=new i.EventTracker,this.tracker.track(t))},manualTrackWebTrends:function(){var e=["DCS.dcssip","www.nytimes.com","DCS.dcsuri","/Video-Click-to-Play","WT.ti","Video Click to Play","WT.z_dcsm",1,"DCSext.module","Video","DCSext.version","Embedded","DCSext.action","click","DCSext.contentCollection",this.pageManager.getMeta("article:section"),"DCSext.region","Body","DCSext.eventName","PlayVideo","DCSext.pgtype",this.pageManager.getMeta("PT")];"function"==typeof window.dcsMultiTrack&&window.dcsMultiTrack.apply(this,e)},primeVideoForMobile:function(e){var t=e.get("videoObject");t&&"html5"===t.type&&t.object&&(t.object.play(),t.object.pause())},onVideoMediaViewerOpen:function(){var t,i=e("figure.media-viewer-video");i&&this.modalVideoModel&&(this.subscribeOnce("nyt:mediaviewer-close",this.onMediaViewerClose),this.modalVideoModel.set("videoFigure",i),t=new o({model:this.modalVideoModel}),this.pageManager.isMobile()&&this.primeVideoForMobile(this.modalVideoModel))},onMediaViewerClose:function(){this.modalVideoModel&&(this.modalVideoModel.kill(),this.modalVideoModel=null)},onMediaViewerOpen:function(){this.videos.each(function(e){e&&e.pause()})},onMediaChange:function(t){var i=e(t.container)||e(".video");i.closest("figure").find(".caption").animate({opacity:0})}});return l}),define("shared/video/instances/videos",["jquery/nyt","underscore/nyt","shared/video/views/embedded-videos"],function(e,t,i){var s=function(){var t=e("figure.video .image");t.length>0&&new i({el:t,posterSelector:".image",videoContainerSelector:"figure.video"})};e(document).ready(function(){t.defer(s)})}),define("shared/messaging/instances/push-notifications",["foundation/cookies"],function(e){var t,i=function(t){"default"===t.permission?window.safari.pushNotification.requestPermission("https://www.nytimes.com/svc/pushmobile","web.com.nytimes",null,i):"granted"===t.permission&&e.writeCookie("NYT-mavericks",t.deviceToken)};"safari"in window&&"pushNotification"in window.safari&&(t=window.safari.pushNotification.permission("web.com.nytimes"),i(t))}),require(["homepage/instances/ad-manager","shared/account/instances/account","shared/recommendations/instances/recommendations","homepage/instances/masthead","homepage/instances/messaging","homepage/instances/navigation","homepage/instances/inside-nyt","homepage/instances/embedded-slideshow","homepage/instances/classifieds-tabs","homepage/instances/homepage","homepage/instances/tracking","shared/video/instances/video-playlist","shared/video/instances/videos","shared/messaging/instances/push-notifications"]);
//# sourceMappingURL=main.js.map